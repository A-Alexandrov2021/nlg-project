function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _objectDestructuringEmpty(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function asyncGeneratorStep(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){asyncGeneratorStep(i,r,a,o,s,"next",e)}function s(e){asyncGeneratorStep(i,r,a,o,s,"throw",e)}o(void 0)}))}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(e,t,n){e.exports=n("zUnb")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},B9Yq:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},EVdn:function(e,t,n){var r;!function(t,n){"use strict";"object"==typeof e.exports?e.exports=t.document?n(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return n(e)}:n(t)}("undefined"!=typeof window?window:this,(function(n,a){"use strict";var i=[],o=Object.getPrototypeOf,s=i.slice,u=i.flat?function(e){return i.flat.call(e)}:function(e){return i.concat.apply([],e)},c=i.push,l=i.indexOf,h={},f=h.toString,d=h.hasOwnProperty,p=d.toString,v=p.call(Object),m={},g=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},b=n.document,k={type:!0,src:!0,nonce:!0,noModule:!0};function _(e,t,n){var r,a,i=(n=n||b).createElement("script");if(i.text=e,t)for(r in k)(a=t[r]||t.getAttribute&&t.getAttribute(r))&&i.setAttribute(r,a);n.head.appendChild(i).parentNode.removeChild(i)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[f.call(e)]||"object":typeof e}var x=function e(t,n){return new e.fn.init(t,n)};function C(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!g(e)&&!y(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}x.fn=x.prototype={jquery:"3.5.1",constructor:x,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return x.each(this,e)},map:function(e){return this.pushStack(x.map(this,(function(t,n){return e.call(t,n,t)})))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(x.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(x.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:c,sort:i.sort,splice:i.splice},x.extend=x.fn.extend=function(){var e,t,n,r,a,i,o=arguments[0]||{},s=1,u=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[s]||{},s++),"object"==typeof o||g(o)||(o={}),s===u&&(o=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&o!==r&&(c&&r&&(x.isPlainObject(r)||(a=Array.isArray(r)))?(n=o[t],i=a&&!Array.isArray(n)?[]:a||x.isPlainObject(n)?n:{},a=!1,o[t]=x.extend(c,i,r)):void 0!==r&&(o[t]=r));return o},x.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==f.call(e)||(t=o(e))&&("function"!=typeof(n=d.call(t,"constructor")&&t.constructor)||p.call(n)!==v))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){_(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(C(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(C(Object(e))?x.merge(n,"string"==typeof e?[e]:e):c.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:l.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,a=e.length;r<n;r++)e[a++]=t[r];return e.length=a,e},grep:function(e,t,n){for(var r=[],a=0,i=e.length,o=!n;a<i;a++)!t(e[a],a)!==o&&r.push(e[a]);return r},map:function(e,t,n){var r,a,i=0,o=[];if(C(e))for(r=e.length;i<r;i++)null!=(a=t(e[i],i,n))&&o.push(a);else for(i in e)null!=(a=t(e[i],i,n))&&o.push(a);return u(o)},guid:1,support:m}),"function"==typeof Symbol&&(x.fn[Symbol.iterator]=i[Symbol.iterator]),x.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){h["[object "+t+"]"]=t.toLowerCase()}));var S=function(e){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,k="sizzle"+1*new Date,_=e.document,w=0,x=0,C=ue(),S=ue(),T=ue(),E=ue(),A=function(e,t){return e===t&&(h=!0),0},I={}.hasOwnProperty,R=[],N=R.pop,O=R.push,D=R.push,F=R.slice,M=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="[\\x20\\t\\r\\n\\f]",z="(?:\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",B="\\["+P+"*("+z+")(?:"+P+"*([*^$|!~]?=)"+P+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+z+"))|)"+P+"*\\]",U=":("+z+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",W=new RegExp(P+"+","g"),V=new RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g"),j=new RegExp("^"+P+"*,"+P+"*"),H=new RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),q=new RegExp(P+"|>"),G=new RegExp(U),K=new RegExp("^"+z+"$"),X={ID:new RegExp("^#("+z+")"),CLASS:new RegExp("^\\.("+z+")"),TAG:new RegExp("^("+z+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+P+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ae=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},ie=function(){f()},oe=ke((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{D.apply(R=F.call(_.childNodes),_.childNodes)}catch(Se){D={apply:R.length?function(e,t){O.apply(e,F.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,a){var i,s,c,l,h,p,g,y=t&&t.ownerDocument,_=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==_&&9!==_&&11!==_)return r;if(!a&&(f(t),t=t||d,v)){if(11!==_&&(h=J.exec(e)))if(i=h[1]){if(9===_){if(!(c=t.getElementById(i)))return r;if(c.id===i)return r.push(c),r}else if(y&&(c=y.getElementById(i))&&b(t,c)&&c.id===i)return r.push(c),r}else{if(h[2])return D.apply(r,t.getElementsByTagName(e)),r;if((i=h[3])&&n.getElementsByClassName&&t.getElementsByClassName)return D.apply(r,t.getElementsByClassName(i)),r}if(n.qsa&&!E[e+" "]&&(!m||!m.test(e))&&(1!==_||"object"!==t.nodeName.toLowerCase())){if(g=e,y=t,1===_&&(q.test(e)||H.test(e))){for((y=ee.test(e)&&ge(t.parentNode)||t)===t&&n.scope||((l=t.getAttribute("id"))?l=l.replace(re,ae):t.setAttribute("id",l=k)),s=(p=o(e)).length;s--;)p[s]=(l?"#"+l:":scope")+" "+be(p[s]);g=p.join(",")}try{return D.apply(r,y.querySelectorAll(g)),r}catch(w){E(e,!0)}finally{l===k&&t.removeAttribute("id")}}}return u(e.replace(V,"$1"),t,r,a)}function ue(){var e=[];return function t(n,a){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=a}}function ce(e){return e[k]=!0,e}function le(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(Se){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function he(e,t){for(var n=e.split("|"),a=n.length;a--;)r.attrHandle[n[a]]=t}function fe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ve(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return ce((function(t){return t=+t,ce((function(n,r){for(var a,i=e([],n.length,t),o=i.length;o--;)n[a=i[o]]&&(n[a]=!(r[a]=n[a]))}))}))}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},i=se.isXML=function(e){var t=(e.ownerDocument||e).documentElement;return!Y.test(e.namespaceURI||t&&t.nodeName||"HTML")},f=se.setDocument=function(e){var t,a,o=e?e.ownerDocument||e:_;return o!=d&&9===o.nodeType&&o.documentElement?(p=(d=o).documentElement,v=!i(d),_!=d&&(a=d.defaultView)&&a.top!==a&&(a.addEventListener?a.addEventListener("unload",ie,!1):a.attachEvent&&a.attachEvent("onunload",ie)),n.scope=le((function(e){return p.appendChild(e).appendChild(d.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),n.attributes=le((function(e){return e.className="i",!e.getAttribute("className")})),n.getElementsByTagName=le((function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length})),n.getElementsByClassName=$.test(d.getElementsByClassName),n.getById=le((function(e){return p.appendChild(e).id=k,!d.getElementsByName||!d.getElementsByName(k).length})),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&v){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&v){var n,r,a,i=t.getElementById(e);if(i){if((n=i.getAttributeNode("id"))&&n.value===e)return[i];for(a=t.getElementsByName(e),r=0;i=a[r++];)if((n=i.getAttributeNode("id"))&&n.value===e)return[i]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],a=0,i=t.getElementsByTagName(e);if("*"===e){for(;n=i[a++];)1===n.nodeType&&r.push(n);return r}return i},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&v)return t.getElementsByClassName(e)},g=[],m=[],(n.qsa=$.test(d.querySelectorAll))&&(le((function(e){var t;p.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+P+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+P+"*(?:value|"+L+")"),e.querySelectorAll("[id~="+k+"-]").length||m.push("~="),(t=d.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+P+"*name"+P+"*="+P+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),le((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+P+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),p.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(n.matchesSelector=$.test(y=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&le((function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),g.push("!=",U)})),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=$.test(p.compareDocumentPosition),b=t||$.test(p.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},A=t?function(e,t){if(e===t)return h=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==d||e.ownerDocument==_&&b(_,e)?-1:t==d||t.ownerDocument==_&&b(_,t)?1:l?M(l,e)-M(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return h=!0,0;var n,r=0,a=e.parentNode,i=t.parentNode,o=[e],s=[t];if(!a||!i)return e==d?-1:t==d?1:a?-1:i?1:l?M(l,e)-M(l,t):0;if(a===i)return fe(e,t);for(n=e;n=n.parentNode;)o.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;o[r]===s[r];)r++;return r?fe(o[r],s[r]):o[r]==_?-1:s[r]==_?1:0},d):d},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(f(e),n.matchesSelector&&v&&!E[t+" "]&&(!g||!g.test(t))&&(!m||!m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(Se){E(t,!0)}return se(t,d,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=d&&f(e),b(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=d&&f(e);var a=r.attrHandle[t.toLowerCase()],i=a&&I.call(r.attrHandle,t.toLowerCase())?a(e,t,!v):void 0;return void 0!==i?i:n.attributes||!v?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},se.escape=function(e){return(e+"").replace(re,ae)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],a=0,i=0;if(h=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(A),h){for(;t=e[i++];)t===e[i]&&(a=r.push(i));for(;a--;)e.splice(r[a],1)}return l=null,e},a=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=a(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=a(t);return n},(r=se.selectors={cacheLength:50,createPseudo:ce,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&G.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=new RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&C(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,n){return function(r){var a=se.attr(r,e);return null==a?"!="===t:!t||(a+="","="===t?a===n:"!="===t?a!==n:"^="===t?n&&0===a.indexOf(n):"*="===t?n&&a.indexOf(n)>-1:"$="===t?n&&a.slice(-n.length)===n:"~="===t?(" "+a.replace(W," ")+" ").indexOf(n)>-1:"|="===t&&(a===n||a.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,a){var i="nth"!==e.slice(0,3),o="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===a?function(e){return!!e.parentNode}:function(t,n,u){var c,l,h,f,d,p,v=i!==o?"nextSibling":"previousSibling",m=t.parentNode,g=s&&t.nodeName.toLowerCase(),y=!u&&!s,b=!1;if(m){if(i){for(;v;){for(f=t;f=f[v];)if(s?f.nodeName.toLowerCase()===g:1===f.nodeType)return!1;p=v="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?m.firstChild:m.lastChild],o&&y){for(b=(d=(c=(l=(h=(f=m)[k]||(f[k]={}))[f.uniqueID]||(h[f.uniqueID]={}))[e]||[])[0]===w&&c[1])&&c[2],f=d&&m.childNodes[d];f=++d&&f&&f[v]||(b=d=0)||p.pop();)if(1===f.nodeType&&++b&&f===t){l[e]=[w,d,b];break}}else if(y&&(b=d=(c=(l=(h=(f=t)[k]||(f[k]={}))[f.uniqueID]||(h[f.uniqueID]={}))[e]||[])[0]===w&&c[1]),!1===b)for(;(f=++d&&f&&f[v]||(b=d=0)||p.pop())&&((s?f.nodeName.toLowerCase()!==g:1!==f.nodeType)||!++b||(y&&((l=(h=f[k]||(f[k]={}))[f.uniqueID]||(h[f.uniqueID]={}))[e]=[w,b]),f!==t)););return(b-=a)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var n,a=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[k]?a(t):a.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ce((function(e,n){for(var r,i=a(e,t),o=i.length;o--;)e[r=M(e,i[o])]=!(n[r]=i[o])})):function(e){return a(e,0,n)}):a}},pseudos:{not:ce((function(e){var t=[],n=[],r=s(e.replace(V,"$1"));return r[k]?ce((function(e,t,n,a){for(var i,o=r(e,null,a,[]),s=e.length;s--;)(i=o[s])&&(e[s]=!(t[s]=i))})):function(e,a,i){return t[0]=e,r(t,null,i,n),t[0]=null,!n.pop()}})),has:ce((function(e){return function(t){return se(e,t).length>0}})),contains:ce((function(e){return e=e.replace(te,ne),function(t){return(t.textContent||a(t)).indexOf(e)>-1}})),lang:ce((function(e){return K.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ve(!1),disabled:ve(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Z.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,n){return[n<0?n+t:n]})),even:me((function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e})),odd:me((function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e})),lt:me((function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e})),gt:me((function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e}))}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pe(t);function ye(){}function be(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function ke(e,t,n){var r=t.dir,a=t.next,i=a||r,o=n&&"parentNode"===i,s=x++;return t.first?function(t,n,a){for(;t=t[r];)if(1===t.nodeType||o)return e(t,n,a);return!1}:function(t,n,u){var c,l,h,f=[w,s];if(u){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||o)if(l=(h=t[k]||(t[k]={}))[t.uniqueID]||(h[t.uniqueID]={}),a&&a===t.nodeName.toLowerCase())t=t[r]||t;else{if((c=l[i])&&c[0]===w&&c[1]===s)return f[2]=c[2];if(l[i]=f,f[2]=e(t,n,u))return!0}return!1}}function _e(e){return e.length>1?function(t,n,r){for(var a=e.length;a--;)if(!e[a](t,n,r))return!1;return!0}:e[0]}function we(e,t,n,r,a){for(var i,o=[],s=0,u=e.length,c=null!=t;s<u;s++)(i=e[s])&&(n&&!n(i,r,a)||(o.push(i),c&&t.push(s)));return o}function xe(e,t,n,r,a,i){return r&&!r[k]&&(r=xe(r)),a&&!a[k]&&(a=xe(a,i)),ce((function(i,o,s,u){var c,l,h,f=[],d=[],p=o.length,v=i||function(e,t,n){for(var r=0,a=t.length;r<a;r++)se(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),m=!e||!i&&t?v:we(v,f,e,s,u),g=n?a||(i?e:p||r)?[]:o:m;if(n&&n(m,g,s,u),r)for(c=we(g,d),r(c,[],s,u),l=c.length;l--;)(h=c[l])&&(g[d[l]]=!(m[d[l]]=h));if(i){if(a||e){if(a){for(c=[],l=g.length;l--;)(h=g[l])&&c.push(m[l]=h);a(null,g=[],c,u)}for(l=g.length;l--;)(h=g[l])&&(c=a?M(i,h):f[l])>-1&&(i[c]=!(o[c]=h))}}else g=we(g===o?g.splice(p,g.length):g),a?a(null,o,g,u):D.apply(o,g)}))}function Ce(e){for(var t,n,a,i=e.length,o=r.relative[e[0].type],s=o||r.relative[" "],u=o?1:0,l=ke((function(e){return e===t}),s,!0),h=ke((function(e){return M(t,e)>-1}),s,!0),f=[function(e,n,r){var a=!o&&(r||n!==c)||((t=n).nodeType?l(e,n,r):h(e,n,r));return t=null,a}];u<i;u++)if(n=r.relative[e[u].type])f=[ke(_e(f),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[k]){for(a=++u;a<i&&!r.relative[e[a].type];a++);return xe(u>1&&_e(f),u>1&&be(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(V,"$1"),n,u<a&&Ce(e.slice(u,a)),a<i&&Ce(e=e.slice(a)),a<i&&be(e))}f.push(n)}return _e(f)}return ye.prototype=r.filters=r.pseudos,r.setFilters=new ye,o=se.tokenize=function(e,t){var n,a,i,o,s,u,c,l=S[e+" "];if(l)return t?0:l.slice(0);for(s=e,u=[],c=r.preFilter;s;){for(o in n&&!(a=j.exec(s))||(a&&(s=s.slice(a[0].length)||s),u.push(i=[])),n=!1,(a=H.exec(s))&&(n=a.shift(),i.push({value:n,type:a[0].replace(V," ")}),s=s.slice(n.length)),r.filter)!(a=X[o].exec(s))||c[o]&&!(a=c[o](a))||(n=a.shift(),i.push({value:n,type:o,matches:a}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):S(e,u).slice(0)},s=se.compile=function(e,t){var n,a=[],i=[],s=T[e+" "];if(!s){for(t||(t=o(e)),n=t.length;n--;)(s=Ce(t[n]))[k]?a.push(s):i.push(s);(s=T(e,function(e,t){var n=t.length>0,a=e.length>0,i=function(i,o,s,u,l){var h,p,m,g=0,y="0",b=i&&[],k=[],_=c,x=i||a&&r.find.TAG("*",l),C=w+=null==_?1:Math.random()||.1,S=x.length;for(l&&(c=o==d||o||l);y!==S&&null!=(h=x[y]);y++){if(a&&h){for(p=0,o||h.ownerDocument==d||(f(h),s=!v);m=e[p++];)if(m(h,o||d,s)){u.push(h);break}l&&(w=C)}n&&((h=!m&&h)&&g--,i&&b.push(h))}if(g+=y,n&&y!==g){for(p=0;m=t[p++];)m(b,k,o,s);if(i){if(g>0)for(;y--;)b[y]||k[y]||(k[y]=N.call(u));k=we(k)}D.apply(u,k),l&&!i&&k.length>0&&g+t.length>1&&se.uniqueSort(u)}return l&&(w=C,c=_),b};return n?ce(i):i}(i,a))).selector=e}return s},u=se.select=function(e,t,n,a){var i,u,c,l,h,f="function"==typeof e&&e,d=!a&&o(e=f.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(c=u[0]).type&&9===t.nodeType&&v&&r.relative[u[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(te,ne),t)||[])[0]))return n;f&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(i=X.needsContext.test(e)?0:u.length;i--&&!r.relative[l=(c=u[i]).type];)if((h=r.find[l])&&(a=h(c.matches[0].replace(te,ne),ee.test(u[0].type)&&ge(t.parentNode)||t))){if(u.splice(i,1),!(e=a.length&&be(u)))return D.apply(n,a),n;break}}return(f||s(e,d))(a,t,!v,n,!t||ee.test(e)&&ge(t.parentNode)||t),n},n.sortStable=k.split("").sort(A).join("")===k,n.detectDuplicates=!!h,f(),n.sortDetached=le((function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))})),le((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||he("type|href|height|width",(function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),n.attributes&&le((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||he("value",(function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),le((function(e){return null==e.getAttribute("disabled")}))||he(L,(function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null})),se}(n);x.find=S,(x.expr=S.selectors)[":"]=x.expr.pseudos,x.uniqueSort=x.unique=S.uniqueSort,x.text=S.getText,x.isXMLDoc=S.isXML,x.contains=S.contains,x.escapeSelector=S.escape;var T=function(e,t,n){for(var r=[],a=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&x(e).is(n))break;r.push(e)}return r},E=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},A=x.expr.match.needsContext;function I(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var R=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function N(e,t,n){return g(t)?x.grep(e,(function(e,r){return!!t.call(e,r,e)!==n})):t.nodeType?x.grep(e,(function(e){return e===t!==n})):"string"!=typeof t?x.grep(e,(function(e){return l.call(t,e)>-1!==n})):x.filter(t,e,n)}x.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,(function(e){return 1===e.nodeType})))},x.fn.extend({find:function(e){var t,n,r=this.length,a=this;if("string"!=typeof e)return this.pushStack(x(e).filter((function(){for(t=0;t<r;t++)if(x.contains(a[t],this))return!0})));for(n=this.pushStack([]),t=0;t<r;t++)x.find(e,a[t],n);return r>1?x.uniqueSort(n):n},filter:function(e){return this.pushStack(N(this,e||[],!1))},not:function(e){return this.pushStack(N(this,e||[],!0))},is:function(e){return!!N(this,"string"==typeof e&&A.test(e)?x(e):e||[],!1).length}});var O,D=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(x.fn.init=function(e,t,n){var r,a;if(!e)return this;if(n=n||O,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:D.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(x.merge(this,x.parseHTML(r[1],(t=t instanceof x?t[0]:t)&&t.nodeType?t.ownerDocument||t:b,!0)),R.test(r[1])&&x.isPlainObject(t))for(r in t)g(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(a=b.getElementById(r[2]))&&(this[0]=a,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==n.ready?n.ready(e):e(x):x.makeArray(e,this)}).prototype=x.fn,O=x(b);var F=/^(?:parents|prev(?:Until|All))/,M={children:!0,contents:!0,next:!0,prev:!0};function L(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}x.fn.extend({has:function(e){var t=x(e,this),n=t.length;return this.filter((function(){for(var e=0;e<n;e++)if(x.contains(this,t[e]))return!0}))},closest:function(e,t){var n,r=0,a=this.length,i=[],o="string"!=typeof e&&x(e);if(!A.test(e))for(;r<a;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){i.push(n);break}return this.pushStack(i.length>1?x.uniqueSort(i):i)},index:function(e){return e?"string"==typeof e?l.call(x(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(x.uniqueSort(x.merge(this.get(),x(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return T(e,"parentNode")},parentsUntil:function(e,t,n){return T(e,"parentNode",n)},next:function(e){return L(e,"nextSibling")},prev:function(e){return L(e,"previousSibling")},nextAll:function(e){return T(e,"nextSibling")},prevAll:function(e){return T(e,"previousSibling")},nextUntil:function(e,t,n){return T(e,"nextSibling",n)},prevUntil:function(e,t,n){return T(e,"previousSibling",n)},siblings:function(e){return E((e.parentNode||{}).firstChild,e)},children:function(e){return E(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(I(e,"template")&&(e=e.content||e),x.merge([],e.childNodes))}},(function(e,t){x.fn[e]=function(n,r){var a=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(a=x.filter(r,a)),this.length>1&&(M[e]||x.uniqueSort(a),F.test(e)&&a.reverse()),this.pushStack(a)}}));var P=/[^\x20\t\r\n\f]+/g;function z(e){return e}function B(e){throw e}function U(e,t,n,r){var a;try{e&&g(a=e.promise)?a.call(e).done(t).fail(n):e&&g(a=e.then)?a.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}x.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return x.each(e.match(P)||[],(function(e,n){t[n]=!0})),t}(e):x.extend({},e);var t,n,r,a,i=[],o=[],s=-1,u=function(){for(a=a||e.once,r=t=!0;o.length;s=-1)for(n=o.shift();++s<i.length;)!1===i[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=i.length,n=!1);e.memory||(n=!1),t=!1,a&&(i=n?[]:"")},c={add:function(){return i&&(n&&!t&&(s=i.length-1,o.push(n)),function t(n){x.each(n,(function(n,r){g(r)?e.unique&&c.has(r)||i.push(r):r&&r.length&&"string"!==w(r)&&t(r)}))}(arguments),n&&!t&&u()),this},remove:function(){return x.each(arguments,(function(e,t){for(var n;(n=x.inArray(t,i,n))>-1;)i.splice(n,1),n<=s&&s--})),this},has:function(e){return e?x.inArray(e,i)>-1:i.length>0},empty:function(){return i&&(i=[]),this},disable:function(){return a=o=[],i=n="",this},disabled:function(){return!i},lock:function(){return a=o=[],n||t||(i=n=""),this},locked:function(){return!!a},fireWith:function(e,n){return a||(n=[e,(n=n||[]).slice?n.slice():n],o.push(n),t||u()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},x.extend({Deferred:function(e){var t=[["notify","progress",x.Callbacks("memory"),x.Callbacks("memory"),2],["resolve","done",x.Callbacks("once memory"),x.Callbacks("once memory"),0,"resolved"],["reject","fail",x.Callbacks("once memory"),x.Callbacks("once memory"),1,"rejected"]],r="pending",a={state:function(){return r},always:function(){return i.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var e=arguments;return x.Deferred((function(n){x.each(t,(function(t,r){var a=g(e[r[4]])&&e[r[4]];i[r[1]]((function(){var e=a&&a.apply(this,arguments);e&&g(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[r[0]+"With"](this,a?[e]:arguments)}))})),e=null})).promise()},then:function(e,r,a){var i=0;function o(e,t,r,a){return function(){var s=this,u=arguments,c=function(){var n,c;if(!(e<i)){if((n=r.apply(s,u))===t.promise())throw new TypeError("Thenable self-resolution");g(c=n&&("object"==typeof n||"function"==typeof n)&&n.then)?a?c.call(n,o(i,t,z,a),o(i,t,B,a)):(i++,c.call(n,o(i,t,z,a),o(i,t,B,a),o(i,t,z,t.notifyWith))):(r!==z&&(s=void 0,u=[n]),(a||t.resolveWith)(s,u))}},l=a?c:function(){try{c()}catch(n){x.Deferred.exceptionHook&&x.Deferred.exceptionHook(n,l.stackTrace),e+1>=i&&(r!==B&&(s=void 0,u=[n]),t.rejectWith(s,u))}};e?l():(x.Deferred.getStackHook&&(l.stackTrace=x.Deferred.getStackHook()),n.setTimeout(l))}}return x.Deferred((function(n){t[0][3].add(o(0,n,g(a)?a:z,n.notifyWith)),t[1][3].add(o(0,n,g(e)?e:z)),t[2][3].add(o(0,n,g(r)?r:B))})).promise()},promise:function(e){return null!=e?x.extend(e,a):a}},i={};return x.each(t,(function(e,n){var o=n[2],s=n[5];a[n[1]]=o.add,s&&o.add((function(){r=s}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(n[3].fire),i[n[0]]=function(){return i[n[0]+"With"](this===i?void 0:this,arguments),this},i[n[0]+"With"]=o.fireWith})),a.promise(i),e&&e.call(i,i),i},when:function(e){var t=arguments.length,n=t,r=Array(n),a=s.call(arguments),i=x.Deferred(),o=function(e){return function(n){r[e]=this,a[e]=arguments.length>1?s.call(arguments):n,--t||i.resolveWith(r,a)}};if(t<=1&&(U(e,i.done(o(n)).resolve,i.reject,!t),"pending"===i.state()||g(a[n]&&a[n].then)))return i.then();for(;n--;)U(a[n],o(n),i.reject);return i.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;x.Deferred.exceptionHook=function(e,t){n.console&&n.console.warn&&e&&W.test(e.name)&&n.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},x.readyException=function(e){n.setTimeout((function(){throw e}))};var V=x.Deferred();function j(){b.removeEventListener("DOMContentLoaded",j),n.removeEventListener("load",j),x.ready()}x.fn.ready=function(e){return V.then(e).catch((function(e){x.readyException(e)})),this},x.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--x.readyWait:x.isReady)||(x.isReady=!0,!0!==e&&--x.readyWait>0||V.resolveWith(b,[x]))}}),x.ready.then=V.then,"complete"===b.readyState||"loading"!==b.readyState&&!b.documentElement.doScroll?n.setTimeout(x.ready):(b.addEventListener("DOMContentLoaded",j),n.addEventListener("load",j));var H=function e(t,n,r,a,i,o,s){var u=0,c=t.length,l=null==r;if("object"===w(r))for(u in i=!0,r)e(t,n,u,r[u],!0,o,s);else if(void 0!==a&&(i=!0,g(a)||(s=!0),l&&(s?(n.call(t,a),n=null):(l=n,n=function(e,t,n){return l.call(x(e),n)})),n))for(;u<c;u++)n(t[u],r,s?a:a.call(t[u],u,n(t[u],r)));return i?t:l?n.call(t):c?n(t[0],r):o},q=/^-ms-/,G=/-([a-z])/g;function K(e,t){return t.toUpperCase()}function X(e){return e.replace(q,"ms-").replace(G,K)}var Y=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Q(){this.expando=x.expando+Q.uid++}Q.uid=1,Q.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Y(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,a=this.cache(e);if("string"==typeof t)a[X(t)]=n;else for(r in t)a[X(r)]=t[r];return a},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||x.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!x.isEmptyObject(t)}};var Z=new Q,$=new Q,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:J.test(e)?JSON.parse(e):e)}(n)}catch(a){}$.set(e,t,n)}else n=void 0;return n}x.extend({hasData:function(e){return $.hasData(e)||Z.hasData(e)},data:function(e,t,n){return $.access(e,t,n)},removeData:function(e,t){$.remove(e,t)},_data:function(e,t,n){return Z.access(e,t,n)},_removeData:function(e,t){Z.remove(e,t)}}),x.fn.extend({data:function(e,t){var n,r,a,i=this[0],o=i&&i.attributes;if(void 0===e){if(this.length&&(a=$.get(i),1===i.nodeType&&!Z.get(i,"hasDataAttrs"))){for(n=o.length;n--;)o[n]&&0===(r=o[n].name).indexOf("data-")&&(r=X(r.slice(5)),te(i,r,a[r]));Z.set(i,"hasDataAttrs",!0)}return a}return"object"==typeof e?this.each((function(){$.set(this,e)})):H(this,(function(t){var n;if(i&&void 0===t)return void 0!==(n=$.get(i,e))||void 0!==(n=te(i,e))?n:void 0;this.each((function(){$.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){$.remove(this,e)}))}}),x.extend({queue:function(e,t,n){var r;if(e)return r=Z.get(e,t=(t||"fx")+"queue"),n&&(!r||Array.isArray(n)?r=Z.access(e,t,x.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){var n=x.queue(e,t=t||"fx"),r=n.length,a=n.shift(),i=x._queueHooks(e,t);"inprogress"===a&&(a=n.shift(),r--),a&&("fx"===t&&n.unshift("inprogress"),delete i.stop,a.call(e,(function(){x.dequeue(e,t)}),i)),!r&&i&&i.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Z.get(e,n)||Z.access(e,n,{empty:x.Callbacks("once memory").add((function(){Z.remove(e,[t+"queue",n])}))})}}),x.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?x.queue(this[0],e):void 0===t?this:this.each((function(){var n=x.queue(this,e,t);x._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&x.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){x.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,a=x.Deferred(),i=this,o=this.length,s=function(){--r||a.resolveWith(i,[i])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(n=Z.get(i[o],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),a.promise(t)}});var ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,re=new RegExp("^(?:([+-])=|)("+ne+")([a-z%]*)$","i"),ae=["Top","Right","Bottom","Left"],ie=b.documentElement,oe=function(e){return x.contains(e.ownerDocument,e)},se={composed:!0};ie.getRootNode&&(oe=function(e){return x.contains(e.ownerDocument,e)||e.getRootNode(se)===e.ownerDocument});var ue=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===x.css(e,"display")};function ce(e,t,n,r){var a,i,o=20,s=r?function(){return r.cur()}:function(){return x.css(e,t,"")},u=s(),c=n&&n[3]||(x.cssNumber[t]?"":"px"),l=e.nodeType&&(x.cssNumber[t]||"px"!==c&&+u)&&re.exec(x.css(e,t));if(l&&l[3]!==c){for(c=c||l[3],l=+(u/=2)||1;o--;)x.style(e,t,l+c),(1-i)*(1-(i=s()/u||.5))<=0&&(o=0),l/=i;x.style(e,t,(l*=2)+c),n=n||[]}return n&&(l=+l||+u||0,a=n[1]?l+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=l,r.end=a)),a}var le={};function he(e){var t,n=e.ownerDocument,r=e.nodeName,a=le[r];return a||(t=n.body.appendChild(n.createElement(r)),a=x.css(t,"display"),t.parentNode.removeChild(t),"none"===a&&(a="block"),le[r]=a,a)}function fe(e,t){for(var n,r,a=[],i=0,o=e.length;i<o;i++)(r=e[i]).style&&(n=r.style.display,t?("none"===n&&(a[i]=Z.get(r,"display")||null,a[i]||(r.style.display="")),""===r.style.display&&ue(r)&&(a[i]=he(r))):"none"!==n&&(a[i]="none",Z.set(r,"display",n)));for(i=0;i<o;i++)null!=a[i]&&(e[i].style.display=a[i]);return e}x.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ue(this)?x(this).show():x(this).hide()}))}});var de,pe,ve=/^(?:checkbox|radio)$/i,me=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ge=/^$|^module$|\/(?:java|ecma)script/i;de=b.createDocumentFragment().appendChild(b.createElement("div")),(pe=b.createElement("input")).setAttribute("type","radio"),pe.setAttribute("checked","checked"),pe.setAttribute("name","t"),de.appendChild(pe),m.checkClone=de.cloneNode(!0).cloneNode(!0).lastChild.checked,de.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!de.cloneNode(!0).lastChild.defaultValue,de.innerHTML="<option></option>",m.option=!!de.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function be(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&I(e,t)?x.merge([e],n):n}function ke(e,t){for(var n=0,r=e.length;n<r;n++)Z.set(e[n],"globalEval",!t||Z.get(t[n],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,m.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var _e=/<|&#?\w+;/;function we(e,t,n,r,a){for(var i,o,s,u,c,l,h=t.createDocumentFragment(),f=[],d=0,p=e.length;d<p;d++)if((i=e[d])||0===i)if("object"===w(i))x.merge(f,i.nodeType?[i]:i);else if(_e.test(i)){for(o=o||h.appendChild(t.createElement("div")),s=(me.exec(i)||["",""])[1].toLowerCase(),o.innerHTML=(u=ye[s]||ye._default)[1]+x.htmlPrefilter(i)+u[2],l=u[0];l--;)o=o.lastChild;x.merge(f,o.childNodes),(o=h.firstChild).textContent=""}else f.push(t.createTextNode(i));for(h.textContent="",d=0;i=f[d++];)if(r&&x.inArray(i,r)>-1)a&&a.push(i);else if(c=oe(i),o=be(h.appendChild(i),"script"),c&&ke(o),n)for(l=0;i=o[l++];)ge.test(i.type||"")&&n.push(i);return h}var xe=/^key/,Ce=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Se=/^([^.]*)(?:\.(.+)|)/;function Te(){return!0}function Ee(){return!1}function Ae(e,t){return e===function(){try{return b.activeElement}catch(e){}}()==("focus"===t)}function Ie(e,t,n,r,a,i){var o,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ie(e,s,n,r,t[s],i);return e}if(null==r&&null==a?(a=n,r=n=void 0):null==a&&("string"==typeof n?(a=r,r=void 0):(a=r,r=n,n=void 0)),!1===a)a=Ee;else if(!a)return e;return 1===i&&(o=a,(a=function(e){return x().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=x.guid++)),e.each((function(){x.event.add(this,t,a,r,n)}))}function Re(e,t,n){n?(Z.set(e,t,!1),x.event.add(e,t,{namespace:!1,handler:function(e){var r,a,i=Z.get(this,t);if(1&e.isTrigger&&this[t]){if(i.length)(x.event.special[t]||{}).delegateType&&e.stopPropagation();else if(i=s.call(arguments),Z.set(this,t,i),r=n(this,t),this[t](),i!==(a=Z.get(this,t))||r?Z.set(this,t,!1):a={},i!==a)return e.stopImmediatePropagation(),e.preventDefault(),a.value}else i.length&&(Z.set(this,t,{value:x.event.trigger(x.extend(i[0],x.Event.prototype),i.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Z.get(e,t)&&x.event.add(e,t,Te)}x.event={global:{},add:function(e,t,n,r,a){var i,o,s,u,c,l,h,f,d,p,v,m=Z.get(e);if(Y(e))for(n.handler&&(n=(i=n).handler,a=i.selector),a&&x.find.matchesSelector(ie,a),n.guid||(n.guid=x.guid++),(u=m.events)||(u=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==x&&x.event.triggered!==t.type?x.event.dispatch.apply(e,arguments):void 0}),c=(t=(t||"").match(P)||[""]).length;c--;)d=v=(s=Se.exec(t[c])||[])[1],p=(s[2]||"").split(".").sort(),d&&(h=x.event.special[d]||{},h=x.event.special[d=(a?h.delegateType:h.bindType)||d]||{},l=x.extend({type:d,origType:v,data:r,handler:n,guid:n.guid,selector:a,needsContext:a&&x.expr.match.needsContext.test(a),namespace:p.join(".")},i),(f=u[d])||((f=u[d]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,r,p,o)||e.addEventListener&&e.addEventListener(d,o)),h.add&&(h.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),a?f.splice(f.delegateCount++,0,l):f.push(l),x.event.global[d]=!0)},remove:function(e,t,n,r,a){var i,o,s,u,c,l,h,f,d,p,v,m=Z.hasData(e)&&Z.get(e);if(m&&(u=m.events)){for(c=(t=(t||"").match(P)||[""]).length;c--;)if(d=v=(s=Se.exec(t[c])||[])[1],p=(s[2]||"").split(".").sort(),d){for(h=x.event.special[d]||{},f=u[d=(r?h.delegateType:h.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=i=f.length;i--;)l=f[i],!a&&v!==l.origType||n&&n.guid!==l.guid||s&&!s.test(l.namespace)||r&&r!==l.selector&&("**"!==r||!l.selector)||(f.splice(i,1),l.selector&&f.delegateCount--,h.remove&&h.remove.call(e,l));o&&!f.length&&(h.teardown&&!1!==h.teardown.call(e,p,m.handle)||x.removeEvent(e,d,m.handle),delete u[d])}else for(d in u)x.event.remove(e,d+t[c],n,r,!0);x.isEmptyObject(u)&&Z.remove(e,"handle events")}},dispatch:function(e){var t,n,r,a,i,o,s=new Array(arguments.length),u=x.event.fix(e),c=(Z.get(this,"events")||Object.create(null))[u.type]||[],l=x.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,u)){for(o=x.event.handlers.call(this,u,c),t=0;(a=o[t++])&&!u.isPropagationStopped();)for(u.currentTarget=a.elem,n=0;(i=a.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==i.namespace&&!u.rnamespace.test(i.namespace)||(u.handleObj=i,u.data=i.data,void 0!==(r=((x.event.special[i.origType]||{}).handle||i.handler).apply(a.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,a,i,o,s=[],u=t.delegateCount,c=e.target;if(u&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(i=[],o={},n=0;n<u;n++)void 0===o[a=(r=t[n]).selector+" "]&&(o[a]=r.needsContext?x(a,this).index(c)>-1:x.find(a,this,null,[c]).length),o[a]&&i.push(r);i.length&&s.push({elem:c,handlers:i})}return c=this,u<t.length&&s.push({elem:c,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(x.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[x.expando]?e:new x.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return ve.test(t.type)&&t.click&&I(t,"input")&&Re(t,"click",Te),!1},trigger:function(e){var t=this||e;return ve.test(t.type)&&t.click&&I(t,"input")&&Re(t,"click"),!0},_default:function(e){var t=e.target;return ve.test(t.type)&&t.click&&I(t,"input")&&Z.get(t,"click")||I(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},x.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},(x.Event=function(e,t){if(!(this instanceof x.Event))return new x.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Te:Ee,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&x.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[x.expando]=!0}).prototype={constructor:x.Event,isDefaultPrevented:Ee,isPropagationStopped:Ee,isImmediatePropagationStopped:Ee,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Te,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Te,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Te,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},x.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&xe.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ce.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},x.event.addProp),x.each({focus:"focusin",blur:"focusout"},(function(e,t){x.event.special[e]={setup:function(){return Re(this,e,Ae),!1},trigger:function(){return Re(this,e),!0},delegateType:t}})),x.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,a=e.relatedTarget,i=e.handleObj;return a&&(a===r||x.contains(r,a))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}})),x.fn.extend({on:function(e,t,n,r){return Ie(this,e,t,n,r)},one:function(e,t,n,r){return Ie(this,e,t,n,r,1)},off:function(e,t,n){var r,a;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,x(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(a in e)this.off(a,t,e[a]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ee),this.each((function(){x.event.remove(this,e,n,t)}))}});var Ne=/<script|<style|<link/i,Oe=/checked\s*(?:[^=]|=\s*.checked.)/i,De=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Fe(e,t){return I(e,"table")&&I(11!==t.nodeType?t:t.firstChild,"tr")&&x(e).children("tbody")[0]||e}function Me(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Le(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Pe(e,t){var n,r,a,i,o,s;if(1===t.nodeType){if(Z.hasData(e)&&(s=Z.get(e).events))for(a in Z.remove(t,"handle events"),s)for(n=0,r=s[a].length;n<r;n++)x.event.add(t,a,s[a][n]);$.hasData(e)&&(i=$.access(e),o=x.extend({},i),$.set(t,o))}}function ze(e,t){var n=t.nodeName.toLowerCase();"input"===n&&ve.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function Be(e,t,n,r){t=u(t);var a,i,o,s,c,l,h=0,f=e.length,d=f-1,p=t[0],v=g(p);if(v||f>1&&"string"==typeof p&&!m.checkClone&&Oe.test(p))return e.each((function(a){var i=e.eq(a);v&&(t[0]=p.call(this,a,i.html())),Be(i,t,n,r)}));if(f&&(i=(a=we(t,e[0].ownerDocument,!1,e,r)).firstChild,1===a.childNodes.length&&(a=i),i||r)){for(s=(o=x.map(be(a,"script"),Me)).length;h<f;h++)c=a,h!==d&&(c=x.clone(c,!0,!0),s&&x.merge(o,be(c,"script"))),n.call(e[h],c,h);if(s)for(l=o[o.length-1].ownerDocument,x.map(o,Le),h=0;h<s;h++)ge.test((c=o[h]).type||"")&&!Z.access(c,"globalEval")&&x.contains(l,c)&&(c.src&&"module"!==(c.type||"").toLowerCase()?x._evalUrl&&!c.noModule&&x._evalUrl(c.src,{nonce:c.nonce||c.getAttribute("nonce")},l):_(c.textContent.replace(De,""),c,l))}return e}function Ue(e,t,n){for(var r,a=t?x.filter(t,e):e,i=0;null!=(r=a[i]);i++)n||1!==r.nodeType||x.cleanData(be(r)),r.parentNode&&(n&&oe(r)&&ke(be(r,"script")),r.parentNode.removeChild(r));return e}x.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,a,i,o,s=e.cloneNode(!0),u=oe(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e)))for(o=be(s),r=0,a=(i=be(e)).length;r<a;r++)ze(i[r],o[r]);if(t)if(n)for(i=i||be(e),o=o||be(s),r=0,a=i.length;r<a;r++)Pe(i[r],o[r]);else Pe(e,s);return(o=be(s,"script")).length>0&&ke(o,!u&&be(e,"script")),s},cleanData:function(e){for(var t,n,r,a=x.event.special,i=0;void 0!==(n=e[i]);i++)if(Y(n)){if(t=n[Z.expando]){if(t.events)for(r in t.events)a[r]?x.event.remove(n,r):x.removeEvent(n,r,t.handle);n[Z.expando]=void 0}n[$.expando]&&(n[$.expando]=void 0)}}}),x.fn.extend({detach:function(e){return Ue(this,e,!0)},remove:function(e){return Ue(this,e)},text:function(e){return H(this,(function(e){return void 0===e?x.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return Be(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Fe(this,e).appendChild(e)}))},prepend:function(){return Be(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Fe(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return Be(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return Be(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(x.cleanData(be(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return x.clone(this,e,t)}))},html:function(e){return H(this,(function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ne.test(e)&&!ye[(me.exec(e)||["",""])[1].toLowerCase()]){e=x.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(x.cleanData(be(t,!1)),t.innerHTML=e);t=0}catch(a){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return Be(this,arguments,(function(t){var n=this.parentNode;x.inArray(this,e)<0&&(x.cleanData(be(this)),n&&n.replaceChild(t,this))}),e)}}),x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){x.fn[e]=function(e){for(var n,r=[],a=x(e),i=a.length-1,o=0;o<=i;o++)n=o===i?this:this.clone(!0),x(a[o])[t](n),c.apply(r,n.get());return this.pushStack(r)}}));var We=new RegExp("^("+ne+")(?!px)[a-z%]+$","i"),Ve=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=n),t.getComputedStyle(e)},je=function(e,t,n){var r,a,i={};for(a in t)i[a]=e.style[a],e.style[a]=t[a];for(a in r=n.call(e),t)e.style[a]=i[a];return r},He=new RegExp(ae.join("|"),"i");function qe(e,t,n){var r,a,i,o,s=e.style;return(n=n||Ve(e))&&(""!==(o=n.getPropertyValue(t)||n[t])||oe(e)||(o=x.style(e,t)),!m.pixelBoxStyles()&&We.test(o)&&He.test(t)&&(r=s.width,a=s.minWidth,i=s.maxWidth,s.minWidth=s.maxWidth=s.width=o,o=n.width,s.width=r,s.minWidth=a,s.maxWidth=i)),void 0!==o?o+"":o}function Ge(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){c.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",l.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ie.appendChild(c).appendChild(l);var e=n.getComputedStyle(l);r="1%"!==e.top,u=12===t(e.marginLeft),l.style.right="60%",o=36===t(e.right),a=36===t(e.width),l.style.position="absolute",i=12===t(l.offsetWidth/3),ie.removeChild(c),l=null}}function t(e){return Math.round(parseFloat(e))}var r,a,i,o,s,u,c=b.createElement("div"),l=b.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===l.style.backgroundClip,x.extend(m,{boxSizingReliable:function(){return e(),a},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),u},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,r,a;return null==s&&(e=b.createElement("table"),t=b.createElement("tr"),r=b.createElement("div"),e.style.cssText="position:absolute;left:-11111px",t.style.height="1px",r.style.height="9px",ie.appendChild(e).appendChild(t).appendChild(r),a=n.getComputedStyle(t),s=parseInt(a.height)>3,ie.removeChild(e)),s}}))}();var Ke=["Webkit","Moz","ms"],Xe=b.createElement("div").style,Ye={};function Qe(e){return x.cssProps[e]||Ye[e]||(e in Xe?e:Ye[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Ke.length;n--;)if((e=Ke[n]+t)in Xe)return e}(e)||e)}var Ze=/^(none|table(?!-c[ea]).+)/,$e=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,n){var r=re.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function nt(e,t,n,r,a,i){var o="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;o<4;o+=2)"margin"===n&&(u+=x.css(e,n+ae[o],!0,a)),r?("content"===n&&(u-=x.css(e,"padding"+ae[o],!0,a)),"margin"!==n&&(u-=x.css(e,"border"+ae[o]+"Width",!0,a))):(u+=x.css(e,"padding"+ae[o],!0,a),"padding"!==n?u+=x.css(e,"border"+ae[o]+"Width",!0,a):s+=x.css(e,"border"+ae[o]+"Width",!0,a));return!r&&i>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-i-u-s-.5))||0),u}function rt(e,t,n){var r=Ve(e),a=(!m.boxSizingReliable()||n)&&"border-box"===x.css(e,"boxSizing",!1,r),i=a,o=qe(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(We.test(o)){if(!n)return o;o="auto"}return(!m.boxSizingReliable()&&a||!m.reliableTrDimensions()&&I(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===x.css(e,"display",!1,r))&&e.getClientRects().length&&(a="border-box"===x.css(e,"boxSizing",!1,r),(i=s in e)&&(o=e[s])),(o=parseFloat(o)||0)+nt(e,t,n||(a?"border":"content"),i,r,o)+"px"}function at(e,t,n,r,a){return new at.prototype.init(e,t,n,r,a)}x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=qe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,i,o,s=X(t),u=$e.test(t),c=e.style;if(u||(t=Qe(s)),o=x.cssHooks[t]||x.cssHooks[s],void 0===n)return o&&"get"in o&&void 0!==(a=o.get(e,!1,r))?a:c[t];"string"==(i=typeof n)&&(a=re.exec(n))&&a[1]&&(n=ce(e,t,a),i="number"),null!=n&&n==n&&("number"!==i||u||(n+=a&&a[3]||(x.cssNumber[s]?"":"px")),m.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),o&&"set"in o&&void 0===(n=o.set(e,n,r))||(u?c.setProperty(t,n):c[t]=n))}},css:function(e,t,n,r){var a,i,o,s=X(t);return $e.test(t)||(t=Qe(s)),(o=x.cssHooks[t]||x.cssHooks[s])&&"get"in o&&(a=o.get(e,!0,n)),void 0===a&&(a=qe(e,t,r)),"normal"===a&&t in et&&(a=et[t]),""===n||n?(i=parseFloat(a),!0===n||isFinite(i)?i||0:a):a}}),x.each(["height","width"],(function(e,t){x.cssHooks[t]={get:function(e,n,r){if(n)return!Ze.test(x.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?rt(e,t,r):je(e,Je,(function(){return rt(e,t,r)}))},set:function(e,n,r){var a,i=Ve(e),o=!m.scrollboxSize()&&"absolute"===i.position,s=(o||r)&&"border-box"===x.css(e,"boxSizing",!1,i),u=r?nt(e,t,r,s,i):0;return s&&o&&(u-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(i[t])-nt(e,t,"border",!1,i)-.5)),u&&(a=re.exec(n))&&"px"!==(a[3]||"px")&&(e.style[t]=n,n=x.css(e,t)),tt(0,n,u)}}})),x.cssHooks.marginLeft=Ge(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(qe(e,"marginLeft"))||e.getBoundingClientRect().left-je(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),x.each({margin:"",padding:"",border:"Width"},(function(e,t){x.cssHooks[e+t]={expand:function(n){for(var r=0,a={},i="string"==typeof n?n.split(" "):[n];r<4;r++)a[e+ae[r]+t]=i[r]||i[r-2]||i[0];return a}},"margin"!==e&&(x.cssHooks[e+t].set=tt)})),x.fn.extend({css:function(e,t){return H(this,(function(e,t,n){var r,a,i={},o=0;if(Array.isArray(t)){for(r=Ve(e),a=t.length;o<a;o++)i[t[o]]=x.css(e,t[o],!1,r);return i}return void 0!==n?x.style(e,t,n):x.css(e,t)}),e,t,arguments.length>1)}}),x.Tween=at,(at.prototype={constructor:at,init:function(e,t,n,r,a,i){this.elem=e,this.prop=n,this.easing=a||x.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=i||(x.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=x.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):1!==e.elem.nodeType||!x.cssHooks[e.prop]&&null==e.elem.style[Qe(e.prop)]?e.elem[e.prop]=e.now:x.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},(x.fx=at.prototype.init).step={};var it,ot,st=/^(?:toggle|show|hide)$/,ut=/queueHooks$/;function ct(){ot&&(!1===b.hidden&&n.requestAnimationFrame?n.requestAnimationFrame(ct):n.setTimeout(ct,x.fx.interval),x.fx.tick())}function lt(){return n.setTimeout((function(){it=void 0})),it=Date.now()}function ht(e,t){var n,r=0,a={height:e};for(t=t?1:0;r<4;r+=2-t)a["margin"+(n=ae[r])]=a["padding"+n]=e;return t&&(a.opacity=a.width=e),a}function ft(e,t,n){for(var r,a=(dt.tweeners[t]||[]).concat(dt.tweeners["*"]),i=0,o=a.length;i<o;i++)if(r=a[i].call(n,t,e))return r}function dt(e,t,n){var r,a,i=0,o=dt.prefilters.length,s=x.Deferred().always((function(){delete u.elem})),u=function(){if(a)return!1;for(var t=it||lt(),n=Math.max(0,c.startTime+c.duration-t),r=1-(n/c.duration||0),i=0,o=c.tweens.length;i<o;i++)c.tweens[i].run(r);return s.notifyWith(e,[c,r,n]),r<1&&o?n:(o||s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c]),!1)},c=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{},easing:x.easing._default},n),originalProperties:t,originalOptions:n,startTime:it||lt(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(a)return this;for(a=!0;n<r;n++)c.tweens[n].run(1);return t?(s.notifyWith(e,[c,1,0]),s.resolveWith(e,[c,t])):s.rejectWith(e,[c,t]),this}}),l=c.props;for(function(e,t){var n,r,a,i,o;for(n in e)if(a=t[r=X(n)],i=e[n],Array.isArray(i)&&(a=i[1],i=e[n]=i[0]),n!==r&&(e[r]=i,delete e[n]),(o=x.cssHooks[r])&&"expand"in o)for(n in i=o.expand(i),delete e[r],i)n in e||(e[n]=i[n],t[n]=a);else t[r]=a}(l,c.opts.specialEasing);i<o;i++)if(r=dt.prefilters[i].call(c,e,l,c.opts))return g(r.stop)&&(x._queueHooks(c.elem,c.opts.queue).stop=r.stop.bind(r)),r;return x.map(l,ft,c),g(c.opts.start)&&c.opts.start.call(e,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),x.fx.timer(x.extend(u,{elem:e,anim:c,queue:c.opts.queue})),c}x.Animation=x.extend(dt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return ce(n.elem,e,re.exec(t),n),n}]},tweener:function(e,t){g(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,a=e.length;r<a;r++)(dt.tweeners[n=e[r]]=dt.tweeners[n]||[]).unshift(t)},prefilters:[function(e,t,n){var r,a,i,o,s,u,c,l,h="width"in t||"height"in t,f=this,d={},p=e.style,v=e.nodeType&&ue(e),m=Z.get(e,"fxshow");for(r in n.queue||(null==(o=x._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,s=o.empty.fire,o.empty.fire=function(){o.unqueued||s()}),o.unqueued++,f.always((function(){f.always((function(){o.unqueued--,x.queue(e,"fx").length||o.empty.fire()}))}))),t)if(st.test(a=t[r])){if(delete t[r],i=i||"toggle"===a,a===(v?"hide":"show")){if("show"!==a||!m||void 0===m[r])continue;v=!0}d[r]=m&&m[r]||x.style(e,r)}if((u=!x.isEmptyObject(t))||!x.isEmptyObject(d))for(r in h&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(c=m&&m.display)&&(c=Z.get(e,"display")),"none"===(l=x.css(e,"display"))&&(c?l=c:(fe([e],!0),c=e.style.display||c,l=x.css(e,"display"),fe([e]))),("inline"===l||"inline-block"===l&&null!=c)&&"none"===x.css(e,"float")&&(u||(f.done((function(){p.display=c})),null==c&&(c="none"===(l=p.display)?"":l)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",f.always((function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}))),u=!1,d)u||(m?"hidden"in m&&(v=m.hidden):m=Z.access(e,"fxshow",{display:c}),i&&(m.hidden=!v),v&&fe([e],!0),f.done((function(){for(r in v||fe([e]),Z.remove(e,"fxshow"),d)x.style(e,r,d[r])}))),u=ft(v?m[r]:0,r,f),r in m||(m[r]=u.start,v&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?dt.prefilters.unshift(e):dt.prefilters.push(e)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||g(e)&&e,duration:e,easing:n&&t||t&&!g(t)&&t};return x.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration=r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){g(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ue).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var a=x.isEmptyObject(e),i=x.speed(t,n,r),o=function(){var t=dt(this,x.extend({},e),i);(a||Z.get(this,"finish"))&&t.stop(!0)};return o.finish=o,a||!1===i.queue?this.each(o):this.queue(i.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,a=null!=e&&e+"queueHooks",i=x.timers,o=Z.get(this);if(a)o[a]&&o[a].stop&&r(o[a]);else for(a in o)o[a]&&o[a].stop&&ut.test(a)&&r(o[a]);for(a=i.length;a--;)i[a].elem!==this||null!=e&&i[a].queue!==e||(i[a].anim.stop(n),t=!1,i.splice(a,1));!t&&n||x.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,n=Z.get(this),r=n[e+"queue"],a=n[e+"queueHooks"],i=x.timers,o=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),a&&a.stop&&a.stop.call(this,!0),t=i.length;t--;)i[t].elem===this&&i[t].queue===e&&(i[t].anim.stop(!0),i.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish}))}}),x.each(["toggle","show","hide"],(function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,a){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ht(t,!0),e,r,a)}})),x.each({slideDown:ht("show"),slideUp:ht("hide"),slideToggle:ht("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}})),x.timers=[],x.fx.tick=function(){var e,t=0,n=x.timers;for(it=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||x.fx.stop(),it=void 0},x.fx.timer=function(e){x.timers.push(e),x.fx.start()},x.fx.interval=13,x.fx.start=function(){ot||(ot=!0,ct())},x.fx.stop=function(){ot=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fn.delay=function(e,t){return e=x.fx&&x.fx.speeds[e]||e,this.queue(t=t||"fx",(function(t,r){var a=n.setTimeout(t,e);r.stop=function(){n.clearTimeout(a)}}))},function(){var e=b.createElement("input"),t=b.createElement("select").appendChild(b.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=b.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var pt,vt=x.expr.attrHandle;x.fn.extend({attr:function(e,t){return H(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){x.removeAttr(this,e)}))}}),x.extend({attr:function(e,t,n){var r,a,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return void 0===e.getAttribute?x.prop(e,t,n):(1===i&&x.isXMLDoc(e)||(a=x.attrHooks[t.toLowerCase()]||(x.expr.match.bool.test(t)?pt:void 0)),void 0!==n?null===n?void x.removeAttr(e,t):a&&"set"in a&&void 0!==(r=a.set(e,n,t))?r:(e.setAttribute(t,n+""),n):a&&"get"in a&&null!==(r=a.get(e,t))?r:null==(r=x.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&I(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,a=t&&t.match(P);if(a&&1===e.nodeType)for(;n=a[r++];)e.removeAttribute(n)}}),pt={set:function(e,t,n){return!1===t?x.removeAttr(e,n):e.setAttribute(n,n),n}},x.each(x.expr.match.bool.source.match(/\w+/g),(function(e,t){var n=vt[t]||x.find.attr;vt[t]=function(e,t,r){var a,i,o=t.toLowerCase();return r||(i=vt[o],vt[o]=a,a=null!=n(e,t,r)?o:null,vt[o]=i),a}}));var mt=/^(?:input|select|textarea|button)$/i,gt=/^(?:a|area)$/i;function yt(e){return(e.match(P)||[]).join(" ")}function bt(e){return e.getAttribute&&e.getAttribute("class")||""}function kt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}x.fn.extend({prop:function(e,t){return H(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[x.propFix[e]||e]}))}}),x.extend({prop:function(e,t,n){var r,a,i=e.nodeType;if(3!==i&&8!==i&&2!==i)return 1===i&&x.isXMLDoc(e)||(a=x.propHooks[t=x.propFix[t]||t]),void 0!==n?a&&"set"in a&&void 0!==(r=a.set(e,n,t))?r:e[t]=n:a&&"get"in a&&null!==(r=a.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,"tabindex");return t?parseInt(t,10):mt.test(e.nodeName)||gt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(x.propHooks.selected={get:function(e){return null},set:function(e){}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){x.propFix[this.toLowerCase()]=this})),x.fn.extend({addClass:function(e){var t,n,r,a,i,o,s,u=0;if(g(e))return this.each((function(t){x(this).addClass(e.call(this,t,bt(this)))}));if((t=kt(e)).length)for(;n=this[u++];)if(a=bt(n),r=1===n.nodeType&&" "+yt(a)+" "){for(o=0;i=t[o++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");a!==(s=yt(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,a,i,o,s,u=0;if(g(e))return this.each((function(t){x(this).removeClass(e.call(this,t,bt(this)))}));if(!arguments.length)return this.attr("class","");if((t=kt(e)).length)for(;n=this[u++];)if(a=bt(n),r=1===n.nodeType&&" "+yt(a)+" "){for(o=0;i=t[o++];)for(;r.indexOf(" "+i+" ")>-1;)r=r.replace(" "+i+" "," ");a!==(s=yt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e,r="string"===n||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):g(e)?this.each((function(n){x(this).toggleClass(e.call(this,n,bt(this),t),t)})):this.each((function(){var t,a,i,o;if(r)for(a=0,i=x(this),o=kt(e);t=o[a++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||((t=bt(this))&&Z.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Z.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+yt(bt(n))+" ").indexOf(t)>-1)return!0;return!1}});var _t=/\r/g;x.fn.extend({val:function(e){var t,n,r,a=this[0];return arguments.length?(r=g(e),this.each((function(n){var a;1===this.nodeType&&(null==(a=r?e.call(this,n,x(this).val()):e)?a="":"number"==typeof a?a+="":Array.isArray(a)&&(a=x.map(a,(function(e){return null==e?"":e+""}))),(t=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,a,"value")||(this.value=a))}))):a?(t=x.valHooks[a.type]||x.valHooks[a.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(a,"value"))?n:"string"==typeof(n=a.value)?n.replace(_t,""):null==n?"":n:void 0}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,"value");return null!=t?t:yt(x.text(e))}},select:{get:function(e){var t,n,r,a=e.options,i=e.selectedIndex,o="select-one"===e.type,s=o?null:[],u=o?i+1:a.length;for(r=i<0?u:o?i:0;r<u;r++)if(((n=a[r]).selected||r===i)&&!n.disabled&&(!n.parentNode.disabled||!I(n.parentNode,"optgroup"))){if(t=x(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,a=e.options,i=x.makeArray(t),o=a.length;o--;)((r=a[o]).selected=x.inArray(x.valHooks.option.get(r),i)>-1)&&(n=!0);return n||(e.selectedIndex=-1),i}}}}),x.each(["radio","checkbox"],(function(){x.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=x.inArray(x(e).val(),t)>-1}},m.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in n;var wt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};x.extend(x.event,{trigger:function(e,t,r,a){var i,o,s,u,c,l,h,f,p=[r||b],v=d.call(e,"type")?e.type:e,m=d.call(e,"namespace")?e.namespace.split("."):[];if(o=f=s=r=r||b,3!==r.nodeType&&8!==r.nodeType&&!wt.test(v+x.event.triggered)&&(v.indexOf(".")>-1&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,(e=e[x.expando]?e:new x.Event(v,"object"==typeof e&&e)).isTrigger=a?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:x.makeArray(t,[e]),h=x.event.special[v]||{},a||!h.trigger||!1!==h.trigger.apply(r,t))){if(!a&&!h.noBubble&&!y(r)){for(wt.test((u=h.delegateType||v)+v)||(o=o.parentNode);o;o=o.parentNode)p.push(o),s=o;s===(r.ownerDocument||b)&&p.push(s.defaultView||s.parentWindow||n)}for(i=0;(o=p[i++])&&!e.isPropagationStopped();)f=o,e.type=i>1?u:h.bindType||v,(l=(Z.get(o,"events")||Object.create(null))[e.type]&&Z.get(o,"handle"))&&l.apply(o,t),(l=c&&o[c])&&l.apply&&Y(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=v,a||e.isDefaultPrevented()||h._default&&!1!==h._default.apply(p.pop(),t)||!Y(r)||c&&g(r[v])&&!y(r)&&((s=r[c])&&(r[c]=null),x.event.triggered=v,e.isPropagationStopped()&&f.addEventListener(v,xt),r[v](),e.isPropagationStopped()&&f.removeEventListener(v,xt),x.event.triggered=void 0,s&&(r[c]=s)),e.result}},simulate:function(e,t,n){var r=x.extend(new x.Event,n,{type:e,isSimulated:!0});x.event.trigger(r,null,t)}}),x.fn.extend({trigger:function(e,t){return this.each((function(){x.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var n=this[0];if(n)return x.event.trigger(e,t,n,!0)}}),m.focusin||x.each({focus:"focusin",blur:"focusout"},(function(e,t){var n=function(e){x.event.simulate(t,e.target,x.event.fix(e))};x.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,a=Z.access(r,t);a||r.addEventListener(e,n,!0),Z.access(r,t,(a||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,a=Z.access(r,t)-1;a?Z.access(r,t,a):(r.removeEventListener(e,n,!0),Z.remove(r,t))}}}));var Ct=n.location,St={guid:Date.now()},Tt=/\?/;x.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new n.DOMParser).parseFromString(e,"text/xml")}catch(r){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+e),t};var Et=/\[\]$/,At=/\r?\n/g,It=/^(?:submit|button|image|reset|file)$/i,Rt=/^(?:input|select|textarea|keygen)/i;function Nt(e,t,n,r){var a;if(Array.isArray(t))x.each(t,(function(t,a){n||Et.test(e)?r(e,a):Nt(e+"["+("object"==typeof a&&null!=a?t:"")+"]",a,n,r)}));else if(n||"object"!==w(t))r(e,t);else for(a in t)Nt(e+"["+a+"]",t[a],n,r)}x.param=function(e,t){var n,r=[],a=function(e,t){var n=g(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!x.isPlainObject(e))x.each(e,(function(){a(this.name,this.value)}));else for(n in e)Nt(n,e[n],t,a);return r.join("&")},x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&Rt.test(this.nodeName)&&!It.test(e)&&(this.checked||!ve.test(e))})).map((function(e,t){var n=x(this).val();return null==n?null:Array.isArray(n)?x.map(n,(function(e){return{name:t.name,value:e.replace(At,"\r\n")}})):{name:t.name,value:n.replace(At,"\r\n")}})).get()}});var Ot=/%20/g,Dt=/#.*$/,Ft=/([?&])_=[^&]*/,Mt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Pt=/^\/\//,zt={},Bt={},Ut="*/".concat("*"),Wt=b.createElement("a");function Vt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,a=0,i=t.toLowerCase().match(P)||[];if(g(n))for(;r=i[a++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function jt(e,t,n,r){var a={},i=e===Bt;function o(s){var u;return a[s]=!0,x.each(e[s]||[],(function(e,s){var c=s(t,n,r);return"string"!=typeof c||i||a[c]?i?!(u=c):void 0:(t.dataTypes.unshift(c),o(c),!1)})),u}return o(t.dataTypes[0])||!a["*"]&&o("*")}function Ht(e,t){var n,r,a=x.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((a[n]?e:r||(r={}))[n]=t[n]);return r&&x.extend(!0,e,r),e}Wt.href=Ct.href,x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ut,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ht(Ht(e,x.ajaxSettings),t):Ht(x.ajaxSettings,e)},ajaxPrefilter:Vt(zt),ajaxTransport:Vt(Bt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var r,a,i,o,s,u,c,l,h,f,d=x.ajaxSetup({},t=t||{}),p=d.context||d,v=d.context&&(p.nodeType||p.jquery)?x(p):x.event,m=x.Deferred(),g=x.Callbacks("once memory"),y=d.statusCode||{},k={},_={},w="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(c){if(!o)for(o={};t=Mt.exec(i);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return c?i:null},setRequestHeader:function(e,t){return null==c&&(e=_[e.toLowerCase()]=_[e.toLowerCase()]||e,k[e]=t),this},overrideMimeType:function(e){return null==c&&(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)C.always(e[C.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||w;return r&&r.abort(t),S(0,t),this}};if(m.promise(C),d.url=((e||d.url||Ct.href)+"").replace(Pt,Ct.protocol+"//"),d.type=t.method||t.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(P)||[""],null==d.crossDomain){u=b.createElement("a");try{u.href=d.url,u.href=u.href,d.crossDomain=Wt.protocol+"//"+Wt.host!=u.protocol+"//"+u.host}catch(T){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=x.param(d.data,d.traditional)),jt(zt,d,t,C),c)return C;for(h in(l=x.event&&d.global)&&0==x.active++&&x.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Lt.test(d.type),a=d.url.replace(Dt,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Ot,"+")):(f=d.url.slice(a.length),d.data&&(d.processData||"string"==typeof d.data)&&(a+=(Tt.test(a)?"&":"?")+d.data,delete d.data),!1===d.cache&&(a=a.replace(Ft,"$1"),f=(Tt.test(a)?"&":"?")+"_="+St.guid+++f),d.url=a+f),d.ifModified&&(x.lastModified[a]&&C.setRequestHeader("If-Modified-Since",x.lastModified[a]),x.etag[a]&&C.setRequestHeader("If-None-Match",x.etag[a])),(d.data&&d.hasContent&&!1!==d.contentType||t.contentType)&&C.setRequestHeader("Content-Type",d.contentType),C.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Ut+"; q=0.01":""):d.accepts["*"]),d.headers)C.setRequestHeader(h,d.headers[h]);if(d.beforeSend&&(!1===d.beforeSend.call(p,C,d)||c))return C.abort();if(w="abort",g.add(d.complete),C.done(d.success),C.fail(d.error),r=jt(Bt,d,t,C)){if(C.readyState=1,l&&v.trigger("ajaxSend",[C,d]),c)return C;d.async&&d.timeout>0&&(s=n.setTimeout((function(){C.abort("timeout")}),d.timeout));try{c=!1,r.send(k,S)}catch(T){if(c)throw T;S(-1,T)}}else S(-1,"No Transport");function S(e,t,o,u){var h,f,b,k,_,w=t;c||(c=!0,s&&n.clearTimeout(s),r=void 0,i=u||"",C.readyState=e>0?4:0,h=e>=200&&e<300||304===e,o&&(k=function(e,t,n){for(var r,a,i,o,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(a in s)if(s[a]&&s[a].test(r)){u.unshift(a);break}if(u[0]in n)i=u[0];else{for(a in n){if(!u[0]||e.converters[a+" "+u[0]]){i=a;break}o||(o=a)}i=i||o}if(i)return i!==u[0]&&u.unshift(i),n[i]}(d,C,o)),!h&&x.inArray("script",d.dataTypes)>-1&&(d.converters["text script"]=function(){}),k=function(e,t,n,r){var a,i,o,s,u,c={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)c[o.toLowerCase()]=e.converters[o];for(i=l.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=i,i=l.shift())if("*"===i)i=u;else if("*"!==u&&u!==i){if(!(o=c[u+" "+i]||c["* "+i]))for(a in c)if((s=a.split(" "))[1]===i&&(o=c[u+" "+s[0]]||c["* "+s[0]])){!0===o?o=c[a]:!0!==c[a]&&(i=s[0],l.unshift(s[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(T){return{state:"parsererror",error:o?T:"No conversion from "+u+" to "+i}}}return{state:"success",data:t}}(d,k,C,h),h?(d.ifModified&&((_=C.getResponseHeader("Last-Modified"))&&(x.lastModified[a]=_),(_=C.getResponseHeader("etag"))&&(x.etag[a]=_)),204===e||"HEAD"===d.type?w="nocontent":304===e?w="notmodified":(w=k.state,f=k.data,h=!(b=k.error))):(b=w,!e&&w||(w="error",e<0&&(e=0))),C.status=e,C.statusText=(t||w)+"",h?m.resolveWith(p,[f,w,C]):m.rejectWith(p,[C,w,b]),C.statusCode(y),y=void 0,l&&v.trigger(h?"ajaxSuccess":"ajaxError",[C,d,h?f:b]),g.fireWith(p,[C,w]),l&&(v.trigger("ajaxComplete",[C,d]),--x.active||x.event.trigger("ajaxStop")))}return C},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,t){return x.get(e,void 0,t,"script")}}),x.each(["get","post"],(function(e,t){x[t]=function(e,n,r,a){return g(n)&&(a=a||r,r=n,n=void 0),x.ajax(x.extend({url:e,type:t,dataType:a,data:n,success:r},x.isPlainObject(e)&&e))}})),x.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),x._evalUrl=function(e,t,n){return x.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){x.globalEval(e,t,n)}})},x.fn.extend({wrapAll:function(e){var t;return this[0]&&(g(e)&&(e=e.call(this[0])),t=x(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return g(e)?this.each((function(t){x(this).wrapInner(e.call(this,t))})):this.each((function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)}))},wrap:function(e){var t=g(e);return this.each((function(n){x(this).wrapAll(t?e.call(this,n):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){x(this).replaceWith(this.childNodes)})),this}}),x.expr.pseudos.hidden=function(e){return!x.expr.pseudos.visible(e)},x.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},x.ajaxSettings.xhr=function(){try{return new n.XMLHttpRequest}catch(e){}};var qt={0:200,1223:204},Gt=x.ajaxSettings.xhr();m.cors=!!Gt&&"withCredentials"in Gt,m.ajax=Gt=!!Gt,x.ajaxTransport((function(e){var t,r;if(m.cors||Gt&&!e.crossDomain)return{send:function(a,i){var o,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)s[o]=e.xhrFields[o];for(o in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||a["X-Requested-With"]||(a["X-Requested-With"]="XMLHttpRequest"),a)s.setRequestHeader(o,a[o]);t=function(e){return function(){t&&(t=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?i(0,"error"):i(s.status,s.statusText):i(qt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=t(),r=s.onerror=s.ontimeout=t("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&n.setTimeout((function(){t&&r()}))},t=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(t)throw u}},abort:function(){t&&t()}}})),x.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),x.ajaxTransport("script",(function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,a){t=x("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&a("error"===e.type?404:200,e.type)}),b.head.appendChild(t[0])},abort:function(){n&&n()}}}));var Kt,Xt=[],Yt=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Xt.pop()||x.expando+"_"+St.guid++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",(function(e,t,r){var a,i,o,s=!1!==e.jsonp&&(Yt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Yt.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return a=e.jsonpCallback=g(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Yt,"$1"+a):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+a),e.converters["script json"]=function(){return o||x.error(a+" was not called"),o[0]},e.dataTypes[0]="json",i=n[a],n[a]=function(){o=arguments},r.always((function(){void 0===i?x(n).removeProp(a):n[a]=i,e[a]&&(e.jsonpCallback=t.jsonpCallback,Xt.push(a)),o&&g(i)&&i(o[0]),o=i=void 0})),"script"})),m.createHTMLDocument=((Kt=b.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Kt.childNodes.length),x.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(m.createHTMLDocument?((r=(t=b.implementation.createHTMLDocument("")).createElement("base")).href=b.location.href,t.head.appendChild(r)):t=b),i=!n&&[],(a=R.exec(e))?[t.createElement(a[1])]:(a=we([e],t,i),i&&i.length&&x(i).remove(),x.merge([],a.childNodes)));var r,a,i},x.fn.load=function(e,t,n){var r,a,i,o=this,s=e.indexOf(" ");return s>-1&&(r=yt(e.slice(s)),e=e.slice(0,s)),g(t)?(n=t,t=void 0):t&&"object"==typeof t&&(a="POST"),o.length>0&&x.ajax({url:e,type:a||"GET",dataType:"html",data:t}).done((function(e){i=arguments,o.html(r?x("<div>").append(x.parseHTML(e)).find(r):e)})).always(n&&function(e,t){o.each((function(){n.apply(this,i||[e.responseText,t,e])}))}),this},x.expr.pseudos.animated=function(e){return x.grep(x.timers,(function(t){return e===t.elem})).length},x.offset={setOffset:function(e,t,n){var r,a,i,o,s,u,c=x.css(e,"position"),l=x(e),h={};"static"===c&&(e.style.position="relative"),s=l.offset(),i=x.css(e,"top"),u=x.css(e,"left"),("absolute"===c||"fixed"===c)&&(i+u).indexOf("auto")>-1?(o=(r=l.position()).top,a=r.left):(o=parseFloat(i)||0,a=parseFloat(u)||0),g(t)&&(t=t.call(e,n,x.extend({},s))),null!=t.top&&(h.top=t.top-s.top+o),null!=t.left&&(h.left=t.left-s.left+a),"using"in t?t.using.call(e,h):("number"==typeof h.top&&(h.top+="px"),"number"==typeof h.left&&(h.left+="px"),l.css(h))}},x.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){x.offset.setOffset(this,e,t)}));var t,n,r=this[0];return r?r.getClientRects().length?{top:(t=r.getBoundingClientRect()).top+(n=r.ownerDocument.defaultView).pageYOffset,left:t.left+n.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],a={top:0,left:0};if("fixed"===x.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===x.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((a=x(e).offset()).top+=x.css(e,"borderTopWidth",!0),a.left+=x.css(e,"borderLeftWidth",!0))}return{top:t.top-a.top-x.css(r,"marginTop",!0),left:t.left-a.left-x.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===x.css(e,"position");)e=e.offsetParent;return e||ie}))}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var n="pageYOffset"===t;x.fn[e]=function(r){return H(this,(function(e,r,a){var i;if(y(e)?i=e:9===e.nodeType&&(i=e.defaultView),void 0===a)return i?i[t]:e[r];i?i.scrollTo(n?i.pageXOffset:a,n?a:i.pageYOffset):e[r]=a}),e,r,arguments.length)}})),x.each(["top","left"],(function(e,t){x.cssHooks[t]=Ge(m.pixelPosition,(function(e,n){if(n)return n=qe(e,t),We.test(n)?x(e).position()[t]+"px":n}))})),x.each({Height:"height",Width:"width"},(function(e,t){x.each({padding:"inner"+e,content:t,"":"outer"+e},(function(n,r){x.fn[r]=function(a,i){var o=arguments.length&&(n||"boolean"!=typeof a),s=n||(!0===a||!0===i?"margin":"border");return H(this,(function(t,n,a){var i;return y(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===a?x.css(t,n,s):x.style(t,n,a,s)}),t,o?a:void 0,o)}}))})),x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){x.fn[t]=function(e){return this.on(t,e)}})),x.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),x.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}));var Qt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;x.proxy=function(e,t){var n,r,a;if("string"==typeof t&&(n=e[t],t=e,e=n),g(e))return r=s.call(arguments,2),(a=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||x.guid++,a},x.holdReady=function(e){e?x.readyWait++:x.ready(!0)},x.isArray=Array.isArray,x.parseJSON=JSON.parse,x.nodeName=I,x.isFunction=g,x.isWindow=y,x.camelCase=X,x.type=w,x.now=Date.now,x.isNumeric=function(e){var t=x.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},x.trim=function(e){return null==e?"":(e+"").replace(Qt,"")},void 0===(r=(function(){return x}).apply(t,[]))||(e.exports=r);var Zt=n.jQuery,$t=n.$;return x.noConflict=function(e){return n.$===x&&(n.$=$t),e&&n.jQuery===x&&(n.jQuery=Zt),x},void 0===a&&(n.jQuery=n.$=x),x}))},EhIR:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},PDX0:function(e,t){(function(t){e.exports=t}).call(this,{})},YSVl:function(e,t,n){var r=n("EhIR"),a=n("uDiL"),i=n("pJ6O"),o=n("yuCN"),s=n("euyF"),u=n("ie1u"),c=n("pJ3+");c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},euyF:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n=a[i]=(n^=n>>>15)^(e^=e>>>12),t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=0==(n=s[127&i]^=r+(o=o+1640531527|0))?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,s[a]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},ie1u:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},"pJ3+":function(e,t,n){var r;!function(a,i){var o,s=this,u=i.pow(256,6),c=i.pow(2,52),l=2*c;function h(e,t,n){var r=[],h=p(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,v(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(256):(e=new Uint8Array(256),(s.crypto||s.msCrypto).getRandomValues(e)),v(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,v(a)]}}():e,3),r),m=new f(r),g=function(){for(var e=m.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=m.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return g.int32=function(){return 0|m.g(4)},g.quick=function(){return m.g(4)/4294967296},g.double=g,p(v(m.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&d(r,m),e.state=function(){return d(m,{})}),n?(i.random=e,t):e})(g,h,"global"in t?t.global:this==i,t.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=h,p(i.random(),a),e.exports){e.exports=h;try{o=n(3)}catch(m){}}else void 0===(r=(function(){return h}).call(t,n,t,e))||(e.exports=r)}([],Math)},pJ6O:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},uDiL:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},yuCN:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],r[a]=n^=(e^=e<<13)^e<<9,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},zUnb:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shuffle",(function(){return qp})),n.d(r,"clamp",(function(){return Gp})),n.d(r,"nearestLargerEven",(function(){return Kp})),n.d(r,"sum",(function(){return Xp})),n.d(r,"randUniform",(function(){return Yp})),n.d(r,"distSquared",(function(){return Qp})),n.d(r,"assert",(function(){return Zp})),n.d(r,"assertShapesMatch",(function(){return $p})),n.d(r,"assertNonNull",(function(){return Jp})),n.d(r,"flatten",(function(){return ev})),n.d(r,"sizeFromShape",(function(){return tv})),n.d(r,"isScalarShape",(function(){return nv})),n.d(r,"arraysEqual",(function(){return rv})),n.d(r,"isInt",(function(){return av})),n.d(r,"tanh",(function(){return iv})),n.d(r,"sizeToSquarishShape",(function(){return ov})),n.d(r,"createShuffledIndices",(function(){return sv})),n.d(r,"rightPad",(function(){return uv})),n.d(r,"repeatedTry",(function(){return cv})),n.d(r,"inferFromImplicitShape",(function(){return lv})),n.d(r,"parseAxisParam",(function(){return hv})),n.d(r,"squeezeShape",(function(){return fv})),n.d(r,"getTypedArrayFromDType",(function(){return dv})),n.d(r,"getArrayFromDType",(function(){return pv})),n.d(r,"checkConversionForErrors",(function(){return vv})),n.d(r,"isValidDtype",(function(){return mv})),n.d(r,"hasEncodingLoss",(function(){return gv})),n.d(r,"isTypedArray",(function(){return yv})),n.d(r,"bytesPerElement",(function(){return bv})),n.d(r,"bytesFromStringArray",(function(){return kv})),n.d(r,"isString",(function(){return _v})),n.d(r,"isBoolean",(function(){return wv})),n.d(r,"isNumber",(function(){return xv})),n.d(r,"inferDtype",(function(){return Cv})),n.d(r,"isFunction",(function(){return Sv})),n.d(r,"nearestDivisor",(function(){return Tv})),n.d(r,"computeStrides",(function(){return Ev})),n.d(r,"toTypedArray",(function(){return Av})),n.d(r,"toNestedArray",(function(){return Iv})),n.d(r,"makeOnesTypedArray",(function(){return Rv})),n.d(r,"makeZerosTypedArray",(function(){return Nv})),n.d(r,"now",(function(){return Ov})),n.d(r,"assertNonNegativeIntegerDimensions",(function(){return Dv})),n.d(r,"fetch",(function(){return Fv})),n.d(r,"encodeString",(function(){return Mv})),n.d(r,"decodeString",(function(){return Lv})),n.d(r,"locToIndex",(function(){return Pv})),n.d(r,"indexToLoc",(function(){return zv}));var a={};n.r(a),n.d(a,"makeTypesMatch",(function(){return rm})),n.d(a,"assertTypesMatch",(function(){return am})),n.d(a,"isTensorInList",(function(){return im})),n.d(a,"getTensorsInContainer",(function(){return om}));var i={};n.r(i),n.d(i,"isMobile",(function(){return lm})),n.d(i,"isBrowser",(function(){return hm}));var o={};n.r(o),n.d(o,"assertParamsValid",(function(){return kb})),n.d(o,"maskToAxes",(function(){return _b})),n.d(o,"computeOutShape",(function(){return wb})),n.d(o,"startForAxis",(function(){return xb})),n.d(o,"stopForAxis",(function(){return Cb})),n.d(o,"isSliceContinous",(function(){return Sb})),n.d(o,"computeFlatOffset",(function(){return Tb}));var s={};n.r(s),n.d(s,"copyModel",(function(){return ok})),n.d(s,"listModels",(function(){return nk})),n.d(s,"moveModel",(function(){return uk})),n.d(s,"removeModel",(function(){return ak})),n.d(s,"browserFiles",(function(){return Ik})),n.d(s,"browserHTTPRequest",(function(){return Uk})),n.d(s,"concatenateArrayBuffers",(function(){return Hb})),n.d(s,"decodeWeights",(function(){return Ub})),n.d(s,"encodeWeights",(function(){return zb})),n.d(s,"fromMemory",(function(){return jk})),n.d(s,"getLoadHandlers",(function(){return Zb})),n.d(s,"getModelArtifactsInfoForJSON",(function(){return Gb})),n.d(s,"getSaveHandlers",(function(){return Qb})),n.d(s,"http",(function(){return Bk})),n.d(s,"isHTTPScheme",(function(){return Pk})),n.d(s,"loadWeights",(function(){return Dk})),n.d(s,"registerLoadRouter",(function(){return Yb})),n.d(s,"registerSaveRouter",(function(){return Xb})),n.d(s,"weightsLoaderFactory",(function(){return Mk})),n.d(s,"withSaveHandler",(function(){return Hk}));var u={};n.r(u),n.d(u,"toPixels",(function(){return Kk})),n.d(u,"fromPixels",(function(){return Yk}));var c={};n.r(c),n.d(c,"Serializable",(function(){return e_})),n.d(c,"SerializationMap",(function(){return t_})),n.d(c,"registerClass",(function(){return n_}));var l={};n.r(l),n.d(l,"segOpComputeOptimalWindowSize",(function(){return iw})),n.d(l,"computeOutShape",(function(){return ow})),n.d(l,"collectGatherOpShapeInfo",(function(){return sw}));var h={};n.r(h),n.d(h,"fft",(function(){return Yw})),n.d(h,"ifft",(function(){return Qw})),n.d(h,"rfft",(function(){return Zw})),n.d(h,"irfft",(function(){return $w}));var f={};n.r(f),n.d(f,"hannWindow",(function(){return ax})),n.d(f,"hammingWindow",(function(){return ix})),n.d(f,"frame",(function(){return ox})),n.d(f,"stft",(function(){return sx}));var d={};n.r(d),n.d(d,"Reduction",(function(){return rx})),n.d(d,"absoluteDifference",(function(){return cx})),n.d(d,"computeWeightedLoss",(function(){return lx})),n.d(d,"cosineDistance",(function(){return hx})),n.d(d,"hingeLoss",(function(){return fx})),n.d(d,"huberLoss",(function(){return dx})),n.d(d,"logLoss",(function(){return px})),n.d(d,"meanSquaredError",(function(){return vx})),n.d(d,"sigmoidCrossEntropy",(function(){return mx})),n.d(d,"softmaxCrossEntropy",(function(){return gx}));var p={};n.r(p),n.d(p,"bandPart",(function(){return bx})),n.d(p,"gramSchmidt",(function(){return kx})),n.d(p,"qr",(function(){return _x}));var v={};n.r(v),n.d(v,"nonMaxSuppression",(function(){return Nx})),n.d(v,"resizeBilinear",(function(){return Ox})),n.d(v,"resizeNearestNeighbor",(function(){return Dx})),n.d(v,"nonMaxSuppressionAsync",(function(){return Fx})),n.d(v,"nonMaxSuppressionWithScore",(function(){return Mx})),n.d(v,"nonMaxSuppressionWithScoreAsync",(function(){return Lx})),n.d(v,"cropAndResize",(function(){return Px}));var m={};n.r(m),n.d(m,"matMul",(function(){return Vx})),n.d(m,"conv2d",(function(){return jx})),n.d(m,"depthwiseConv2d",(function(){return Hx}));var g={};n.r(g),n.d(g,"add",(function(){return ay})),n.d(g,"addN",(function(){return r_})),n.d(g,"batchToSpaceND",(function(){return db})),n.d(g,"batchNorm",(function(){return i_})),n.d(g,"batchNorm2d",(function(){return o_})),n.d(g,"batchNorm3d",(function(){return s_})),n.d(g,"batchNorm4d",(function(){return u_})),n.d(g,"broadcastTo",(function(){return l_})),n.d(g,"clone",(function(){return c_})),n.d(g,"concat",(function(){return $m})),n.d(g,"concat1d",(function(){return h_})),n.d(g,"concat2d",(function(){return f_})),n.d(g,"concat3d",(function(){return d_})),n.d(g,"concat4d",(function(){return p_})),n.d(g,"conv1d",(function(){return v_})),n.d(g,"conv2d",(function(){return jg})),n.d(g,"conv2dTranspose",(function(){return m_})),n.d(g,"conv3d",(function(){return g_})),n.d(g,"conv3dTranspose",(function(){return y_})),n.d(g,"depthToSpace",(function(){return b_})),n.d(g,"depthwiseConv2d",(function(){return k_})),n.d(g,"diag",(function(){return __})),n.d(g,"div",(function(){return tb})),n.d(g,"divNoNan",(function(){return I_})),n.d(g,"dot",(function(){return R_})),n.d(g,"equal",(function(){return N_})),n.d(g,"eye",(function(){return O_})),n.d(g,"greater",(function(){return D_})),n.d(g,"greaterEqual",(function(){return F_})),n.d(g,"less",(function(){return M_})),n.d(g,"lessEqual",(function(){return L_})),n.d(g,"localResponseNormalization",(function(){return P_})),n.d(g,"matMul",(function(){return cg})),n.d(g,"max",(function(){return z_})),n.d(g,"multinomial",(function(){return B_})),n.d(g,"notEqual",(function(){return U_})),n.d(g,"oneHot",(function(){return Gk})),n.d(g,"outerProduct",(function(){return W_})),n.d(g,"pad",(function(){return bb})),n.d(g,"pad1d",(function(){return V_})),n.d(g,"pad2d",(function(){return j_})),n.d(g,"pad3d",(function(){return H_})),n.d(g,"pad4d",(function(){return q_})),n.d(g,"rand",(function(){return G_})),n.d(g,"randomGamma",(function(){return Z_})),n.d(g,"randomNormal",(function(){return $_})),n.d(g,"randomUniform",(function(){return J_})),n.d(g,"separableConv2d",(function(){return ew})),n.d(g,"spaceToBatchND",(function(){return hg})),n.d(g,"split",(function(){return Tg})),n.d(g,"square",(function(){return nb})),n.d(g,"squaredDifference",(function(){return tw})),n.d(g,"sub",(function(){return ab})),n.d(g,"tile",(function(){return ib})),n.d(g,"truncatedNormal",(function(){return nw})),n.d(g,"booleanMaskAsync",(function(){return fw})),n.d(g,"complex",(function(){return Om})),n.d(g,"real",(function(){return Dm})),n.d(g,"imag",(function(){return Fm})),n.d(g,"reverse",(function(){return dw})),n.d(g,"reverse1d",(function(){return pw})),n.d(g,"reverse2d",(function(){return vw})),n.d(g,"reverse3d",(function(){return mw})),n.d(g,"reverse4d",(function(){return gw})),n.d(g,"maxPool",(function(){return kw})),n.d(g,"avgPool",(function(){return _w})),n.d(g,"pool",(function(){return ww})),n.d(g,"maxPool3d",(function(){return xw})),n.d(g,"avgPool3d",(function(){return Cw})),n.d(g,"maxPoolWithArgmax",(function(){return Sw})),n.d(g,"slice",(function(){return Rb})),n.d(g,"slice1d",(function(){return Nb})),n.d(g,"slice2d",(function(){return Ob})),n.d(g,"slice3d",(function(){return Db})),n.d(g,"slice4d",(function(){return Fb})),n.d(g,"abs",(function(){return iy})),n.d(g,"acos",(function(){return oy})),n.d(g,"acosh",(function(){return sy})),n.d(g,"asin",(function(){return uy})),n.d(g,"asinh",(function(){return cy})),n.d(g,"atan",(function(){return ly})),n.d(g,"atanh",(function(){return hy})),n.d(g,"ceil",(function(){return fy})),n.d(g,"clipByValue",(function(){return dy})),n.d(g,"cos",(function(){return py})),n.d(g,"cosh",(function(){return vy})),n.d(g,"erf",(function(){return my})),n.d(g,"exp",(function(){return gy})),n.d(g,"expm1",(function(){return yy})),n.d(g,"floor",(function(){return by})),n.d(g,"log",(function(){return ky})),n.d(g,"log1p",(function(){return _y})),n.d(g,"logSigmoid",(function(){return wy})),n.d(g,"neg",(function(){return xy})),n.d(g,"reciprocal",(function(){return Cy})),n.d(g,"round",(function(){return Sy})),n.d(g,"rsqrt",(function(){return Ty})),n.d(g,"sigmoid",(function(){return Ey})),n.d(g,"sign",(function(){return Ay})),n.d(g,"isNaN",(function(){return Iy})),n.d(g,"isInf",(function(){return Ry})),n.d(g,"isFinite",(function(){return Ny})),n.d(g,"sin",(function(){return Oy})),n.d(g,"sinh",(function(){return Dy})),n.d(g,"softplus",(function(){return Fy})),n.d(g,"sqrt",(function(){return My})),n.d(g,"step",(function(){return Ly})),n.d(g,"tan",(function(){return Py})),n.d(g,"tanh",(function(){return zy})),n.d(g,"all",(function(){return vg})),n.d(g,"any",(function(){return mg})),n.d(g,"argMax",(function(){return gg})),n.d(g,"argMin",(function(){return yg})),n.d(g,"logSumExp",(function(){return bg})),n.d(g,"mean",(function(){return kg})),n.d(g,"min",(function(){return _g})),n.d(g,"moments",(function(){return wg})),n.d(g,"sum",(function(){return xg})),n.d(g,"prod",(function(){return Cg})),n.d(g,"equalStrict",(function(){return Tw})),n.d(g,"greaterEqualStrict",(function(){return Ew})),n.d(g,"greaterStrict",(function(){return Aw})),n.d(g,"lessEqualStrict",(function(){return Iw})),n.d(g,"lessStrict",(function(){return Rw})),n.d(g,"notEqualStrict",(function(){return Nw})),n.d(g,"addStrict",(function(){return By})),n.d(g,"atan2",(function(){return Uy})),n.d(g,"divStrict",(function(){return Wy})),n.d(g,"floorDiv",(function(){return Vy})),n.d(g,"maximum",(function(){return jy})),n.d(g,"maximumStrict",(function(){return Hy})),n.d(g,"minimum",(function(){return qy})),n.d(g,"minimumStrict",(function(){return Gy})),n.d(g,"mod",(function(){return Ky})),n.d(g,"modStrict",(function(){return Xy})),n.d(g,"mul",(function(){return Yy})),n.d(g,"mulStrict",(function(){return Qy})),n.d(g,"pow",(function(){return Zy})),n.d(g,"powStrict",(function(){return $y})),n.d(g,"squaredDifferenceStrict",(function(){return Jy})),n.d(g,"subStrict",(function(){return eb})),n.d(g,"elu",(function(){return Fw})),n.d(g,"leakyRelu",(function(){return Mw})),n.d(g,"prelu",(function(){return Lw})),n.d(g,"relu",(function(){return Pw})),n.d(g,"relu6",(function(){return zw})),n.d(g,"selu",(function(){return Bw})),n.d(g,"logicalAnd",(function(){return x_})),n.d(g,"logicalNot",(function(){return C_})),n.d(g,"logicalOr",(function(){return S_})),n.d(g,"logicalXor",(function(){return T_})),n.d(g,"where",(function(){return E_})),n.d(g,"whereAsync",(function(){return A_})),n.d(g,"buffer",(function(){return Jm})),n.d(g,"print",(function(){return eg})),n.d(g,"cast",(function(){return tg})),n.d(g,"cumsum",(function(){return ng})),n.d(g,"expandDims",(function(){return rg})),n.d(g,"reshape",(function(){return ag})),n.d(g,"squeeze",(function(){return ig})),n.d(g,"stack",(function(){return og})),n.d(g,"unstack",(function(){return sg})),n.d(g,"setdiff1dAsync",(function(){return ug})),n.d(g,"fill",(function(){return Km})),n.d(g,"linspace",(function(){return Xm})),n.d(g,"ones",(function(){return qm})),n.d(g,"range",(function(){return Ym})),n.d(g,"scalar",(function(){return Pm})),n.d(g,"tensor",(function(){return Mm})),n.d(g,"tensor1d",(function(){return zm})),n.d(g,"tensor2d",(function(){return Bm})),n.d(g,"tensor3d",(function(){return Um})),n.d(g,"tensor4d",(function(){return Wm})),n.d(g,"tensor5d",(function(){return Vm})),n.d(g,"tensor6d",(function(){return jm})),n.d(g,"variable",(function(){return Hm})),n.d(g,"zeros",(function(){return Gm})),n.d(g,"onesLike",(function(){return Qm})),n.d(g,"zerosLike",(function(){return Zm})),n.d(g,"transpose",(function(){return lb})),n.d(g,"softmax",(function(){return Uw})),n.d(g,"logSoftmax",(function(){return Ww})),n.d(g,"norm",(function(){return Vw})),n.d(g,"gather",(function(){return lw})),n.d(g,"unsortedSegmentSum",(function(){return hw})),n.d(g,"basicLSTMCell",(function(){return jw})),n.d(g,"multiRNNCell",(function(){return Hw})),n.d(g,"movingAverage",(function(){return qw})),n.d(g,"stridedSlice",(function(){return Gw})),n.d(g,"topk",(function(){return Kw})),n.d(g,"scatterND",(function(){return Xw})),n.d(g,"fft",(function(){return Yw})),n.d(g,"ifft",(function(){return Qw})),n.d(g,"rfft",(function(){return Zw})),n.d(g,"irfft",(function(){return $w})),n.d(g,"sparseToDense",(function(){return Jw})),n.d(g,"gatherND",(function(){return ex})),n.d(g,"dropout",(function(){return tx})),n.d(g,"hannWindow",(function(){return ax})),n.d(g,"hammingWindow",(function(){return ix})),n.d(g,"frame",(function(){return ox})),n.d(g,"stft",(function(){return sx})),n.d(g,"inTopKAsync",(function(){return ux})),n.d(g,"op",(function(){return Nm})),n.d(g,"image",(function(){return v})),n.d(g,"linalg",(function(){return p})),n.d(g,"losses",(function(){return d})),n.d(g,"spectral",(function(){return h})),n.d(g,"fused",(function(){return m})),n.d(g,"signal",(function(){return f}));var y={};n.r(y),n.d(y,"axesAreInnerMostDims",(function(){return _m})),n.d(y,"combineLocations",(function(){return wm})),n.d(y,"computeOutAndReduceShapes",(function(){return xm})),n.d(y,"expandShapeToKeepDim",(function(){return Cm})),n.d(y,"assertAxesAreInnerMostDims",(function(){return Sm})),n.d(y,"getAxesPermutation",(function(){return Tm})),n.d(y,"getUndoAxesPermutation",(function(){return Em})),n.d(y,"getInnerMostAxes",(function(){return Am})),n.d(y,"getBroadcastDims",(function(){return dm})),n.d(y,"getReductionAxes",(function(){return pm})),n.d(y,"assertAndGetBroadcastShape",(function(){return vm})),n.d(y,"assertParamsConsistent",(function(){return Im})),n.d(y,"computeOutShape",(function(){return Rm})),n.d(y,"computePool2DInfo",(function(){return Ag})),n.d(y,"computePool3DInfo",(function(){return Ig})),n.d(y,"computeConv2DInfo",(function(){return Rg})),n.d(y,"computeConv3DInfo",(function(){return Ng})),n.d(y,"computeDefaultPad",(function(){return Og})),n.d(y,"tupleValuesAreOne",(function(){return Pg})),n.d(y,"eitherStridesOrDilationsAreOne",(function(){return zg})),n.d(y,"convertConv2DDataFormat",(function(){return Bg})),n.d(y,"PARALLELIZE_THRESHOLD",(function(){return rw})),n.d(y,"computeOptimalWindowSize",(function(){return aw})),n.d(y,"nonMaxSuppressionV3",(function(){return Cx})),n.d(y,"nonMaxSuppressionV5",(function(){return Sx})),n.d(y,"upcastType",(function(){return tm})),n.d(y,"getReshaped",(function(){return rC})),n.d(y,"getPermuted",(function(){return aC})),n.d(y,"getReshapedPermuted",(function(){return iC})),n.d(y,"getSliceBeginCoords",(function(){return oC})),n.d(y,"getSliceSize",(function(){return sC})),n.d(y,"prepareAndValidate",(function(){return Qk})),n.d(y,"validateUpdateShape",(function(){return Zk})),n.d(y,"validateInput",(function(){return $k})),n.d(y,"calculateShapes",(function(){return Jk})),n.d(y,"SELU_SCALEALPHA",(function(){return Ow})),n.d(y,"SELU_SCALE",(function(){return Dw})),n.d(y,"shouldFuse",(function(){return zx})),n.d(y,"ERF_P",(function(){return uC})),n.d(y,"ERF_A1",(function(){return cC})),n.d(y,"ERF_A2",(function(){return lC})),n.d(y,"ERF_A3",(function(){return hC})),n.d(y,"ERF_A4",(function(){return fC})),n.d(y,"ERF_A5",(function(){return dC})),n.d(y,"warn",(function(){return pC})),n.d(y,"log",(function(){return vC})),n.d(y,"mergeRealAndImagArrays",(function(){return mC})),n.d(y,"splitRealAndImagArrays",(function(){return gC})),n.d(y,"complexWithEvenIndex",(function(){return yC})),n.d(y,"complexWithOddIndex",(function(){return bC})),n.d(y,"getComplexWithIndex",(function(){return kC})),n.d(y,"assignToTypedArray",(function(){return _C})),n.d(y,"exponents",(function(){return wC})),n.d(y,"exponent",(function(){return xC})),n.d(y,"segment_util",(function(){return l})),n.d(y,"castTensor",(function(){return CC})),n.d(y,"reshapeTensor",(function(){return SC})),n.d(y,"linspaceImpl",(function(){return TC}));var b={};n.r(b),n.d(b,"nonMaxSuppressionV3",(function(){return Cx})),n.d(b,"nonMaxSuppressionV5",(function(){return Sx})),n.d(b,"split",(function(){return EC})),n.d(b,"tile",(function(){return AC})),n.d(b,"topkImpl",(function(){return IC})),n.d(b,"whereImpl",(function(){return w_}));var k={};n.r(k),n.d(k,"json",(function(){return VI}));var _={};n.r(_),n.d(_,"json",(function(){return jI}));var w={};n.r(w),n.d(w,"json",(function(){return HI}));var x={};n.r(x),n.d(x,"json",(function(){return qI}));var C={};n.r(C),n.d(C,"json",(function(){return GI}));var S={};n.r(S),n.d(S,"json",(function(){return KI}));var T={};n.r(T),n.d(T,"json",(function(){return XI}));var E={};n.r(E),n.d(E,"json",(function(){return YI}));var A={};n.r(A),n.d(A,"json",(function(){return QI}));var I={};n.r(I),n.d(I,"json",(function(){return ZI}));var R={};n.r(R),n.d(R,"json",(function(){return $I}));var N={};n.r(N),n.d(N,"json",(function(){return JI}));var O={};n.r(O),n.d(O,"json",(function(){return eR}));var D={};n.r(D),n.d(D,"json",(function(){return tR}));var F={};n.r(F),n.d(F,"json",(function(){return nR}));var M={};n.r(M),n.d(M,"json",(function(){return rR}));var L={};function P(e){return"function"==typeof e}n.r(L),n.d(L,"maxImpl",(function(){return AR})),n.d(L,"transposeImpl",(function(){return IR}));var z=!1,B={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else z&&console.log("RxJS: Back to a better error behavior. Thank you. <3");z=e},get useDeprecatedSynchronousErrorHandling(){return z}};function U(e){setTimeout((function(){throw e}),0)}var W={closed:!0,next:function(e){},error:function(e){if(B.useDeprecatedSynchronousErrorHandling)throw e;U(e)},complete:function(){}},V=Array.isArray||function(e){return e&&"number"==typeof e.length};function j(e){return null!==e&&"object"==typeof e}var H,q=function(){function e(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map((function(e,t){return"".concat(t+1,") ").concat(e.toString())})).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),G=((H=function(){function e(t){_classCallCheck(this,e),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return _createClass(e,[{key:"unsubscribe",value:function(){var t;if(!this.closed){var n=this._parentOrParents,r=this._unsubscribe,a=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var i=0;i<n.length;++i)n[i].remove(this);if(P(r))try{r.call(this)}catch(c){t=c instanceof q?K(c.errors):[c]}if(V(a))for(var o=-1,s=a.length;++o<s;){var u=a[o];if(j(u))try{u.unsubscribe()}catch(c){t=t||[],c instanceof q?t=t.concat(K(c.errors)):t.push(c)}}if(t)throw new q(t)}}},{key:"add",value:function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var a=n._parentOrParents;if(null===a)n._parentOrParents=this;else if(a instanceof e){if(a===this)return n;n._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return n;a.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}]),e}()).EMPTY=function(e){return e.closed=!0,e}(new H),H);function K(e){return e.reduce((function(e,t){return e.concat(t instanceof q?t.errors:t)}),[])}var X="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),Y=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;switch(_classCallCheck(this,n),(i=t.call(this)).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=W;break;case 1:if(!e){i.destination=W;break}if("object"==typeof e){e instanceof n?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(_assertThisInitialized(i))):(i.syncErrorThrowable=!0,i.destination=new Q(_assertThisInitialized(i),e));break}default:i.syncErrorThrowable=!0,i.destination=new Q(_assertThisInitialized(i),e,r,a)}return i}return _createClass(n,[{key:X,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(n.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}],[{key:"create",value:function(e,t,r){var a=new n(e,t,r);return a.syncErrorThrowable=!1,a}}]),n}(G),Q=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o,s;_classCallCheck(this,n),(o=t.call(this))._parentSubscriber=e;var u=_assertThisInitialized(o);return P(r)?s=r:r&&(s=r.next,a=r.error,i=r.complete,r!==W&&(P((u=Object.create(r)).unsubscribe)&&o.add(u.unsubscribe.bind(u)),u.unsubscribe=o.unsubscribe.bind(_assertThisInitialized(o)))),o._context=u,o._next=s,o._error=a,o._complete=i,o}return _createClass(n,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;B.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,n=B.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):U(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;U(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};B.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),B.useDeprecatedSynchronousErrorHandling)throw n;U(n)}}},{key:"__tryOrSetError",value:function(e,t,n){if(!B.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return B.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(U(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),n}(Y),Z="function"==typeof Symbol&&Symbol.observable||"@@observable";function $(e){return e}function J(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ee(t)}function ee(e){return 0===e.length?$:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var te,ne=((te=function(){function e(t){_classCallCheck(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return _createClass(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this.operator,a=function(e,t,n){if(e){if(e instanceof Y)return e;if(e[X])return e[X]()}return e||t||n?new Y(e,t,n):new Y(W)}(e,t,n);if(a.add(r?r.call(a,this.source):this.source||B.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),B.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){B.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,a=t.isStopped;if(n||a)return!1;e=r&&r instanceof Y?r:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=re(t))((function(t,r){var a;a=n.subscribe((function(t){try{e(t)}catch(n){r(n),a&&a.unsubscribe()}}),r,t)}))}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:Z,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this:ee(t)(this)}},{key:"toPromise",value:function(e){var t=this;return new(e=re(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))}}]),e}()).create=function(e){return new te(e)},te);function re(e){if(e||(e=B.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var ae,ie=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),oe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).subject=e,a.subscriber=r,a.closed=!1,a}return _createClass(n,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}}}]),n}(G),se=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).destination=e,r}return n}(Y),ue=((ae=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _createClass(n,[{key:X,value:function(){return new se(this)}},{key:"lift",value:function(e){var t=new ce(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new ie;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].next(e)}},{key:"error",value:function(e){if(this.closed)throw new ie;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new ie;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new ie;return _get(_getPrototypeOf(n.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new ie;return this.hasError?(e.error(this.thrownError),G.EMPTY):this.isStopped?(e.complete(),G.EMPTY):(this.observers.push(e),new oe(this,e))}},{key:"asObservable",value:function(){var e=new ne;return e.source=this,e}}]),n}(ne)).create=function(e,t){return new ce(e,t)},ae),ce=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).destination=e,a.source=r,a}return _createClass(n,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):G.EMPTY}}]),n}(ue);function le(e){return e&&"function"==typeof e.schedule}var he=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this)).parent=e,i.outerValue=r,i.outerIndex=a,i.index=0,i}return _createClass(n,[{key:"_next",value:function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}},{key:"_error",value:function(e){this.parent.notifyError(e,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),n}(Y),fe=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};var de="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",pe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ve(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var me=function(e){if(e&&"function"==typeof e[Z])return r=e,function(e){var t=r[Z]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(pe(e))return fe(e);if(ve(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,U),e};if(e&&"function"==typeof e[de])return t=e,function(e){for(var n=t[de]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,a=j(e)?"an invalid object":"'".concat(e,"'");throw new TypeError("You provided ".concat(a," where a stream was expected.")+" You can provide an Observable, Promise, Array, or Iterable.")};function ge(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new he(e,n,r);if(!a.closed)return t instanceof ne?t.subscribe(a):me(t)(a)}var ye=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}},{key:"notifyError",value:function(e,t){this.destination.error(e)}},{key:"notifyComplete",value:function(e){this.destination.complete()}}]),n}(Y);function be(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new ke(e,t))}}var ke=function(){function e(t,n){_classCallCheck(this,e),this.project=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new _e(e,this.project,this.thisArg))}}]),e}(),_e=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).project=r,i.count=0,i.thisArg=a||_assertThisInitialized(i),i}return _createClass(n,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(Y);function we(e,t){return new ne((function(n){var r=new G,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function xe(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[Z]}(e))return function(e,t){return new ne((function(n){var r=new G;return r.add(t.schedule((function(){var a=e[Z]();r.add(a.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(ve(e))return function(e,t){return new ne((function(n){var r=new G;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(pe(e))return we(e,t);if(function(e){return e&&"function"==typeof e[de]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new ne((function(n){var r,a=new G;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(t.schedule((function(){r=e[de](),a.add(t.schedule((function(){if(!n.closed){var e,t;try{var a=r.next();e=a.value,t=a.done}catch(i){return void n.error(i)}t?n.complete():(n.next(e),this.schedule())}})))}))),a}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof ne?e:new ne(me(e))}function Ce(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof t?function(r){return r.pipe(Ce((function(n,r){return xe(e(n,r)).pipe(be((function(e,a){return t(n,e,r,a)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Se(e,n))})}var Se=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck(this,e),this.project=t,this.concurrent=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Te(e,this.project,this.concurrent))}}]),e}(),Te=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck(this,n),(a=t.call(this,e)).project=r,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return _createClass(n,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=new he(this,t,n),a=this.destination;a.add(r);var i=ge(this,e,void 0,void 0,r);i!==r&&a.add(i)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}},{key:"notifyComplete",value:function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),n}(ye);function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return Ce($,e)}function Ae(e,t){return t?we(e,t):new ne(fe(e))}function Ie(){return function(e){return e.lift(new Ne(e))}}var Re,Ne=function(){function e(t){_classCallCheck(this,e),this.connectable=t}return _createClass(e,[{key:"call",value:function(e,t){var n=this.connectable;n._refCount++;var r=new Oe(e,n),a=t.subscribe(r);return r.closed||(r.connection=n.connect()),a}}]),e}(),Oe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).connectable=r,a}return _createClass(n,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}]),n}(Y),De={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(Re=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).source=e,a.subjectFactory=r,a._refCount=0,a._isComplete=!1,a}return _createClass(n,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new G).add(this.source.subscribe(new Fe(this.getSubject(),this))),e.closed&&(this._connection=null,e=G.EMPTY)),e}},{key:"refCount",value:function(){return Ie()(this)}}]),n}(ne).prototype)._subscribe},_isComplete:{value:Re._isComplete,writable:!0},getSubject:{value:Re.getSubject},connect:{value:Re.connect},refCount:{value:Re.refCount}},Fe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).connectable=r,a}return _createClass(n,[{key:"_error",value:function(e){this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),n}(se);function Me(){return new ue}function Le(){return function(e){return Ie()((t=Me,function(e){var n;n="function"==typeof t?t:function(){return t};var r=Object.create(e,De);return r.source=e,r.subjectFactory=n,r})(e));var t}}function Pe(e){return{toString:e}.toString()}function ze(e,t,n){return Pe((function(){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof a)return r.apply(this,t),this;var i=_construct(a,t);return o.annotation=i,o;function o(e,t,n){for(var r=e.hasOwnProperty("__parameters__")?e.__parameters__:Object.defineProperty(e,"__parameters__",{value:[]}).__parameters__;r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),e}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a}))}var Be=ze("Inject",(function(e){return{token:e}})),Ue=ze("Optional"),We=ze("Self"),Ve=ze("SkipSelf"),je=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function He(e){for(var t in e)if(e[t]===He)return t;throw Error("Could not find renamed property on target object.")}function qe(e,t){for(var n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Ge(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ke(e){return{factory:e.factory,providers:e.providers||[],imports:e.imports||[]}}function Xe(e){return Ye(e,e[Ze])||Ye(e,e[et])}function Ye(e,t){return t&&t.token===e?t:null}function Qe(e){return e&&(e.hasOwnProperty($e)||e.hasOwnProperty(tt))?e[$e]:null}var Ze=He({"\u0275prov":He}),$e=He({"\u0275inj":He}),Je=He({"\u0275provFallback":He}),et=He({ngInjectableDef:He}),tt=He({ngInjectorDef:He});function nt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(nt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return"".concat(e.overriddenName);if(e.name)return"".concat(e.name);var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function rt(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}var at=He({__forward_ref__:He});function it(e){return e.__forward_ref__=it,e.toString=function(){return nt(this())},e}function ot(e){return"function"==typeof(t=e)&&t.hasOwnProperty(at)&&t.__forward_ref__===it?e():e;var t}var st,ut="undefined"!=typeof globalThis&&globalThis,ct="undefined"!=typeof window&&window,lt="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ht="undefined"!=typeof global&&global,ft=ut||ht||ct||lt,dt=He({"\u0275cmp":He}),pt=He({"\u0275dir":He}),vt=He({"\u0275pipe":He}),mt=He({"\u0275mod":He}),gt=He({"\u0275loc":He}),yt=He({"\u0275fac":He}),bt=He({__NG_ELEMENT_ID__:He}),kt=function(){function e(t,n){_classCallCheck(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Ge({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return _createClass(e,[{key:"toString",value:function(){return"InjectionToken ".concat(this._desc)}}]),e}(),_t=new kt("INJECTOR",-1),wt={},xt=/\n/gm,Ct=He({provide:String,useValue:He}),St=void 0;function Tt(e){var t=St;return St=e,t}function Et(e){var t=st;return st=e,t}function At(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je.Default;if(void 0===St)throw new Error("inject() must be called from an injection context");return null===St?Nt(e,void 0,t):St.get(e,t&je.Optional?null:void 0,t)}function It(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je.Default;return(st||At)(ot(e),t)}var Rt=It;function Nt(e,t,n){var r=Xe(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&je.Optional)return null;if(void 0!==t)return t;throw new Error("Injector: NOT_FOUND [".concat(nt(e),"]"))}function Ot(e){for(var t=[],n=0;n<e.length;n++){var r=ot(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");for(var a=void 0,i=je.Default,o=0;o<r.length;o++){var s=r[o];s instanceof Ue||"Optional"===s.ngMetadataName||s===Ue?i|=je.Optional:s instanceof Ve||"SkipSelf"===s.ngMetadataName||s===Ve?i|=je.SkipSelf:s instanceof We||"Self"===s.ngMetadataName||s===We?i|=je.Self:a=s instanceof Be||s===Be?s.token:s}t.push(It(a,i))}else t.push(It(r))}return t}var Dt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wt;if(t===wt){var n=new Error("NullInjectorError: No provider for ".concat(nt(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}(),Ft=function e(){_classCallCheck(this,e)},Mt=function e(){_classCallCheck(this,e)};function Lt(e,t){e.forEach((function(e){return Array.isArray(e)?Lt(e,t):t(e)}))}function Pt(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function zt(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Bt(e,t){for(var n=[],r=0;r<e;r++)n.push(t);return n}function Ut(e,t){var n=Wt(e,t);if(n>=0)return e[1|n]}function Wt(e,t){return function(e,t,n){for(var r=0,a=e.length>>1;a!==r;){var i=r+(a-r>>1),o=e[i<<1];if(t===o)return i<<1;o>t?a=i:r=i+1}return~(a<<1)}(e,t)}var Vt=function(){var e={OnPush:0,Default:1};return e[e.OnPush]="OnPush",e[e.Default]="Default",e}(),jt=function(){var e={Emulated:0,Native:1,None:2,ShadowDom:3};return e[e.Emulated]="Emulated",e[e.Native]="Native",e[e.None]="None",e[e.ShadowDom]="ShadowDom",e}(),Ht={},qt=[],Gt=0;function Kt(e){return Pe((function(){var t=e.type,n=t.prototype,r={},a={type:t,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onChanges:null,onInit:n.ngOnInit||null,doCheck:n.ngDoCheck||null,afterContentInit:n.ngAfterContentInit||null,afterContentChecked:n.ngAfterContentChecked||null,afterViewInit:n.ngAfterViewInit||null,afterViewChecked:n.ngAfterViewChecked||null,onDestroy:n.ngOnDestroy||null,onPush:e.changeDetection===Vt.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||qt,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||jt.Emulated,id:"c",styles:e.styles||qt,_:null,setInput:null,schemas:e.schemas||null,tView:null},i=e.directives,o=e.features,s=e.pipes;return a.id+=Gt++,a.inputs=$t(e.inputs,r),a.outputs=$t(e.outputs),o&&o.forEach((function(e){return e(a)})),a.directiveDefs=i?function(){return("function"==typeof i?i():i).map(Xt)}:null,a.pipeDefs=s?function(){return("function"==typeof s?s():s).map(Yt)}:null,a}))}function Xt(e){return en(e)||function(e){return e[pt]||null}(e)}function Yt(e){return function(e){return e[vt]||null}(e)}var Qt={};function Zt(e){var t={type:e.type,bootstrap:e.bootstrap||qt,declarations:e.declarations||qt,imports:e.imports||qt,exports:e.exports||qt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&Pe((function(){Qt[e.id]=e.type})),t}function $t(e,t){if(null==e)return Ht;var n={};for(var r in e)if(e.hasOwnProperty(r)){var a=e[r],i=a;Array.isArray(a)&&(i=a[1],a=a[0]),n[a]=r,t&&(t[a]=i)}return n}var Jt=Kt;function en(e){return e[dt]||null}function tn(e,t){return e.hasOwnProperty(yt)?e[yt]:null}function nn(e,t){var n=e[mt]||null;if(!n&&!0===t)throw new Error("Type ".concat(nt(e)," does not have '\u0275mod' property."));return n}function rn(e){return Array.isArray(e)&&"object"==typeof e[1]}function an(e){return Array.isArray(e)&&!0===e[1]}function on(e){return 0!=(8&e.flags)}function sn(e){return 2==(2&e.flags)}function un(e){return 1==(1&e.flags)}function cn(e){return null!==e.template}function ln(e){return 0!=(512&e[2])}var hn=void 0;function fn(e){return!!e.listen}var dn={createRenderer:function(e,t){return void 0!==hn?hn:"undefined"!=typeof document?document:void 0}};function pn(e){for(;Array.isArray(e);)e=e[0];return e}function vn(e,t){return pn(t[e+20])}function mn(e,t){return pn(t[e.index])}function gn(e,t){return e.data[t+20]}function yn(e,t){var n=t[e];return rn(n)?n:n[0]}function bn(e){var t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function kn(e){return 4==(4&e[2])}function _n(e){return 128==(128&e[2])}function wn(e,t){return null===e||null==t?null:e[t]}function xn(e){e[18]=0}function Cn(e,t){e[5]+=t;for(var n=e,r=e[3];null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}var Sn={lFrame:jn(null),bindingsEnabled:!0,checkNoChangesMode:!1};function Tn(){return Sn.bindingsEnabled}function En(){return Sn.lFrame.lView}function An(){return Sn.lFrame.tView}function In(){return Sn.lFrame.previousOrParentTNode}function Rn(e,t){Sn.lFrame.previousOrParentTNode=e,Sn.lFrame.isParent=t}function Nn(){return Sn.lFrame.isParent}function On(){Sn.lFrame.isParent=!1}function Dn(){return Sn.checkNoChangesMode}function Fn(e){Sn.checkNoChangesMode=e}function Mn(){return Sn.lFrame.bindingIndex++}function Ln(e,t){var n=Sn.lFrame;n.bindingIndex=n.bindingRootIndex=e,Pn(t)}function Pn(e){Sn.lFrame.currentDirectiveIndex=e}function zn(){return Sn.lFrame.currentQueryIndex}function Bn(e){Sn.lFrame.currentQueryIndex=e}function Un(e,t){var n=Vn();Sn.lFrame=n,n.previousOrParentTNode=t,n.lView=e}function Wn(e,t){var n=Vn(),r=e[1];Sn.lFrame=n,n.previousOrParentTNode=t,n.lView=e,n.tView=r,n.contextLView=e,n.bindingIndex=r.bindingStartIndex}function Vn(){var e=Sn.lFrame,t=null===e?null:e.child;return null===t?jn(e):t}function jn(e){var t={previousOrParentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:0,contextLView:null,elementDepthCount:0,currentNamespace:null,currentSanitizer:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null};return null!==e&&(e.child=t),t}function Hn(){var e=Sn.lFrame;return Sn.lFrame=e.parent,e.previousOrParentTNode=null,e.lView=null,e}var qn=Hn;function Gn(){var e=Hn();e.isParent=!0,e.tView=null,e.selectedIndex=0,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.currentSanitizer=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Kn(){return Sn.lFrame.selectedIndex}function Xn(e){Sn.lFrame.selectedIndex=e}function Yn(){var e=Sn.lFrame;return gn(e.tView,e.selectedIndex)}function Qn(e,t){for(var n=t.directiveStart,r=t.directiveEnd;n<r;n++){var a=e.data[n];a.afterContentInit&&(e.contentHooks||(e.contentHooks=[])).push(-n,a.afterContentInit),a.afterContentChecked&&((e.contentHooks||(e.contentHooks=[])).push(n,a.afterContentChecked),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,a.afterContentChecked)),a.afterViewInit&&(e.viewHooks||(e.viewHooks=[])).push(-n,a.afterViewInit),a.afterViewChecked&&((e.viewHooks||(e.viewHooks=[])).push(n,a.afterViewChecked),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,a.afterViewChecked)),null!=a.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a.onDestroy)}}function Zn(e,t,n){er(e,t,3,n)}function $n(e,t,n,r){(3&e[2])===n&&er(e,t,n,r)}function Jn(e,t){var n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function er(e,t,n,r){for(var a=null!=r?r:-1,i=0,o=void 0!==r?65535&e[18]:0;o<t.length;o++)if("number"==typeof t[o+1]){if(i=t[o],null!=r&&i>=r)break}else t[o]<0&&(e[18]+=65536),(i<a||-1==a)&&(tr(e,n,t,o),e[18]=(4294901760&e[18])+o+2),o++}function tr(e,t,n,r){var a=n[r]<0,i=n[r+1],o=e[a?-n[r]:n[r]];a?e[2]>>11<e[18]>>16&&(3&e[2])===t&&(e[2]+=2048,i.call(o)):i.call(o)}var nr=function e(t,n,r){_classCallCheck(this,e),this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r};function rr(e,t,n){for(var r=fn(e),a=0;a<n.length;){var i=n[a];if("number"==typeof i){if(0!==i)break;a++;var o=n[a++],s=n[a++],u=n[a++];r?e.setAttribute(t,s,u,o):t.setAttributeNS(o,s,u)}else{var c=i,l=n[++a];ir(c)?r&&e.setProperty(t,c,l):r?e.setAttribute(t,c,l):t.setAttribute(c,l),a++}}return a}function ar(e){return 3===e||4===e||6===e}function ir(e){return 64===e.charCodeAt(0)}function or(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else for(var n=-1,r=0;r<t.length;r++){var a=t[r];"number"==typeof a?n=a:0===n||sr(e,n,a,null,-1===n||2===n?t[++r]:null)}return e}function sr(e,t,n,r,a){var i=0,o=e.length;if(-1===t)o=-1;else for(;i<e.length;){var s=e[i++];if("number"==typeof s){if(s===t){o=-1;break}if(s>t){o=i-1;break}}}for(;i<e.length;){var u=e[i];if("number"==typeof u)break;if(u===n){if(null===r)return void(null!==a&&(e[i+1]=a));if(r===e[i+1])return void(e[i+2]=a)}i++,null!==r&&i++,null!==a&&i++}-1!==o&&(e.splice(o,0,t),i=o+1),e.splice(i++,0,n),null!==r&&e.splice(i++,0,r),null!==a&&e.splice(i++,0,a)}function ur(e){return-1!==e}function cr(e){return 32767&e}function lr(e){return e>>16}function hr(e,t){for(var n=lr(e),r=t;n>0;)r=r[15],n--;return r}function fr(e){return"string"==typeof e?e:null==e?"":""+e}function dr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():fr(e)}var pr=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(ft);function vr(e){return e instanceof Function?e():e}var mr=!0;function gr(e){var t=mr;return mr=e,t}var yr=0;function br(e,t){var n=_r(e,t);if(-1!==n)return n;var r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,kr(r.data,e),kr(t,null),kr(r.blueprint,null));var a=wr(e,t),i=e.injectorIndex;if(ur(a))for(var o=cr(a),s=hr(a,t),u=s[1].data,c=0;c<8;c++)t[i+c]=s[o+c]|u[o+c];return t[i+8]=a,i}function kr(e,t){e.push(0,0,0,0,0,0,0,0,t)}function _r(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null==t[e.injectorIndex+8]?-1:e.injectorIndex}function wr(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;for(var n=t[6],r=1;n&&-1===n.injectorIndex;)n=(t=t[15])?t[6]:null,r++;return n?n.injectorIndex|r<<16:-1}function xr(e,t,n){!function(e,t,n){var r="string"!=typeof n?n[bt]:n.charCodeAt(0)||0;null==r&&(r=n[bt]=yr++);var a=255&r,i=1<<a,o=64&a,s=32&a,u=t.data;128&a?o?s?u[e+7]|=i:u[e+6]|=i:s?u[e+5]|=i:u[e+4]|=i:o?s?u[e+3]|=i:u[e+2]|=i:s?u[e+1]|=i:u[e]|=i}(e,t,n)}function Cr(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:je.Default,a=arguments.length>4?arguments[4]:void 0;if(null!==e){var i=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;var t=e[bt];return"number"==typeof t&&t>0?255&t:t}(n);if("function"==typeof i){Un(t,e);try{var o=i();if(null!=o||r&je.Optional)return o;throw new Error("No provider for ".concat(dr(n),"!"))}finally{qn()}}else if("number"==typeof i){if(-1===i)return new Nr(e,t);var s=null,u=_r(e,t),c=-1,l=r&je.Host?t[16][6]:null;for((-1===u||r&je.SkipSelf)&&(c=-1===u?wr(e,t):t[u+8],Rr(r,!1)?(s=t[1],u=cr(c),t=hr(c,t)):u=-1);-1!==u;){c=t[u+8];var h=t[1];if(Ir(i,u,h.data)){var f=Tr(u,t,n,s,r,l);if(f!==Sr)return f}Rr(r,t[1].data[u+8]===l)&&Ir(i,u,t)?(s=h,u=cr(c),t=hr(c,t)):u=-1}}}if(r&je.Optional&&void 0===a&&(a=null),0==(r&(je.Self|je.Host))){var d=t[9],p=Et(void 0);try{return d?d.get(n,a,r&je.Optional):Nt(n,a,r&je.Optional)}finally{Et(p)}}if(r&je.Optional)return a;throw new Error("NodeInjector: NOT_FOUND [".concat(dr(n),"]"))}var Sr={};function Tr(e,t,n,r,a,i){var o=t[1],s=o.data[e+8],u=Er(s,o,n,null==r?sn(s)&&mr:r!=o&&3===s.type,a&je.Host&&i===s);return null!==u?Ar(t,o,u,s):Sr}function Er(e,t,n,r,a){for(var i=e.providerIndexes,o=t.data,s=65535&i,u=e.directiveStart,c=i>>16,l=a?s+c:e.directiveEnd,h=r?s:s+c;h<l;h++){var f=o[h];if(h<u&&n===f||h>=u&&f.type===n)return h}if(a){var d=o[u];if(d&&cn(d)&&d.type===n)return u}return null}function Ar(e,t,n,r){var a=e[n],i=t.data;if(a instanceof nr){var o=a;if(o.resolving)throw new Error("Circular dep for ".concat(dr(i[n])));var s,u=gr(o.canSeeViewProviders);o.resolving=!0,o.injectImpl&&(s=Et(o.injectImpl)),Un(e,r);try{a=e[n]=o.factory(void 0,i,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){var r=t.onChanges,a=t.onInit,i=t.doCheck;r&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)),a&&(n.preOrderHooks||(n.preOrderHooks=[])).push(-e,a),i&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,i),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,i))}(n,i[n],t)}finally{o.injectImpl&&Et(s),gr(u),o.resolving=!1,qn()}}return a}function Ir(e,t,n){var r=64&e,a=32&e;return!!((128&e?r?a?n[t+7]:n[t+6]:a?n[t+5]:n[t+4]:r?a?n[t+3]:n[t+2]:a?n[t+1]:n[t])&1<<e)}function Rr(e,t){return!(e&je.Self||e&je.Host&&t)}var Nr=function(){function e(t,n){_classCallCheck(this,e),this._tNode=t,this._lView=n}return _createClass(e,[{key:"get",value:function(e,t){return Cr(this._tNode,this._lView,e,void 0,t)}}]),e}();function Or(e){return e.ngDebugContext}function Dr(e){return e.ngOriginalError}function Fr(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var Mr=function(){function e(){_classCallCheck(this,e),this._console=console}return _createClass(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||Fr}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(e){return e?Or(e)?Or(e):this._findContext(Dr(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=Dr(e);t&&Dr(t);)t=Dr(t);return t}}]),e}(),Lr=function(){function e(t){_classCallCheck(this,e),this.changingThisBreaksApplicationSecurity=t}return _createClass(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: ".concat(this.changingThisBreaksApplicationSecurity)+" (see http://g.co/ng/security#xss)"}}]),e}(),Pr=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"HTML"}}]),n}(Lr),zr=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"Style"}}]),n}(Lr),Br=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"Script"}}]),n}(Lr),Ur=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"URL"}}]),n}(Lr),Wr=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getTypeName",value:function(){return"ResourceURL"}}]),n}(Lr);function Vr(e){return e instanceof Lr?e.changingThisBreaksApplicationSecurity:e}function jr(e,t){var n=Hr(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error("Required a safe ".concat(t,", got a ").concat(n," (see http://g.co/ng/security#xss)"))}return n===t}function Hr(e){return e instanceof Lr&&e.getTypeName()||null}var qr=!0,Gr=!1;function Kr(){return Gr=!0,qr}var Xr=function(){function e(t){_classCallCheck(this,e),this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert");var n=this.inertDocument.body;if(null==n){var r=this.inertDocument.createElement("html");this.inertDocument.appendChild(r),n=this.inertDocument.createElement("body"),r.appendChild(n)}n.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!n.querySelector||n.querySelector("svg")?(n.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=n.querySelector&&n.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(e){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return _createClass(e,[{key:"getInertBodyElement_XHR",value:function(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch(r){return null}var t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(void 0);var n=t.response.body;return n.removeChild(n.firstChild),n}},{key:"getInertBodyElement_DOMParser",value:function(e){e="<body><remove></remove>"+e+"</body>";try{var t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch(n){return null}}},{key:"getInertBodyElement_InertDocument",value:function(e){var t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=e,t;var n=this.inertDocument.createElement("body");return n.innerHTML=e,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}},{key:"stripCustomNsAttrs",value:function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var r=t.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||e.removeAttribute(r)}for(var a=e.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}]),e}(),Yr=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,Qr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Zr(e){return(e=String(e)).match(Yr)||e.match(Qr)?e:(Kr()&&console.warn("WARNING: sanitizing unsafe URL value ".concat(e," (see http://g.co/ng/security#xss)")),"unsafe:"+e)}function $r(e){var t,n={},r=_createForOfIteratorHelper(e.split(","));try{for(r.s();!(t=r.n()).done;){n[t.value]=!0}}catch(a){r.e(a)}finally{r.f()}return n}function Jr(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];for(var s in o)o.hasOwnProperty(s)&&(e[s]=!0)}return e}var ea,ta=$r("area,br,col,hr,img,wbr"),na=$r("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ra=$r("rp,rt"),aa=Jr(ra,na),ia=Jr(ta,Jr(na,$r("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Jr(ra,$r("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),aa),oa=$r("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),sa=$r("srcset"),ua=Jr(oa,sa,$r("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),$r("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ca=$r("script,style,template"),la=function(){function e(){_classCallCheck(this,e),this.sanitizedSomething=!1,this.buf=[]}return _createClass(e,[{key:"sanitizeChildren",value:function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(e){var t=e.nodeName.toLowerCase();if(!ia.hasOwnProperty(t))return this.sanitizedSomething=!0,!ca.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);for(var n,r=e.attributes,a=0;a<r.length;a++){var i=r.item(a),o=i.name,s=o.toLowerCase();if(ua.hasOwnProperty(s)){var u=i.value;oa[s]&&(u=Zr(u)),sa[s]&&(n=u,u=(n=String(n)).split(",").map((function(e){return Zr(e.trim())})).join(", ")),this.buf.push(" ",o,'="',da(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(e){var t=e.nodeName.toLowerCase();ia.hasOwnProperty(t)&&!ta.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}},{key:"chars",value:function(e){this.buf.push(da(e))}},{key:"checkClobberedElement",value:function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: ".concat(e.outerHTML));return t}}]),e}(),ha=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,fa=/([^\#-~ |!])/g;function da(e){return e.replace(/&/g,"&amp;").replace(ha,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(fa,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function pa(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var va=function(){var e={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return e[e.NONE]="NONE",e[e.HTML]="HTML",e[e.STYLE]="STYLE",e[e.SCRIPT]="SCRIPT",e[e.URL]="URL",e[e.RESOURCE_URL]="RESOURCE_URL",e}(),ma=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|Z|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:attr|calc|var))\\([-0-9.%, #a-zA-Z]+\\))$","g"),ga=/^url\(([^)]+)\)$/;function ya(e,t){e.__ngContext__=t}function ba(e){throw new Error("Multiple components match node with tagname ".concat(e.tagName))}function ka(){throw new Error("Cannot mix multi providers and regular providers")}function _a(e,t,n){for(var r=e.length;;){var a=e.indexOf(t,n);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){var i=t.length;if(a+i===r||e.charCodeAt(a+i)<=32)return a}n=a+1}}function wa(e,t,n){for(var r=0;r<e.length;){var a=e[r++];if(n&&"class"===a){if(-1!==_a((a=e[r]).toLowerCase(),t,0))return!0}else if(1===a){for(;r<e.length&&"string"==typeof(a=e[r++]);)if(a.toLowerCase()===t)return!0;return!1}}return!1}function xa(e){return 0===e.type&&"ng-template"!==e.tagName}function Ca(e,t,n){return t===(0!==e.type||n?e.tagName:"ng-template")}function Sa(e,t,n){for(var r=4,a=e.attrs||[],i=function(e){for(var t=0;t<e.length;t++)if(ar(e[t]))return t;return e.length}(a),o=!1,s=0;s<t.length;s++){var u=t[s];if("number"!=typeof u){if(!o)if(4&r){if(r=2|1&r,""!==u&&!Ca(e,u,n)||""===u&&1===t.length){if(Ta(r))return!1;o=!0}}else{var c=8&r?u:t[++s];if(8&r&&null!==e.attrs){if(!wa(e.attrs,c,n)){if(Ta(r))return!1;o=!0}continue}var l=Ea(8&r?"class":u,a,xa(e),n);if(-1===l){if(Ta(r))return!1;o=!0;continue}if(""!==c){var h;h=l>i?"":a[l+1].toLowerCase();var f=8&r?h:null;if(f&&-1!==_a(f,c,0)||2&r&&c!==h){if(Ta(r))return!1;o=!0}}}}else{if(!o&&!Ta(r)&&!Ta(u))return!1;if(o&&Ta(u))continue;o=!1,r=u|1&r}}return Ta(r)||o}function Ta(e){return 0==(1&e)}function Ea(e,t,n,r){if(null===t)return-1;var a=0;if(r||!n){for(var i=!1;a<t.length;){var o=t[a];if(o===e)return a;if(3===o||6===o)i=!0;else{if(1===o||2===o){for(var s=t[++a];"string"==typeof s;)s=t[++a];continue}if(4===o)break;if(0===o){a+=4;continue}}a+=i?1:2}return-1}return function(e,t){var n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){var r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Aa(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<t.length;r++)if(Sa(e,t[r],n))return!0;return!1}function Ia(e,t){e:for(var n=0;n<t.length;n++){var r=t[n];if(e.length===r.length){for(var a=0;a<e.length;a++)if(e[a]!==r[a])continue e;return!0}}return!1}function Ra(e,t){return e?":not("+t.trim()+")":t}function Na(e){for(var t=e[0],n=1,r=2,a="",i=!1;n<e.length;){var o=e[n];if("string"==typeof o)if(2&r){var s=e[++n];a+="["+o+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?a+="."+o:4&r&&(a+=" "+o);else""===a||Ta(o)||(t+=Ra(i,a),a=""),r=o,i=i||!Ta(r);n++}return""!==a&&(t+=Ra(i,a)),t}var Oa={};function Da(e){var t=e[3];return an(t)?t[3]:t}function Fa(e){return La(e[13])}function Ma(e){return La(e[4])}function La(e){for(;null!==e&&!an(e);)e=e[4];return e}function Pa(e){za(An(),En(),Kn()+e,Dn())}function za(e,t,n,r){if(!r)if(3==(3&t[2])){var a=e.preOrderCheckHooks;null!==a&&Zn(t,a,n)}else{var i=e.preOrderHooks;null!==i&&$n(t,i,0,n)}Xn(n)}function Ba(e,t){return e<<17|t<<2}function Ua(e){return e>>17&32767}function Wa(e){return 2|e}function Va(e){return(131068&e)>>2}function ja(e,t){return-131069&e|t<<2}function Ha(e){return 1|e}function qa(e,t){var n=e.contentQueries;if(null!==n)for(var r=0;r<n.length;r+=2){var a=n[r],i=n[r+1];if(-1!==i){var o=e.data[i];Bn(a),o.contentQueries(2,t[i],i)}}}function Ga(e,t,n){return fn(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function Ka(e,t,n,r,a,i,o,s,u,c){var l=t.blueprint.slice();return l[0]=a,l[2]=140|r,xn(l),l[3]=l[15]=e,l[8]=n,l[10]=o||e&&e[10],l[11]=s||e&&e[11],l[12]=u||e&&e[12]||null,l[9]=c||e&&e[9]||null,l[6]=i,l[16]=2==t.type?e[16]:l,l}function Xa(e,t,n,r,a,i){var o=n+20,s=e.data[o]||function(e,t,n,r,a,i){var o=In(),s=Nn(),u=s?o:o&&o.parent,c=e.data[n]=ni(0,u&&u!==t?u:null,r,n,a,i);return null===e.firstChild&&(e.firstChild=c),o&&(!s||null!=o.child||null===c.parent&&2!==o.type?s||(o.next=c):o.child=c),c}(e,t,o,r,a,i);return Rn(s,!0),s}function Ya(e,t,n){Wn(t,t[6]);try{var r=e.viewQuery;null!==r&&xi(1,r,n);var a=e.template;null!==a&&$a(e,t,a,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&qa(e,t),e.staticViewQueries&&xi(2,e.viewQuery,n);var i=e.components;null!==i&&function(e,t){for(var n=0;n<t.length;n++)yi(e,t[n])}(t,i)}catch(o){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),o}finally{t[2]&=-5,Gn()}}function Qa(e,t,n,r){var a=t[2];if(256!=(256&a)){Wn(t,t[6]);var i=Dn();try{xn(t),Sn.lFrame.bindingIndex=e.bindingStartIndex,null!==n&&$a(e,t,n,2,r);var o=3==(3&a);if(!i)if(o){var s=e.preOrderCheckHooks;null!==s&&Zn(t,s,null)}else{var u=e.preOrderHooks;null!==u&&$n(t,u,0,null),Jn(t,0)}if(function(e){for(var t=Fa(e);null!==t;t=Ma(t))if(t[2])for(var n=t[9],r=0;r<n.length;r++){var a=n[r],i=a[3];0==(1024&a[2])&&Cn(i,1),a[2]|=1024}}(t),function(e){for(var t=Fa(e);null!==t;t=Ma(t))for(var n=10;n<t.length;n++){var r=t[n],a=r[1];_n(r)&&Qa(a,r,a.template,r[8])}}(t),null!==e.contentQueries&&qa(e,t),!i)if(o){var c=e.contentCheckHooks;null!==c&&Zn(t,c)}else{var l=e.contentHooks;null!==l&&$n(t,l,1),Jn(t,1)}!function(e,t){try{var n=e.expandoInstructions;if(null!==n)for(var r=e.expandoStartIndex,a=-1,i=0;i<n.length;i++){var o=n[i];"number"==typeof o?o<=0?(Xn(0-o),a=r+=9+n[++i]):r+=o:(null!==o&&(Ln(r,a),o(2,t[a])),a++)}}finally{Xn(-1)}}(e,t);var h=e.components;null!==h&&function(e,t){for(var n=0;n<t.length;n++)gi(e,t[n])}(t,h);var f=e.viewQuery;if(null!==f&&xi(2,f,r),!i)if(o){var d=e.viewCheckHooks;null!==d&&Zn(t,d)}else{var p=e.viewHooks;null!==p&&$n(t,p,2),Jn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),i||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Cn(t[3],-1))}finally{Gn()}}}function Za(e,t,n,r){var a=t[10],i=!Dn(),o=kn(t);try{i&&!o&&a.begin&&a.begin(),o&&Ya(e,t,r),Qa(e,t,n,r)}finally{i&&!o&&a.end&&a.end()}}function $a(e,t,n,r,a){var i=Kn();try{Xn(-1),2&r&&t.length>20&&za(e,t,0,Dn()),n(r,a)}finally{Xn(i)}}function Ja(e,t,n){Tn()&&(function(e,t,n,r){var a=n.directiveStart,i=n.directiveEnd;e.firstCreatePass||br(n,t),ya(r,t);for(var o=n.initialInputs,s=a;s<i;s++){var u=e.data[s],c=cn(u);c&&di(t,n,u);var l=Ar(t,e,s,n);ya(l,t),null!==o&&pi(0,s-a,l,u,0,o),c&&(yn(n.index,t)[8]=l)}}(e,t,n,mn(n,t)),128==(128&n.flags)&&function(e,t,n){var r=n.directiveStart,a=n.directiveEnd,i=e.expandoInstructions,o=e.firstCreatePass,s=n.index-20,u=Sn.lFrame.currentDirectiveIndex;try{Xn(s);for(var c=r;c<a;c++){var l=e.data[c],h=t[c];Pn(c),null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs?si(l,h):o&&i.push(null)}}finally{Xn(-1),Pn(u)}}(e,t,n))}function ei(e){var t=e.tView;return null===t||t.incompleteFirstPass?e.tView=ti(1,-1,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function ti(e,t,n,r,a,i,o,s,u,c){var l=20+r,h=l+a,f=function(e,t){for(var n=[],r=0;r<t;r++)n.push(r<e?null:Oa);return n}(l,h);return f[1]={type:e,id:t,blueprint:f,template:n,queries:null,viewQuery:s,node:null,data:f.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:h,expandoInstructions:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof i?i():i,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:u,consts:c,incompleteFirstPass:!1}}function ni(e,t,n,r,a,i){return{type:n,index:r,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,tagName:a,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function ri(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,a):n[r]=[t,a]}return n}function ai(e,t,n,r){var a=!1;if(Tn()){var i=function(e,t,n){var r=e.directiveRegistry,a=null;if(r)for(var i=0;i<r.length;i++){var o=r[i];Aa(n,o.selectors,!1)&&(a||(a=[]),xr(br(n,t),e,o.type),cn(o)?(2&n.flags&&ba(n),ci(e,n),a.unshift(o)):a.push(o))}return a}(e,t,n),o=null===r?null:{"":-1};if(null!==i){var s=0;a=!0,hi(n,e.data.length,i.length);for(var u=0;u<i.length;u++){var c=i[u];c.providersResolver&&c.providersResolver(c)}ui(e,n,i.length);for(var l=!1,h=!1,f=0;f<i.length;f++){var d=i[f];n.mergedAttrs=or(n.mergedAttrs,d.hostAttrs),fi(e,t,d),li(e.data.length-1,d,o),null!==d.contentQueries&&(n.flags|=8),null===d.hostBindings&&null===d.hostAttrs&&0===d.hostVars||(n.flags|=128),!l&&(d.onChanges||d.onInit||d.doCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index-20),l=!0),h||!d.onChanges&&!d.doCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index-20),h=!0),ii(e,d),s+=d.hostVars}!function(e,t){for(var n=t.directiveEnd,r=e.data,a=t.attrs,i=[],o=null,s=null,u=t.directiveStart;u<n;u++){var c=r[u],l=c.inputs,h=null===a||xa(t)?null:vi(l,a);i.push(h),o=ri(l,u,o),s=ri(c.outputs,u,s)}null!==o&&(o.hasOwnProperty("class")&&(t.flags|=16),o.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=i,t.inputs=o,t.outputs=s}(e,n),oi(e,t,s)}o&&function(e,t,n){if(t)for(var r=e.localNames=[],a=0;a<t.length;a+=2){var i=n[t[a+1]];if(null==i)throw new Error("Export of name '".concat(t[a+1],"' not found!"));r.push(t[a],i)}}(n,r,o)}return n.mergedAttrs=or(n.mergedAttrs,n.attrs),a}function ii(e,t){var n=e.expandoInstructions;n.push(t.hostBindings),0!==t.hostVars&&n.push(t.hostVars)}function oi(e,t,n){for(var r=0;r<n;r++)t.push(Oa),e.blueprint.push(Oa),e.data.push(null)}function si(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function ui(e,t,n){var r=20-t.index,a=e.data.length-(65535&t.providerIndexes);(e.expandoInstructions||(e.expandoInstructions=[])).push(r,a,n)}function ci(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function li(e,t,n){if(n){if(t.exportAs)for(var r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;cn(t)&&(n[""]=e)}}function hi(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function fi(e,t,n){e.data.push(n);var r=n.factory||(n.factory=tn(n.type)),a=new nr(r,cn(n),null);e.blueprint.push(a),t.push(a)}function di(e,t,n){var r=mn(t,e),a=ei(n),i=e[10],o=bi(e,Ka(e,a,null,n.onPush?64:16,r,t,i,i.createRenderer(r,n)));e[t.index]=o}function pi(e,t,n,r,a,i){var o=i[t];if(null!==o)for(var s=r.setInput,u=0;u<o.length;){var c=o[u++],l=o[u++],h=o[u++];null!==s?r.setInput(n,h,c,l):n[l]=h}}function vi(e,t){for(var n=null,r=0;r<t.length;){var a=t[r];if(0!==a)if(5!==a){if("number"==typeof a)break;e.hasOwnProperty(a)&&(null===n&&(n=[]),n.push(a,e[a],t[r+1])),r+=2}else r+=2;else r+=4}return n}function mi(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function gi(e,t){var n=yn(t,e);if(_n(n)){var r=n[1];80&n[2]?Qa(r,n,r.template,n[8]):n[5]>0&&function e(t){for(var n=Fa(t);null!==n;n=Ma(n))for(var r=10;r<n.length;r++){var a=n[r];if(1024&a[2]){var i=a[1];Qa(i,a,i.template,a[8])}else a[5]>0&&e(a)}var o=t[1].components;if(null!==o)for(var s=0;s<o.length;s++){var u=yn(o[s],t);_n(u)&&u[5]>0&&e(u)}}(n)}}function yi(e,t){var n=yn(t,e),r=n[1];!function(e,t){for(var n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n),Ya(r,n,n[8])}function bi(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function ki(e){for(;e;){e[2]|=64;var t=Da(e);if(ln(e)&&!t)return e;e=t}return null}function _i(e,t,n){var r=t[10];r.begin&&r.begin();try{Qa(e,t,e.template,n)}catch(a){throw Ei(t,a),a}finally{r.end&&r.end()}}function wi(e){!function(e){for(var t=0;t<e.components.length;t++){var n=e.components[t],r=bn(n),a=r[1];Za(a,r,a.template,n)}}(e[8])}function xi(e,t,n){Bn(0),t(e,n)}var Ci=Promise.resolve(null);function Si(e){return e[7]||(e[7]=[])}function Ti(e){return e.cleanup||(e.cleanup=[])}function Ei(e,t){var n=e[9],r=n?n.get(Mr,null):null;r&&r.handleError(t)}function Ai(e,t,n,r,a){for(var i=0;i<n.length;){var o=n[i++],s=n[i++],u=t[o],c=e.data[o];null!==c.setInput?c.setInput(u,a,r,s):u[s]=a}}function Ii(e,t){var n=t[3];return-1===e.index?an(n)?n:null:n}function Ri(e,t){var n=Ii(e,t);return n?Vi(t[11],n[7]):null}function Ni(e,t,n,r,a){if(null!=r){var i,o=!1;an(r)?i=r:rn(r)&&(o=!0,r=r[0]);var s=pn(r);0===e&&null!==n?null==a?Ui(t,n,s):Bi(t,n,s,a||null):1===e&&null!==n?Bi(t,n,s,a||null):2===e?function(e,t,n){var r=Vi(e,t);r&&function(e,t,n,r){fn(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,s,o):3===e&&t.destroyNode(s),null!=i&&function(e,t,n,r,a){var i=n[7];i!==pn(n)&&Ni(t,e,r,i,a);for(var o=10;o<n.length;o++){var s=n[o];Ki(s[1],s,e,t,r,i)}}(t,e,i,n,a)}}function Oi(e,t,n,r){var a=Ri(e.node,t);a&&Ki(e,t,t[11],n?1:2,a,r)}function Di(e,t){var n=e[9],r=n.indexOf(t);1024&t[2]&&Cn(t[3],-1),n.splice(r,1)}function Fi(e,t){if(!(e.length<=10)){var n=10+t,r=e[n];if(r){var a=r[17];null!==a&&a!==e&&Di(a,r),t>0&&(e[n-1][4]=r[4]);var i=zt(e,10+t);Oi(r[1],r,!1,null);var o=i[19];null!==o&&o.detachView(i[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}}function Mi(e,t){if(!(256&t[2])){var n=t[11];fn(n)&&n.destroyNode&&Ki(e,t,n,3,null,null),function(e){var t=e[13];if(!t)return Pi(e[1],e);for(;t;){var n=null;if(rn(t))n=t[13];else{var r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)rn(t)&&Pi(t[1],t),t=Li(t,e);null===t&&(t=e),rn(t)&&Pi(t[1],t),n=t&&t[4]}t=n}}(t)}}function Li(e,t){var n;return rn(e)&&(n=e[6])&&2===n.type?Ii(n,e):e[3]===t?null:e[3]}function Pi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){var n;if(null!=e&&null!=(n=e.destroyHooks))for(var r=0;r<n.length;r+=2){var a=t[n[r]];if(!(a instanceof nr)){var i=n[r+1];if(Array.isArray(i))for(var o=0;o<i.length;o+=2)i[o+1].call(a[i[o]]);else i.call(a)}}}(e,t),function(e,t){var n=e.cleanup;if(null!==n){for(var r=t[7],a=0;a<n.length-1;a+=2)if("string"==typeof n[a]){var i=n[a+1],o="function"==typeof i?i(t):pn(t[i]),s=r[n[a+2]],u=n[a+3];"boolean"==typeof u?o.removeEventListener(n[a],s,u):u>=0?r[u]():r[-u].unsubscribe(),a+=2}else n[a].call(r[n[a+1]]);t[7]=null}}(e,t);var n=t[6];n&&3===n.type&&fn(t[11])&&t[11].destroy();var r=t[17];if(null!==r&&an(t[3])){r!==t[3]&&Di(r,t);var a=t[19];null!==a&&a.detachView(e)}}}function zi(e,t,n){for(var r=t.parent;null!=r&&(4===r.type||5===r.type);)r=(t=r).parent;if(null==r){var a=n[6];return 2===a.type?Ri(a,n):n[0]}if(t&&5===t.type&&4&t.flags)return mn(t,n).parentNode;if(2&r.flags){var i=e.data,o=i[i[r.index].directiveStart].encapsulation;if(o!==jt.ShadowDom&&o!==jt.Native)return null}return mn(r,n)}function Bi(e,t,n,r){fn(e)?e.insertBefore(t,n,r):t.insertBefore(n,r,!0)}function Ui(e,t,n){fn(e)?e.appendChild(t,n):t.appendChild(n)}function Wi(e,t,n,r){null!==r?Bi(e,t,n,r):Ui(e,t,n)}function Vi(e,t){return fn(e)?e.parentNode(t):t.parentNode}function ji(e,t){if(2===e.type){var n=Ii(e,t);return null===n?null:qi(n.indexOf(t,10)-10,n)}return 4===e.type||5===e.type?mn(e,t):null}function Hi(e,t,n,r){var a=zi(e,r,t);if(null!=a){var i=t[11],o=ji(r.parent||t[6],t);if(Array.isArray(n))for(var s=0;s<n.length;s++)Wi(i,a,n[s],o);else Wi(i,a,n,o)}}function qi(e,t){var n=10+e+1;if(n<t.length){var r=t[n],a=r[1].firstChild;if(null!==a)return function e(t,n){if(null!==n){var r=n.type;if(3===r)return mn(n,t);if(0===r)return qi(-1,t[n.index]);if(4===r||5===r){var a=n.child;if(null!==a)return e(t,a);var i=t[n.index];return an(i)?qi(-1,i):pn(i)}var o=t[16],s=o[6],u=Da(o),c=s.projection[n.projection];return null!=c?e(u,c):e(t,n.next)}return null}(r,a)}return t[7]}function Gi(e,t,n,r,a,i,o){for(;null!=n;){var s=r[n.index],u=n.type;o&&0===t&&(s&&ya(pn(s),r),n.flags|=4),64!=(64&n.flags)&&(4===u||5===u?(Gi(e,t,n.child,r,a,i,!1),Ni(t,e,a,s,i)):1===u?Xi(e,t,r,n,a,i):Ni(t,e,a,s,i)),n=o?n.projectionNext:n.next}}function Ki(e,t,n,r,a,i){Gi(n,r,e.node.child,t,a,i,!1)}function Xi(e,t,n,r,a,i){var o=n[16],s=o[6].projection[r.projection];if(Array.isArray(s))for(var u=0;u<s.length;u++)Ni(t,e,a,s[u],i);else Gi(e,t,s,o[3],a,i,!0)}function Yi(e,t,n){fn(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Qi(e,t,n){fn(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}var Zi,$i,Ji,eo=function(){function e(t,n){_classCallCheck(this,e),this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._viewContainerRef=null}return _createClass(e,[{key:"destroy",value:function(){if(this._appRef)this._appRef.detachView(this);else if(this._viewContainerRef){var e=this._viewContainerRef.indexOf(this);e>-1&&this._viewContainerRef.detach(e),this._viewContainerRef=null}Mi(this._lView[1],this._lView)}},{key:"onDestroy",value:function(e){var t,n,r;t=this._lView[1],r=e,Si(n=this._lView).push(r),t.firstCreatePass&&Ti(t).push(n[7].length-1,null)}},{key:"markForCheck",value:function(){ki(this._cdRefInjectingView||this._lView)}},{key:"detach",value:function(){this._lView[2]&=-129}},{key:"reattach",value:function(){this._lView[2]|=128}},{key:"detectChanges",value:function(){_i(this._lView[1],this._lView,this.context)}},{key:"checkNoChanges",value:function(){!function(e,t,n){Fn(!0);try{_i(e,t,n)}finally{Fn(!1)}}(this._lView[1],this._lView,this.context)}},{key:"attachToViewContainerRef",value:function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}},{key:"detachFromAppRef",value:function(){var e;this._appRef=null,Ki(this._lView[1],e=this._lView,e[11],2,null,null)}},{key:"attachToAppRef",value:function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}},{key:"rootNodes",get:function(){var e=this._lView;return null==e[0]?function e(t,n,r,a){for(var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];null!==r;){var o=n[r.index];if(null!==o&&a.push(pn(o)),an(o))for(var s=10;s<o.length;s++){var u=o[s],c=u[1].firstChild;null!==c&&e(u[1],u,c,a)}var l=r.type;if(4===l||5===l)e(t,n,r.child,a);else if(1===l){var h=n[16],f=h[6].projection[r.projection];if(Array.isArray(f))a.push.apply(a,_toConsumableArray(f));else{var d=Da(h);e(d[1],d,f,a,!0)}}r=i?r.projectionNext:r.next}return a}(e[1],e,e[6].child,[]):[]}},{key:"context",get:function(){return this._lView[8]}},{key:"destroyed",get:function(){return 256==(256&this._lView[2])}}]),e}(),to=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e))._view=e,r}return _createClass(n,[{key:"detectChanges",value:function(){wi(this._view)}},{key:"checkNoChanges",value:function(){!function(e){Fn(!0);try{wi(e)}finally{Fn(!1)}}(this._view)}},{key:"context",get:function(){return null}}]),n}(eo);function no(e,t,n){return Zi||(Zi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(e)),new Zi(mn(t,n))}function ro(e,t,n,r){return $i||($i=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this))._declarationView=e,i._declarationTContainer=r,i.elementRef=a,i}return _createClass(n,[{key:"createEmbeddedView",value:function(e){var t=this._declarationTContainer.tViews,n=Ka(this._declarationView,t,e,16,null,t.node);n[17]=this._declarationView[this._declarationTContainer.index];var r=this._declarationView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Ya(t,n,e),new eo(n)}}]),n}(e)),0===n.type?new $i(r,n,no(t,n,r)):null}function ao(e,t,n,r){var a;Ji||(Ji=function(e){_inherits(r,e);var n=_createSuper(r);function r(e,t,a){var i;return _classCallCheck(this,r),(i=n.call(this))._lContainer=e,i._hostTNode=t,i._hostView=a,i}return _createClass(r,[{key:"clear",value:function(){for(;this.length>0;)this.remove(this.length-1)}},{key:"get",value:function(e){return null!==this._lContainer[8]&&this._lContainer[8][e]||null}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,a){var i=n||this.parentInjector;if(!a&&null==e.ngModule&&i){var o=i.get(Ft,null);o&&(a=o)}var s=e.create(i,r,void 0,a);return this.insert(s.hostView,t),s}},{key:"insert",value:function(e,t){var n=e._lView,r=n[1];if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");if(this.allocateContainerIfNeeded(),an(n[3])){var a=this.indexOf(e);if(-1!==a)this.detach(a);else{var i=n[3],o=new Ji(i,i[6],i[3]);o.detach(o.indexOf(e))}}var s=this._adjustIndex(t);return function(e,t,n,r){var a=10+r,i=n.length;r>0&&(n[a-1][4]=t),r<i-10?(t[4]=n[a],Pt(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;var o=t[17];null!==o&&n!==o&&function(e,t){var n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(o,t);var s=t[19];null!==s&&s.insertView(e),t[2]|=128}(r,n,this._lContainer,s),Oi(r,n,!0,qi(s,this._lContainer)),e.attachToViewContainerRef(this),Pt(this._lContainer[8],s,e),e}},{key:"move",value:function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");return this.insert(e,t)}},{key:"indexOf",value:function(e){var t=this._lContainer[8];return null!==t?t.indexOf(e):-1}},{key:"remove",value:function(e){this.allocateContainerIfNeeded();var t=this._adjustIndex(e,-1);!function(e,t){var n=Fi(e,t);n&&Mi(n[1],n)}(this._lContainer,t),zt(this._lContainer[8],t)}},{key:"detach",value:function(e){this.allocateContainerIfNeeded();var t=this._adjustIndex(e,-1),n=Fi(this._lContainer,t);return n&&null!=zt(this._lContainer[8],t)?new eo(n):null}},{key:"_adjustIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e?this.length+t:e}},{key:"allocateContainerIfNeeded",value:function(){null===this._lContainer[8]&&(this._lContainer[8]=[])}},{key:"element",get:function(){return no(t,this._hostTNode,this._hostView)}},{key:"injector",get:function(){return new Nr(this._hostTNode,this._hostView)}},{key:"parentInjector",get:function(){var e=wr(this._hostTNode,this._hostView),t=hr(e,this._hostView),n=function(e,t,n){if(n.parent&&-1!==n.parent.injectorIndex){for(var r=n.parent.injectorIndex,a=n.parent;null!=a.parent&&r==a.parent.injectorIndex;)a=a.parent;return a}for(var i=lr(e),o=t,s=t[6];i>1;)s=(o=o[15])[6],i--;return s}(e,this._hostView,this._hostTNode);return ur(e)&&null!=n?new Nr(n,t):new Nr(null,this._hostView)}},{key:"length",get:function(){return this._lContainer.length-10}}]),r}(e));var i=r[n.index];if(an(i))a=i;else{var o;if(4===n.type)o=pn(i);else if(o=r[11].createComment(""),ln(r)){var s=r[11],u=mn(n,r);Bi(s,Vi(s,u),o,function(e,t){return fn(e)?e.nextSibling(t):t.nextSibling}(s,u))}else Hi(r[1],r,o,n);r[n.index]=a=mi(i,r,o,n),bi(r,a)}return new Ji(a,n,r)}var io=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return oo()},e}(),oo=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,n){if(!n&&sn(e)){var r=yn(e.index,t);return new eo(r,r)}return 3===e.type||0===e.type||4===e.type||5===e.type?new eo(t[16],t):null}(In(),En(),e)},so=new kt("Set Injector scope."),uo={},co={},lo=[],ho=void 0;function fo(){return void 0===ho&&(ho=new Dt),ho}function po(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return new vo(e,n,t||fo(),r)}var vo=function(){function e(t,n,r){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,e),this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;var o=[];n&&Lt(n,(function(e){return a.processProvider(e,t,n)})),Lt([t],(function(e){return a.processInjectorType(e,[],o)})),this.records.set(_t,go(void 0,this));var s=this.records.get(so);this.scope=null!=s?s.value:null,this.source=i||("object"==typeof t?null:nt(t))}return _createClass(e,[{key:"destroy",value:function(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach((function(e){return e.ngOnDestroy()}))}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wt,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:je.Default;this.assertNotDestroyed();var r,a=Tt(this);try{if(!(n&je.SkipSelf)){var i=this.records.get(e);if(void 0===i){var o=("function"==typeof(r=e)||"object"==typeof r&&r instanceof kt)&&Xe(e);i=o&&this.injectableDefInScope(o)?go(mo(e),uo):null,this.records.set(e,i)}if(null!=i)return this.hydrate(e,i)}return(n&je.Self?fo():this.parent).get(e,t=n&je.Optional&&t===wt?null:t)}catch(s){if("NullInjectorError"===s.name){if((s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(nt(e)),a)throw s;return function(e,t,n,r){var a=e.ngTempTokenPath;throw t.__source&&a.unshift(t.__source),e.message=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var a=nt(t);if(Array.isArray(t))a=t.map(nt).join(" -> ");else if("object"==typeof t){var i=[];for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];i.push(o+":"+("string"==typeof s?JSON.stringify(s):nt(s)))}a="{".concat(i.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(a,"]: ").concat(e.replace(xt,"\n  "))}("\n"+e.message,a,"R3InjectorError",r),e.ngTokenPath=a,e.ngTempTokenPath=null,e}(s,e,0,this.source)}throw s}finally{Tt(a)}}},{key:"_resolveInjectorDefTypes",value:function(){var e=this;this.injectorDefTypes.forEach((function(t){return e.get(t)}))}},{key:"toString",value:function(){var e=[];return this.records.forEach((function(t,n){return e.push(nt(n))})),"R3Injector[".concat(e.join(", "),"]")}},{key:"assertNotDestroyed",value:function(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}},{key:"processInjectorType",value:function(e,t,n){var r=this;if(!(e=ot(e)))return!1;var a=Qe(e),i=null==a&&e.ngModule||void 0,o=void 0===i?e:i,s=-1!==n.indexOf(o);if(void 0!==i&&(a=Qe(i)),null==a)return!1;if(null!=a.imports&&!s){var u;n.push(o);try{Lt(a.imports,(function(e){r.processInjectorType(e,t,n)&&(void 0===u&&(u=[]),u.push(e))}))}finally{}if(void 0!==u)for(var c=function(e){var t=u[e],n=t.ngModule,a=t.providers;Lt(a,(function(e){return r.processProvider(e,n,a||lo)}))},l=0;l<u.length;l++)c(l)}this.injectorDefTypes.add(o),this.records.set(o,go(a.factory,uo));var h=a.providers;if(null!=h&&!s){var f=e;Lt(h,(function(e){return r.processProvider(e,f,h)}))}return void 0!==i&&void 0!==e.providers}},{key:"processProvider",value:function(e,t,n){var r=bo(e=ot(e))?e:ot(e&&e.provide),a=function(e,t,n){return yo(e)?go(void 0,e.useValue):go(function(e,t,n){var r,a=void 0;if(bo(e)){var i=ot(e);return tn(i)||mo(i)}if(yo(e))a=function(){return ot(e.useValue)};else if((r=e)&&r.useFactory)a=function(){return e.useFactory.apply(e,_toConsumableArray(Ot(e.deps||[])))};else if(function(e){return!(!e||!e.useExisting)}(e))a=function(){return It(ot(e.useExisting))};else{var o=ot(e&&(e.useClass||e.provide));if(o||function(e,t,n){var r="";throw e&&t&&(r=" - only instances of Provider and Type are allowed, got: [".concat(t.map((function(e){return e==n?"?"+n+"?":"..."})).join(", "),"]")),new Error("Invalid provider for the NgModule '".concat(nt(e),"'")+r)}(t,n,e),!function(e){return!!e.deps}(e))return tn(o)||mo(o);a=function(){return _construct(o,_toConsumableArray(Ot(e.deps)))}}return a}(e,t,n),uo)}(e,t,n);if(bo(e)||!0!==e.multi){var i=this.records.get(r);i&&void 0!==i.multi&&ka()}else{var o=this.records.get(r);o?void 0===o.multi&&ka():((o=go(void 0,uo,!0)).factory=function(){return Ot(o.multi)},this.records.set(r,o)),r=e,o.multi.push(e)}this.records.set(r,a)}},{key:"hydrate",value:function(e,t){var n;return t.value===co?function(e){throw new Error("Cannot instantiate cyclic dependency! ".concat(e))}(nt(e)):t.value===uo&&(t.value=co,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value}},{key:"injectableDefInScope",value:function(e){return!!e.providedIn&&("string"==typeof e.providedIn?"any"===e.providedIn||e.providedIn===this.scope:this.injectorDefTypes.has(e.providedIn))}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();function mo(e){var t=Xe(e),n=null!==t?t.factory:tn(e);if(null!==n)return n;var r=Qe(e);if(null!==r)return r.factory;if(e instanceof kt)throw new Error("Token ".concat(nt(e)," is missing a \u0275prov definition."));if(e instanceof Function)return function(e){var t=e.length;if(t>0){var n=Bt(t,"?");throw new Error("Can't resolve all parameters for ".concat(nt(e),": (").concat(n.join(", "),")."))}var r=function(e){var t=e&&(e[Ze]||e[et]||e[Je]&&e[Je]());if(t){var n=function(e){if(e.hasOwnProperty("name"))return e.name;var t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn('DEPRECATED: DI is instantiating a token "'.concat(n,'" that inherits its @Injectable decorator but does not provide one itself.\n')+'This will become an error in v10. Please add @Injectable() to the "'.concat(n,'" class.')),t}return null}(e);return null!==r?function(){return r.factory(e)}:function(){return new e}}(e);throw new Error("unreachable")}function go(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{factory:e,value:t,multi:n?[]:void 0}}function yo(e){return null!==e&&"object"==typeof e&&Ct in e}function bo(e){return"function"==typeof e}var ko=function(e,t,n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,a=po(e,t,n,r);return a._resolveInjectorDefTypes(),a}({name:n},t,e,n)},_o=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?ko(e,t,""):ko(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=wt,e.NULL=new Dt,e.\u0275prov=Ge({token:e,providedIn:"any",factory:function(){return It(_t)}}),e.__NG_ELEMENT_ID__=-1,e}(),wo=new kt("AnalyzeForEntryComponents"),xo=new Map,Co=new Set;function So(e){return"string"==typeof e?e:e.text()}function To(e,t,n){var r=n?e.styles:null,a=n?e.classes:null,i=0;if(null!==t)for(var o=0;o<t.length;o++){var s=t[o];"number"==typeof s?i=s:1==i?a=rt(a,s):2==i&&(r=rt(r,s+": "+t[++o]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=a:e.classesWithoutHost=a}var Eo=null;function Ao(){if(!Eo){var e=ft.Symbol;if(e&&e.iterator)Eo=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(Eo=r)}}return Eo}function Io(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function Ro(e){return!!No(e)&&(Array.isArray(e)||!(e instanceof Map)&&Ao()in e)}function No(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Oo(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Do(e,t,n,r){var a=En();return Oo(a,Mn(),t)&&(An(),function(e,t,n,r,a,i){var o=mn(e,t),s=t[11];if(null==r)fn(s)?s.removeAttribute(o,n,i):o.removeAttribute(n);else{var u=null==a?fr(r):a(r,e.tagName||"",n);fn(s)?s.setAttribute(o,n,u,i):i?o.setAttributeNS(i,n,u):o.setAttribute(n,u)}}(Yn(),a,e,t,n,r)),Do}function Fo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je.Default,n=En();return null==n?It(e,t):Cr(In(),n,ot(e),t)}function Mo(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;var n=e.attrs;if(n)for(var r=n.length,a=0;a<r;){var i=n[a];if(ar(i))break;if(0===i)a+=2;else if("number"==typeof i)for(a++;a<r&&"string"==typeof n[a];)a++;else{if(i===t)return n[a+1];a+=2}}return null}(In(),e)}function Lo(){throw new Error("invalid")}function Po(e,t,n){var r=En();return Oo(r,Mn(),t)&&function(e,t,n,r,a,i,o,s){var u,c,l=mn(t,n),h=t.inputs;null!=h&&(u=h[r])?(Ai(e,n,u,r,a),sn(t)&&function(e,t){var n=yn(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3===t.type&&(r="class"===(c=r)?"className":"for"===c?"htmlFor":"formaction"===c?"formAction":"innerHtml"===c?"innerHTML":"readonly"===c?"readOnly":"tabindex"===c?"tabIndex":c,a=null!=o?o(a,t.tagName||"",r):a,fn(i)?i.setProperty(l,r,a):ir(r)||(l.setProperty?l.setProperty(r,a):l[r]=a))}(An(),Yn(),r,e,t,r[11],n),Po}function zo(e,t,n,r,a){var i=a?"class":"style";Ai(e,n,t.inputs[i],i,r)}function Bo(e,t,n,r){var a=En(),i=An(),o=20+e,s=a[11],u=a[o]=Ga(t,s,Sn.lFrame.currentNamespace),c=i.firstCreatePass?function(e,t,n,r,a,i,o){var s=t.consts,u=wn(s,i),c=Xa(t,n[6],e,3,a,u);return ai(t,n,c,wn(s,o)),null!==c.attrs&&To(c,c.attrs,!1),null!==c.mergedAttrs&&To(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(e,i,a,0,t,n,r):i.data[o];Rn(c,!0);var l=c.mergedAttrs;null!==l&&rr(s,u,l);var h=c.classes;null!==h&&Qi(s,u,h);var f=c.styles;null!==f&&Yi(s,u,f),Hi(i,a,u,c),0===Sn.lFrame.elementDepthCount&&ya(u,a),Sn.lFrame.elementDepthCount++,un(c)&&(Ja(i,a,c),function(e,t,n){if(on(t))for(var r=t.directiveEnd,a=t.directiveStart;a<r;a++){var i=e.data[a];i.contentQueries&&i.contentQueries(1,n[a],a)}}(i,c,a)),null!==r&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mn,r=t.localNames;if(null!==r)for(var a=t.index+1,i=0;i<r.length;i+=2){var o=r[i+1],s=-1===o?n(t,e):e[o];e[a++]=s}}(a,c)}function Uo(){var e=In();Nn()?On():Rn(e=e.parent,!1);var t=e;Sn.lFrame.elementDepthCount--;var n=An();n.firstCreatePass&&(Qn(n,e),on(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&zo(n,t,En(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&zo(n,t,En(),t.stylesWithoutHost,!1)}function Wo(e,t,n,r){Bo(e,t,n,r),Uo()}function Vo(e){return!!e&&"function"==typeof e.then}function jo(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a=En(),i=An(),o=In();return function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0,u=un(r),c=e.firstCreatePass&&(e.cleanup||(e.cleanup=[])),l=Si(t),h=!0;if(3===r.type){var f=mn(r,t),d=s?s(f):Ht,p=d.target||f,v=l.length,m=s?function(e){return s(pn(e[r.index])).target}:r.index;if(fn(n)){var g=null;if(!s&&u&&(g=function(e,t,n,r){var a=e.cleanup;if(null!=a)for(var i=0;i<a.length-1;i+=2){var o=a[i];if(o===n&&a[i+1]===r){var s=t[7],u=a[i+2];return s.length>u?s[u]:null}"string"==typeof o&&(i+=2)}return null}(e,t,a,r.index)),null!==g)(g.__ngLastListenerFn__||g).__ngNextListenerFn__=i,g.__ngLastListenerFn__=i,h=!1;else{i=qo(r,t,i,!1);var y=n.listen(d.name||p,a,i);l.push(i,y),c&&c.push(a,m,v,v+1)}}else i=qo(r,t,i,!0),p.addEventListener(a,i,o),l.push(i),c&&c.push(a,m,v,o)}var b,k=r.outputs;if(h&&null!==k&&(b=k[a])){var _=b.length;if(_)for(var w=0;w<_;w+=2){var x=t[b[w]][b[w+1]].subscribe(i),C=l.length;l.push(i,x),c&&c.push(a,r.index,C,-(C+1))}}}(i,a,a[11],o,e,t,n,r),jo}function Ho(e,t,n){try{return!1!==t(n)}catch(r){return Ei(e,r),!1}}function qo(e,t,n,r){return function a(i){if(i===Function)return n;var o=2&e.flags?yn(e.index,t):t;0==(32&t[2])&&ki(o);for(var s=Ho(t,n,i),u=a.__ngNextListenerFn__;u;)s=Ho(t,u,i)&&s,u=u.__ngNextListenerFn__;return r&&!1===s&&(i.preventDefault(),i.returnValue=!1),s}}function Go(e,t){for(var n=null,r=function(e){var t=e.attrs;if(null!=t){var n=t.indexOf(5);if(0==(1&n))return t[n+1]}return null}(e),a=0;a<t.length;a++){var i=t[a];if("*"!==i){if(null===r?Aa(e,i,!0):Ia(r,i))return a}else n=a}return n}function Ko(e){var t=En()[16][6];if(!t.projection)for(var n=t.projection=Bt(e?e.length:1,null),r=n.slice(),a=t.child;null!==a;){var i=e?Go(a,e):0;null!==i&&(r[i]?r[i].projectionNext=a:n[i]=a,r[i]=a),a=a.next}}function Xo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=En(),a=An(),i=Xa(a,r[6],e,1,null,n||null);null===i.projection&&(i.projection=t),On(),function(e,t,n){Xi(t[11],0,t,n,zi(e,n,t),ji(n.parent||t[6],t))}(a,r,i)}var Yo=[];function Qo(e,t,n,r,a){for(var i=e[n+1],o=null===t,s=r?Ua(i):Va(i),u=!1;0!==s&&(!1===u||o);){var c=e[s+1];Zo(e[s],t)&&(u=!0,e[s+1]=r?Ha(c):Wa(c)),s=r?Ua(c):Va(c)}u&&(e[n+1]=r?Wa(i):Ha(i))}function Zo(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Wt(e,t)>=0}function $o(e,t){return function(e,t,n,r){var a,i,o,s=En(),u=An(),c=(a=Sn.lFrame,i=a.bindingIndex,a.bindingIndex=a.bindingIndex+2,i);(u.firstUpdatePass&&function(e,t,n,r){var a=e.data;if(null===a[n+1]){var i=a[Kn()+20],o=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(16&e.flags)})(i)&&null===t&&!o&&(t=!1),t=function(e,t,n,r){var a=function(e){var t=Sn.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e),i=t.residualClasses;if(null===a)0===t.classBindings&&(n=es(n=Jo(null,e,t,n,!0),t.attrs,!0),i=null);else{var o=t.directiveStylingLast;if(-1===o||e[o]!==a)if(n=Jo(a,e,t,n,!0),null===i){var s=function(e,t,n){var r=t.classBindings;if(0!==Va(r))return e[Ua(r)]}(e,t);void 0!==s&&Array.isArray(s)&&function(e,t,n,r){e[Ua(t.classBindings)]=r}(e,t,0,s=es(s=Jo(null,e,t,s[1],!0),t.attrs,!0))}else i=function(e,t,n){for(var r=void 0,a=t.directiveEnd,i=1+t.directiveStylingLast;i<a;i++)r=es(r,e[i].hostAttrs,!0);return es(r,t.attrs,!0)}(e,t)}return void 0!==i&&(t.residualClasses=i),n}(a,i,t),function(e,t,n,r,a,i){var o=t.classBindings,s=Ua(o),u=Va(o);e[r]=n;var c,l=!1;if(Array.isArray(n)){var h=n;(null===(c=h[1])||Wt(h,c)>0)&&(l=!0)}else c=n;if(a)if(0!==u){var f=Ua(e[s+1]);e[r+1]=Ba(f,s),0!==f&&(e[f+1]=ja(e[f+1],r)),e[s+1]=131071&e[s+1]|r<<17}else e[r+1]=Ba(s,0),0!==s&&(e[s+1]=ja(e[s+1],r)),s=r;else e[r+1]=Ba(u,0),0===s?s=r:e[u+1]=ja(e[u+1],r),u=r;l&&(e[r+1]=Wa(e[r+1])),Qo(e,c,r,!0),Qo(e,c,r,!1),function(e,t,n,r,a){var i=e.residualClasses;null!=i&&"string"==typeof t&&Wt(i,t)>=0&&(n[r+1]=Ha(n[r+1]))}(t,c,e,r),o=Ba(s,u),t.classBindings=o}(a,i,t,n,o)}}(u,e,c),t!==Oa&&Oo(s,c,t))&&(null==n&&(o=function(){var e=Sn.lFrame;return null===e?null:e.currentSanitizer}())&&(n=o),function(e,t,n,r,a,i,o,s){if(3===t.type){var u=e.data,c=u[s+1];ns(1==(1&c)?ts(u,t,n,a,Va(c),!0):void 0)||(ns(i)||2==(2&c)&&(i=ts(u,null,n,a,s,!0)),function(e,t,n,r,a){var i=fn(e);a?i?e.addClass(n,r):n.classList.add(r):i?e.removeClass(n,r):n.classList.remove(r)}(r,0,vn(Kn(),n),a,i))}}(u,u.data[Kn()+20],s,s[11],e,s[c+1]=function(e,t){return null==e||("function"==typeof t?e=t(e):"string"==typeof t?e+=t:"object"==typeof e&&(e=nt(Vr(e)))),e}(t,n),0,c))}(e,t,null),$o}function Jo(e,t,n,r,a){var i=null,o=n.directiveEnd,s=n.directiveStylingLast;for(-1===s?s=n.directiveStart:s++;s<o&&(r=es(r,(i=t[s]).hostAttrs,a),i!==e);)s++;return null!==e&&(n.directiveStylingLast=s),r}function es(e,t,n){var r,a,i,o,s=n?1:2,u=-1;if(null!==t)for(var c=0;c<t.length;c++){var l=t[c];"number"==typeof l?u=l:u===s&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),r=e,a=l,i=!!n||t[++c],o=void 0,(o=Wt(r,a))>=0?r[1|o]=i:function(e,t,n,r){var a=e.length;if(a==t)e.push(n,r);else if(1===a)e.push(r,e[0]),e[0]=n;else{for(a--,e.push(e[a-1],e[a]);a>t;)e[a]=e[a-2],a--;e[t]=n,e[t+1]=r}}(r,o=~o,a,i))}return void 0===e?null:e}function ts(e,t,n,r,a,i){for(var o=null===t,s=void 0;a>0;){var u=e[a],c=Array.isArray(u),l=c?u[1]:u,h=null===l,f=n[a+1];f===Oa&&(f=h?Yo:void 0);var d=h?Ut(f,r):l===r?f:void 0;if(c&&!ns(d)&&(d=Ut(u,r)),ns(d)&&(s=d,o))return s;var p=e[a+1];a=o?Ua(p):Va(p)}if(null!==t){var v=i?t.residualClasses:t.residualStyles;null!=v&&(s=Ut(v,r))}return s}function ns(e){return void 0!==e}function rs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=En(),r=An(),a=e+20,i=r.firstCreatePass?Xa(r,n[6],e,3,null,null):r.data[a],o=n[a]=function(e,t){return fn(t)?t.createText(e):t.createTextNode(e)}(t,n[11]);Hi(r,n,o,i),Rn(i,!1)}function as(e,t,n){var r=En(),a=function(e,t,n,r){return Oo(e,Mn(),n)?t+fr(n)+r:Oa}(r,e,t,n);return a!==Oa&&function(e,t,n){var r=vn(t,e),a=e[11];fn(a)?a.setValue(r,n):r.textContent=n}(r,Kn(),a),as}function is(e,t){var n=bn(e)[1],r=n.data.length-1;Qn(n,{directiveStart:r,directiveEnd:r+1})}function os(e){for(var t=Object.getPrototypeOf(e.type.prototype).constructor,n=!0,r=[e];t;){var a=void 0;if(cn(e))a=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");a=t.\u0275dir}if(a){if(n){r.push(a);var i=e;i.inputs=ss(e.inputs),i.declaredInputs=ss(e.declaredInputs),i.outputs=ss(e.outputs);var o=a.hostBindings;o&&ls(e,o);var s=a.viewQuery,u=a.contentQueries;if(s&&us(e,s),u&&cs(e,u),qe(e.inputs,a.inputs),qe(e.declaredInputs,a.declaredInputs),qe(e.outputs,a.outputs),cn(a)&&a.data.animation){var c=e.data;c.animation=(c.animation||[]).concat(a.data.animation)}i.afterContentChecked=i.afterContentChecked||a.afterContentChecked,i.afterContentInit=e.afterContentInit||a.afterContentInit,i.afterViewChecked=e.afterViewChecked||a.afterViewChecked,i.afterViewInit=e.afterViewInit||a.afterViewInit,i.doCheck=e.doCheck||a.doCheck,i.onDestroy=e.onDestroy||a.onDestroy,i.onInit=e.onInit||a.onInit}var l=a.features;if(l)for(var h=0;h<l.length;h++){var f=l[h];f&&f.ngInherit&&f(e),f===os&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){for(var t=0,n=null,r=e.length-1;r>=0;r--){var a=e[r];a.hostVars=t+=a.hostVars,a.hostAttrs=or(a.hostAttrs,n=or(n,a.hostAttrs))}}(r)}function ss(e){return e===Ht?{}:e===qt?[]:e}function us(e,t){var n=e.viewQuery;e.viewQuery=n?function(e,r){t(e,r),n(e,r)}:t}function cs(e,t){var n=e.contentQueries;e.contentQueries=n?function(e,r,a){t(e,r,a),n(e,r,a)}:t}function ls(e,t){var n=e.hostBindings;e.hostBindings=n?function(e,r){t(e,r),n(e,r)}:t}var hs=function(){function e(t,n,r){_classCallCheck(this,e),this.previousValue=t,this.currentValue=n,this.firstChange=r}return _createClass(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}();function fs(e){e.type.prototype.ngOnChanges&&(e.setInput=ds,e.onChanges=function(){var e=ps(this),t=e&&e.current;if(t){var n=e.previous;if(n===Ht)e.previous=t;else for(var r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}})}function ds(e,t,n,r){var a=ps(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:Ht,current:null}),i=a.current||(a.current={}),o=a.previous,s=this.declaredInputs[n],u=o[s];i[s]=new hs(u&&u.currentValue,t,o===Ht),e[r]=t}function ps(e){return e.__ngSimpleChanges__||null}fs.ngInherit=!0;var vs=function e(){_classCallCheck(this,e)},ms=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){throw function(e){var t=Error("No component factory found for ".concat(nt(e),". Did you add it to @NgModule.entryComponents?"));return t.ngComponent=e,t}(e)}}]),e}(),gs=function(){var e=function e(){_classCallCheck(this,e)};return e.NULL=new ms,e}(),ys=function(){var e=function e(t){_classCallCheck(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=function(){return bs(e)},e}(),bs=function(e){return no(e,In(),En())},ks=function e(){_classCallCheck(this,e)},_s=function(){var e={Important:1,DashCase:2};return e[e.Important]="Important",e[e.DashCase]="DashCase",e}(),ws=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return xs()},e}(),xs=function(){var e=En(),t=yn(In().index,e);return function(e){var t=e[11];if(fn(t))return t;throw new Error("Cannot inject Renderer2 when the application uses Renderer3!")}(rn(t)?t:e)},Cs=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275prov=Ge({token:e,providedIn:"root",factory:function(){return null}}),e}(),Ss=function e(t){_classCallCheck(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")},Ts=new Ss("9.1.9"),Es=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return Ro(e)}},{key:"create",value:function(e){return new Is(e)}}]),e}(),As=function(e,t){return t},Is=function(){function e(t){_classCallCheck(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||As}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,a=null;t||n;){var i=!n||t&&t.currentIndex<Ds(n,r,a)?t:n,o=Ds(i,r,a),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(t=t._next,null==i.previousIndex)r++;else{a||(a=[]);var u=o-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<a.length?a[l]:a[l]=0,f=h+l;c<=f&&f<u&&(a[l]=h+1)}a[i.previousIndex]=c-u}}o!==s&&e(i,o,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!Ro(e))throw new Error("Error trying to diff '".concat(nt(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,a,i=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=e[s],a=this._trackByFn(s,r),null!==i&&Io(i.trackById,a)?(o&&(i=this._verifyReinsertion(i,r,a,s)),Io(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,a,s),o=!0),i=i._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,a=e[Ao()]();!(r=a.next()).done;)t(r.value)}(e,(function(e){a=t._trackByFn(n,e),null!==i&&Io(i.trackById,a)?(o&&(i=t._verifyReinsertion(i,e,a,n)),Io(i.item,e)||t._addIdentityChange(i,e)):(i=t._mismatch(i,e,a,n),o=!0),i=i._next,n++})),this.length=n;return this._truncate(i),this.collection=e,this.isDirty}},{key:"_reset",value:function(){if(this.isDirty){var e,t;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var a;return null===e?a=this._itTail:(a=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Io(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,a,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Io(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,a,r)):e=this._addAfter(new Rs(t,n),a,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==a?e=this._reinsertAfter(a,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,a=e._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Os),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Os),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}}]),e}(),Rs=function e(t,n){_classCallCheck(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},Ns=function(){function e(){_classCallCheck(this,e),this._head=null,this._tail=null}return _createClass(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Io(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),Os=function(){function e(){_classCallCheck(this,e),this.map=new Map}return _createClass(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new Ns,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"clear",value:function(){this.map.clear()}},{key:"isEmpty",get:function(){return 0===this.map.size}}]),e}();function Ds(e,t,n){var r=e.previousIndex;if(null===r)return r;var a=0;return n&&r<n.length&&(a=n[r]),r+t+a}var Fs=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return e instanceof Map||No(e)}},{key:"create",value:function(){return new Ms}}]),e}(),Ms=function(){function e(){_classCallCheck(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||No(e)))throw new Error("Error trying to diff '".concat(nt(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var a=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,a)}})),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,a=n._next;return r&&(r._next=a),a&&(a._prev=r),n._next=null,n._prev=null,n}var i=new Ls(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){Io(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach((function(n){return t(e[n],n)}))}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}}]),e}(),Ls=function e(t){_classCallCheck(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},Ps=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t,n=this.factories.find((function(t){return t.supports(e)}));if(null!=n)return n;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Ve,new Ue]]}}}]),e}();return e.\u0275prov=Ge({token:e,providedIn:"root",factory:function(){return new e([new Es])}}),e}(),zs=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t=this.factories.find((function(t){return t.supports(e)}));if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new Ve,new Ue]]}}}]),e}();return e.\u0275prov=Ge({token:e,providedIn:"root",factory:function(){return new e([new Fs])}}),e}(),Bs=[new Fs],Us=new Ps([new Es]),Ws=new zs(Bs),Vs=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return js(e,ys)},e}(),js=function(e,t){return ro(e,t,In(),En())},Hs=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return qs(e,ys)},e}(),qs=function(e,t){return ao(e,t,In(),En())},Gs={},Ks=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).ngModule=e,r}return _createClass(n,[{key:"resolveComponentFactory",value:function(e){var t=en(e);return new Qs(t,this.ngModule)}}]),n}(gs);function Xs(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}var Ys=new kt("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return pr}}),Qs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).componentDef=e,a.ngModule=r,a.componentType=e.type,a.selector=e.selectors.map(Na).join(","),a.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],a.isBoundToModule=!!r,a}return _createClass(n,[{key:"create",value:function(e,t,n,r){var a,i,o=(r=r||this.ngModule)?function(e,t){return{get:function(n,r,a){var i=e.get(n,Gs,a);return i!==Gs||r===Gs?i:t.get(n,r,a)}}}(e,r.injector):e,s=o.get(ks,dn),u=o.get(Cs,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",h=n?function(e,t,n){if(fn(e))return e.selectRootElement(t,n===jt.ShadowDom);var r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(c,n,this.componentDef.encapsulation):Ga(l,s.createRenderer(null,this.componentDef),function(e){var t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),f=this.componentDef.onPush?576:528,d="string"==typeof n&&/^#root-ng-internal-isolated-\d+/.test(n),p={components:[],scheduler:pr,clean:Ci,playerHandler:null,flags:0},v=ti(0,-1,null,1,0,null,null,null,null,null),m=Ka(null,v,p,f,null,null,s,c,u,o);Wn(m,null);try{var g=function(e,t,n,r,a,i){var o=n[1];n[20]=e;var s=Xa(o,null,0,3,null,null),u=s.mergedAttrs=t.hostAttrs;null!==u&&(To(s,u,!0),null!==e&&(rr(a,e,u),null!==s.classes&&Qi(a,e,s.classes),null!==s.styles&&Yi(a,e,s.styles)));var c=r.createRenderer(e,t),l=Ka(n,ei(t),null,t.onPush?64:16,n[20],s,r,c,void 0);return o.firstCreatePass&&(xr(br(s,n),o,t.type),ci(o,s),hi(s,n.length,1)),bi(n,l),n[20]=l}(h,this.componentDef,m,s,c);if(h)if(n)rr(c,h,["ng-version",Ts.full]);else{var y=function(e){for(var t=[],n=[],r=1,a=2;r<e.length;){var i=e[r];if("string"==typeof i)2===a?""!==i&&t.push(i,e[++r]):8===a&&n.push(i);else{if(!Ta(a))break;a=i}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]),b=y.attrs,k=y.classes;b&&rr(c,h,b),k&&k.length>0&&Qi(c,h,k.join(" "))}if(i=gn(v,0),void 0!==t)for(var _=i.projection=[],w=0;w<this.ngContentSelectors.length;w++){var x=t[w];_.push(null!=x?Array.from(x):null)}a=function(e,t,n,r,a){var i=n[1],o=function(e,t,n){var r=In();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),ui(e,r,1),fi(e,t,n));var a=Ar(t,e,t.length-1,r);ya(a,t);var i=mn(r,t);return i&&ya(i,t),a}(i,n,t);r.components.push(o),e[8]=o,a&&a.forEach((function(e){return e(o,t)})),t.contentQueries&&t.contentQueries(1,o,n.length-1);var s=In();if(i.firstCreatePass&&(null!==t.hostBindings||null!==t.hostAttrs)){Xn(s.index-20);var u=n[1];ii(u,t),oi(u,n,t.hostVars),si(t,o)}return o}(g,this.componentDef,m,p,[is]),Ya(v,m,null)}finally{Gn()}var C=new Zs(this.componentType,a,no(ys,i,m),m,i);return n&&!d||(v.node.child=i),C}},{key:"inputs",get:function(){return Xs(this.componentDef.inputs)}},{key:"outputs",get:function(){return Xs(this.componentDef.outputs)}}]),n}(vs),Zs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s,u,c,l;return _classCallCheck(this,n),(s=t.call(this)).location=a,s._rootLView=i,s._tNode=o,s.destroyCbs=[],s.instance=r,s.hostView=s.changeDetectorRef=new to(i),u=i[1],c=i,null==(l=u.node)&&(u.node=l=ni(0,null,2,-1,null,null)),c[6]=l,s.componentType=e,s}return _createClass(n,[{key:"destroy",value:function(){this.destroyCbs&&(this.destroyCbs.forEach((function(e){return e()})),this.destroyCbs=null,!this.hostView.destroyed&&this.hostView.destroy())}},{key:"onDestroy",value:function(e){this.destroyCbs&&this.destroyCbs.push(e)}},{key:"injector",get:function(){return new Nr(this._tNode,this._rootLView)}}]),n}(function(){return function e(){_classCallCheck(this,e)}}()),$s=void 0,Js=["en",[["a","p"],["AM","PM"],$s],[["AM","PM"],$s,$s],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],$s,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],$s,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",$s,"{1} 'at' {0}",$s],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],eu={};function tu(e){return e in eu||(eu[e]=ft.ng&&ft.ng.common&&ft.ng.common.locales&&ft.ng.common.locales[e]),eu[e]}var nu=function(){var e={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencyCode:15,CurrencySymbol:16,CurrencyName:17,Currencies:18,Directionality:19,PluralCase:20,ExtraData:21};return e[e.LocaleId]="LocaleId",e[e.DayPeriodsFormat]="DayPeriodsFormat",e[e.DayPeriodsStandalone]="DayPeriodsStandalone",e[e.DaysFormat]="DaysFormat",e[e.DaysStandalone]="DaysStandalone",e[e.MonthsFormat]="MonthsFormat",e[e.MonthsStandalone]="MonthsStandalone",e[e.Eras]="Eras",e[e.FirstDayOfWeek]="FirstDayOfWeek",e[e.WeekendRange]="WeekendRange",e[e.DateFormat]="DateFormat",e[e.TimeFormat]="TimeFormat",e[e.DateTimeFormat]="DateTimeFormat",e[e.NumberSymbols]="NumberSymbols",e[e.NumberFormats]="NumberFormats",e[e.CurrencyCode]="CurrencyCode",e[e.CurrencySymbol]="CurrencySymbol",e[e.CurrencyName]="CurrencyName",e[e.Currencies]="Currencies",e[e.Directionality]="Directionality",e[e.PluralCase]="PluralCase",e[e.ExtraData]="ExtraData",e}();function ru(e){var t;null==(t=e)&&function(e,t,n,r){throw new Error("ASSERTION ERROR: ".concat("Expected localeId to be defined")+" [Expected=> null != ".concat(t," <=Actual]"))}(0,t),"string"==typeof e&&e.toLowerCase().replace(/_/g,"-")}var au=new Map,iu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;_classCallCheck(this,n),(a=t.call(this))._parent=r,a._bootstrapComponents=[],a.injector=_assertThisInitialized(a),a.destroyCbs=[],a.componentFactoryResolver=new Ks(_assertThisInitialized(a));var i=nn(e),o=e[gt]||null;return o&&ru(o),a._bootstrapComponents=vr(i.bootstrap),a._r3Injector=po(e,r,[{provide:Ft,useValue:_assertThisInitialized(a)},{provide:gs,useValue:a.componentFactoryResolver}],nt(e)),a._r3Injector._resolveInjectorDefTypes(),a.instance=a.get(e),a}return _createClass(n,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_o.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:je.Default;return e===_o||e===Ft||e===_t?this:this._r3Injector.get(e,t,n)}},{key:"destroy",value:function(){var e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach((function(e){return e()})),this.destroyCbs=null}},{key:"onDestroy",value:function(e){this.destroyCbs.push(e)}}]),n}(Ft),ou=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).moduleType=e,null!==nn(e)&&function e(t){if(null!==t.\u0275mod.id){var n=t.\u0275mod.id;(function(e,t,n){if(t&&t!==n)throw new Error("Duplicate module registered for ".concat(e," - ").concat(nt(t)," vs ").concat(nt(t.name)))})(n,au.get(n),t),au.set(n,t)}var r=t.\u0275mod.imports;r instanceof Function&&(r=r()),r&&r.forEach((function(t){return e(t)}))}(e),r}return _createClass(n,[{key:"create",value:function(e){return new iu(this.moduleType,e)}}]),n}(Mt),su=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,n),(e=t.call(this)).__isAsync=r,e}return _createClass(n,[{key:"emit",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,r){var a,i=function(e){return null},o=function(){return null};e&&"object"==typeof e?(a=this.__isAsync?function(t){setTimeout((function(){return e.next(t)}))}:function(t){e.next(t)},e.error&&(i=this.__isAsync?function(t){setTimeout((function(){return e.error(t)}))}:function(t){e.error(t)}),e.complete&&(o=this.__isAsync?function(){setTimeout((function(){return e.complete()}))}:function(){e.complete()})):(a=this.__isAsync?function(t){setTimeout((function(){return e(t)}))}:function(t){e(t)},t&&(i=this.__isAsync?function(e){setTimeout((function(){return t(e)}))}:function(e){t(e)}),r&&(o=this.__isAsync?function(){setTimeout((function(){return r()}))}:function(){r()}));var s=_get(_getPrototypeOf(n.prototype),"subscribe",this).call(this,a,i,o);return e instanceof G&&e.add(s),s}}]),n}(ue);function uu(){return this._results[Ao()]()}var cu=function(){function e(){_classCallCheck(this,e),this.dirty=!0,this._results=[],this.changes=new su,this.length=0;var t=Ao(),n=e.prototype;n[t]||(n[t]=uu)}return _createClass(e,[{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e){this._results=function e(t,n){void 0===n&&(n=t);for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?(n===t&&(n=t.slice(0,r)),e(a,n)):n!==t&&n.push(a)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}},{key:"notifyOnChanges",value:function(){this.changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}(),lu=function(){function e(t){_classCallCheck(this,e),this.queryList=t,this.matches=null}return _createClass(e,[{key:"clone",value:function(){return new e(this.queryList)}},{key:"setDirty",value:function(){this.queryList.setDirty()}}]),e}(),hu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.queries=t}return _createClass(e,[{key:"createEmbeddedView",value:function(t){var n=t.queries;if(null!==n){for(var r=null!==t.contentQueries?t.contentQueries[0]:n.length,a=[],i=0;i<r;i++){var o=n.getByIndex(i);a.push(this.queries[o.indexInDeclarationView].clone())}return new e(a)}return null}},{key:"insertView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"detachView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"dirtyQueriesWithMatches",value:function(e){for(var t=0;t<this.queries.length;t++)null!==yu(e,t).matches&&this.queries[t].setDirty()}}]),e}(),fu=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,e),this.predicate=t,this.descendants=n,this.isStatic=r,this.read=a},du=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.queries=t}return _createClass(e,[{key:"elementStart",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}},{key:"elementEnd",value:function(e){for(var t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}},{key:"embeddedTView",value:function(t){for(var n=null,r=0;r<this.length;r++){var a=null!==n?n.length:0,i=this.getByIndex(r).embeddedTView(t,a);i&&(i.indexInDeclarationView=r,null!==n?n.push(i):n=[i])}return null!==n?new e(n):null}},{key:"template",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}},{key:"getByIndex",value:function(e){return this.queries[e]}},{key:"track",value:function(e){this.queries.push(e)}},{key:"length",get:function(){return this.queries.length}}]),e}(),pu=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;_classCallCheck(this,e),this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}return _createClass(e,[{key:"elementStart",value:function(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}},{key:"elementEnd",value:function(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}},{key:"template",value:function(e,t){this.elementStart(e,t)}},{key:"embeddedTView",value:function(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new e(this.metadata)):null}},{key:"isApplyingToNode",value:function(e){if(this._appliesToNextNode&&!1===this.metadata.descendants){for(var t=this._declarationNodeIndex,n=e.parent;null!==n&&4===n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}},{key:"matchTNode",value:function(e,t){if(Array.isArray(this.metadata.predicate))for(var n=this.metadata.predicate,r=0;r<n.length;r++)this.matchTNodeWithReadOption(e,t,vu(t,n[r]));else{var a=this.metadata.predicate;a===Vs?0===t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Er(t,e,a,!1,!1))}}},{key:"matchTNodeWithReadOption",value:function(e,t,n){if(null!==n){var r=this.metadata.read;if(null!==r)if(r===ys||r===Hs||r===Vs&&0===t.type)this.addMatch(t.index,-2);else{var a=Er(t,e,r,!1,!1);null!==a&&this.addMatch(t.index,a)}else this.addMatch(t.index,n)}}},{key:"addMatch",value:function(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}]),e}();function vu(e,t){var n=e.localNames;if(null!==n)for(var r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function mu(e,t,n,r){return-1===n?function(e,t){return 3===e.type||4===e.type?no(ys,e,t):0===e.type?ro(Vs,ys,e,t):null}(t,e):-2===n?function(e,t,n){return n===ys?no(ys,t,e):n===Vs?ro(Vs,ys,t,e):n===Hs?ao(Hs,ys,t,e):void 0}(e,t,r):Ar(e,e[1],n,t)}function gu(e,t,n,r){var a=t[19].queries[r];if(null===a.matches){for(var i=e.data,o=n.matches,s=[],u=0;u<o.length;u+=2){var c=o[u];s.push(c<0?null:mu(t,i[c],o[u+1],n.metadata.read))}a.matches=s}return a.matches}function yu(e,t){return e.queries.getByIndex(t)}var bu=new kt("Application Initializer"),ku=function(){var e=function(){function e(t){var n=this;_classCallCheck(this,e),this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return _createClass(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var a=this.appInits[r]();Vo(a)&&t.push(a)}Promise.all(t).then((function(){n()})).catch((function(t){e.reject(t)})),0===t.length&&n(),this.initialized=!0}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(It(bu,8))},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}(),_u=new kt("AppId"),wu={provide:_u,useFactory:function(){return"".concat(xu()).concat(xu()).concat(xu())},deps:[]};function xu(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Cu=new kt("Platform Initializer"),Su=new kt("Platform ID"),Tu=new kt("appBootstrapListener"),Eu=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}(),Au=new kt("LocaleId"),Iu=new kt("DefaultCurrencyCode"),Ru=function e(t,n){_classCallCheck(this,e),this.ngModuleFactory=t,this.componentFactories=n},Nu=function(e){return new ou(e)},Ou=Nu,Du=function(e){return Promise.resolve(Nu(e))},Fu=function(e){var t=Nu(e),n=vr(nn(e).declarations).reduce((function(e,t){var n=en(t);return n&&e.push(new Qs(n)),e}),[]);return new Ru(t,n)},Mu=Fu,Lu=function(e){return Promise.resolve(Fu(e))},Pu=function(){var e=function(){function e(){_classCallCheck(this,e),this.compileModuleSync=Ou,this.compileModuleAsync=Du,this.compileModuleAndAllComponentsSync=Mu,this.compileModuleAndAllComponentsAsync=Lu}return _createClass(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}(),zu=new kt("compilerOptions"),Bu=Promise.resolve(0);function Uu(e){"undefined"==typeof Zone?Bu.then((function(){e&&e.apply(null,null)})):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var Wu=function(){function e(t){var n,r,a=t.enableLongStackTrace,i=void 0!==a&&a,o=t.shouldCoalesceEventChangeDetection,s=void 0!==o&&o;if(_classCallCheck(this,e),this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new su(!1),this.onMicrotaskEmpty=new su(!1),this.onStable=new su(!1),this.onError=new su(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),this.shouldCoalesceEventChangeDetection=s,this.lastRequestAnimationFrameId=-1,this.nativeRequestAnimationFrame=function(){var e=ft.requestAnimationFrame,t=ft.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){var n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);var r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,r=!!(n=this).shouldCoalesceEventChangeDetection&&n.nativeRequestAnimationFrame&&function(){!function(e){-1===e.lastRequestAnimationFrameId&&(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(ft,(function(){e.lastRequestAnimationFrameId=-1,qu(e),Hu(e)})),qu(e))}(n)},n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0,maybeDelayChangeDetection:r},onInvokeTask:function(e,t,a,i,o,s){try{return Gu(n),e.invokeTask(a,i,o,s)}finally{r&&"eventTask"===i.type&&r(),Ku(n)}},onInvoke:function(e,t,r,a,i,o,s){try{return Gu(n),e.invoke(r,a,i,o,s)}finally{Ku(n)}},onHasTask:function(e,t,r,a){e.hasTask(r,a),t===r&&("microTask"==a.change?(n._hasPendingMicrotasks=a.microTask,qu(n),Hu(n)):"macroTask"==a.change&&(n.hasPendingMacrotasks=a.macroTask))},onHandleError:function(e,t,r,a){return e.handleError(r,a),n.runOutsideAngular((function(){return n.onError.emit(a)})),!1}})}return _createClass(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var a=this._inner,i=a.scheduleEventTask("NgZoneEvent: "+r,e,ju,Vu,Vu);try{return a.runTask(i,t,n)}finally{a.cancelTask(i)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}();function Vu(){}var ju={};function Hu(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular((function(){return e.onStable.emit(null)}))}finally{e.isStable=!0}}}function qu(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||e.shouldCoalesceEventChangeDetection&&-1!==e.lastRequestAnimationFrameId)}function Gu(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Ku(e){e._nesting--,Hu(e)}var Xu,Yu=function(){function e(){_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new su,this.onMicrotaskEmpty=new su,this.onStable=new su,this.onError=new su}return _createClass(e,[{key:"run",value:function(e,t,n){return e.apply(t,n)}},{key:"runGuarded",value:function(e,t,n){return e.apply(t,n)}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e,t,n,r){return e.apply(t,n)}}]),e}(),Qu=function(){var e=function(){function e(t){var n=this;_classCallCheck(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run((function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")}))}return _createClass(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular((function(){e._ngZone.onStable.subscribe({next:function(){Wu.assertNotInAngularZone(),Uu((function(){e._isZoneStable=!0,e._runCallbacksIfReady()}))}})}))}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())Uu((function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1}));else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter((function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)})),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map((function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}})):[]}},{key:"addCallback",value:function(e,t,n){var r=this,a=-1;t&&t>0&&(a=setTimeout((function(){r._callbacks=r._callbacks.filter((function(e){return e.timeoutId!==a})),e(r._didWork,r.getPendingTasks())}),t)),this._callbacks.push({doneCb:e,timeoutId:a,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(It(Wu))},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}(),Zu=function(){var e=function(){function e(){_classCallCheck(this,e),this._applications=new Map,$u.addToWindow(this)}return _createClass(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return $u.findTestabilityInTree(this,e,t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}(),$u=new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),Ju=function(e,t,n){var r=e.get(zu,[]).concat(t),a=new ou(n);if(0===xo.size)return Promise.resolve(a);var i,o,s=(i=r.map((function(e){return e.providers})),o=[],i.forEach((function(e){return e&&o.push.apply(o,_toConsumableArray(e))})),o);if(0===s.length)return Promise.resolve(a);var u=function(){var e=ft.ng;if(!e||!e.\u0275compilerFacade)throw new Error("Angular JIT compilation failed: '@angular/compiler' not loaded!\n  - JIT compilation is discouraged for production use-cases! Consider AOT mode instead.\n  - Did you bootstrap using '@angular/platform-browser-dynamic' or '@angular/platform-server'?\n  - Alternatively provide the compiler with 'import \"@angular/compiler\";' before bootstrapping.");return e.\u0275compilerFacade}(),c=_o.create({providers:s}).get(u.ResourceLoader);return function(e){var t=[],n=new Map;function r(e){var t=n.get(e);if(!t){var r=function(e){return Promise.resolve(c.get(e))}(e);n.set(e,t=r.then(So))}return t}return xo.forEach((function(e,n){var a=[];e.templateUrl&&a.push(r(e.templateUrl).then((function(t){e.template=t})));var i=e.styleUrls,o=e.styles||(e.styles=[]),s=e.styles.length;i&&i.forEach((function(t,n){o.push(""),a.push(r(t).then((function(r){o[s+n]=r,i.splice(i.indexOf(t),1),0==i.length&&(e.styleUrls=void 0)})))}));var u=Promise.all(a).then((function(){return function(e){Co.delete(e)}(n)}));t.push(u)})),xo=new Map,Promise.all(t).then((function(){}))}().then((function(){return a}))},ec=new kt("AllowMultipleToken"),tc=function e(t,n){_classCallCheck(this,e),this.name=t,this.token=n};function nc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: ".concat(t),a=new kt(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=rc();if(!i||i.injector.get(ec,!1))if(e)e(n.concat(t).concat({provide:a,useValue:!0}));else{var o=n.concat(t).concat({provide:a,useValue:!0},{provide:so,useValue:"platform"});!function(e){if(Xu&&!Xu.destroyed&&!Xu.injector.get(ec,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Xu=e.get(ac);var t=e.get(Cu,null);t&&t.forEach((function(e){return e()}))}(_o.create({providers:o,name:r}))}return function(e){var t=rc();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(a)}}function rc(){return Xu&&!Xu.destroyed?Xu:null}var ac=function(){var e=function(){function e(t){_classCallCheck(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n,r,a=this,i=(n=t?t.ngZone:void 0,r=t&&t.ngZoneEventCoalescing||!1,"noop"===n?new Yu:("zone.js"===n?void 0:n)||new Wu({enableLongStackTrace:Kr(),shouldCoalesceEventChangeDetection:r})),o=[{provide:Wu,useValue:i}];return i.run((function(){var t=_o.create({providers:o,parent:a.injector,name:e.moduleType.name}),n=e.create(t),r=n.injector.get(Mr,null);if(!r)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy((function(){return uc(a._modules,n)})),i.runOutsideAngular((function(){return i.onError.subscribe({next:function(e){r.handleError(e)}})})),function(e,t,r){try{var i=((o=n.injector.get(ku)).runInitializers(),o.donePromise.then((function(){return ru(n.injector.get(Au,"en-US")||"en-US"),a._moduleDoBootstrap(n),n})));return Vo(i)?i.catch((function(n){throw t.runOutsideAngular((function(){return e.handleError(n)})),n})):i}catch(s){throw t.runOutsideAngular((function(){return e.handleError(s)})),s}var o}(r,i)}))}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=ic({},n);return Ju(this.injector,r,e).then((function(e){return t.bootstrapModuleFactory(e,r)}))}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(sc);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach((function(e){return t.bootstrap(e)}));else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(nt(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. ')+"Please define one of these.");e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach((function(e){return e.destroy()})),this._destroyListeners.forEach((function(e){return e()})),this._destroyed=!0}},{key:"injector",get:function(){return this._injector}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();return e.\u0275fac=function(t){return new(t||e)(It(_o))},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}();function ic(e,t){return Array.isArray(t)?t.reduce(ic,e):Object.assign(Object.assign({},e),t)}var oc,sc=((oc=function(){function e(t,n,r,a,i,o){var s=this;_classCallCheck(this,e),this._zone=t,this._console=n,this._injector=r,this._exceptionHandler=a,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Kr(),this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run((function(){s.tick()}))}});var u=new ne((function(e){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular((function(){e.next(s._stable),e.complete()}))})),c=new ne((function(e){var t;s._zone.runOutsideAngular((function(){t=s._zone.onStable.subscribe((function(){Wu.assertNotInAngularZone(),Uu((function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,e.next(!0))}))}))}));var n=s._zone.onUnstable.subscribe((function(){Wu.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular((function(){e.next(!1)})))}));return function(){t.unsubscribe(),n.unsubscribe()}}));this.isStable=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Number.POSITIVE_INFINITY,a=null,i=t[t.length-1];return le(i)?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===a&&1===t.length&&t[0]instanceof ne?t[0]:Ee(r)(Ae(t,a))}(u,c.pipe(Le()))}return _createClass(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof vs?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var a=n.isBoundToModule?void 0:this._injector.get(Ft),i=n.create(_o.NULL,[],t||n.selector,a);i.onDestroy((function(){r._unloadComponent(i)}));var o=i.injector.get(Qu,null);return o&&i.injector.get(Zu).registerApplication(i.location.nativeElement,o),this._loadComponent(i),Kr()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}},{key:"tick",value:function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;var t,n=_createForOfIteratorHelper(this._views);try{for(n.s();!(t=n.n()).done;)t.value.detectChanges()}catch(i){n.e(i)}finally{n.f()}if(this._enforceNoNewChanges){var r,a=_createForOfIteratorHelper(this._views);try{for(a.s();!(r=a.n()).done;)r.value.checkNoChanges()}catch(i){a.e(i)}finally{a.f()}}}catch(o){this._zone.runOutsideAngular((function(){return e._exceptionHandler.handleError(o)}))}finally{this._runningTick=!1}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;uc(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Tu,[]).concat(this._bootstrapListeners).forEach((function(t){return t(e)}))}},{key:"_unloadComponent",value:function(e){this.detachView(e.hostView),uc(this.components,e)}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach((function(e){return e.destroy()}))}},{key:"viewCount",get:function(){return this._views.length}}]),e}()).\u0275fac=function(e){return new(e||oc)(It(Wu),It(Eu),It(_o),It(Mr),It(gs),It(ku))},oc.\u0275prov=Ge({token:oc,factory:oc.\u0275fac}),oc);function uc(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var cc=function e(){_classCallCheck(this,e)},lc=function e(){_classCallCheck(this,e)},hc={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},fc=function(){var e=function(){function e(t,n){_classCallCheck(this,e),this._compiler=t,this._config=n||hc}return _createClass(e,[{key:"load",value:function(e){return this.loadAndCompile(e)}},{key:"loadAndCompile",value:function(e){var t=this,r=_slicedToArray(e.split("#"),2),a=r[0],i=r[1];return void 0===i&&(i="default"),n("zn8P")(a).then((function(e){return e[i]})).then((function(e){return dc(e,a,i)})).then((function(e){return t._compiler.compileModuleAsync(e)}))}},{key:"loadFactory",value:function(e){var t=_slicedToArray(e.split("#"),2),r=t[0],a=t[1],i="NgFactory";return void 0===a&&(a="default",i=""),n("zn8P")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then((function(e){return e[a+i]})).then((function(e){return dc(e,r,a)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(It(Pu),It(lc,8))},e.\u0275prov=Ge({token:e,factory:e.\u0275fac}),e}();function dc(e,t,n){if(!e)throw new Error("Cannot find '".concat(n,"' in '").concat(t,"'"));return e}var pc=nc(null,"core",[{provide:Su,useValue:"unknown"},{provide:ac,deps:[_o]},{provide:Zu,deps:[]},{provide:Eu,deps:[]}]),vc=[{provide:sc,useClass:sc,deps:[Wu,Eu,_o,Mr,gs,ku]},{provide:Ys,deps:[Wu],useFactory:function(e){var t=[];return e.onStable.subscribe((function(){for(;t.length;)t.pop()()})),function(e){t.push(e)}}},{provide:ku,useClass:ku,deps:[[new Ue,bu]]},{provide:Pu,useClass:Pu,deps:[]},wu,{provide:Ps,useFactory:function(){return Us},deps:[]},{provide:zs,useFactory:function(){return Ws},deps:[]},{provide:Au,useFactory:function(e){return ru(e=e||"undefined"!=typeof $localize&&$localize.locale||"en-US"),e},deps:[[new Be(Au),new Ue,new Ve]]},{provide:Iu,useValue:"USD"}],mc=function(){var e=function e(t){_classCallCheck(this,e)};return e.\u0275mod=Zt({type:e}),e.\u0275inj=Ke({factory:function(t){return new(t||e)(It(sc))},providers:vc}),e}(),gc=null;function yc(){return gc}var bc,kc=new kt("DocumentToken"),_c=((bc=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||bc)},bc.\u0275prov=Ge({factory:wc,token:bc,providedIn:"platform"}),bc);function wc(){return It(Sc)}var xc,Cc=new kt("Location Initialized"),Sc=((xc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r._init(),r}return _createClass(n,[{key:"_init",value:function(){this.location=yc().getLocation(),this._history=yc().getHistory()}},{key:"getBaseHrefFromDOM",value:function(){return yc().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){yc().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}},{key:"onHashChange",value:function(e){yc().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}},{key:"pushState",value:function(e,t,n){Tc()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){Tc()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"getState",value:function(){return this._history.state}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}}]),n}(_c)).\u0275fac=function(e){return new(e||xc)(It(kc))},xc.\u0275prov=Ge({factory:Ec,token:xc,providedIn:"platform"}),xc);function Tc(){return!!window.history.pushState}function Ec(){return new Sc(It(kc))}function Ac(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function Ic(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Rc(e){return e&&"?"!==e[0]?"?"+e:e}var Nc,Oc=((Nc=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||Nc)},Nc.\u0275prov=Ge({factory:Dc,token:Nc,providedIn:"root"}),Nc);function Dc(e){var t=It(kc).location;return new zc(It(_c),t&&t.origin||"")}var Fc,Mc,Lc,Pc=new kt("appBaseHref"),zc=((Lc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck(this,n),(a=t.call(this))._platformLocation=e,null==r&&(r=a._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return a._baseHref=r,_possibleConstructorReturn(a)}return _createClass(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"prepareExternalUrl",value:function(e){return Ac(this._baseHref,e)}},{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._platformLocation.pathname+Rc(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?"".concat(t).concat(n):t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Rc(r));this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Rc(r));this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(Oc)).\u0275fac=function(e){return new(e||Lc)(It(_c),It(Pc,8))},Lc.\u0275prov=Ge({token:Lc,factory:Lc.\u0275fac}),Lc),Bc=((Mc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this))._platformLocation=e,a._baseHref="",null!=r&&(a._baseHref=r),a}return _createClass(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"path",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}},{key:"prepareExternalUrl",value:function(e){var t=Ac(this._baseHref,e);return t.length>0?"#"+t:t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Rc(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+Rc(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(Oc)).\u0275fac=function(e){return new(e||Mc)(It(_c),It(Pc,8))},Mc.\u0275prov=Ge({token:Mc,factory:Mc.\u0275fac}),Mc),Uc=((Fc=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._subject=new su,this._urlChangeListeners=[],this._platformStrategy=t;var a=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=Ic(Vc(a)),this._platformStrategy.onPopState((function(e){r._subject.emit({url:r.path(!0),pop:!0,state:e.state,type:e.type})}))}return _createClass(e,[{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.normalize(this._platformStrategy.path(e))}},{key:"getState",value:function(){return this._platformLocation.getState()}},{key:"isCurrentPathEqualTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.path()==this.normalize(e+Rc(t))}},{key:"normalize",value:function(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,Vc(t)))}},{key:"prepareExternalUrl",value:function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Rc(t)),n)}},{key:"replaceState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Rc(t)),n)}},{key:"forward",value:function(){this._platformStrategy.forward()}},{key:"back",value:function(){this._platformStrategy.back()}},{key:"onUrlChange",value:function(e){var t=this;this._urlChangeListeners.push(e),this.subscribe((function(e){t._notifyUrlChangeListeners(e.url,e.state)}))}},{key:"_notifyUrlChangeListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._urlChangeListeners.forEach((function(n){return n(e,t)}))}},{key:"subscribe",value:function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}]),e}()).\u0275fac=function(e){return new(e||Fc)(It(Oc),It(_c))},Fc.normalizeQueryParams=Rc,Fc.joinWithSlash=Ac,Fc.stripTrailingSlash=Ic,Fc.\u0275prov=Ge({factory:Wc,token:Fc,providedIn:"root"}),Fc);function Wc(){return new Uc(It(Oc),It(_c))}function Vc(e){return e.replace(/\/index.html$/,"")}var jc,Hc,qc,Gc,Kc,Xc,Yc,Qc,Zc,$c=function(){var e={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return e[e.Zero]="Zero",e[e.One]="One",e[e.Two]="Two",e[e.Few]="Few",e[e.Many]="Many",e[e.Other]="Other",e}(),Jc=function e(){_classCallCheck(this,e)},el=((jc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).locale=e,r}return _createClass(n,[{key:"getPluralCategory",value:function(e,t){switch(function(e){return function(e){var t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e),n=tu(t);if(n)return n;var r=t.split("-")[0];if(n=tu(r))return n;if("en"===r)return Js;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}(e)[nu.PluralCase]}(t||this.locale)(e)){case $c.Zero:return"zero";case $c.One:return"one";case $c.Two:return"two";case $c.Few:return"few";case $c.Many:return"many";default:return"other"}}}]),n}(Jc)).\u0275fac=function(e){return new(e||jc)(It(Au))},jc.\u0275prov=Ge({token:jc,factory:jc.\u0275fac}),jc),tl=function(){function e(t,n,r,a){_classCallCheck(this,e),this.$implicit=t,this.ngForOf=n,this.index=r,this.count=a}return _createClass(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),nl=((Hc=function(){function e(t,n,r){_classCallCheck(this,e),this._viewContainer=t,this._template=n,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}return _createClass(e,[{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'. NgFor only supports binding to Iterables such as Arrays."))}}var t;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}},{key:"_applyChanges",value:function(e){var t=this,n=[];e.forEachOperation((function(e,r,a){if(null==e.previousIndex){var i=t._viewContainer.createEmbeddedView(t._template,new tl(null,t._ngForOf,-1,-1),null===a?void 0:a),o=new rl(e,i);n.push(o)}else if(null==a)t._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=t._viewContainer.get(r);t._viewContainer.move(s,a);var u=new rl(e,s);n.push(u)}}));for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var a=0,i=this._viewContainer.length;a<i;a++){var o=this._viewContainer.get(a);o.context.index=a,o.context.count=i,o.context.ngForOf=this._ngForOf}e.forEachIdentityChange((function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item}))}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}},{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",set:function(e){Kr()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn("trackBy must be a function, but received ".concat(JSON.stringify(e),". ")+"See https://angular.io/api/common/NgForOf#change-propagation for more information."),this._trackByFn=e},get:function(){return this._trackByFn}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}()).\u0275fac=function(e){return new(e||Hc)(Fo(Hs),Fo(Vs),Fo(Ps))},Hc.\u0275dir=Jt({type:Hc,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),Hc),rl=function e(t,n){_classCallCheck(this,e),this.record=t,this.view=n},al=((Kc=function(){function e(t,n,r){_classCallCheck(this,e),this._ngEl=t,this._differs=n,this._renderer=r,this._ngStyle=null,this._differ=null}return _createClass(e,[{key:"ngDoCheck",value:function(){if(this._differ){var e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}},{key:"_setStyle",value:function(e,t){var n=_slicedToArray(e.split("."),2),r=n[0],a=n[1];null!=(t=null!=t&&a?"".concat(t).concat(a):t)?this._renderer.setStyle(this._ngEl.nativeElement,r,t):this._renderer.removeStyle(this._ngEl.nativeElement,r)}},{key:"_applyChanges",value:function(e){var t=this;e.forEachRemovedItem((function(e){return t._setStyle(e.key,null)})),e.forEachAddedItem((function(e){return t._setStyle(e.key,e.currentValue)})),e.forEachChangedItem((function(e){return t._setStyle(e.key,e.currentValue)}))}},{key:"ngStyle",set:function(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}}]),e}()).\u0275fac=function(e){return new(e||Kc)(Fo(ys),Fo(zs),Fo(ws))},Kc.\u0275dir=Jt({type:Kc,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),Kc),il=((Gc=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:Gc}),Gc.\u0275inj=Ke({factory:function(e){return new(e||Gc)},providers:[{provide:Jc,useClass:el}]}),Gc),ol=((qc=function e(){_classCallCheck(this,e)}).\u0275prov=Ge({token:qc,providedIn:"root",factory:function(){return new sl(It(kc),window,It(Mr))}}),qc),sl=function(){function e(t,n,r){_classCallCheck(this,e),this.document=t,this.window=n,this.errorHandler=r,this.offset=function(){return[0,0]}}return _createClass(e,[{key:"setOffset",value:function(e){this.offset=Array.isArray(e)?function(){return e}:e}},{key:"getScrollPosition",value:function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]}},{key:"scrollToPosition",value:function(e){this.supportScrollRestoration()&&this.window.scrollTo(e[0],e[1])}},{key:"scrollToAnchor",value:function(e){if(this.supportScrollRestoration()){e=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(e):e.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{var t=this.document.querySelector("#".concat(e));if(t)return void this.scrollToElement(t);var n=this.document.querySelector("[name='".concat(e,"']"));if(n)return void this.scrollToElement(n)}catch(r){this.errorHandler.handleError(r)}}}},{key:"setHistoryScrollRestoration",value:function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}},{key:"scrollToElement",value:function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(n-a[0],r-a[1])}},{key:"supportScrollRestoration",value:function(){try{return!!this.window&&!!this.window.scrollTo}catch(e){return!1}}}]),e}(),ul=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getProperty",value:function(e,t){return e[t]}},{key:"log",value:function(e){window.console&&window.console.log&&window.console.log(e)}},{key:"logGroup",value:function(e){window.console&&window.console.group&&window.console.group(e)}},{key:"logGroupEnd",value:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()}},{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"remove",value:function(e){return e.parentNode&&e.parentNode.removeChild(e),e}},{key:"getValue",value:function(e){return e.value}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getHistory",value:function(){return window.history}},{key:"getLocation",value:function(){return window.location}},{key:"getBaseHref",value:function(e){var t,n=cl||(cl=document.querySelector("base"))?cl.getAttribute("href"):null;return null==n?null:(t=n,Xc||(Xc=document.createElement("a")),Xc.setAttribute("href",t),"/"===Xc.pathname.charAt(0)?Xc.pathname:"/"+Xc.pathname)}},{key:"resetBaseElement",value:function(){cl=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"performanceNow",value:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}},{key:"supportsCookies",value:function(){return!0}},{key:"getCookie",value:function(e){return function(e,t){t=encodeURIComponent(t);var n,r=_createForOfIteratorHelper(e.split(";"));try{for(r.s();!(n=r.n()).done;){var a=n.value,i=a.indexOf("="),o=_slicedToArray(-1==i?[a,""]:[a.slice(0,i),a.slice(i+1)],2),s=o[0],u=o[1];if(s.trim()===t)return decodeURIComponent(u)}}catch(c){r.e(c)}finally{r.f()}return null}(document.cookie,e)}}],[{key:"makeCurrent",value:function(){var e;e=new n,gc||(gc=e)}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.call(this)}return _createClass(n,[{key:"supportsDOMEvents",value:function(){return!0}}]),n}(function(){return function e(){_classCallCheck(this,e)}}())),cl=null,ll=new kt("TRANSITION_ID"),hl=[{provide:bu,useFactory:function(e,t,n){return function(){n.get(ku).donePromise.then((function(){var n=yc();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter((function(t){return t.getAttribute("ng-transition")===e})).forEach((function(e){return n.remove(e)}))}))}},deps:[ll,kc,_o],multi:!0}],fl=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){ft.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},ft.getAllAngularTestabilities=function(){return e.getAllTestabilities()},ft.getAllAngularRootElements=function(){return e.getAllRootElements()},ft.frameworkStabilizers||(ft.frameworkStabilizers=[]),ft.frameworkStabilizers.push((function(e){var t=ft.getAllAngularTestabilities(),n=t.length,r=!1,a=function(t){r=r||t,0==--n&&e(r)};t.forEach((function(e){e.whenStable(a)}))}))}},{key:"findTestabilityInTree",value:function(e,t,n){if(null==t)return null;var r=e.getTestability(t);return null!=r?r:n?yc().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}],[{key:"init",value:function(){var t;t=new e,$u=t}}]),e}(),dl=new kt("EventManagerPlugins"),pl=((Yc=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach((function(e){return e.manager=r})),this._plugins=t.slice().reverse()}return _createClass(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var a=n[r];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error("No event manager plugin found for event ".concat(e))}}]),e}()).\u0275fac=function(e){return new(e||Yc)(It(dl),It(Wu))},Yc.\u0275prov=Ge({token:Yc,factory:Yc.\u0275fac}),Yc),vl=function(){function e(t){_classCallCheck(this,e),this._doc=t}return _createClass(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=yc().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),ml=((Zc=function(){function e(){_classCallCheck(this,e),this._stylesSet=new Set}return _createClass(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach((function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))})),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}()).\u0275fac=function(e){return new(e||Zc)},Zc.\u0275prov=Ge({token:Zc,factory:Zc.\u0275fac}),Zc),gl=((Qc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r._hostNodes=new Set,r._styleNodes=new Set,r._hostNodes.add(e.head),r}return _createClass(n,[{key:"_addStylesToHost",value:function(e,t){var n=this;e.forEach((function(e){var r=n._doc.createElement("style");r.textContent=e,n._styleNodes.add(t.appendChild(r))}))}},{key:"addHost",value:function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}},{key:"removeHost",value:function(e){this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach((function(n){return t._addStylesToHost(e,n)}))}},{key:"ngOnDestroy",value:function(){this._styleNodes.forEach((function(e){return yc().remove(e)}))}}]),n}(ml)).\u0275fac=function(e){return new(e||Qc)(It(kc))},Qc.\u0275prov=Ge({token:Qc,factory:Qc.\u0275fac}),Qc),yl={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},bl=/%COMP%/g;function kl(e,t,n){for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?kl(e,a,n):(a=a.replace(bl,e),n.push(a))}return n}function _l(e){return function(t){if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var wl,xl,Cl,Sl,Tl,El,Al=((wl=function(){function e(t,n,r){_classCallCheck(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new Il(t)}return _createClass(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case jt.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new Rl(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case jt.Native:case jt.ShadowDom:return new Nl(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=kl(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||wl)(It(pl),It(gl),It(_u))},wl.\u0275prov=Ge({token:wl,factory:wl.\u0275fac}),wl),Il=function(){function e(t){_classCallCheck(this,e),this.eventManager=t,this.data=Object.create(null)}return _createClass(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(yl[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var a=yl[r];a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=yl[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&_s.DashCase?e.style.setProperty(t,n,r&_s.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&_s.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,_l(n)):this.eventManager.addEventListener(e,t,_l(n))}}]),e}(),Rl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck(this,n),(o=t.call(this,e)).component=a;var s,u=kl(i+"-"+a.id,a.styles,[]);return r.addStyles(u),o.contentAttr="_ngcontent-%COMP%".replace(bl,i+"-"+a.id),o.hostAttr=(s=i+"-"+a.id,"_nghost-%COMP%".replace(bl,s)),o}return _createClass(n,[{key:"applyToHost",value:function(e){_get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var r=_get(_getPrototypeOf(n.prototype),"createElement",this).call(this,e,t);return _get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),n}(Il),Nl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck(this,n),(o=t.call(this,e)).sharedStylesHost=r,o.hostEl=a,o.component=i,o.shadowRoot=i.encapsulation===jt.ShadowDom?a.attachShadow({mode:"open"}):a.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var s=kl(i.id,i.styles,[]),u=0;u<s.length;u++){var c=document.createElement("style");c.textContent=s[u],o.shadowRoot.appendChild(c)}return o}return _createClass(n,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,r)}},{key:"removeChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(_get(_getPrototypeOf(n.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),n}(Il),Ol=((xl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this;return e.addEventListener(t,n,!1),function(){return r.removeEventListener(e,t,n)}}},{key:"removeEventListener",value:function(e,t,n){return e.removeEventListener(t,n)}}]),n}(vl)).\u0275fac=function(e){return new(e||xl)(It(kc))},xl.\u0275prov=Ge({token:xl,factory:xl.\u0275fac}),xl),Dl=["alt","control","meta","shift"],Fl={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ml={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Ll={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Pl=((Tl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"supports",value:function(e){return null!=n.parseEventName(e)}},{key:"addEventListener",value:function(e,t,r){var a=n.parseEventName(t),i=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular((function(){return yc().onAndCancel(e,a.domEventName,i)}))}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;var a=n._normalizeKey(t.pop()),i="";if(Dl.forEach((function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),i+=e+".")})),i+=a,0!=t.length||0===a.length)return null;var o={};return o.domEventName=r,o.fullKey=i,o}},{key:"getEventFullKey",value:function(e){var t="",n=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Ml.hasOwnProperty(t)&&(t=Ml[t]))}return Fl[t]||t}(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Dl.forEach((function(r){r!=n&&(0,Ll[r])(e)&&(t+=r+".")})),t+=n}},{key:"eventCallback",value:function(e,t,r){return function(a){n.getEventFullKey(a)===e&&r.runGuarded((function(){return t(a)}))}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),n}(vl)).\u0275fac=function(e){return new(e||Tl)(It(kc))},Tl.\u0275prov=Ge({token:Tl,factory:Tl.\u0275fac}),Tl),zl=((Sl=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||Sl)},Sl.\u0275prov=Ge({factory:function(){return It(Bl)},token:Sl,providedIn:"root"}),Sl),Bl=((Cl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r}return _createClass(n,[{key:"sanitize",value:function(e,t){if(null==t)return null;switch(e){case va.NONE:return t;case va.HTML:return jr(t,"HTML")?Vr(t):function(e,t){var n=null;try{ea=ea||new Xr(e);var r=t?String(t):"";n=ea.getInertBodyElement(r);var a=5,i=r;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,r=i,i=n.innerHTML,n=ea.getInertBodyElement(r)}while(r!==i);var o=new la,s=o.sanitizeChildren(pa(n)||n);return Kr()&&o.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=pa(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(t));case va.STYLE:return jr(t,"Style")?Vr(t):function(e){if(!(e=String(e).trim()))return"";var t=e.match(ga);return t&&Zr(t[1])===t[1]||e.match(ma)&&function(e){for(var t=!0,n=!0,r=0;r<e.length;r++){var a=e.charAt(r);"'"===a&&n?t=!t:'"'===a&&t&&(n=!n)}return t&&n}(e)?e:(Kr()&&console.warn("WARNING: sanitizing unsafe style value ".concat(e," (see http://g.co/ng/security#xss).")),"unsafe")}(t);case va.SCRIPT:if(jr(t,"Script"))return Vr(t);throw new Error("unsafe value used in a script context");case va.URL:return Hr(t),jr(t,"URL")?Vr(t):Zr(String(t));case va.RESOURCE_URL:if(jr(t,"ResourceURL"))return Vr(t);throw new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext ".concat(e," (see http://g.co/ng/security#xss)"))}}},{key:"bypassSecurityTrustHtml",value:function(e){return new Pr(e)}},{key:"bypassSecurityTrustStyle",value:function(e){return new zr(e)}},{key:"bypassSecurityTrustScript",value:function(e){return new Br(e)}},{key:"bypassSecurityTrustUrl",value:function(e){return new Ur(e)}},{key:"bypassSecurityTrustResourceUrl",value:function(e){return new Wr(e)}}]),n}(zl)).\u0275fac=function(e){return new(e||Cl)(It(kc))},Cl.\u0275prov=Ge({factory:function(){return e=It(_t),new Bl(e.get(kc));var e},token:Cl,providedIn:"root"}),Cl),Ul=nc(pc,"browser",[{provide:Su,useValue:"browser"},{provide:Cu,useValue:function(){ul.makeCurrent(),fl.init()},multi:!0},{provide:kc,useFactory:function(){return function(e){hn=e}(document),document},deps:[]}]),Wl=[[],{provide:so,useValue:"root"},{provide:Mr,useFactory:function(){return new Mr},deps:[]},{provide:dl,useClass:Ol,multi:!0,deps:[kc,Wu,Su]},{provide:dl,useClass:Pl,multi:!0,deps:[kc]},[],{provide:Al,useClass:Al,deps:[pl,gl,_u]},{provide:ks,useExisting:Al},{provide:ml,useExisting:gl},{provide:gl,useClass:gl,deps:[kc]},{provide:Qu,useClass:Qu,deps:[Wu]},{provide:pl,useClass:pl,deps:[dl,Wu]},[]],Vl=((El=function(){function e(t){if(_classCallCheck(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:_u,useValue:t.appId},{provide:ll,useExisting:_u},hl]}}}]),e}()).\u0275mod=Zt({type:El}),El.\u0275inj=Ke({factory:function(e){return new(e||El)(It(El,12))},providers:Wl,imports:[il,mc]}),El);function jl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return le(r)?(t.pop(),we(t,r)):Ae(t)}"undefined"!=typeof window&&window;var Hl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._value=e,r}return _createClass(n,[{key:"_subscribe",value:function(e){var t=_get(_getPrototypeOf(n.prototype),"_subscribe",this).call(this,e);return t&&!t.closed&&e.next(this._value),t}},{key:"getValue",value:function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new ie;return this._value}},{key:"next",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,this._value=e)}},{key:"value",get:function(){return this.getValue()}}]),n}(ue),ql=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),Gl={},Kl=function(){function e(t){_classCallCheck(this,e),this.resultSelector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Xl(e,this.resultSelector))}}]),e}(),Xl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).resultSelector=r,a.active=0,a.values=[],a.observables=[],a}return _createClass(n,[{key:"_next",value:function(e){this.values.push(Gl),this.observables.push(e)}},{key:"_complete",value:function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(ge(this,r,r,n))}}}},{key:"notifyComplete",value:function(e){0==(this.active-=1)&&this.destination.complete()}},{key:"notifyNext",value:function(e,t,n,r,a){var i=this.values,o=this.toRespond?i[n]===Gl?--this.toRespond:this.toRespond:0;i[n]=t,0===o&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))}},{key:"_tryResultSelector",value:function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(ye),Yl=new ne((function(e){return e.complete()}));function Ql(e){return e?function(e){return new ne((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Yl}function Zl(e){return new ne((function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?xe(n):Ql()).subscribe(t)}))}function $l(){return Ee(1)}function Jl(e,t){return function(n){return n.lift(new eh(e,t))}}var eh=function(){function e(t,n){_classCallCheck(this,e),this.predicate=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new th(e,this.predicate,this.thisArg))}}]),e}(),th=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).predicate=r,i.thisArg=a,i.count=0,i}return _createClass(n,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}]),n}(Y),nh=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}();function rh(e){return function(t){return 0===e?Ql():t.lift(new ah(e))}}var ah=function(){function e(t){if(_classCallCheck(this,e),this.total=t,this.total<0)throw new nh}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new ih(e,this.total))}}]),e}(),ih=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).total=r,a.ring=new Array,a.count=0,a}return _createClass(n,[{key:"_next",value:function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}},{key:"_complete",value:function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,a=0;a<n;a++){var i=t++%n;e.next(r[i])}e.complete()}}]),n}(Y);function oh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ch;return function(t){return t.lift(new sh(e))}}var sh=function(){function e(t){_classCallCheck(this,e),this.errorFactory=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new uh(e,this.errorFactory))}}]),e}(),uh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).errorFactory=r,a.hasValue=!1,a}return _createClass(n,[{key:"_next",value:function(e){this.hasValue=!0,this.destination.next(e)}},{key:"_complete",value:function(){if(this.hasValue)return this.destination.complete();var e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}]),n}(Y);function ch(){return new ql}function lh(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t){return t.lift(new hh(e))}}var hh=function(){function e(t){_classCallCheck(this,e),this.defaultValue=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new fh(e,this.defaultValue))}}]),e}(),fh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).defaultValue=r,a.isEmpty=!0,a}return _createClass(n,[{key:"_next",value:function(e){this.isEmpty=!1,this.destination.next(e)}},{key:"_complete",value:function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}]),n}(Y);function dh(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Jl((function(t,n){return e(t,n,r)})):$,rh(1),n?lh(t):oh((function(){return new ql})))}}function ph(e){return function(t){var n=new vh(e),r=t.lift(n);return n.caught=r}}var vh=function(){function e(t){_classCallCheck(this,e),this.selector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new mh(e,this.selector,this.caught))}}]),e}(),mh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e)).selector=r,i.caught=a,i}return _createClass(n,[{key:"error",value:function(e){if(!this.isStopped){var t;try{t=this.selector(e,this.caught)}catch(i){return void _get(_getPrototypeOf(n.prototype),"error",this).call(this,i)}this._unsubscribeAndRecycle();var r=new he(this,void 0,void 0);this.add(r);var a=ge(this,t,void 0,void 0,r);a!==r&&this.add(a)}}}]),n}(ye);function gh(e){return function(t){return 0===e?Ql():t.lift(new yh(e))}}var yh=function(){function e(t){if(_classCallCheck(this,e),this.total=t,this.total<0)throw new nh}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new bh(e,this.total))}}]),e}(),bh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).total=r,a.count=0,a}return _createClass(n,[{key:"_next",value:function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}]),n}(Y);function kh(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Jl((function(t,n){return e(t,n,r)})):$,gh(1),n?lh(t):oh((function(){return new ql})))}}var _h=function(){function e(t,n,r){_classCallCheck(this,e),this.predicate=t,this.thisArg=n,this.source=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new wh(e,this.predicate,this.thisArg,this.source))}}]),e}(),wh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).predicate=r,o.thisArg=a,o.source=i,o.index=0,o.thisArg=a||_assertThisInitialized(o),o}return _createClass(n,[{key:"notifyComplete",value:function(e){this.destination.next(e),this.destination.complete()}},{key:"_next",value:function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)}},{key:"_complete",value:function(){this.notifyComplete(!0)}}]),n}(Y);function xh(e,t){return"function"==typeof t?function(n){return n.pipe(xh((function(n,r){return xe(e(n,r)).pipe(be((function(e,a){return t(n,e,r,a)})))})))}:function(t){return t.lift(new Ch(e))}}var Ch=function(){function e(t){_classCallCheck(this,e),this.project=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Sh(e,this.project))}}]),e}(),Sh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).project=r,a.index=0,a}return _createClass(n,[{key:"_next",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe();var a=new he(this,t,n),i=this.destination;i.add(a),this.innerSubscription=ge(this,e,void 0,void 0,a),this.innerSubscription!==a&&i.add(this.innerSubscription)}},{key:"_complete",value:function(){var e=this.innerSubscription;e&&!e.closed||_get(_getPrototypeOf(n.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=null}},{key:"notifyComplete",value:function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}}]),n}(ye);function Th(){return $l()(jl.apply(void 0,arguments))}function Eh(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Ah(e,t,n))}}var Ah=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.accumulator=t,this.seed=n,this.hasSeed=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Ih(e,this.accumulator,this.seed,this.hasSeed))}}]),e}(),Ih=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).accumulator=r,o._seed=a,o.hasSeed=i,o.index=0,o}return _createClass(n,[{key:"_next",value:function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)}},{key:"seed",get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e}}]),n}(Y);function Rh(e,t){return Ce(e,t,1)}function Nh(){}function Oh(e,t,n){return function(r){return r.lift(new Dh(e,t,n))}}var Dh=function(){function e(t,n,r){_classCallCheck(this,e),this.nextOrObserver=t,this.error=n,this.complete=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Fh(e,this.nextOrObserver,this.error,this.complete))}}]),e}(),Fh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e))._tapNext=Nh,o._tapError=Nh,o._tapComplete=Nh,o._tapError=a||Nh,o._tapComplete=i||Nh,P(r)?(o._context=_assertThisInitialized(o),o._tapNext=r):r&&(o._context=r,o._tapNext=r.next||Nh,o._tapError=r.error||Nh,o._tapComplete=r.complete||Nh),o}return _createClass(n,[{key:"_next",value:function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}},{key:"_error",value:function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}]),n}(Y);function Mh(e){return function(t){return t.lift(new Ph(e))}}var Lh,Ph=function(){function e(t){_classCallCheck(this,e),this.callback=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new zh(e,this.callback))}}]),e}(),zh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).add(new G(r)),a}return n}(Y),Bh=function e(t,n){_classCallCheck(this,e),this.id=t,this.url=n},Uh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imperative",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck(this,n),(a=t.call(this,e,r)).navigationTrigger=i,a.restoredState=o,a}return _createClass(n,[{key:"toString",value:function(){return"NavigationStart(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(Bh),Wh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).urlAfterRedirects=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"')")}}]),n}(Bh),Vh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).reason=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationCancel(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(Bh),jh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).error=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationError(id: ".concat(this.id,", url: '").concat(this.url,"', error: ").concat(this.error,")")}}]),n}(Bh),Hh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"RoutesRecognized(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Bh),qh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"GuardsCheckStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Bh),Gh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck(this,n),(s=t.call(this,e,r)).urlAfterRedirects=a,s.state=i,s.shouldActivate=o,s}return _createClass(n,[{key:"toString",value:function(){return"GuardsCheckEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,", shouldActivate: ").concat(this.shouldActivate,")")}}]),n}(Bh),Kh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"ResolveStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Bh),Xh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass(n,[{key:"toString",value:function(){return"ResolveEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(Bh),Yh=function(){function e(t){_classCallCheck(this,e),this.route=t}return _createClass(e,[{key:"toString",value:function(){return"RouteConfigLoadStart(path: ".concat(this.route.path,")")}}]),e}(),Qh=function(){function e(t){_classCallCheck(this,e),this.route=t}return _createClass(e,[{key:"toString",value:function(){return"RouteConfigLoadEnd(path: ".concat(this.route.path,")")}}]),e}(),Zh=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ChildActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),$h=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ChildActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),Jh=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),ef=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),tf=function(){function e(t,n,r){_classCallCheck(this,e),this.routerEvent=t,this.position=n,this.anchor=r}return _createClass(e,[{key:"toString",value:function(){return"Scroll(anchor: '".concat(this.anchor,"', position: '").concat(this.position?"".concat(this.position[0],", ").concat(this.position[1]):null,"')")}}]),e}(),nf=((Lh=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||Lh)},Lh.\u0275cmp=Kt({type:Lh,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&Wo(0,"router-outlet")},directives:function(){return[sp]},encapsulation:2}),Lh),rf=function(){function e(t){_classCallCheck(this,e),this.params=t||{}}return _createClass(e,[{key:"has",value:function(e){return this.params.hasOwnProperty(e)}},{key:"get",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null}},{key:"getAll",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]}},{key:"keys",get:function(){return Object.keys(this.params)}}]),e}();function af(e){return new rf(e)}function of(e){var t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function sf(e,t,n){var r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;for(var a={},i=0;i<r.length;i++){var o=r[i],s=e[i];if(o.startsWith(":"))a[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}var uf=function e(t,n){_classCallCheck(this,e),this.routes=t,this.module=n};function cf(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;n<e.length;n++){var r=e[n];lf(r,hf(t,r))}}function lf(e,t){if(!e)throw new Error("\n      Invalid configuration of route '".concat(t,"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    "));if(Array.isArray(e))throw new Error("Invalid configuration of route '".concat(t,"': Array cannot be specified"));if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&"primary"!==e.outlet)throw new Error("Invalid configuration of route '".concat(t,"': a componentless route without children or loadChildren cannot have a named outlet set"));if(e.redirectTo&&e.children)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and children cannot be used together"));if(e.redirectTo&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and loadChildren cannot be used together"));if(e.children&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': children and loadChildren cannot be used together"));if(e.redirectTo&&e.component)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and component cannot be used together"));if(e.path&&e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': path and matcher cannot be used together"));if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"'. One of the following must be provided: component, redirectTo, children or loadChildren"));if(void 0===e.path&&void 0===e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': routes must have either a path or a matcher specified"));if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error("Invalid configuration of route '".concat(t,"': path cannot start with a slash"));if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error("Invalid configuration of route '{path: \"".concat(t,'", redirectTo: "').concat(e.redirectTo,"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'."));if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error("Invalid configuration of route '".concat(t,"': pathMatch can only be set to 'prefix' or 'full'"));e.children&&cf(e.children,t)}function hf(e,t){return t?e||t.path?e&&!t.path?"".concat(e,"/"):!e&&t.path?t.path:"".concat(e,"/").concat(t.path):"":e}function ff(e){var t=e.children&&e.children.map(ff),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&"primary"!==n.outlet&&(n.component=nf),n}function df(e,t){var n,r=Object.keys(e),a=Object.keys(t);if(!r||!a||r.length!=a.length)return!1;for(var i=0;i<r.length;i++)if(!pf(e[n=r[i]],t[n]))return!1;return!0}function pf(e,t){return Array.isArray(e)&&Array.isArray(t)?e.length==t.length&&e.every((function(e){return t.indexOf(e)>-1})):e===t}function vf(e){return Array.prototype.concat.apply([],e)}function mf(e){return e.length>0?e[e.length-1]:null}function gf(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function yf(e){return(t=e)&&"function"==typeof t.subscribe?e:Vo(e)?xe(Promise.resolve(e)):jl(e);var t}function bf(e,t,n){return n?function(e,t){return df(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!xf(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!t.children[r])return!1;if(!e(t.children[r],n.children[r]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every((function(n){return pf(e[n],t[n])}))}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,r,a){if(n.segments.length>a.length)return!!xf(n.segments.slice(0,a.length),a)&&!r.hasChildren();if(n.segments.length===a.length){if(!xf(n.segments,a))return!1;for(var i in r.children){if(!n.children[i])return!1;if(!e(n.children[i],r.children[i]))return!1}return!0}var o=a.slice(0,n.segments.length),s=a.slice(n.segments.length);return!!xf(n.segments,o)&&!!n.children.primary&&t(n.children.primary,r,s)}(t,n,n.segments)}(e.root,t.root)}var kf=function(){function e(t,n,r){_classCallCheck(this,e),this.root=t,this.queryParams=n,this.fragment=r}return _createClass(e,[{key:"toString",value:function(){return Ef.serialize(this)}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=af(this.queryParams)),this._queryParamMap}}]),e}(),_f=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.segments=t,this.children=n,this.parent=null,gf(n,(function(e,t){return e.parent=r}))}return _createClass(e,[{key:"hasChildren",value:function(){return this.numberOfChildren>0}},{key:"toString",value:function(){return Af(this)}},{key:"numberOfChildren",get:function(){return Object.keys(this.children).length}}]),e}(),wf=function(){function e(t,n){_classCallCheck(this,e),this.path=t,this.parameters=n}return _createClass(e,[{key:"toString",value:function(){return Ff(this)}},{key:"parameterMap",get:function(){return this._parameterMap||(this._parameterMap=af(this.parameters)),this._parameterMap}}]),e}();function xf(e,t){return e.length===t.length&&e.every((function(e,n){return e.path===t[n].path}))}function Cf(e,t){var n=[];return gf(e.children,(function(e,r){"primary"===r&&(n=n.concat(t(e,r)))})),gf(e.children,(function(e,r){"primary"!==r&&(n=n.concat(t(e,r)))})),n}var Sf=function e(){_classCallCheck(this,e)},Tf=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"parse",value:function(e){var t=new Bf(e);return new kf(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}},{key:"serialize",value:function(e){var t,n,r;return"".concat("/".concat(function e(t,n){if(!t.hasChildren())return Af(t);if(n){var r=t.children.primary?e(t.children.primary,!1):"",a=[];return gf(t.children,(function(t,n){"primary"!==n&&a.push("".concat(n,":").concat(e(t,!1)))})),a.length>0?"".concat(r,"(").concat(a.join("//"),")"):r}var i=Cf(t,(function(n,r){return"primary"===r?[e(t.children.primary,!1)]:["".concat(r,":").concat(e(n,!1))]}));return"".concat(Af(t),"/(").concat(i.join("//"),")")}(e.root,!0)),(n=e.queryParams,r=Object.keys(n).map((function(e){var t=n[e];return Array.isArray(t)?t.map((function(t){return"".concat(Rf(e),"=").concat(Rf(t))})).join("&"):"".concat(Rf(e),"=").concat(Rf(t))})),r.length?"?".concat(r.join("&")):"")).concat("string"==typeof e.fragment?"#".concat((t=e.fragment,encodeURI(t))):"")}}]),e}(),Ef=new Tf;function Af(e){return e.segments.map((function(e){return Ff(e)})).join("/")}function If(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Rf(e){return If(e).replace(/%3B/gi,";")}function Nf(e){return If(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Of(e){return decodeURIComponent(e)}function Df(e){return Of(e.replace(/\+/g,"%20"))}function Ff(e){return"".concat(Nf(e.path)).concat((t=e.parameters,Object.keys(t).map((function(e){return";".concat(Nf(e),"=").concat(Nf(t[e]))})).join("")));var t}var Mf=/^[^\/()?;=#]+/;function Lf(e){var t=e.match(Mf);return t?t[0]:""}var Pf=/^[^=?&#]+/,zf=/^[^?&#]+/,Bf=function(){function e(t){_classCallCheck(this,e),this.url=t,this.remaining=t}return _createClass(e,[{key:"parseRootSegment",value:function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new _f([],{}):new _f([],this.parseChildren())}},{key:"parseQueryParams",value:function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}},{key:"parseFragment",value:function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}},{key:"parseChildren",value:function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new _f(e,t)),n}},{key:"parseSegment",value:function(){var e=Lf(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '".concat(this.remaining,"'."));return this.capture(e),new wf(Of(e),this.parseMatrixParams())}},{key:"parseMatrixParams",value:function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e}},{key:"parseParam",value:function(e){var t=Lf(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=Lf(this.remaining);r&&(n=r,this.capture(n))}e[Of(t)]=Of(n)}}},{key:"parseQueryParam",value:function(e){var t,n,r=(t=this.remaining,(n=t.match(Pf))?n[0]:"");if(r){this.capture(r);var a="";if(this.consumeOptional("=")){var i=function(e){var t=e.match(zf);return t?t[0]:""}(this.remaining);i&&(a=i,this.capture(a))}var o=Df(r),s=Df(a);if(e.hasOwnProperty(o)){var u=e[o];Array.isArray(u)||(u=[u],e[o]=u),u.push(s)}else e[o]=s}}},{key:"parseParens",value:function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Lf(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '".concat(this.url,"'"));var a=void 0;n.indexOf(":")>-1?(a=n.substr(0,n.indexOf(":")),this.capture(a),this.capture(":")):e&&(a="primary");var i=this.parseChildren();t[a]=1===Object.keys(i).length?i.primary:new _f([],i),this.consumeOptional("//")}return t}},{key:"peekStartsWith",value:function(e){return this.remaining.startsWith(e)}},{key:"consumeOptional",value:function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}},{key:"capture",value:function(e){if(!this.consumeOptional(e))throw new Error('Expected "'.concat(e,'".'))}}]),e}(),Uf=function(){function e(t){_classCallCheck(this,e),this._root=t}return _createClass(e,[{key:"parent",value:function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}},{key:"children",value:function(e){var t=Wf(e,this._root);return t?t.children.map((function(e){return e.value})):[]}},{key:"firstChild",value:function(e){var t=Wf(e,this._root);return t&&t.children.length>0?t.children[0].value:null}},{key:"siblings",value:function(e){var t=Vf(e,this._root);return t.length<2?[]:t[t.length-2].children.map((function(e){return e.value})).filter((function(t){return t!==e}))}},{key:"pathFromRoot",value:function(e){return Vf(e,this._root).map((function(e){return e.value}))}},{key:"root",get:function(){return this._root.value}}]),e}();function Wf(e,t){if(e===t.value)return t;var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var a=Wf(e,n.value);if(a)return a}}catch(i){r.e(i)}finally{r.f()}return null}function Vf(e,t){if(e===t.value)return[t];var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var a=Vf(e,n.value);if(a.length)return a.unshift(t),a}}catch(i){r.e(i)}finally{r.f()}return[]}var jf=function(){function e(t,n){_classCallCheck(this,e),this.value=t,this.children=n}return _createClass(e,[{key:"toString",value:function(){return"TreeNode(".concat(this.value,")")}}]),e}();function Hf(e){var t={};return e&&e.children.forEach((function(e){return t[e.value.outlet]=e})),t}var qf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e)).snapshot=r,Zf(_assertThisInitialized(a),e),a}return _createClass(n,[{key:"toString",value:function(){return this.snapshot.toString()}}]),n}(Uf);function Gf(e,t){var n=function(e,t){var n=new Yf([],{},{},"",{},"primary",t,null,e.root,-1,{});return new Qf("",new jf(n,[]))}(e,t),r=new Hl([new wf("",{})]),a=new Hl({}),i=new Hl({}),o=new Hl({}),s=new Hl(""),u=new Kf(r,a,o,s,i,"primary",t,n.root);return u.snapshot=n.root,new qf(new jf(u,[]),n)}var Kf=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=u}return _createClass(e,[{key:"toString",value:function(){return this.snapshot?this.snapshot.toString():"Future(".concat(this._futureSnapshot,")")}},{key:"routeConfig",get:function(){return this._futureSnapshot.routeConfig}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=this.params.pipe(be((function(e){return af(e)})))),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(be((function(e){return af(e)})))),this._queryParamMap}}]),e}();function Xf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emptyOnly",n=e.pathFromRoot,r=0;if("always"!==t)for(r=n.length-1;r>=1;){var a=n[r],i=n[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(i.component)break;r--}}return function(e){return e.reduce((function(e,t){return{params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}}),{params:{},data:{},resolve:{}})}(n.slice(r))}var Yf=function(){function e(t,n,r,a,i,o,s,u,c,l,h){_classCallCheck(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=h}return _createClass(e,[{key:"toString",value:function(){return"Route(url:'".concat(this.url.map((function(e){return e.toString()})).join("/"),"', path:'").concat(this.routeConfig?this.routeConfig.path:"","')")}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=af(this.params)),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=af(this.queryParams)),this._queryParamMap}}]),e}(),Qf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,r)).url=e,Zf(_assertThisInitialized(a),r),a}return _createClass(n,[{key:"toString",value:function(){return $f(this._root)}}]),n}(Uf);function Zf(e,t){t.value._routerState=e,t.children.forEach((function(t){return Zf(e,t)}))}function $f(e){var t=e.children.length>0?" { ".concat(e.children.map($f).join(", ")," } "):"";return"".concat(e.value).concat(t)}function Jf(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,df(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),df(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!df(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),df(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function ed(e,t){var n,r;return df(e.params,t.params)&&xf(n=e.url,r=t.url)&&n.every((function(e,t){return df(e.parameters,r[t].parameters)}))&&!(!e.parent!=!t.parent)&&(!e.parent||ed(e.parent,t.parent))}function td(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function nd(e,t,n,r,a){var i={};return r&&gf(r,(function(e,t){i[t]=Array.isArray(e)?e.map((function(e){return"".concat(e)})):"".concat(e)})),new kf(n.root===e?t:function e(t,n,r){var a={};return gf(t.children,(function(t,i){a[i]=t===n?r:e(t,n,r)})),new _f(t.segments,a)}(n.root,e,t),i,a)}var rd=function(){function e(t,n,r){if(_classCallCheck(this,e),this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&td(r[0]))throw new Error("Root segment cannot have matrix parameters");var a=r.find((function(e){return"object"==typeof e&&null!=e&&e.outlets}));if(a&&a!==mf(r))throw new Error("{outlets:{}} has to be the last command")}return _createClass(e,[{key:"toRoot",value:function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}]),e}(),ad=function e(t,n,r){_classCallCheck(this,e),this.segmentGroup=t,this.processChildren=n,this.index=r};function id(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets.primary:"".concat(e)}function od(e,t,n){if(e||(e=new _f([],{})),0===e.segments.length&&e.hasChildren())return sd(e,t,n);var r=function(e,t,n){for(var r=0,a=t,i={match:!1,pathIndex:0,commandIndex:0};a<e.segments.length;){if(r>=n.length)return i;var o=e.segments[a],s=id(n[r]),u=r<n.length-1?n[r+1]:null;if(a>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!hd(s,u,o))return i;r+=2}else{if(!hd(s,{},o))return i;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,t,n),a=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){var i=new _f(e.segments.slice(0,r.pathIndex),{});return i.children.primary=new _f(e.segments.slice(r.pathIndex),e.children),sd(i,0,a)}return r.match&&0===a.length?new _f(e.segments,{}):r.match&&!e.hasChildren()?ud(e,t,n):r.match?sd(e,0,a):ud(e,t,n)}function sd(e,t,n){if(0===n.length)return new _f(e.segments,{});var r=function(e){return"object"!=typeof e[0]||void 0===e[0].outlets?{primary:e}:e[0].outlets}(n),a={};return gf(r,(function(n,r){null!==n&&(a[r]=od(e.children[r],t,n))})),gf(e.children,(function(e,t){void 0===r[t]&&(a[t]=e)})),new _f(e.segments,a)}function ud(e,t,n){for(var r=e.segments.slice(0,t),a=0;a<n.length;){if("object"==typeof n[a]&&void 0!==n[a].outlets){var i=cd(n[a].outlets);return new _f(r,i)}if(0===a&&td(n[0]))r.push(new wf(e.segments[t].path,n[0])),a++;else{var o=id(n[a]),s=a<n.length-1?n[a+1]:null;o&&s&&td(s)?(r.push(new wf(o,ld(s))),a+=2):(r.push(new wf(o,{})),a++)}}return new _f(r,{})}function cd(e){var t={};return gf(e,(function(e,n){null!==e&&(t[n]=ud(new _f([],{}),0,e))})),t}function ld(e){var t={};return gf(e,(function(e,n){return t[n]="".concat(e)})),t}function hd(e,t,n){return e==n.path&&df(t,n.parameters)}var fd=function(){function e(t,n,r,a){_classCallCheck(this,e),this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=a}return _createClass(e,[{key:"activate",value:function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Jf(this.futureState.root),this.activateChildRoutes(t,n,e)}},{key:"deactivateChildRoutes",value:function(e,t,n){var r=this,a=Hf(t);e.children.forEach((function(e){var t=e.value.outlet;r.deactivateRoutes(e,a[t],n),delete a[t]})),gf(a,(function(e,t){r.deactivateRouteAndItsChildren(e,n)}))}},{key:"deactivateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(r===a)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else a&&this.deactivateRouteAndItsChildren(t,n)}},{key:"deactivateRouteAndItsChildren",value:function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}},{key:"detachAndStoreRouteSubtree",value:function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:r,route:e,contexts:a})}}},{key:"deactivateRouteAndOutlet",value:function(e,t){var n=this,r=t.getContext(e.value.outlet);if(r){var a=Hf(e),i=e.value.component?r.children:t;gf(a,(function(e,t){return n.deactivateRouteAndItsChildren(e,i)})),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}},{key:"activateChildRoutes",value:function(e,t,n){var r=this,a=Hf(t);e.children.forEach((function(e){r.activateRoutes(e,a[e.value.outlet],n),r.forwardEvent(new ef(e.value.snapshot))})),e.children.length&&this.forwardEvent(new $h(e.value.snapshot))}},{key:"activateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(Jf(r),r===a)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){var o=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){var s=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),dd(s.route)}else{var u=function(e){for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(r.snapshot),c=u?u.module.componentFactoryResolver:null;o.attachRef=null,o.route=r,o.resolver=c,o.outlet&&o.outlet.activateWith(r,c),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}}]),e}();function dd(e){Jf(e.value),e.children.forEach(dd)}function pd(e){return"function"==typeof e}function vd(e){return e instanceof kf}var md=function e(t){_classCallCheck(this,e),this.segmentGroup=t||null},gd=function e(t){_classCallCheck(this,e),this.urlTree=t};function yd(e){return new ne((function(t){return t.error(new md(e))}))}function bd(e){return new ne((function(t){return t.error(new gd(e))}))}function kd(e){return new ne((function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '".concat(e,"'")))}))}var _d=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.configLoader=n,this.urlSerializer=r,this.urlTree=a,this.config=i,this.allowRedirects=!0,this.ngModule=t.get(Ft)}return _createClass(e,[{key:"apply",value:function(){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,"primary").pipe(be((function(t){return e.createUrlTree(t,e.urlTree.queryParams,e.urlTree.fragment)}))).pipe(ph((function(t){if(t instanceof gd)return e.allowRedirects=!1,e.match(t.urlTree);if(t instanceof md)throw e.noMatchError(t);throw t})))}},{key:"match",value:function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,"primary").pipe(be((function(n){return t.createUrlTree(n,e.queryParams,e.fragment)}))).pipe(ph((function(e){if(e instanceof md)throw t.noMatchError(e);throw e})))}},{key:"noMatchError",value:function(e){return new Error("Cannot match any routes. URL Segment: '".concat(e.segmentGroup,"'"))}},{key:"createUrlTree",value:function(e,t,n){var r=e.segments.length>0?new _f([],{primary:e}):e;return new kf(r,t,n)}},{key:"expandSegmentGroup",value:function(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(be((function(e){return new _f([],e)}))):this.expandSegment(e,n,t,n.segments,r,!0)}},{key:"expandChildren",value:function(e,t,n){var r=this;return function(n,a){if(0===Object.keys(n).length)return jl({});var i=[],o=[],s={};return gf(n,(function(n,a){var u,c,l=(u=a,c=n,r.expandSegmentGroup(e,t,c,u)).pipe(be((function(e){return s[a]=e})));"primary"===a?i.push(l):o.push(l)})),jl.apply(null,i.concat(o)).pipe($l(),dh(),be((function(){return s})))}(n.children)}},{key:"expandSegment",value:function(e,t,n,r,a,i){var o=this;return jl.apply(void 0,_toConsumableArray(n)).pipe(be((function(s){return o.expandSegmentAgainstRoute(e,t,n,s,r,a,i).pipe(ph((function(e){if(e instanceof md)return jl(null);throw e})))})),$l(),kh((function(e){return!!e})),ph((function(e,n){if(e instanceof ql||"EmptyError"===e.name){if(o.noLeftoversInUrl(t,r,a))return jl(new _f([],{}));throw new md(t)}throw e})))}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"expandSegmentAgainstRoute",value:function(e,t,n,r,a,i,o){return Sd(r)!==i?yd(t):void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,a):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i):yd(t)}},{key:"expandSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i)}},{key:"expandWildCardWithParamsAgainstRouteUsingRedirect",value:function(e,t,n,r){var a=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?bd(i):this.lineralizeSegments(n,i).pipe(Ce((function(n){var i=new _f(n,{});return a.expandSegment(e,i,t,n,r,!1)})))}},{key:"expandRegularSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){var o=this,s=wd(t,r,a),u=s.matched,c=s.consumedSegments,l=s.lastChild,h=s.positionalParamSegments;if(!u)return yd(t);var f=this.applyRedirectCommands(c,r.redirectTo,h);return r.redirectTo.startsWith("/")?bd(f):this.lineralizeSegments(r,f).pipe(Ce((function(r){return o.expandSegment(e,t,n,r.concat(a.slice(l)),i,!1)})))}},{key:"matchSegmentAgainstRoute",value:function(e,t,n,r){var a=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(be((function(e){return n._loadedConfig=e,new _f(r,{})}))):jl(new _f(r,{}));var i=wd(t,n,r),o=i.matched,s=i.consumedSegments,u=i.lastChild;if(!o)return yd(t);var c=r.slice(u);return this.getChildConfig(e,n,r).pipe(Ce((function(e){var n=e.module,r=e.routes,i=function(e,t,n,r){return n.length>0&&function(e,t,n){return n.some((function(n){return Cd(e,t,n)&&"primary"!==Sd(n)}))}(e,n,r)?{segmentGroup:xd(new _f(t,function(e,t){var n={};n.primary=t;var r,a=_createForOfIteratorHelper(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;""===i.path&&"primary"!==Sd(i)&&(n[Sd(i)]=new _f([],{}))}}catch(o){a.e(o)}finally{a.f()}return n}(r,new _f(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return n.some((function(n){return Cd(e,t,n)}))}(e,n,r)?{segmentGroup:xd(new _f(e.segments,function(e,t,n,r){var a,i={},o=_createForOfIteratorHelper(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;Cd(e,t,s)&&!r[Sd(s)]&&(i[Sd(s)]=new _f([],{}))}}catch(u){o.e(u)}finally{o.f()}return Object.assign(Object.assign({},r),i)}(e,n,r,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,s,c,r),o=i.segmentGroup,u=i.slicedSegments;return 0===u.length&&o.hasChildren()?a.expandChildren(n,r,o).pipe(be((function(e){return new _f(s,e)}))):0===r.length&&0===u.length?jl(new _f(s,{})):a.expandSegment(n,o,r,u,"primary",!0).pipe(be((function(e){return new _f(s.concat(e.segments),e.children)})))})))}},{key:"getChildConfig",value:function(e,t,n){var r=this;return t.children?jl(new uf(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?jl(t._loadedConfig):function(e,t,n){var r,a=t.canLoad;return a&&0!==a.length?xe(a).pipe(be((function(r){var a,i=e.get(r);if(function(e){return e&&pd(e.canLoad)}(i))a=i.canLoad(t,n);else{if(!pd(i))throw new Error("Invalid CanLoad guard");a=i(t,n)}return yf(a)}))).pipe($l(),(r=function(e){return!0===e},function(e){return e.lift(new _h(r,void 0,e))})):jl(!0)}(e.injector,t,n).pipe(Ce((function(n){return n?r.configLoader.load(e.injector,t).pipe(be((function(e){return t._loadedConfig=e,e}))):function(e){return new ne((function(t){return t.error(of("Cannot load children because the guard of the route \"path: '".concat(e.path,"'\" returned false")))}))}(t)}))):jl(new uf([],e))}},{key:"lineralizeSegments",value:function(e,t){for(var n=[],r=t.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return jl(n);if(r.numberOfChildren>1||!r.children.primary)return kd(e.redirectTo);r=r.children.primary}}},{key:"applyRedirectCommands",value:function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}},{key:"applyRedirectCreatreUrlTree",value:function(e,t,n,r){var a=this.createSegmentGroup(e,t.root,n,r);return new kf(a,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}},{key:"createQueryParams",value:function(e,t){var n={};return gf(e,(function(e,r){if("string"==typeof e&&e.startsWith(":")){var a=e.substring(1);n[r]=t[a]}else n[r]=e})),n}},{key:"createSegmentGroup",value:function(e,t,n,r){var a=this,i=this.createSegments(e,t.segments,n,r),o={};return gf(t.children,(function(t,i){o[i]=a.createSegmentGroup(e,t,n,r)})),new _f(i,o)}},{key:"createSegments",value:function(e,t,n,r){var a=this;return t.map((function(t){return t.path.startsWith(":")?a.findPosParam(e,t,r):a.findOrReturn(t,n)}))}},{key:"findPosParam",value:function(e,t,n){var r=n[t.path.substring(1)];if(!r)throw new Error("Cannot redirect to '".concat(e,"'. Cannot find '").concat(t.path,"'."));return r}},{key:"findOrReturn",value:function(e,t){var n,r=0,a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.path===e.path)return t.splice(r),i;r++}}catch(o){a.e(o)}finally{a.f()}return e}}]),e}();function wd(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(t.matcher||sf)(n,e,t);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function xd(e){if(1===e.numberOfChildren&&e.children.primary){var t=e.children.primary;return new _f(e.segments.concat(t.segments),t.children)}return e}function Cd(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Sd(e){return e.outlet||"primary"}var Td=function e(t){_classCallCheck(this,e),this.path=t,this.route=this.path[this.path.length-1]},Ed=function e(t,n){_classCallCheck(this,e),this.component=t,this.route=n};function Ad(e,t,n){var r=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Id(e,t,n){var r=Hf(e),a=e.value;gf(r,(function(e,r){Id(e,a.component?t?t.children.getContext(r):null:t,n)})),n.canDeactivateChecks.push(new Ed(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}var Rd=Symbol("INITIAL_VALUE");function Nd(){return xh((function(e){return(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=null,a=null;return le(t[t.length-1])&&(a=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&V(t[0])&&(t=t[0]),Ae(t,a).lift(new Kl(r))}).apply(void 0,_toConsumableArray(e.map((function(e){return e.pipe(gh(1),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return le(r)?(t.pop(),function(e){return Th(t,e,r)}):function(e){return Th(t,e)}}(Rd))})))).pipe(Eh((function(e,t){var n=!1;return t.reduce((function(e,r,a){if(e!==Rd)return e;if(r===Rd&&(n=!0),!n){if(!1===r)return r;if(a===t.length-1||vd(r))return r}return e}),e)}),Rd),Jl((function(e){return e!==Rd})),be((function(e){return vd(e)?e:!0===e})),gh(1))}))}function Od(e,t){return null!==e&&t&&t(new Jh(e)),jl(!0)}function Dd(e,t){return null!==e&&t&&t(new Zh(e)),jl(!0)}function Fd(e,t,n){var r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?jl(r.map((function(r){return Zl((function(){var a,i=Ad(r,t,n);if(function(e){return e&&pd(e.canActivate)}(i))a=yf(i.canActivate(t,e));else{if(!pd(i))throw new Error("Invalid CanActivate guard");a=yf(i(t,e))}return a.pipe(kh())}))}))).pipe(Nd()):jl(!0)}function Md(e,t,n){var r=t[t.length-1],a=t.slice(0,t.length-1).reverse().map((function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)})).filter((function(e){return null!==e})).map((function(t){return Zl((function(){return jl(t.guards.map((function(a){var i,o=Ad(a,t.node,n);if(function(e){return e&&pd(e.canActivateChild)}(o))i=yf(o.canActivateChild(r,e));else{if(!pd(o))throw new Error("Invalid CanActivateChild guard");i=yf(o(r,e))}return i.pipe(kh())}))).pipe(Nd())}))}));return jl(a).pipe(Nd())}var Ld=function e(){_classCallCheck(this,e)},Pd=function(){function e(t,n,r,a,i,o){_classCallCheck(this,e),this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}return _createClass(e,[{key:"recognize",value:function(){try{var e=Ud(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,"primary"),n=new Yf([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},"primary",this.rootComponentType,null,this.urlTree.root,-1,{}),r=new jf(n,t),a=new Qf(this.url,r);return this.inheritParamsAndData(a._root),jl(a)}catch(i){return new ne((function(e){return e.error(i)}))}}},{key:"inheritParamsAndData",value:function(e){var t=this,n=e.value,r=Xf(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach((function(e){return t.inheritParamsAndData(e)}))}},{key:"processSegmentGroup",value:function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}},{key:"processChildren",value:function(e,t){var n,r=this,a=Cf(t,(function(t,n){return r.processSegmentGroup(e,t,n)}));return n={},a.forEach((function(e){var t=n[e.value.outlet];if(t){var r=t.url.map((function(e){return e.toString()})).join("/"),a=e.value.url.map((function(e){return e.toString()})).join("/");throw new Error("Two segments cannot have the same outlet name: '".concat(r,"' and '").concat(a,"'."))}n[e.value.outlet]=e.value})),a.sort((function(e,t){return"primary"===e.value.outlet?-1:"primary"===t.value.outlet?1:e.value.outlet.localeCompare(t.value.outlet)})),a}},{key:"processSegment",value:function(e,t,n,r){var a,i=_createForOfIteratorHelper(e);try{for(i.s();!(a=i.n()).done;){var o=a.value;try{return this.processSegmentAgainstRoute(o,t,n,r)}catch(s){if(!(s instanceof Ld))throw s}}}catch(u){i.e(u)}finally{i.f()}if(this.noLeftoversInUrl(t,n,r))return[];throw new Ld}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"processSegmentAgainstRoute",value:function(e,t,n,r){if(e.redirectTo)throw new Ld;if((e.outlet||"primary")!==r)throw new Ld;var a,i=[],o=[];if("**"===e.path){var s=n.length>0?mf(n).parameters:{};a=new Yf(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,jd(e),r,e.component,e,zd(t),Bd(t)+n.length,Hd(e))}else{var u=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new Ld;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(t.matcher||sf)(n,e,t);if(!r)throw new Ld;var a={};gf(r.posParams,(function(e,t){a[t]=e.path}));var i=r.consumed.length>0?Object.assign(Object.assign({},a),r.consumed[r.consumed.length-1].parameters):a;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:i}}(t,e,n);i=u.consumedSegments,o=n.slice(u.lastChild),a=new Yf(i,u.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,jd(e),r,e.component,e,zd(t),Bd(t)+i.length,Hd(e))}var c=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),l=Ud(t,i,o,c,this.relativeLinkResolution),h=l.segmentGroup,f=l.slicedSegments;if(0===f.length&&h.hasChildren()){var d=this.processChildren(c,h);return[new jf(a,d)]}if(0===c.length&&0===f.length)return[new jf(a,[])];var p=this.processSegment(c,h,f,"primary");return[new jf(a,p)]}}]),e}();function zd(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function Bd(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Ud(e,t,n,r,a){if(n.length>0&&function(e,t,n){return n.some((function(n){return Wd(e,t,n)&&"primary"!==Vd(n)}))}(e,n,r)){var i=new _f(t,function(e,t,n,r){var a={};a.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;var i,o=_createForOfIteratorHelper(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(""===s.path&&"primary"!==Vd(s)){var u=new _f([],{});u._sourceSegment=e,u._segmentIndexShift=t.length,a[Vd(s)]=u}}}catch(c){o.e(c)}finally{o.f()}return a}(e,t,r,new _f(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some((function(n){return Wd(e,t,n)}))}(e,n,r)){var o=new _f(e.segments,function(e,t,n,r,a,i){var o,s={},u=_createForOfIteratorHelper(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(Wd(e,n,c)&&!a[Vd(c)]){var l=new _f([],{});l._sourceSegment=e,l._segmentIndexShift="legacy"===i?e.segments.length:t.length,s[Vd(c)]=l}}}catch(h){u.e(h)}finally{u.f()}return Object.assign(Object.assign({},a),s)}(e,t,n,r,e.children,a));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}var s=new _f(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function Wd(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function Vd(e){return e.outlet||"primary"}function jd(e){return e.data||{}}function Hd(e){return e.resolve||{}}function qd(e,t,n,r){var a=Ad(e,t,r);return yf(a.resolve?a.resolve(t,n):a(t,n))}function Gd(e){return function(t){return t.pipe(xh((function(t){var n=e(t);return n?xe(n).pipe(be((function(){return t}))):xe([t])})))}}var Kd=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shouldDetach",value:function(e){return!1}},{key:"store",value:function(e,t){}},{key:"shouldAttach",value:function(e){return!1}},{key:"retrieve",value:function(e){return null}},{key:"shouldReuseRoute",value:function(e,t){return e.routeConfig===t.routeConfig}}]),e}(),Xd=new kt("ROUTES"),Yd=function(){function e(t,n,r,a){_classCallCheck(this,e),this.loader=t,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=a}return _createClass(e,[{key:"load",value:function(e,t){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(be((function(r){n.onLoadEndListener&&n.onLoadEndListener(t);var a=r.create(e);return new uf(vf(a.injector.get(Xd)).map(ff),a)})))}},{key:"loadModuleFactory",value:function(e){var t=this;return"string"==typeof e?xe(this.loader.load(e)):yf(e()).pipe(Ce((function(e){return e instanceof Mt?jl(e):xe(t.compiler.compileModuleAsync(e))})))}}]),e}(),Qd=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shouldProcessUrl",value:function(e){return!0}},{key:"extract",value:function(e){return e}},{key:"merge",value:function(e,t){return e}}]),e}();function Zd(e){throw e}function $d(e,t,n){return t.parse("/")}function Jd(e,t){return jl(null)}var ep,tp,np,rp,ap=((ep=function(){function e(t,n,r,a,i,o,s,u){var c=this;_classCallCheck(this,e),this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=r,this.location=a,this.config=u,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new ue,this.errorHandler=Zd,this.malformedUriErrorHandler=$d,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Jd,afterPreactivation:Jd},this.urlHandlingStrategy=new Qd,this.routeReuseStrategy=new Kd,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=i.get(Ft),this.console=i.get(Eu);var l=i.get(Wu);this.isNgZoneEnabled=l instanceof Wu,this.resetConfig(u),this.currentUrlTree=new kf(new _f([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Yd(o,s,(function(e){return c.triggerEvent(new Yh(e))}),(function(e){return c.triggerEvent(new Qh(e))})),this.routerState=Gf(this.currentUrlTree,this.rootComponentType),this.transitions=new Hl({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return _createClass(e,[{key:"setupNavigations",value:function(e){var t=this,n=this.events;return e.pipe(Jl((function(e){return 0!==e.id})),be((function(e){return Object.assign(Object.assign({},e),{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})})),xh((function(e){var r,a,i,o=!1,s=!1;return jl(e).pipe(Oh((function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?Object.assign(Object.assign({},t.lastSuccessfulNavigation),{previousNavigation:null}):null}})),xh((function(e){var r,a,i,o,s=!t.navigated||e.extractedUrl.toString()!==t.browserUrlTree.toString();if(("reload"===t.onSameUrlNavigation||s)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return jl(e).pipe(xh((function(e){var r=t.transitions.getValue();return n.next(new Uh(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),r!==t.transitions.getValue()?Yl:[e]})),xh((function(e){return Promise.resolve(e)})),(r=t.ngModule.injector,a=t.configLoader,i=t.urlSerializer,o=t.config,function(e){return e.pipe(xh((function(e){return function(e,t,n,r,a){return new _d(e,t,n,r,a).apply()}(r,a,i,e.extractedUrl,o).pipe(be((function(t){return Object.assign(Object.assign({},e),{urlAfterRedirects:t})})))})))}),Oh((function(e){t.currentNavigation=Object.assign(Object.assign({},t.currentNavigation),{finalUrl:e.urlAfterRedirects})})),function(e,n,r,a,i){return function(r){return r.pipe(Ce((function(r){return function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"emptyOnly",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"legacy";return new Pd(e,t,n,r,a,i).recognize()}(e,n,r.urlAfterRedirects,(o=r.urlAfterRedirects,t.serializeUrl(o)),a,i).pipe(be((function(e){return Object.assign(Object.assign({},r),{targetSnapshot:e})})));var o})))}}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),Oh((function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),Oh((function(e){var r=new Hh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(r)})));if(s&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var u=e.id,c=e.extractedUrl,l=e.source,h=e.restoredState,f=e.extras,d=new Uh(u,t.serializeUrl(c),l,h);n.next(d);var p=Gf(c,t.rootComponentType).snapshot;return jl(Object.assign(Object.assign({},e),{targetSnapshot:p,urlAfterRedirects:c,extras:Object.assign(Object.assign({},f),{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),Yl})),Gd((function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.beforePreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})})),Oh((function(e){var n=new qh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),be((function(e){return Object.assign(Object.assign({},e),{guards:(n=e.targetSnapshot,r=e.currentSnapshot,a=t.rootContexts,i=n._root,function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},o=Hf(n);return t.children.forEach((function(t){!function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},o=t.value,s=n?n.value:null,u=r?r.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){var c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!xf(e.url,t.url);case"pathParamsOrQueryParamsChange":return!xf(e.url,t.url)||!df(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ed(e,t)||!df(e.queryParams,t.queryParams);case"paramsChange":default:return!ed(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Td(a)):(o.data=s.data,o._resolvedData=s._resolvedData),e(t,n,o.component?u?u.children:null:r,a,i),c&&i.canDeactivateChecks.push(new Ed(u&&u.outlet&&u.outlet.component||null,s))}else s&&Id(n,u,i),i.canActivateChecks.push(new Td(a)),e(t,null,o.component?u?u.children:null:r,a,i)}(t,o[t.value.outlet],r,a.concat([t.value]),i),delete o[t.value.outlet]})),gf(o,(function(e,t){return Id(e,r.getContext(t),i)})),i}(i,r?r._root:null,a,[i.value]))});var n,r,a,i})),function(e,t){return function(n){return n.pipe(Ce((function(n){var r=n.targetSnapshot,a=n.currentSnapshot,i=n.guards,o=i.canActivateChecks,s=i.canDeactivateChecks;return 0===s.length&&0===o.length?jl(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return xe(e).pipe(Ce((function(e){return function(e,t,n,r,a){var i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return i&&0!==i.length?jl(i.map((function(i){var o,s=Ad(i,t,a);if(function(e){return e&&pd(e.canDeactivate)}(s))o=yf(s.canDeactivate(e,t,n,r));else{if(!pd(s))throw new Error("Invalid CanDeactivate guard");o=yf(s(e,t,n,r))}return o.pipe(kh())}))).pipe(Nd()):jl(!0)}(e.component,e.route,n,t,r)})),kh((function(e){return!0!==e}),!0))}(s,r,a,e).pipe(Ce((function(n){return n&&"boolean"==typeof n?function(e,t,n,r){return xe(t).pipe(Rh((function(t){return xe([Dd(t.route.parent,r),Od(t.route,r),Md(e,t.path,n),Fd(e,t.route,n)]).pipe($l(),kh((function(e){return!0!==e}),!0))})),kh((function(e){return!0!==e}),!0))}(r,o,e,t):jl(n)})),be((function(e){return Object.assign(Object.assign({},n),{guardsResult:e})})))})))}}(t.ngModule.injector,(function(e){return t.triggerEvent(e)})),Oh((function(e){if(vd(e.guardsResult)){var n=of('Redirecting to "'.concat(t.serializeUrl(e.guardsResult),'"'));throw n.url=e.guardsResult,n}})),Oh((function(e){var n=new Gh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(n)})),Jl((function(e){if(!e.guardsResult){t.resetUrlToCurrentUrlTree();var r=new Vh(e.id,t.serializeUrl(e.extractedUrl),"");return n.next(r),e.resolve(!1),!1}return!0})),Gd((function(e){if(e.guards.canActivateChecks.length)return jl(e).pipe(Oh((function(e){var n=new Kh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),(n=t.paramsInheritanceStrategy,r=t.ngModule.injector,function(e){return e.pipe(Ce((function(e){var t=e.targetSnapshot,a=e.guards.canActivateChecks;return a.length?xe(a).pipe(Rh((function(e){return function(e,t,n,r){return function(e,t,n,r){var a=Object.keys(e);if(0===a.length)return jl({});if(1===a.length){var i=a[0];return qd(e[i],t,n,r).pipe(be((function(e){return _defineProperty({},i,e)})))}var o={};return xe(a).pipe(Ce((function(a){return qd(e[a],t,n,r).pipe(be((function(e){return o[a]=e,e})))}))).pipe(dh(),be((function(){return o})))}(e._resolve,e,t,r).pipe(be((function(t){return e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),Xf(e,n).resolve),null})))}(e.route,t,n,r)})),function(e,t){return arguments.length>=2?function(n){return J(Eh(e,t),rh(1),lh(t))(n)}:function(t){return J(Eh((function(t,n,r){return e(t,n,r+1)})),rh(1))(t)}}((function(e,t){return e})),be((function(t){return e}))):jl(e)})))}),Oh((function(e){var n=new Xh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})));var n,r})),Gd((function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.afterPreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})})),be((function(e){var n=function(e,t,n){var r=function e(t,n,r){if(r&&t.shouldReuseRoute(n.value,r.value.snapshot)){var a=r.value;a._futureSnapshot=n.value;var i=function(t,n,r){return n.children.map((function(n){var a,i=_createForOfIteratorHelper(r.children);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(t.shouldReuseRoute(o.value.snapshot,n.value))return e(t,n,o)}}catch(s){i.e(s)}finally{i.f()}return e(t,n)}))}(t,n,r);return new jf(a,i)}var o=t.retrieve(n.value);if(o){var s=o.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(var r=0;r<t.children.length;++r)e(t.children[r],n.children[r])}(n,s),s}var u,c=new Kf(new Hl((u=n.value).url),new Hl(u.params),new Hl(u.queryParams),new Hl(u.fragment),new Hl(u.data),u.outlet,u.component,u),l=n.children.map((function(n){return e(t,n)}));return new jf(c,l)}(e,t._root,n?n._root:void 0);return new qf(r,t)}(t.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:n})})),Oh((function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(t.currentUrlTree,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),(r=t.rootContexts,a=t.routeReuseStrategy,i=function(e){return t.triggerEvent(e)},be((function(e){return new fd(a,e.targetRouterState,e.currentRouterState,i).activate(r),e}))),Oh({next:function(){o=!0},complete:function(){o=!0}}),Mh((function(){if(!o&&!s){t.resetUrlToCurrentUrlTree();var r=new Vh(e.id,t.serializeUrl(e.extractedUrl),"Navigation ID ".concat(e.id," is not equal to the current navigation id ").concat(t.navigationId));n.next(r),e.resolve(!1)}t.currentNavigation=null})),ph((function(r){if(s=!0,(u=r)&&u.ngNavigationCancelingError){var a=vd(r.url);a||(t.navigated=!0,t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));var i=new Vh(e.id,t.serializeUrl(e.extractedUrl),r.message);n.next(i),a?setTimeout((function(){var n=t.urlHandlingStrategy.merge(r.url,t.rawUrlTree);return t.scheduleNavigation(n,"imperative",null,{skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy},{resolve:e.resolve,reject:e.reject,promise:e.promise})}),0):e.resolve(!1)}else{t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);var o=new jh(e.id,t.serializeUrl(e.extractedUrl),r);n.next(o);try{e.resolve(t.errorHandler(r))}catch(c){e.reject(c)}}var u;return Yl})))})))}},{key:"resetRootComponentType",value:function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}},{key:"getTransition",value:function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}},{key:"setTransition",value:function(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}},{key:"initialNavigation",value:function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}},{key:"setUpLocationChangeListener",value:function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe((function(t){var n=e.parseUrl(t.url),r="popstate"===t.type?"popstate":"hashchange",a=t.state&&t.state.navigationId?t.state:null;setTimeout((function(){e.scheduleNavigation(n,r,a,{replaceUrl:!0})}),0)})))}},{key:"getCurrentNavigation",value:function(){return this.currentNavigation}},{key:"triggerEvent",value:function(e){this.events.next(e)}},{key:"resetConfig",value:function(e){cf(e),this.config=e.map(ff),this.navigated=!1,this.lastSuccessfulId=-1}},{key:"ngOnDestroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}},{key:"createUrlTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.relativeTo,r=t.queryParams,a=t.fragment,i=t.preserveQueryParams,o=t.queryParamsHandling,s=t.preserveFragment;Kr()&&i&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var u=n||this.routerState.root,c=s?this.currentUrlTree.fragment:a,l=null;if(o)switch(o){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}else l=i?this.currentUrlTree.queryParams:r||null;return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,a){if(0===n.length)return nd(t.root,t.root,t,r,a);var i=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new rd(!0,0,e);var t=0,n=!1,r=e.reduce((function(e,r,a){if("object"==typeof r&&null!=r){if(r.outlets){var i={};return gf(r.outlets,(function(e,t){i[t]="string"==typeof e?e.split("/"):e})),[].concat(_toConsumableArray(e),[{outlets:i}])}if(r.segmentPath)return[].concat(_toConsumableArray(e),[r.segmentPath])}return"string"!=typeof r?[].concat(_toConsumableArray(e),[r]):0===a?(r.split("/").forEach((function(r,a){0==a&&"."===r||(0==a&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))})),e):[].concat(_toConsumableArray(e),[r])}),[]);return new rd(n,t,r)}(n);if(i.toRoot())return nd(t.root,new _f([],{}),t,r,a);var o=function(e,t,n){if(e.isAbsolute)return new ad(t.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new ad(n.snapshot._urlSegment,!0,0);var r=td(e.commands[0])?0:1;return function(e,t,n){for(var r=e,a=t,i=n;i>a;){if(i-=a,!(r=r.parent))throw new Error("Invalid number of '../'");a=r.segments.length}return new ad(r,!1,a-i)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(i,t,e),s=o.processChildren?sd(o.segmentGroup,o.index,i.commands):od(o.segmentGroup,o.index,i.commands);return nd(o.segmentGroup,s,t,r,a)}(u,this.currentUrlTree,e,l,c)}},{key:"navigateByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};Kr()&&this.isNgZoneEnabled&&!Wu.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=vd(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}},{key:"navigate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};return function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains ".concat(n," segment at index ").concat(t))}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}},{key:"serializeUrl",value:function(e){return this.urlSerializer.serialize(e)}},{key:"parseUrl",value:function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}},{key:"isActive",value:function(e,t){if(vd(e))return bf(this.currentUrlTree,e,t);var n=this.parseUrl(e);return bf(this.currentUrlTree,n,t)}},{key:"removeEmptyProps",value:function(e){return Object.keys(e).reduce((function(t,n){var r=e[n];return null!=r&&(t[n]=r),t}),{})}},{key:"processNavigations",value:function(){var e=this;this.navigations.subscribe((function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.events.next(new Wh(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,e.currentNavigation=null,t.resolve(!0)}),(function(t){e.console.warn("Unhandled Navigation Error: ")}))}},{key:"scheduleNavigation",value:function(e,t,n,r,a){var i,o,s,u=this.getTransition();if(u&&"imperative"!==t&&"imperative"===u.source&&u.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(u&&"hashchange"==t&&"popstate"===u.source&&u.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(u&&"popstate"==t&&"hashchange"===u.source&&u.rawUrl.toString()===e.toString())return Promise.resolve(!0);a?(i=a.resolve,o=a.reject,s=a.promise):s=new Promise((function(e,t){i=e,o=t}));var c=++this.navigationId;return this.setTransition({id:c,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:i,reject:o,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch((function(e){return Promise.reject(e)}))}},{key:"setBrowserUrl",value:function(e,t,n,r){var a=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(a)||t?this.location.replaceState(a,"",Object.assign(Object.assign({},r),{navigationId:n})):this.location.go(a,"",Object.assign(Object.assign({},r),{navigationId:n}))}},{key:"resetStateAndUrl",value:function(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}},{key:"resetUrlToCurrentUrlTree",value:function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}},{key:"url",get:function(){return this.serializeUrl(this.currentUrlTree)}}]),e}()).\u0275fac=function(e){Lo()},ep.\u0275dir=Jt({type:ep}),ep),ip=function e(){_classCallCheck(this,e),this.outlet=null,this.route=null,this.resolver=null,this.children=new op,this.attachRef=null},op=function(){function e(){_classCallCheck(this,e),this.contexts=new Map}return _createClass(e,[{key:"onChildOutletCreated",value:function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}},{key:"onChildOutletDestroyed",value:function(e){var t=this.getContext(e);t&&(t.outlet=null)}},{key:"onOutletDeactivated",value:function(){var e=this.contexts;return this.contexts=new Map,e}},{key:"onOutletReAttached",value:function(e){this.contexts=e}},{key:"getOrCreateContext",value:function(e){var t=this.getContext(e);return t||(t=new ip,this.contexts.set(e,t)),t}},{key:"getContext",value:function(e){return this.contexts.get(e)||null}}]),e}(),sp=((tp=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.parentContexts=t,this.location=n,this.resolver=r,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new su,this.deactivateEvents=new su,this.name=a||"primary",t.onChildOutletCreated(this.name,this)}return _createClass(e,[{key:"ngOnDestroy",value:function(){this.parentContexts.onChildOutletDestroyed(this.name)}},{key:"ngOnInit",value:function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}},{key:"detach",value:function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e}},{key:"attach",value:function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}},{key:"deactivate",value:function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}},{key:"activateWith",value:function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,a=new up(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,a),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}},{key:"isActivated",get:function(){return!!this.activated}},{key:"component",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}},{key:"activatedRoute",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}},{key:"activatedRouteData",get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}}]),e}()).\u0275fac=function(e){return new(e||tp)(Fo(op),Fo(Hs),Fo(gs),Mo("name"),Fo(io))},tp.\u0275dir=Jt({type:tp,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),tp),up=function(){function e(t,n,r){_classCallCheck(this,e),this.route=t,this.childContexts=n,this.parent=r}return _createClass(e,[{key:"get",value:function(e,t){return e===Kf?this.route:e===op?this.childContexts:this.parent.get(e,t)}}]),e}(),cp=function e(){_classCallCheck(this,e)},lp=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"preload",value:function(e,t){return jl(null)}}]),e}(),hp=((rp=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.router=t,this.injector=a,this.preloadingStrategy=i,this.loader=new Yd(n,r,(function(e){return t.triggerEvent(new Yh(e))}),(function(e){return t.triggerEvent(new Qh(e))}))}return _createClass(e,[{key:"setUpPreloading",value:function(){var e=this;this.subscription=this.router.events.pipe(Jl((function(e){return e instanceof Wh})),Rh((function(){return e.preload()}))).subscribe((function(){}))}},{key:"preload",value:function(){var e=this.injector.get(Ft);return this.processRoutes(e,this.router.config)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"processRoutes",value:function(e,t){var n,r=[],a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.loadChildren&&!i.canLoad&&i._loadedConfig){var o=i._loadedConfig;r.push(this.processRoutes(o.module,o.routes))}else i.loadChildren&&!i.canLoad?r.push(this.preloadConfig(e,i)):i.children&&r.push(this.processRoutes(e,i.children))}}catch(s){a.e(s)}finally{a.f()}return xe(r).pipe(Ee(),be((function(e){})))}},{key:"preloadConfig",value:function(e,t){var n=this;return this.preloadingStrategy.preload(t,(function(){return n.loader.load(e.injector,t).pipe(Ce((function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)})))}))}}]),e}()).\u0275fac=function(e){return new(e||rp)(It(ap),It(cc),It(Pu),It(_o),It(cp))},rp.\u0275prov=Ge({token:rp,factory:rp.\u0275fac}),rp),fp=((np=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e),this.router=t,this.viewportScroller=n,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}return _createClass(e,[{key:"init",value:function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}},{key:"createScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof Uh?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Wh&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))}))}},{key:"consumeScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof tf&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))}))}},{key:"scheduleScrollEvent",value:function(e,t){this.router.triggerEvent(new tf(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}},{key:"ngOnDestroy",value:function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}]),e}()).\u0275fac=function(e){Lo()},np.\u0275dir=Jt({type:np}),np),dp=new kt("ROUTER_CONFIGURATION"),pp=new kt("ROUTER_FORROOT_GUARD"),vp=[Uc,{provide:Sf,useClass:Tf},{provide:ap,useFactory:function(e,t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,l=new ap(null,e,t,n,r,a,i,vf(o));if(u&&(l.urlHandlingStrategy=u),c&&(l.routeReuseStrategy=c),s.errorHandler&&(l.errorHandler=s.errorHandler),s.malformedUriErrorHandler&&(l.malformedUriErrorHandler=s.malformedUriErrorHandler),s.enableTracing){var h=yc();l.events.subscribe((function(e){h.logGroup("Router Event: ".concat(e.constructor.name)),h.log(e.toString()),h.log(e),h.logGroupEnd()}))}return s.onSameUrlNavigation&&(l.onSameUrlNavigation=s.onSameUrlNavigation),s.paramsInheritanceStrategy&&(l.paramsInheritanceStrategy=s.paramsInheritanceStrategy),s.urlUpdateStrategy&&(l.urlUpdateStrategy=s.urlUpdateStrategy),s.relativeLinkResolution&&(l.relativeLinkResolution=s.relativeLinkResolution),l},deps:[Sf,op,Uc,_o,cc,Pu,Xd,dp,[function(){return function e(){_classCallCheck(this,e)}}(),new Ue],[function(){return function e(){_classCallCheck(this,e)}}(),new Ue]]},op,{provide:Kf,useFactory:function(e){return e.routerState.root},deps:[ap]},{provide:cc,useClass:fc},hp,lp,function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"preload",value:function(e,t){return t().pipe(ph((function(){return jl(null)})))}}]),e}(),{provide:dp,useValue:{enableTracing:!1}}];function mp(){return new tc("Router",ap)}var gp,yp=((gp=function(){function e(t,n){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(t,n){return{ngModule:e,providers:[vp,wp(t),{provide:pp,useFactory:_p,deps:[[ap,new Ue,new Ve]]},{provide:dp,useValue:n||{}},{provide:Oc,useFactory:kp,deps:[_c,[new Be(Pc),new Ue],dp]},{provide:fp,useFactory:bp,deps:[ap,ol,dp]},{provide:cp,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:lp},{provide:tc,multi:!0,useFactory:mp},[Cp,{provide:bu,multi:!0,useFactory:Sp,deps:[Cp]},{provide:Ap,useFactory:Tp,deps:[Cp]},{provide:Tu,multi:!0,useExisting:Ap}]]}}},{key:"forChild",value:function(t){return{ngModule:e,providers:[wp(t)]}}}]),e}()).\u0275mod=Zt({type:gp}),gp.\u0275inj=Ke({factory:function(e){return new(e||gp)(It(pp,8),It(ap,8))}}),gp);function bp(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new fp(e,t,n)}function kp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.useHash?new Bc(e,t):new zc(e,t)}function _p(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function wp(e){return[{provide:wo,multi:!0,useValue:e},{provide:Xd,multi:!0,useValue:e}]}var xp,Cp=((xp=function(){function e(t){_classCallCheck(this,e),this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new ue}return _createClass(e,[{key:"appInitializer",value:function(){var e=this;return this.injector.get(Cc,Promise.resolve(null)).then((function(){var t=null,n=new Promise((function(e){return t=e})),r=e.injector.get(ap),a=e.injector.get(dp);if(e.isLegacyDisabled(a)||e.isLegacyEnabled(a))t(!0);else if("disabled"===a.initialNavigation)r.setUpLocationChangeListener(),t(!0);else{if("enabled"!==a.initialNavigation)throw new Error("Invalid initialNavigation options: '".concat(a.initialNavigation,"'"));r.hooks.afterPreactivation=function(){return e.initNavigation?jl(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},r.initialNavigation()}return n}))}},{key:"bootstrapListener",value:function(e){var t=this.injector.get(dp),n=this.injector.get(hp),r=this.injector.get(fp),a=this.injector.get(ap),i=this.injector.get(sc);e===i.components[0]&&(this.isLegacyEnabled(t)?a.initialNavigation():this.isLegacyDisabled(t)&&a.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),a.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}},{key:"isLegacyEnabled",value:function(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}},{key:"isLegacyDisabled",value:function(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}]),e}()).\u0275fac=function(e){return new(e||xp)(It(_o))},xp.\u0275prov=Ge({token:xp,factory:xp.\u0275fac}),xp);function Sp(e){return e.appInitializer.bind(e)}function Tp(e){return e.bootstrapListener.bind(e)}var Ep,Ap=new kt("Router Initializer"),Ip=[],Rp=((Ep=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:Ep}),Ep.\u0275inj=Ke({factory:function(e){return new(e||Ep)},imports:[[yp.forRoot(Ip)],yp]}),Ep);function Np(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}var Op=function(){function e(t){_classCallCheck(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return _createClass(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"get",value:function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,r[0],r[1]),r.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=_slicedToArray(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}},{key:"features",get:function(){return this.flags}}]),e}();function Dp(){return Mp}var Fp,Mp=null;function Lp(){if(null==Fp){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Fp=e}return Fp}function Pp(e,t){var n,r=(null==(n=Lp())._tfGlobals&&(n._tfGlobals=new Map),n._tfGlobals);if(r.has(e))return r.get(e);var a=t();return r.set(e,a),r.get(e)}var zp=Pp("kernelRegistry",(function(){return new Map})),Bp=Pp("gradRegistry",(function(){return new Map}));function Up(e,t){var n=Hp(e,t);return zp.get(n)}function Wp(e){return Bp.get(e)}function Vp(e){for(var t=zp.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=_slicedToArray(i,2),s=o[0],u=o[1];_slicedToArray(s.split("_"),1)[0]===e&&n.push(u)}return n}function jp(e){var t=e.kernelName,n=e.backendName,r=Hp(t,n);zp.has(r)&&console.warn("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),zp.set(r,e)}function Hp(e,t){return"".concat(t,"_").concat(e)}function qp(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function Gp(e,t,n){return Math.max(e,Math.min(t,n))}function Kp(e){return e%2==0?e:e+1}function Xp(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Yp(e,t){var n=Math.random();return t*n+(1-n)*e}function Qp(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function Zp(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function $p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Zp(rv(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function Jp(e){Zp(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function ev(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||yv(e)&&!n)for(var r=0;r<e.length;++r)ev(e[r],t,n);else t.push(e);return t}function tv(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function nv(e){return 0===e.length}function rv(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function av(e){return e%1==0}function iv(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function ov(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function sv(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return qp(t),t}function uv(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function cv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function lv(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function hv(e,t){var n=t.length;return Zp((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),Zp(e.every((function(e){return av(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function fv(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:hv(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function dv(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function pv(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function vv(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function mv(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function gv(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function yv(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function bv(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function kv(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function _v(e){return"string"==typeof e||e instanceof String}function wv(e){return"boolean"==typeof e}function xv(e){return"number"==typeof e}function Cv(e){return Array.isArray(e)?Cv(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":xv(e)?"float32":_v(e)?"string":wv(e)?"bool":"float32"}function Sv(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Tv(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Ev(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Av(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ev(e)),n&&vv(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),a=0;a<r.length;++a)0!==Math.round(e[a])&&(r[a]=1);return r}throw new Error("Unknown data type ".concat(t))}function Iv(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size."));return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else for(var s=n[0],u=n.slice(1),c=u.reduce((function(e,t){return e*t})),l=0;l<s;l++)a[l]=e(t+l*c,u,r);return a}(0,e,t)}function Rv(e,t){for(var n=Nv(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Nv(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Ov(){return Dp().platform.now()}function Dv(e){e.forEach((function(t){Zp(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function Fv(e,t){return Dp().platform.fetch(e,t)}function Mv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Dp().platform.encode(e,t)}function Lv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Dp().platform.decode(e,t)}function Pv(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function zv(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}var Bv=function(){function e(t,n){_classCallCheck(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new Uv)}return _createClass(e,[{key:"profileKernel",value:function(e,t,n){var r,a=this,i=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(r,n.dtype,e),i.then((function(i){var o="";null!=i.getExtraProfileInfo&&(o=i.getExtraProfileInfo()),a.logger.logKernelProfile(e,n,r,i.kernelMs,t,o)}))}))})),r}}]),e}(),Uv=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?uv("".concat(r,"ms"),9):r.error,s=uv(e,25),u=t.rank,c=t.size,l=uv(t.shape.toString(),14),h="";for(var f in a){var d=a[f].shape||t.shape,p=d.length;h+="".concat(f,": ").concat(p,"D ").concat(p>0?d:""," ")}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function Wv(e,t,n){return uv(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):_v(e)?"'".concat(e,"'"):"bool"===n?Vv(e):parseFloat(e.toFixed(7)).toString(),t)}function Vv(e){return 0===e?"false":"true"}function jv(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Hv=function(){function e(t,n,r){var a=this;if(_classCallCheck(this,e),this.dtype=n,this.shape=t.slice(),this.size=tv(t),null!=r){var i=r.length;Zp(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||pv(n,this.size),this.strides=Ev(t)}return _createClass(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),Zp(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r])throw new Error("Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape));r++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"toTensor",value:function(){return qv().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function(){return this.shape.length}}]),e}(),qv=null,Gv=null,Kv=function(){function e(t,n,r,a){_classCallCheck(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=tv(t),this.strides=Ev(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}var t,n,r,a;return _createClass(e,[{key:"flatten",value:function(){return this.throwIfDisposed(),this.as1D()}},{key:"asScalar",value:function(){return this.throwIfDisposed(),Zp(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])}},{key:"as1D",value:function(){return this.throwIfDisposed(),this.reshape([this.size])}},{key:"as2D",value:function(e,t){return this.throwIfDisposed(),this.reshape([e,t])}},{key:"as3D",value:function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])}},{key:"as4D",value:function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])}},{key:"as5D",value:function(e,t,n,r,a){return this.throwIfDisposed(),this.reshape([e,t,n,r,a])}},{key:"asType",value:function(e){return this.throwIfDisposed(),Gv.cast(this,e)}},{key:"buffer",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Gv.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"bufferSync",value:function(){return Gv.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Iv(this.shape,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"arraySync",value:function(){return Iv(this.shape,this.dataSync())}},{key:"data",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=qv().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return Lv(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(){return n.apply(this,arguments)})},{key:"dataSync",value:function(){this.throwIfDisposed();var e=qv().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Lv(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,qv().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dispose",value:function(){this.isDisposed||(qv().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"toFloat",value:function(){return this.asType("float32")}},{key:"toInt",value:function(){return this.asType("int32")}},{key:"toBool",value:function(){return this.asType("bool")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Gv.print(this,e)}},{key:"reshape",value:function(e){return this.throwIfDisposed(),Gv.reshape(this,e)}},{key:"reshapeAs",value:function(e){return this.throwIfDisposed(),this.reshape(e.shape)}},{key:"expandDims",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Gv.expandDims(this,e)}},{key:"cumsum",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Gv.cumsum(this,e,t,n)}},{key:"squeeze",value:function(e){return this.throwIfDisposed(),Gv.squeeze(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),Gv.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,n,r){var a=Ev(t),i=function(e,t,n,r){var a=tv(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?jv(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],Wv(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[Wv(jv(t)[0],0,r)]:"bool"===r?[Vv(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=Array.from(t.slice(0,3*s)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(l=jv(l),h=jv(h)),["["+l.map((function(e,t){return Wv(e,i[t],r)})).join(", ")+", ..., "+h.map((function(e,t){return Wv(e,i[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?jv(t):Array.from(t)).map((function(e,t){return Wv(e,i[t],r)})).join(", ")+"]"]}var f=n.slice(1),d=a.slice(1),p=a[0]*s,v=[];if(u>20){for(var m=0;m<3;m++){var g=m*p;v.push.apply(v,_toConsumableArray(e(t.slice(g,g+p),f,r,d,i,!1)))}v.push("...");for(var y=u-3;y<u;y++){var b=y*p;v.push.apply(v,_toConsumableArray(e(t.slice(b,b+p),f,r,d,i,y===u-1)))}}else for(var k=0;k<u;k++){var _=k*p;v.push.apply(v,_toConsumableArray(e(t.slice(_,_+p),f,r,d,i,k===u-1)))}var w=2===c?",":"";v[0]="["+v[0]+w;for(var x=1;x<v.length-1;x++)v[x]=" "+v[x]+w;for(var C=",\n",S=2;S<c;S++)C+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(o?"":C),v}(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)}},{key:"gather",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.throwIfDisposed(),Gv.gather(this,e,t)}},{key:"norm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"euclidean",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.throwIfDisposed(),Gv.norm(this,e,t,n)}},{key:"slice",value:function(e,t){return this.throwIfDisposed(),Gv.slice(this,e,t)}},{key:"reverse",value:function(e){return this.throwIfDisposed(),Gv.reverse(this,e)}},{key:"stack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Gv.stack([this,e],t)}},{key:"unstack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Gv.unstack(this,e)}},{key:"all",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.all(this,e,t)}},{key:"any",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.any(this,e,t)}},{key:"logSumExp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.logSumExp(this,e,t)}},{key:"sum",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.sum(this,e,t)}},{key:"prod",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.prod(this,e,t)}},{key:"mean",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.mean(this,e,t)}},{key:"min",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.min(this,e,t)}},{key:"argMin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.throwIfDisposed(),Gv.argMin(this,e)}},{key:"argMax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.throwIfDisposed(),Gv.argMax(this,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),Gv.cast(this,e)}},{key:"addStrict",value:function(e){return this.throwIfDisposed(),Gv.addStrict(this,e)}},{key:"atan2",value:function(e){return this.throwIfDisposed(),Gv.atan2(this,e)}},{key:"subStrict",value:function(e){return this.throwIfDisposed(),Gv.subStrict(this,e)}},{key:"pow",value:function(e){return this.throwIfDisposed(),Gv.pow(this,e)}},{key:"powStrict",value:function(e){return this.throwIfDisposed(),Gv.powStrict(this,e)}},{key:"mul",value:function(e){return this.throwIfDisposed(),Gv.mul(this,e)}},{key:"mulStrict",value:function(e){return this.throwIfDisposed(),Gv.mulStrict(this,e)}},{key:"floorDiv",value:function(e){return this.throwIfDisposed(),Gv.floorDiv(this,e)}},{key:"divStrict",value:function(e){return this.throwIfDisposed(),Gv.divStrict(this,e)}},{key:"minimum",value:function(e){return this.throwIfDisposed(),Gv.minimum(this,e)}},{key:"minimumStrict",value:function(e){return this.throwIfDisposed(),Gv.minimumStrict(this,e)}},{key:"maximum",value:function(e){return this.throwIfDisposed(),Gv.maximum(this,e)}},{key:"maximumStrict",value:function(e){return this.throwIfDisposed(),Gv.maximumStrict(this,e)}},{key:"mod",value:function(e){return this.throwIfDisposed(),Gv.mod(this,e)}},{key:"modStrict",value:function(e){return this.throwIfDisposed(),Gv.modStrict(this,e)}},{key:"squaredDifferenceStrict",value:function(e){return this.throwIfDisposed(),Gv.squaredDifferenceStrict(this,e)}},{key:"notEqualStrict",value:function(e){return this.throwIfDisposed(),Gv.notEqualStrict(this,e)}},{key:"lessStrict",value:function(e){return this.throwIfDisposed(),Gv.lessStrict(this,e)}},{key:"equalStrict",value:function(e){return this.throwIfDisposed(),Gv.equalStrict(this,e)}},{key:"lessEqualStrict",value:function(e){return this.throwIfDisposed(),Gv.lessEqualStrict(this,e)}},{key:"greaterStrict",value:function(e){return this.throwIfDisposed(),Gv.greaterStrict(this,e)}},{key:"greaterEqualStrict",value:function(e){return this.throwIfDisposed(),Gv.greaterEqualStrict(this,e)}},{key:"logicalAnd",value:function(e){return this.throwIfDisposed(),Gv.logicalAnd(this,e)}},{key:"logicalOr",value:function(e){return this.throwIfDisposed(),Gv.logicalOr(this,e)}},{key:"logicalNot",value:function(){return this.throwIfDisposed(),Gv.logicalNot(this)}},{key:"logicalXor",value:function(e){return this.throwIfDisposed(),Gv.logicalXor(this,e)}},{key:"where",value:function(e,t){return this.throwIfDisposed(),Gv.where(e,this,t)}},{key:"neg",value:function(){return this.throwIfDisposed(),Gv.neg(this)}},{key:"ceil",value:function(){return this.throwIfDisposed(),Gv.ceil(this)}},{key:"floor",value:function(){return this.throwIfDisposed(),Gv.floor(this)}},{key:"sign",value:function(){return this.throwIfDisposed(),Gv.sign(this)}},{key:"isNaN",value:function(){return this.throwIfDisposed(),Gv.isNaN(this)}},{key:"isInf",value:function(){return this.throwIfDisposed(),Gv.isInf(this)}},{key:"isFinite",value:function(){return this.throwIfDisposed(),Gv.isFinite(this)}},{key:"exp",value:function(){return this.throwIfDisposed(),Gv.exp(this)}},{key:"expm1",value:function(){return this.throwIfDisposed(),Gv.expm1(this)}},{key:"log",value:function(){return this.throwIfDisposed(),Gv.log(this)}},{key:"log1p",value:function(){return this.throwIfDisposed(),Gv.log1p(this)}},{key:"sqrt",value:function(){return this.throwIfDisposed(),Gv.sqrt(this)}},{key:"rsqrt",value:function(){return this.throwIfDisposed(),Gv.rsqrt(this)}},{key:"square",value:function(){return this.throwIfDisposed(),Gv.square(this)}},{key:"reciprocal",value:function(){return this.throwIfDisposed(),Gv.reciprocal(this)}},{key:"abs",value:function(){return this.throwIfDisposed(),Gv.abs(this)}},{key:"clipByValue",value:function(e,t){return this.throwIfDisposed(),Gv.clipByValue(this,e,t)}},{key:"relu",value:function(){return this.throwIfDisposed(),Gv.relu(this)}},{key:"relu6",value:function(){return this.throwIfDisposed(),Gv.relu6(this)}},{key:"elu",value:function(){return this.throwIfDisposed(),Gv.elu(this)}},{key:"selu",value:function(){return this.throwIfDisposed(),Gv.selu(this)}},{key:"leakyRelu",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;return this.throwIfDisposed(),Gv.leakyRelu(this,e)}},{key:"prelu",value:function(e){return this.throwIfDisposed(),Gv.prelu(this,e)}},{key:"sigmoid",value:function(){return this.throwIfDisposed(),Gv.sigmoid(this)}},{key:"logSigmoid",value:function(){return this.throwIfDisposed(),Gv.logSigmoid(this)}},{key:"softplus",value:function(){return this.throwIfDisposed(),Gv.softplus(this)}},{key:"zerosLike",value:function(){return this.throwIfDisposed(),Gv.zerosLike(this)}},{key:"onesLike",value:function(){return this.throwIfDisposed(),Gv.onesLike(this)}},{key:"sin",value:function(){return this.throwIfDisposed(),Gv.sin(this)}},{key:"cos",value:function(){return this.throwIfDisposed(),Gv.cos(this)}},{key:"tan",value:function(){return this.throwIfDisposed(),Gv.tan(this)}},{key:"asin",value:function(){return this.throwIfDisposed(),Gv.asin(this)}},{key:"acos",value:function(){return this.throwIfDisposed(),Gv.acos(this)}},{key:"atan",value:function(){return this.throwIfDisposed(),Gv.atan(this)}},{key:"sinh",value:function(){return this.throwIfDisposed(),Gv.sinh(this)}},{key:"cosh",value:function(){return this.throwIfDisposed(),Gv.cosh(this)}},{key:"tanh",value:function(){return this.throwIfDisposed(),Gv.tanh(this)}},{key:"asinh",value:function(){return this.throwIfDisposed(),Gv.asinh(this)}},{key:"acosh",value:function(){return this.throwIfDisposed(),Gv.acosh(this)}},{key:"atanh",value:function(){return this.throwIfDisposed(),Gv.atanh(this)}},{key:"erf",value:function(){return this.throwIfDisposed(),Gv.erf(this)}},{key:"round",value:function(){return this.throwIfDisposed(),Gv.round(this)}},{key:"step",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.throwIfDisposed(),Gv.step(this,e)}},{key:"softmax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.throwIfDisposed(),Gv.softmax(this,e)}},{key:"logSoftmax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.throwIfDisposed(),Gv.logSoftmax(this,e)}},{key:"resizeBilinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.image.resizeBilinear(this,e,t)}},{key:"resizeNearestNeighbor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.throwIfDisposed(),Gv.image.resizeNearestNeighbor(this,e,t)}},{key:"avgPool",value:function(e,t,n,r){return this.throwIfDisposed(),Gv.avgPool(this,e,t,n,r)}},{key:"maxPool",value:function(e,t,n,r){return this.throwIfDisposed(),Gv.maxPool(this,e,t,n,r)}},{key:"pool",value:function(e,t,n,r,a){return this.throwIfDisposed(),Gv.pool(this,e,t,n,r,a)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),qv().makeVariable(this,e,t,n)}},{key:"unsortedSegmentSum",value:function(e,t){return this.throwIfDisposed(),Gv.unsortedSegmentSum(this,e,t)}},{key:"topk",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.throwIfDisposed(),Gv.topk(this,e,t)}},{key:"stridedSlice",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return this.throwIfDisposed(),Gv.stridedSlice(this,e,t,n,r,a,i,o,s)}},{key:"fft",value:function(){return this.throwIfDisposed(),Gv.spectral.fft(this)}},{key:"ifft",value:function(){return this.throwIfDisposed(),Gv.spectral.ifft(this)}},{key:"rfft",value:function(){return this.throwIfDisposed(),Gv.spectral.rfft(this)}},{key:"irfft",value:function(){return this.throwIfDisposed(),Gv.spectral.irfft(this)}},{key:"rank",get:function(){return this.shape.length}},{key:"isDisposed",get:function(){return this.isDisposedInternal}}]),e}();Object.defineProperty(Kv,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var Xv,Yv,Qv,Zv,$v,Jv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return _createClass(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!rv(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));qv().disposeTensor(this),this.dataId=e.dataId,qv().incRef(this,null)}},{key:"dispose",value:function(){qv().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(Kv);Object.defineProperty(Jv,Symbol.hasInstance,{value:function(e){return e instanceof Kv&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Xv||(Xv={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Yv||(Yv={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Qv||(Qv={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Zv||(Zv={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}($v||($v={}));var em={float32:Zv,int32:Yv,bool:Qv,complex64:$v};function tm(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return em[e][t]}function nm(e){return tm(e,"int32")}function rm(e,t){if(e.dtype===t.dtype)return[e,t];var n=tm(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function am(e,t){Zp(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and")+" second(".concat(t.dtype,") input must match")}))}function im(e,t){return t.some((function(t){return t.id===e.id}))}function om(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof Kv)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var o in i){var s=i[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var sm=function(){function e(){_classCallCheck(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return _createClass(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),um=function(){function e(t){_classCallCheck(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sm}var t,n,r,a;return _createClass(e,[{key:"ready",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return",void e.sent);case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Bv(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function(){var e=this;Vp(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Vp(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(Promise.resolve(r)===r){var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(o){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],(function(e){return{x:function(){return e.toFloat()}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=r-t-a-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(i>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(i," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,v=Up(r,this.backendName);if(null!=v)h=function(){var e=u.backend.numDataIds();p=v.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var h=u.getTensorsForGradient(r,t,s);if(null==h){null==o&&(o=[]);var f=s.filter((function(e,t){return o[t]}));h=(i||[]).slice().concat(f)}c=u.saveTensorsForBackwardMode(h)}return s};else{var m=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};h=function(){var t=u.backend.numDataIds();p=u.tidy((function(){return e(u.backend,m)}));var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return h()})):h()})),l&&this.addTapeNode(r,t,s,n,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(p)?s:s[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Wp(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(Zp(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var a=e;"string"===(n=n||"float32")&&_v(e[0])&&(a=e.map((function(e){return Mv(e)})));var i=r.write(a,t,n),o=new Kv(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=kv(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new Kv(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var a=new Jv(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*bv(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Jv||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,e.abrupt("return",(this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,_toConsumableArray(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,this.state.activeProfile));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Wp(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Nv(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=om(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Zp(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));Zp(i instanceof Kv,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(d[m.outputs[y].id]){for(var b in g)d[g[b].id]=!0,p[m.id]=!0;break}for(var k=[],_=0;_<e.length;_++){var w=e[_];if(a[w.id]&&p[w.id]){var x={};for(var C in w.inputs){var S=w.inputs[C];r[S.id]&&(x[C]=S)}var T=Object.assign({},w);T.inputs=x,T.outputs=w.outputs,k.push(T)}}return k}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,a,s={};s[i.id]=null==n?(e=i.shape,a=Rv(tv(e),"float32"),cm.makeTensor(a,e,"float32")):n,function(e,t,n){for(var a=function(n){var a=t[n],i=[];if(a.outputs.forEach((function(t){var n=e[t.id];i.push(null!=n?n:null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));var o=a.gradient(i),s=function(t){if(!(t in o))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(o),"."));var n=function(e){return r.tidy(e)}((function(){return o[t]()}));if("float32"!==n.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(n.dtype,"'"));var i=a.inputs[t];if(!rv(n.shape,i.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(n.shape,"', which does not match ")+"the shape of the input '".concat(i.shape,"'"));if(null==e[i.id])e[i.id]=n;else{var s=e[i.id];e[i.id]=s.add(n),s.dispose()}};for(var u in a.inputs)s(u)},i=t.length-1;i>=0;i--)a(i)}(s,o);var u=t.map((function(e){return s[e.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=_createForOfIteratorHelper(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:u}}))}},{key:"customGrad",value:function(e){var t=this;return Zp(Sv(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;Zp(r.every((function(e){return e instanceof Kv})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return Zp((i=e.apply(void 0,r.concat([n]))).value instanceof Kv,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),Zp(Sv(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];Zp(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),Zp(a.every((function(e){return e instanceof Kv})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ov(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=Ov()-n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sm,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}}]),e}();um.nextTensorId=0,um.nextVariableId=0;var cm=function(){var e=Lp();if(null==e._tfengine){var t=new Op(e);e._tfengine=new um(t)}return Mp=e._tfengine.ENV,qv=function(){return e._tfengine},e._tfengine}();function lm(){if("undefined"!=typeof navigator&&null!=navigator){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function hm(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var fm=Dp();function dm(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function pm(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function vm(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,"."));n.unshift(i)}}return n}fm.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),fm.registerFlag("IS_BROWSER",(function(){return hm()})),fm.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),fm.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),fm.registerFlag("PROD",(function(){return!1})),fm.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return fm.getBool("DEBUG")})),fm.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),fm.registerFlag("IS_TEST",(function(){return!1}));var mm={kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=vm(r.shape,a.shape);return{a:function(){var t=e,n=pm(r.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=pm(a.shape,i);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}}};function gm(e,t){var n=e;if(yv(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||yv(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Dp().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||yv(t)){Zp(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, ")+"but is an array of ".concat(t.length," elements")})),Zp(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," ")+"elements, but has ".concat(t.length," elements")}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else Zp(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(n[0]," elements")}))}(e,r,[]),r}function ym(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}function bm(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof Kv)return ym(r,e.dtype,t,n),e;var a=Cv(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),ym(r,a,t,n),null==e||!yv(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(null==e?"null":e.constructor.name,"'"));var i=gm(e,a);yv(e)||Array.isArray(e)||(e=[e]);var o="string"!==a?Av(e,a,Dp().getBool("DEBUG")):ev(e,[],!0);return cm.makeTensor(o,i,a)}function km(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return bm(e,"".concat(t,"[").concat(r,"]"),n)}),r)}function _m(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function wm(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function xm(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function Cm(e,t){return wm(e,t.map((function(e){return 1})),t)}function Sm(e,t,n){Zp(_m(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function Tm(e,t){if(_m(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Em(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Am(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Im(e,t){var n=e[0].length;e.forEach((function(e,t){Zp(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),Zp(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)Zp(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function Rm(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Nm(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var a=function(){cm.startScope(n);try{var e=r.apply(void 0,arguments);return e instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),cm.endScope(e),e}catch(t){throw cm.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Om=Nm({complex_:function(e,t){var n=bm(e,"real","complex"),r=bm(t,"imag","complex");return $p(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex()."),cm.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),Dm=Nm({real_:function(e){var t=bm(e,"input","real");return cm.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),Fm=Nm({imag_:function(e){var t=bm(e,"input","imag");return cm.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function Mm(e,t,n){return Lm(e,t,gm(e,n),n)}function Lm(e,t,n,r){if(null==r&&(r=Cv(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!yv(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Dv(t);var a=tv(t),i=tv(n);Zp(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==tv(t.slice(o));Zp(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return yv(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Av(e,r,Dp().getBool("DEBUG")):ev(e,[],!0),cm.makeTensor(e,t,r)}function Pm(e,t){if((yv(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&yv(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Lm(e,[],[],t)}function zm(e,t){Jp(e);var n=gm(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Lm(e,null,n,t)}function Bm(e,t,n){if(Jp(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=gm(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Lm(e,t,r,n)}function Um(e,t,n){if(Jp(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=gm(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Lm(e,t,r,n)}function Wm(e,t,n){if(Jp(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=gm(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Lm(e,t,r,n)}function Vm(e,t,n){if(Jp(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=gm(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Lm(e,t,r,n)}function jm(e,t,n){if(Jp(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=gm(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Lm(e,t=t||r,r,n)}function Hm(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return cm.makeVariable(e,t,n,r)}function qm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=qm(e,"float32"),r=Gm(e,"float32");return Om(n,r)}var a=Rv(tv(e),t);return cm.makeTensor(a,e,t)}function Gm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Gm(e,"float32"),r=Gm(e,"float32");return Om(n,r)}var a=Nv(tv(e),t);return cm.makeTensor(a,e,t)}function Km(e,t,n){return cm.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function Xm(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return cm.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})}function Ym(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return Gm([0],r);var a=Nv(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return zm(a,r)}var Qm=Nm({onesLike_:function(e){var t=bm(e,"x","onesLike");if("complex64"===t.dtype){var n=Qm(Dm(t)),r=Zm(Fm(t));return Om(n,r)}return cm.runKernelFunc((function(e){return e.onesLike(t)}),{x:t},(function(e,t){return{x:function(){return Zm(e)}}}),"OnesLike")}}),Zm=Nm({zerosLike_:function(e){var t=bm(e,"x","zerosLike");return cm.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},(function(e,t){return{x:function(){return Zm(e)}}}),"ZerosLike")}}),$m=Nm({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Zp(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=km(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))}));var r=hv(t,n[0].shape)[0],a=Rm(n.map((function(e){return e.shape})),r);return 0===tv(a)?Mm([],a):1===(n=n.filter((function(e){return e.size>0}))).length?n[0]:(Im(n.map((function(e){return e.shape})),r),cm.runKernelFunc((function(e,r){var a=hv(t,n[0].shape)[0],i=e.concat(n,a);return r(n),i}),n,null,"Concat",{axis:t}))}});function Jm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Dv(e),new Hv(e,t,n)}function eg(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}var tg=Nm({cast_:function(e,t){var n=bm(e,"x","cast");if(!mv(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return cm.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",{dtype:t})}}),ng=Nm({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=bm(e,"x","cumsum"),i=Tm([t|=0],a.rank),o=a;null!=i&&(o=a.transpose(i));var s=Am(1,a.rank)[0],u=cm.runKernelFunc((function(e){return e.cumsum(o,s,n,r)}),{permutedX:o},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=i&&(u=u.transpose(i)),u}}),rg=Nm({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=bm(e,"x","expandDims",null);Zp(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(Zp(-(n.rank+1)<=t,(function(){return"Axis must be in the interval [".concat(-(n.rank+1),", ").concat(n.rank,"]")})),t=n.rank+t+1),r.splice(t,0,1),ag(n,r)}}),ag=Nm({reshape_:function(e,t){var n=bm(e,"x","reshape",null);return t=lv(t,n.size),Zp(n.size===tv(t),(function(){return"new shape and old shape must have the same number of elements."})),cm.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",{shape:t})}}),ig=Nm({squeeze_:function(e,t){var n=bm(e,"x","squeeze");return ag(n,fv(n.shape,t).newShape)}}),og=Nm({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=km(e,"tensors","stack");if(Zp(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].shape,a=n[0].dtype;Zp(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){$p(r,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){Zp(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(e){return e.expandDims(t)}));return $m(i,t)}}),sg=Nm({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=t||0;var n=bm(e,"x","unstack");return Zp(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")})),t<0&&(t+=n.shape.length),cm.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return og(e,t)}}}),"Unpack",{axis:t})}}),ug=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=bm(t,"x","setdiff1d"),a=bm(n,"y","setdiff1d"),Zp(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),Zp(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),Zp(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new Hv([u],r.dtype),h=new Hv([u],"int32"),f=0,d=0;f<i.length;f++)s.has(i[f])||(l.values[d]=i[f],h.values[d]=f,d++);return e.abrupt("return",[l.toTensor(),h.toTensor()]);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),cg=Nm({matMul_:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=bm(e,"a","matMul"),o=bm(t,"b","matMul");n=_slicedToArray(rm(i,o),2),i=n[0],o=n[1],Zp(i.rank>=2&&o.rank>=2&&i.rank===o.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, "+"got ranks ".concat(i.rank," and ").concat(o.rank,".")}));var s=r?i.shape[i.rank-2]:i.shape[i.rank-1],u=a?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=a?o.shape[o.rank-2]:o.shape[o.rank-1],h=i.shape.slice(0,-2),f=o.shape.slice(0,-2),d=tv(h),p=tv(f);Zp(rv(h,f),(function(){return"Error in matMul: outer dimensions (".concat(h,") and (")+"".concat(f,") of Tensors with shapes ").concat(i.shape," and ")+"".concat(o.shape," must match.")})),Zp(s===u,(function(){return"Error in matMul: inner shapes (".concat(s,") and (")+"".concat(u,") of Tensors with shapes ").concat(i.shape," and ")+"".concat(o.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var v=i.shape.slice(0,-2).concat([c,l]),m=ag(i,r?[d,s,c]:[d,c,s]),g=ag(o,a?[p,l,u]:[p,u,l]),y=cm.runKernelFunc((function(e,t){return t([m,g]),e.batchMatMul(m,g,r,a)}),{a:m,b:g},null,"BatchMatMul",{transposeA:r,transposeB:a});return ag(y,v)}}),lg={kernelName:"BatchMatMul",inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return cg(e,i,!1,!1)},b:function(){return cg(e,a,!0,!1)}}:o&&!s?{a:function(){return cg(i,e,!1,!0)},b:function(){return cg(a,e,!1,!1)}}:{a:function(){return cg(i,e,!0,!0)},b:function(){return cg(e,a,!0,!0)}}:{a:function(){return cg(e,i,!1,!0)},b:function(){return cg(a,e,!0,!1)}}}},hg=Nm({spaceToBatchND_:function(e,t,n){var r=bm(e,"x","spaceToBatchND");return Zp(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),Zp(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),Zp(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())})),cm.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{x:r},null,"SpaceToBatchND",{blockShape:t,paddings:n})}}),fg={kernelName:"BatchToSpaceND",gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return hg(e,r,a)}}}};function dg(e){return cm.customGrad(e)}function pg(e,t,n,r,a){return t.rank<n.rank&&(t=t.reshape(Cm(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Cm(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==a?r:r.transpose(a)}}}var vg=Nm({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","all","bool"),a=hv(t,r.shape),i=a,o=Tm(i,r.rank);null!=o&&(r=r.transpose(o),i=Am(i.length,r.rank));var s=cm.runKernelFunc((function(e){return e.all(r,i)}),{$x:r});if(n){var u=Cm(s.shape,a);return s.reshape(u)}return s}}),mg=Nm({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","any","bool"),a=hv(t,r.shape),i=a,o=Tm(i,r.rank);null!=o&&(r=r.transpose(o),i=Am(i.length,r.rank));var s=cm.runKernelFunc((function(e){return e.any(r,i)}),{$x:r});if(n){var u=Cm(s.shape,a);return s.reshape(u)}return s}}),gg=Nm({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=bm(e,"x","argMax");null==t&&(t=0);var r=hv(t,n.shape),a=Tm(r,n.rank);return null!=a&&(n=n.transpose(a),r=Am(r.length,n.rank)),cm.runKernelFunc((function(e,t){var a=e.argMax(n,r[0]);return t([n]),a}),{x:n},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Zm(n)}}}),"ArgMax",{axis:r[0]},[n])}}),yg=Nm({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=bm(e,"x","argMin");null==t&&(t=0);var r=hv(t,n.shape),a=Tm(r,n.rank);return null!=a&&(n=n.transpose(a),r=Am(r.length,n.rank)),cm.runKernelFunc((function(e,t){var a=e.argMin(n,r[0]);return t([n]),a}),{$x:n},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return Zm(n)}}}))}}),bg=Nm({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","logSumExp"),a=hv(t,r.shape),i=r.max(a,!0),o=r.sub(i).exp().sum(a).log(),s=i.reshape(o.shape).add(o);if(n){var u=Cm(s.shape,a);return s.reshape(u)}return s}}),kg=Nm({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","mean"),a=hv(t,r.shape),i=tv(xm(r.shape,a)[1]);return dg((function(e){var r=Pm(i);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return a.forEach((function(e){n[e]=1})),t.reshape(n).mul(qm(e.shape,"float32")).div(i)}}}))(r)}}),_g=Nm({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","min"),a=r,i=hv(t,r.shape),o=i,s=Tm(o,r.rank);null!=s&&(r=r.transpose(s),o=Am(o.length,r.rank));var u=cm.runKernelFunc((function(e,t){var n=e.min(r,o);return t([a,n]),n}),{x:r},(function(e,t){return pg(e,t[1],t[0],i,s)}),"Min",{axes:o},[r],[!0]);if(n){var c=Cm(u.shape,i);u=u.reshape(c)}return u}}),wg=Nm({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=hv(t,(e=bm(e,"x","moments")).shape),a=e.mean(r,n),i=a.shape;n||(i=Cm(a.shape,r));var o=e.toFloat().sub(a.reshape(i)).square();return{mean:a,variance:o.mean(r,n)}}}),xg=Nm({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var a=hv(t,r.shape);return dg((function(e){var t=Tm(a,e.rank),r=a,i=e;null!=t&&(i=e.transpose(t),r=Am(r.length,e.rank));var o=function(t){var n=e.shape.slice();return a.forEach((function(e){n[e]=1})),t.reshape(n).mul(qm(e.shape,"float32"))},s=cm.runKernelFunc((function(e){return e.sum(i,r)}),{x:i},(function(e){return{x:function(){return o(e)}}}),"Sum",{axes:r});if(n){var u=Cm(s.shape,a);s=s.reshape(u)}return{value:s,gradFunc:o}}))(r)}}),Cg=Nm({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var a=hv(t,r.shape),i=Tm(a,r.rank),o=a,s=r;null!=i&&(s=r.transpose(i),o=Am(o.length,r.rank));var u=cm.runKernelFunc((function(e){return e.prod(s,o)}),{permutedX:s});if(n){var c=Cm(u.shape,a);u=u.reshape(c)}return u}}),Sg={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n.inputShape,a=n.shape,i=Array.from(a),o=r.length-1;o>=0;o--)if(r[o]===a[o])i[o]=1;else if(1!==r[o])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(a,"]."));for(var s=[],u=0;u<i.length;u++)i[u]>1&&s.push(u);return{x:function(){return xg(e,s,!0)}}}},Tg=Nm({split_:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=bm(e,"x","split"),i=hv(r,a.shape)[0];return"number"==typeof t?(Zp(a.shape[i]%t==0,(function(){return"Number of splits must evenly divide the axis."})),n=new Array(t).fill(a.shape[i]/t)):(Zp(a.shape[i]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),n=t),cm.runKernelFunc((function(e,t){return e.split(a,n,i)}),{x:a},null,"SplitV",{numOrSizeSplits:t,axis:r})}}),Eg={kernelName:"Concat",saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=hv(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Tg(e,i,a).map((function(e){return function(){return e}}))}};function Ag(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Dg(t),c=_slicedToArray(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,h,e[1],e[1]]}return Rg(e,o,n,r,a,i,!1,s)}function Ig(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Fg(t),l=_slicedToArray(c,3),h=l[0],f=l[1],d=l[2];if("NDHWC"===u)s="channelsLast",o=[h,f,d,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[h,f,d,e[1],e[1]]}return Ng(e,o,n,r,a,!1,s,i)}function Rg(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var f=_slicedToArray(e,4);u=f[0],c=f[1],l=f[2],h=f[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var d=_slicedToArray(e,4);u=d[0],h=d[1],c=d[2],l=d[3]}var p,v=_slicedToArray(t,4),m=v[0],g=v[1],y=v[3],b=Dg(n),k=_slicedToArray(b,2),_=k[0],w=k[1],x=Dg(r),C=_slicedToArray(x,2),S=C[0],T=C[1],E=Mg(m,S),A=Mg(g,T),I=function(e,t,n,r,a,i,o,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=Og(e,t,n));var i=e[1],o=Lg((e[0]-t+2*r)/n+1,a);Zp(av(o),(function(){return"The output # of rows (".concat(o,") must be an integer. ")+"Change the stride and/or zero pad parameters"}));var s=Lg((i-t+2*r)/n+1,a);return Zp(av(s),(function(){return"The output # of columns (".concat(s,") must be an integer. ")+"Change the stride and/or zero pad parameters"})),[o,s]}([t,n],i,r,e,s);c=h[0],l=h[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/a);var f=Math.max(0,(c-1)*r+i-t),d=Math.max(0,(l-1)*a+o-n),p=Math.floor(f/2),v=f-p,m=Math.floor(d/2);u={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-i+1)/r),l=Math.ceil((n-o+1)/a)}return{padInfo:u,outHeight:c,outWidth:l}}(a,c,l,_,w,E,A,i),R=I.padInfo,N=I.outHeight,O=I.outWidth,D=o?y*h:y;return"channelsFirst"===s?p=[u,D,N,O]:"channelsLast"===s&&(p=[u,N,O,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:N,outWidth:O,outChannels:D,padInfo:R,strideHeight:_,strideWidth:w,filterHeight:m,filterWidth:g,effectiveFilterHeight:E,effectiveFilterWidth:A,dilationHeight:S,dilationWidth:T,inShape:e,outShape:p,filterShape:t}}function Ng(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,f=-1;if("channelsLast"===o){var d=_slicedToArray(e,5);u=d[0],c=d[1],l=d[2],h=d[3],f=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var p=_slicedToArray(e,5);u=p[0],f=p[1],c=p[2],l=p[3],h=p[4]}var v,m=_slicedToArray(t,5),g=m[0],y=m[1],b=m[2],k=m[4],_=Fg(n),w=_slicedToArray(_,3),x=w[0],C=w[1],S=w[2],T=Fg(r),E=_slicedToArray(T,3),A=E[0],I=E[1],R=E[2],N=Mg(g,A),O=Mg(y,I),D=Mg(b,R),F=function(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=Og(e,t,r));var o=e[1],s=e[2],u=Lg((e[0]-t+2*a)/r+1,i);Zp(av(u),(function(){return"The output # of depths (".concat(u,") must be an integer. ")+"Change the stride and/or zero pad parameters"}));var c=Lg((o-t+2*a)/r+1,i);Zp(av(c),(function(){return"The output # of rows (".concat(c,") must be an integer. ")+"Change the stride and/or zero pad parameters"}));var l=Lg((s-t+2*a)/r+1,i);return Zp(av(l),(function(){return"The output # of columns (".concat(l,") must be an integer. ")+"Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,a,e,l);f=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(m/2),k=m-b,_=Math.floor(g/2),w=g-_,x=Math.floor(y/2);h={top:_,bottom:w,left:x,right:y-x,front:b,back:k,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}(a,c,l,h,x,C,S,N,O,D,s),M=F.padInfo,L=F.outDepth,P=F.outHeight,z=F.outWidth,B=i?k*f:k;return"channelsFirst"===o?v=[u,B,L,P,z]:"channelsLast"===o&&(v=[u,L,P,z,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:f,outDepth:L,outHeight:P,outWidth:z,outChannels:B,padInfo:M,strideDepth:x,strideHeight:C,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:N,effectiveFilterHeight:O,effectiveFilterWidth:D,dilationDepth:A,dilationHeight:I,dilationWidth:R,inShape:e,outShape:v,filterShape:t}}function Og(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Mg(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Dg(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Fg(e){return"number"==typeof e?[e,e,e]:e}function Mg(e,t){return t<=1?e:e+(e-1)*(t-1)}function Lg(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Pg(e){var t=_slicedToArray(Dg(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function zg(e,t){return Pg(e)||Pg(t)}function Bg(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}var Ug=Nm({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=ag(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=ag(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Zp(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),Zp(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),Zp(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];return Zp(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),Zp(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),null!=o&&Zp(av(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")})),cm.runKernelFunc((function(e){var t=Bg(i),c=Rg(s.shape,n,r,1,a,o,!1,t);return e.conv2dDerFilter(s,u,c)}),{x:s,dy:u},null,"Conv2DBackpropFilter",{strides:r,pad:a,dataFormat:i,dimRoundingMode:o})}}),Wg=Nm({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;Zp(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=ag(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),Zp(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),Zp(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),Zp(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];Zp(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),Zp(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),null!=o&&Zp(av(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var f=cm.runKernelFunc((function(e,t){var c=Bg(i),l=Rg(s,n.shape,r,1,a,o,!1,c),h=e.conv2dDerInput(u,n,l);return t([u,n]),h}),{dy:u,filter:n},null,"Conv2DBackpropInput",{strides:r,pad:a,dataFormat:i,dimRoundingMode:o});return c?ag(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),Vg={kernelName:"Conv2D",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return Zp(Pg(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return Wg(a.shape,e,i,s,u,c)},filter:function(){return Ug(a,e,i.shape,s,u,c)}}}},jg=Nm({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=bm(e,"x","conv2d"),u=bm(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=ag(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Zp(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),Zp(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),null!=o&&Zp(av(r),(function(){return"Error in conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];Zp(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),Zp(zg(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")}));var f=cm.runKernelFunc((function(e,t){var s=Bg(a),l=Rg(c.shape,u.shape,n,i,r,o,!1,s),h=e.conv2d(c,u,l);return t([c,u]),h}),{x:c,filter:u},null,"Conv2D",{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?ag(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),Hg={kernelName:"Conv2DBackpropInput",inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return jg(e,i,o,s,u,1,c)},filter:function(){return Ug(e,a,i.shape,o,s,u,c)}}}},qg=Nm({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=ag(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;return 4===o.rank&&(o=ag(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Zp(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),Zp(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),Zp(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),Zp(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),Zp(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")})),cm.runKernelFunc((function(e){var t=Ng(i.shape,n,r,1,a);return e.conv3dDerFilter(i,o,t)}),{x:i,y:o},null,"Conv3DBackpropFilterV2",{strides:r,pad:a})}}),Gg=Nm({conv3DBackpropInput_:function(e,t,n,r,a){Zp(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=ag(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];Zp(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),Zp(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),Zp(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),Zp(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),Zp(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l=cm.runKernelFunc((function(e){var t=Ng(i,n.shape,r,1,a);return e.conv3dDerInput(o,n,t)}),{dy:o},null,"Conv3DBackpropInputV2",{pad:a});return s?ag(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),Kg={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;Zp(Pg(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=_slicedToArray(t,2),s=o[0],u=o[1];return{x:function(){return Gg(s.shape,e,u,a,i)},filter:function(){return qg(s,e,u.shape,a,i)}}}},Xg=Nm({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r){var a=e;3===e.rank&&(a=ag(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var i=t;return 3===i.rank&&(i=ag(t,[1,t.shape[0],t.shape[1],t.shape[2]])),cm.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(a,i,r)}),{x:a,dy:i},null,"DepthwiseConv2dNativeBackpropFilter")}}),Yg=Nm({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r){var a=t,i=!1;3===t.rank&&(i=!0,a=ag(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var o=cm.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(a,n,r)}),{dy:a},null,"DepthwiseConv2dNativeBackpropInput");return i?ag(o,[o.shape[1],o.shape[2],o.shape[3]]):o}}),Qg={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;Zp(Pg(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=_slicedToArray(t,2),c=u[0],l=u[1];Zp(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),Zp(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),Zp(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),Zp(zg(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),null!=o&&Zp(av(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var h=Rg(c.shape,l.shape,a,s,i,o,!0);return{x:function(){return Yg(c.shape,e,l,h)},filter:function(){return Xg(c,e,l.shape,h)}}}};function Zg(e){Dp().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function $g(){return cm}function Jg(){return cm.memory()}function ey(e,t){return cm.tidy(e,t)}function ty(e){om(e).forEach((function(e){return e.dispose()}))}function ny(e){return cm.keep(e)}function ry(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return cm.registerBackend(e,t,n)}var ay=Nm({add_:function(e,t){var n,r=bm(e,"a","add"),a=bm(t,"b","add");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],cm.runKernelFunc((function(e,t){var n=e.add(r,a);return t([r,a]),n}),{a:r,b:a},null,"Add")}}),iy=Nm({abs_:function(e){var t=bm(e,"x","abs");return"complex64"===t.dtype?cm.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):cm.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),oy=Nm({acos_:function(e){var t=bm(e,"x","acos");return cm.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){var t=n.toFloat().square(),r=Pm(1).sub(t).sqrt();return e.div(r).neg()}}}))}}),sy=Nm({acosh_:function(e){var t=bm(e,"x","acosh");return cm.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){var t=n.toFloat().square().sub(1).sqrt();return e.div(t)}}}))}}),uy=Nm({asin_:function(e){var t=bm(e,"x","asin");return cm.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.div(Pm(1).sub(n.toFloat().square()).sqrt())}}}))}}),cy=Nm({asinh_:function(e){var t=bm(e,"x","asinh");return cm.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){var t=Pm(1).add(n.toFloat().square()).sqrt();return e.div(t)}}}))}}),ly=Nm({atan_:function(e){var t=bm(e,"x","atan");return cm.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),hy=Nm({atanh_:function(e){var t=bm(e,"x","atanh");return cm.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.div(Pm(1).sub(n.toFloat().square()))}}}))}}),fy=Nm({ceil_:function(e){var t=bm(e,"x","ceil");return cm.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),dy=Nm({clipByValue_:function(e,t,n){var r=bm(e,"x","clipByValue");return Zp(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")})),cm.runKernelFunc((function(e,a){var i=e.clip(r,t,n);return a([r]),i}),{x:r},(function(e,r){var a=_slicedToArray(r,1)[0];return{x:function(){return e.where(a.greaterEqual(t).logicalAnd(a.lessEqual(n)),Zm(e))}}}),"ClipByValue",{min:t,max:n},[r])}}),py=Nm({cos_:function(e){var t=bm(e,"x","cos");return cm.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},[t])}}),vy=Nm({cosh_:function(e){var t=bm(e,"x","cosh");return cm.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return n.toFloat().sinh().mul(e)}}}))}}),my=Nm({erf_:function(e){var t=bm(e,"x","erf");return Zp("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),cm.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),gy=Nm({exp_:function(e){var t=bm(e,"x","exp");return cm.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mul(t[0])}}}),"Exp",{},[],[!0])}}),yy=Nm({expm1_:function(e){var t=bm(e,"x","expm1");return cm.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.mul(n.exp())}}}))}}),by=Nm({floor_:function(e){var t=bm(e,"x","floor");return cm.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),ky=Nm({log_:function(e){var t=bm(e,"x","log");return cm.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},[t])}}),_y=Nm({log1p_:function(e){var t=bm(e,"x","log1p");return cm.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.div(n.add(1))}}}))}}),wy=Nm({logSigmoid_:function(e){var t=bm(e,"x","logSigmoid");return cm.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),xy=Nm({neg_:function(e){var t=bm(e,"x","neg");return cm.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},[t])}}),Cy=Nm({reciprocal_:function(e){var t=bm(e,"x","reciprocal");return cm.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),Sy=Nm({round_:function(e){var t=bm(e,"x","round");return cm.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),Ty=Nm({rsqrt_:function(e){var t=bm(e,"x","rsqrt");return cm.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},[t])}}),Ey=Nm({sigmoid_:function(e){var t=bm(e,"x","sigmoid");return cm.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return e.mul(n.mul(Pm(1).sub(n)))}}}),"Sigmoid")}}),Ay=Nm({sign_:function(e){var t=bm(e,"x","sign");return cm.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),Iy=Nm({isNaN_:function(e){var t=bm(e,"x","isNaN");return cm.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),Ry=Nm({isInf_:function(e){var t=bm(e,"x","isInf");return cm.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),Ny=Nm({isFinite_:function(e){var t=bm(e,"x","isFinite");return cm.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return Zm(e)}}}))}}),Oy=Nm({sin_:function(e){var t=bm(e,"x","sin");return cm.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},[t])}}),Dy=Nm({sinh_:function(e){var t=bm(e,"x","sinh");return cm.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return n.toFloat().cosh().mul(e)}}}))}}),Fy=Nm({softplus_:function(e){var t=bm(e,"x","softplus");return cm.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),My=Nm({sqrt_:function(e){var t=bm(e,"x","sqrt");return cm.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}),"Sqrt",{})}}),Ly=Nm({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=bm(e,"x","step");return cm.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return Zm(e)}}}))}}),Py=Nm({tan_:function(e){var t=bm(e,"x","tan");return cm.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),zy=Nm({tanh_:function(e){var t=bm(e,"x","tanh");return cm.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Pm(1).sub(n.square()).mul(e)}}}),"Tanh",{},null,[!0])}}),By=Nm({addStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","addStrict"),r=bm(t,"b","addStrict");return $p(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Uy=Nm({atan2_:function(e,t){var n=bm(e,"a","atan2"),r=bm(t,"b","atan2"),a=_slicedToArray(rm(n,r),2);n=a[0],r=a[1];var i=vm(n.shape,r.shape);return cm.runKernelFunc((function(e,t){var a=e.atan2(n,r);return t([n,r]),a}),{$a:n,$b:r},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{$a:function(){var t=ay(r.square(),a.square()),n=e.mul(a.div(t)),o=pm(r.shape,i);return o.length>0&&(n=n.sum(o)),n.reshape(r.shape)},$b:function(){var t=ay(r.square(),a.square()),n=xy(e.mul(r.div(t))),o=pm(a.shape,i);return o.length>0&&(n=n.sum(o)),n.reshape(a.shape)}}}))}}),Wy=Nm({divStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","div"),r=bm(t,"b","div");return $p(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Vy=Nm({floorDiv_:function(e,t){var n=bm(e,"a","floorDiv"),r=bm(t,"b","floorDiv"),a=_slicedToArray(rm(n,r),2);n=a[0],r=a[1];var i=vm(n.shape,r.shape);return cm.runKernelFunc((function(e,t){var a=e.floorDiv(n,r);return t([n,r]),a}),{a:n,b:r},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){var t=e.div(a.toFloat()),n=pm(r.shape,i);return n.length>0?t.sum(n).reshape(r.shape):t},b:function(){var t=e.mul(r.toFloat()),n=pm(a.shape,i);n.length>0&&(t=t.sum(n).reshape(a.shape));var o=a.square();return t.div(o.toFloat()).neg()}}}),"FloorDiv")}}),jy=Nm({maximum_:function(e,t){var n,r=bm(e,"a","maximum"),a=bm(t,"b","maximum");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),vm(r.shape,a.shape),cm.runKernelFunc((function(e,t){var n=e.maximum(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){return e.mul(r.greaterEqual(a).toFloat())},b:function(){return e.mul(r.less(a).toFloat())}}}),"Maximum")}}),Hy=Nm({maximumStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","maximumStrict"),r=bm(t,"b","maximumStrict");return $p(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),qy=Nm({minimum_:function(e,t){var n,r=bm(e,"a","minimum"),a=bm(t,"b","minimum");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],"bool"===r.dtype&&(r=r.toInt(),a=a.toInt()),vm(r.shape,a.shape),cm.runKernelFunc((function(e,t){var n=e.minimum(r,a);return t([r,a]),n}),{a:r,b:a},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){return e.mul(r.lessEqual(a).toFloat())},b:function(){return e.mul(r.greater(a).toFloat())}}}),"Minimum")}}),Gy=Nm({minimumStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","minimumStrict"),r=bm(t,"b","minimumStrict");return $p(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Ky=Nm({mod_:function(e,t){var n=bm(e,"a","mod"),r=bm(t,"b","mod"),a=_slicedToArray(rm(n,r),2);n=a[0],r=a[1];var i=vm(n.shape,r.shape);return cm.runKernelFunc((function(e,t){var a=e.mod(n,r);return t([n,r]),a}),{$a:n,$b:r},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{$a:function(){var t=pm(r.shape,i);return t.length>0?e.sum(t).reshape(r.shape):e},$b:function(){var t=e.mul(r.div(a).floor().neg()),n=pm(a.shape,i);return n.length>0?t.sum(n).reshape(a.shape):t}}}))}}),Xy=Nm({modStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","modStrict"),r=bm(t,"b","modStrict");return $p(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Yy=Nm({mul_:function(e,t){var n=bm(e,"a","mul"),r=bm(t,"b","mul"),a=_slicedToArray(rm(n,r),2);n=a[0],r=a[1];var i=vm(n.shape,r.shape);return cm.runKernelFunc((function(e,t){var a=e.multiply(n,r);return t([n,r]),a}),{a:n,b:r},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){var t=e.mul(a.toFloat()),n=pm(r.shape,i);return n.length>0?t.sum(n).reshape(r.shape):t},b:function(){var t=e.mul(r.toFloat()),n=pm(a.shape,i);return n.length>0?t.sum(n).reshape(a.shape):t}}}),"Mul")}}),Qy=Nm({mulStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","mul"),r=bm(t,"b","mul");return $p(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Zy=Nm({pow_:function(e,t){var n=bm(e,"base","pow"),r=bm(t,"exp","pow"),a=_slicedToArray(rm(n,r),2);n=a[0],r=a[1];var i=vm(n.shape,r.shape);return cm.runKernelFunc((function(e,t){var a=e.pow(n,r);return t([n,r,a]),a}),{a:n,b:r},(function(e,t){var n=_slicedToArray(t,3),r=n[0],a=n[1],o=n[2];return{a:function(){var t=a.toFloat(),n=e.mul(t.mul(r.pow(t.sub(Pm(1))))),o=pm(r.shape,i);return o.length>0&&(n=n.sum(o)),n.reshape(r.shape)},b:function(){var t=r.greater(0),n=r.log().where(t,Zm(r)),s=e.mul(o.mul(n)),u=pm(a.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(a.shape)}}}),"Pow",{},[n,r],[!0])}}),$y=Nm({powStrict_:function(e,t){return Zg("strict variants of ops have been deprecated and will be removed in future"),$p(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Jy=Nm({squaredDifferenceStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","squaredDifferenceStrict"),r=bm(t,"b","squaredDifferenceStrict");return $p(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),eb=Nm({subStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","subStrict"),r=bm(t,"b","subStrict");return $p(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),tb=Nm({div_:function(e,t){var n,r=bm(e,"a","div"),a=bm(t,"b","div");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype?Vy(r,a):cm.runKernelFunc((function(e,t){var n=e.realDivide(r,a);return t([r,a]),n}),{a:r,b:a},null,"Div",{})}}),nb=Nm({square_:function(e){var t=bm(e,"x","square");return cm.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},[t],[])}}),rb={kernelName:"Div",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=vm(r.shape,a.shape);return{a:function(){var t=tb(e,a.toFloat()),n=pm(r.shape,i);return n.length>0?xg(t,n).reshape(r.shape):t},b:function(){var t=Yy(e,r.toFloat()),n=pm(a.shape,i);n.length>0&&(t=ag(xg(t,n),a.shape));var o=nb(a);return xy(tb(t,o.toFloat()))}}}},ab=Nm({sub_:function(e,t){var n,r=bm(e,"a","sub"),a=bm(t,"b","sub");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],cm.runKernelFunc((function(e,t){var n=e.subtract(r,a);return t([r,a]),n}),{a:r,b:a},null,"Sub")}}),ib=Nm({tile_:function(e,t){var n=bm(e,"x","tile",null);return Zp(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")})),cm.runKernelFunc((function(e,r){var a=e.tile(n,t);return r([n]),a}),{x:n},null,"Tile",{reps:t},[n])}}),ob={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=_slicedToArray(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?Pm(1):u,l=pm(o.shape,i.shape),h=[];if(1===o.rank){for(var f=0;f<i.shape.length-1;++f)h.push(i.shape[f]);h.push(1)}var d=ab(i,o),p=Yy(e,c),v=Ty(ay(s,Pm(r))),m=Yy(Yy(Yy(v,v),v),Pm(-.5));return{x:function(){return ag(Yy(Yy(e,1===o.rank?ib(v.as4D(1,1,1,o.shape[0]),h):v),c),i.shape)},mean:function(){var e=Yy(Yy(v,Pm(-1)),p);return 1===o.rank&&(e=xg(e,l)),ag(e,o.shape)},variance:function(){var e=Yy(Yy(m,d),p);return 1===o.rank&&(e=xg(e,l)),ag(e,o.shape)},scale:function(){var t=Yy(d,v),n=Yy(e,t);return 1===o.rank&&(n=xg(n,l)),ag(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=xg(t,l)),ag(t,o.shape)}}}},sb={kernelName:"GreaterEqual",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1];return{a:function(){return Zm(r)},b:function(){return Zm(a)}}}},ub=Nm({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5;return cm.runKernelFunc((function(s){return s.LRNGrad(n,e,t,r,a,i,o)}),{x:e,y:t,dy:n},null,"LRNBackprop",{depthRadius:r,bias:a,alpha:i,beta:o})}}),cb={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return ub(a,i,e,o,s,u,c)}}}},lb=Nm({transpose_:function(e,t){var n=bm(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),Zp(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){Zp(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(t)}))})),n.rank<=1?n.clone():cm.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",{perm:t})}}),hb={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=_slicedToArray(t,2),i=a[0],o=a[1],s=hv(r,i.shape),u=Tm(s,i.rank),c=pg(e,o,i,s,u);return{x:function(){var e=c.x();return null!=u&&(e=lb(e)),e}}}},fb={kernelName:"OneHot",inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Gm(n.shape,"float32")}}}},db=Nm({batchToSpaceND_:function(e,t,n){var r=bm(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));return Zp(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),Zp(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),Zp(r.shape[0]%a==0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)})),cm.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{x:r},null,"BatchToSpaceND",{blockShape:t,crops:n})}}),pb={kernelName:"SpaceToBatchND",gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return db(e,r,a)}}}},vb={kernelName:"SplitV",gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return $m(e,r)}}}},mb={kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Yy(e,Yy(n.toFloat(),2))}}}},gb={kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=Pm(2);return{a:function(){return Yy(e,Yy(i,ab(r,a)))},b:function(){return Yy(e,Yy(i,ab(a,r)))}}}},yb={kernelName:"Sub",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=vm(r.shape,a.shape);return{a:function(){var t=e,n=pm(r.shape,i);return n.length>0&&(t=xg(t,n)),ag(t,r.shape)},b:function(){var t=e,n=pm(a.shape,i);return n.length>0&&(t=xg(t,n)),ag(xy(t),a.shape)}}}},bb=Nm({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=bm(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return cm.runKernelFunc((function(e,a){return a([r]),e.pad(r,t,n)}),{x:r},null,"PadV2",{paddings:t,constantValue:n})}});function kb(e,t,n){Zp(e.rank===t.length,(function(){return"Error in slice".concat(e.rank,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(e.rank,").")})),Zp(e.rank===n.length,(function(){return"Error in slice".concat(e.rank,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(e.rank,").")}));for(var r=function(r){Zp(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice".concat(e.rank,"D: begin[").concat(r,"] + size[").concat(r,"] ")+"(".concat(t[r]+n[r],") would overflow input.shape[").concat(r,"] (").concat(e.shape[r],")")}))},a=0;a<e.rank;++a)r(a)}function _b(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function wb(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function xb(e,t,n,r,a){var i=t[a];(e&1<<a||null==i)&&(i=(n[a]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var o=r[a];return i<0&&(i+=o),i=Gp(0,i,o-1)}function Cb(e,t,n,r,a){var i=t[a],o=n[a]||1;(e&1<<a||null==i)&&(i=o>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[a];return i<0&&(i+=s),i=o>0?Gp(0,i,s):Gp(-1,i,s-1)}function Sb(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Tb(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}for(var Eb,Ab,Ib,Rb=Nm({slice_:function(e,t,n){var r,a,i=bm(e,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(_toConsumableArray(new Array(i.rank-1).fill(0))):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(0)):t.slice()).forEach((function(e){Zp(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(_toConsumableArray(new Array(i.rank-1).fill(-1))):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(Zp(-1===e,(function(){return"Negative size values should be exactly -1 but got "+"".concat(e," for the slice() size at index ").concat(t,".")})),i.shape[t]-r[t])})),kb(i,r,a);var o=i.shape;return cm.runKernelFunc((function(e){return e.slice(i,r,a)}),{x:i},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],o[n]-r[n]-a[n]]);return{x:function(){return bb(e,t)}}}),"Slice",{begin:r,size:a})}}),Nb=Nm({slice1d_:function(e,t,n){var r=bm(e,"x","slice1d");return Zp(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Rb(r,[t],[n])}}),Ob=Nm({slice2d_:function(e,t,n){var r=bm(e,"x","slice2d");return Zp(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Rb(r,t,n)}}),Db=Nm({slice3d_:function(e,t,n){var r=bm(e,"x","slice3d");return Zp(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Rb(r,t,n)}}),Fb=Nm({slice4d_:function(e,t,n){var r=bm(e,"x","slice4d");return Zp(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Rb(r,t,n)}}),Mb=0,Lb=[mm,{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},lg,fg,Sg,Eg,Vg,Hg,Kg,Qg,rb,ob,sb,{kernelName:"Identity",gradFunc:function(e){return{x:function(){return e.toFloat()}}}},cb,fb,{kernelName:"PadV2",inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return e.slice(a,r.shape)}}}},vb,hb,pb,mb,gb,{kernelName:"Tile",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray(t,1)[0],a=n.reps;return{x:function(){var t=Zm(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=ay(t,Rb(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=ay(t,Rb(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=ay(t,Rb(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var f=0;f<a[2];++f)for(var d=0;d<a[3];++d)t=ay(t,Rb(e,[l*r.shape[0],h*r.shape[1],f*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=Em(n.perm);return{x:function(){return lb(e,r)}}}},yb];Mb<Lb.length;Mb++){Ab=void 0,Ab=(Eb=Lb[Mb]).kernelName,Bp.has(Ab)&&console.warn("Overriding the gradient for '".concat(Ab,"'")),Bp.set(Ab,Eb)}Dp().get("IS_BROWSER")&&Dp().setPlatform("browser",new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}())),Dp().get("IS_NODE")&&Dp().setPlatform("node",new(function(){function e(){_classCallCheck(this,e),this.util=n(2),this.textEncoder=new this.util.TextEncoder}return _createClass(e,[{key:"fetch",value:function(e,t){return null!=Dp().global.fetch?Dp().global.fetch(e,t):(null==Ib&&(Ib=n(1)),Ib(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}()));var Pb={float32:4,int32:4,uint16:2,uint8:1,bool:1};function zb(e,t){return Bb.apply(this,arguments)}function Bb(){return(Bb=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.t0=Wb,e.next=6,Promise.all(a);case 6:return e.t1=e.sent,e.t2=(0,e.t0)(e.t1),e.t3=r,e.abrupt("return",{data:e.t2,specs:e.t3});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ub(e,t){var n,r={},a=0,i=_createForOfIteratorHelper(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=o.name,u=o.dtype,c=o.shape,l=tv(c),h=void 0;if("quantization"in o){var f=o.quantization;if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Weight ".concat(o.name," has unknown ")+"quantization dtype ".concat(f.dtype,". ")+"Supported quantization dtypes are: 'uint8' and 'uint16'.");var d=Pb[f.dtype],p=e.slice(a,a+l*d),v="uint8"===f.dtype?new Uint8Array(p):new Uint16Array(p);if("float32"===u){h=new Float32Array(v.length);for(var m=0;m<v.length;m++)h[m]=v[m]*f.scale+f.min}else{if("int32"!==u)throw new Error("Unsupported dtype in weight '".concat(s,"': ").concat(u));h=new Int32Array(v.length);for(var g=0;g<v.length;g++)h[g]=Math.round(v[g]*f.scale+f.min)}a+=l*d}else if("string"===u){var y=tv(o.shape);h=[];for(var b=0;b<y;b++){var k=new Uint32Array(e.slice(a,a+4))[0];a+=4;var _=new Uint8Array(e.slice(a,a+k));h.push(_),a+=k}}else{var w=Pb[u],x=e.slice(a,a+l*w);if("float32"===u)h=new Float32Array(x);else if("int32"===u)h=new Int32Array(x);else{if("bool"!==u)throw new Error("Unsupported dtype in weight '".concat(s,"': ").concat(u));h=new Uint8Array(x)}a+=l*w}r[s]=Mm(h,c,u)}}catch(C){i.e(C)}finally{i.f()}return r}function Wb(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var Vb="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function jb(e){return Vb?Buffer.byteLength(e):new Blob([e]).size}function Hb(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function qb(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Gb(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:jb(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:jb(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var Kb=function(){function e(){_classCallCheck(this,e),this.saveRouters=[],this.loadRouters=[]}return _createClass(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Xb=function(e){return Kb.registerSaveRouter(e)},Yb=function(e){return Kb.registerLoadRouter(e)},Qb=function(e){return Kb.getSaveHandlers(e)},Zb=function(e,t){return Kb.getLoadHandlers(e,t)},$b=function(){function e(){_classCallCheck(this,e),this.managers={}}return _createClass(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){Zp(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),Zp(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();Zp(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();function Jb(e){if(-1===e.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat($b.getSchemes().join(",")));return{scheme:e.split("://")[0],path:e.split("://")[1]}}function ek(e,t){return tk.apply(this,arguments)}function tk(){return(tk=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],Zp(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),Zp((a=Kb.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),Zp(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],Zp((o=Kb.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),Zp(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],u=Jb(t).scheme,c=Jb(t).path,l=u===Jb(t).scheme,e.next=12,i.load();case 12:if(h=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,$b.getManager(u).removeModel(c);case 17:return e.next=19,s.save(h);case 19:if(f=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,$b.getManager(u).removeModel(c);case 24:return e.abrupt("return",f.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nk(){return rk.apply(this,arguments)}function rk(){return(rk=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=$b.getSchemes(),n={},r=_createForOfIteratorHelper(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,$b.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+"://"+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})))).apply(this,arguments)}function ak(e){return ik.apply(this,arguments)}function ik(){return(ik=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Jb(t),e.abrupt("return",$b.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ok(e,t){return sk.apply(this,arguments)}function sk(){return(sk=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ek(t,n,!1));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function uk(e,t){return ck.apply(this,arguments)}function ck(){return(ck=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ek(t,n,!0));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lk(){if(!Dp().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function hk(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var fk=function(){function e(t){if(_classCallCheck(this,e),this.indexedDB=lk(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}var t,n;return _createClass(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return hk(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction("models_store","readonly"),s=o.objectStore("models_store").get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=Gb(t),l=i.transaction("model_info_store","readwrite"),h=l.objectStore("model_info_store"),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore("model_info_store")).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();fk.URL_SCHEME="indexeddb://";var dk=function(e){return Dp().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(fk.URL_SCHEME)?(t=e.slice(fk.URL_SCHEME.length),new fk(t)):null;var t};Kb.registerSaveRouter(dk),Kb.registerLoadRouter(dk);var pk=function(){function e(){_classCallCheck(this,e),this.indexedDB=lk()}var t,n;return _createClass(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return hk(r)},r.onsuccess=function(){var t=r.result,a=t.transaction("model_info_store","readonly"),i=a.objectStore("model_info_store").getAll();i.onsuccess=function(){var t,n={},r=_createForOfIteratorHelper(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=(n=t).startsWith(fk.URL_SCHEME)?n.slice(fk.URL_SCHEME.length):n,new Promise((function(e,n){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return hk(a)},a.onsuccess=function(){var r,i=a.result,o=i.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),n(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(r=i.transaction("models_store","readwrite")).objectStore("models_store").delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return n(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),n(u.error)}},u.onerror=function(e){return i.close(),n(u.error)},o.oncomplete=function(){null==r?i.close():r.oncomplete=function(){return i.close()}}},a.onerror=function(e){return n(a.error)}}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();if(Dp().getBool("IS_BROWSER"))try{$b.registerManager(fk.URL_SCHEME,new pk)}catch(az){}var vk="tensorflowjs_models",mk="info",gk="model_topology",yk="weight_specs",bk="weight_data",kk="model_metadata";function _k(e){return{info:[vk,e,mk].join("/"),topology:[vk,e,gk].join("/"),weightSpecs:[vk,e,yk].join("/"),weightData:[vk,e,bk].join("/"),modelMetadata:[vk,e,kk].join("/")}}function wk(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join("/")}var xk=function(){function e(t){if(_classCallCheck(this,e),!Dp().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=_k(this.modelPath)}var t,n;return _createClass(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Gb(t),e.prev=3,e.abrupt("return",(this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(Vb)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),{modelArtifactsInfo:a}));case 7:throw e.prev=7,e.t0=e.catch(3),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 10:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,n.userDefinedMetadata=o.userDefinedMetadata),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=function(e){if(Vb){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(s),n));case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();xk.URL_SCHEME="localstorage://";var Ck=function(e){return Dp().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(xk.URL_SCHEME)?(t=e.slice(xk.URL_SCHEME.length),new xk(t)):null;var t};Kb.registerSaveRouter(Ck),Kb.registerLoadRouter(Ck);var Sk=function(){function e(){_classCallCheck(this,e),Zp(Dp().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Zp("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}var t,n;return _createClass(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=vk+"/",r="/"+mk,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(t[wk(i)]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=_k(t=(n=t).startsWith(xk.URL_SCHEME)?n.slice(xk.URL_SCHEME.length):n),null!=this.LS.getItem(r.info)){e.next=3;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 3:return a=JSON.parse(this.LS.getItem(r.info)),e.abrupt("return",(this.LS.removeItem(r.info),this.LS.removeItem(r.topology),this.LS.removeItem(r.weightSpecs),this.LS.removeItem(r.weightData),a));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();if(Dp().getBool("IS_BROWSER"))try{$b.registerManager(xk.URL_SCHEME,new Sk)}catch(az){}function Tk(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Ek=function(){function e(t){if(_classCallCheck(this,e),!Dp().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}var t;return _createClass(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=r,e.next=10,Tk((function(){return a.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=n,e.next=16,Tk((function(){return i.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:Gb(t)});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();Ek.URL_SCHEME="downloads://";var Ak=function(){function e(t){if(_classCallCheck(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.files=t}var t;return _createClass(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.files[0],n=this.files.slice(1),e.abrupt("return",new Promise((function(e,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===n.length&&e({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=r.checkManifestAndWeightFiles(u,n)}catch(az){return void a(az)}var l=[],h=[],f=[];u.forEach((function(e){e.paths.forEach((function(e){h.push(e),f.push(null)})),l.push.apply(l,_toConsumableArray(e.weights))})),u.forEach((function(t){t.paths.forEach((function(t){var n=new FileReader;n.onload=function(n){var r=n.target.result,a=h.indexOf(t);f[a]=r,-1===f.indexOf(null)&&e({modelTopology:s,weightSpecs:l,weightData:Hb(f),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},n.onerror=function(e){return a("Failed to weights data from file of path '".concat(t,"'."))},n.readAsArrayBuffer(c[t])}))}))}else a(new Error("weightManifest field is missing from file ".concat(t.name)))}else a(new Error("modelTopology field is missing from file ".concat(t.name)))},i.onerror=function(e){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"checkManifestAndWeightFiles",value:function(e,t){var n,r=[],a=t.map((function(e){return qb(e.name)})),i={},o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){n.value.paths.forEach((function(e){var n=qb(e);if(-1!==r.indexOf(n))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(n,"'"));if(r.push(n),-1===a.indexOf(n))throw new Error("Weight file with basename '".concat(n,"' is not provided."));i[e]=t[a.indexOf(n)]}))}}catch(az){o.e(az)}finally{o.f()}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(t.length,")."));return i}}]),e}();function Ik(e){return new Ak(e)}function Rk(e,t,n,r){!function(e){Zp(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){Zp(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),Zp(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),Zp(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Nk(e,t){return Ok.apply(this,arguments)}function Ok(){return(Ok=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Dp().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),null!=n.onProgress){e.next=9;break}return e.next=6,Promise.all(a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,Rk(a,n.onProgress,0,.5);case 11:e.t0=e.sent;case 12:if(i=e.t0.map((function(e){return e.arrayBuffer()})),null!=n.onProgress){e.next=19;break}return e.next=16,Promise.all(i);case 16:e.t1=e.sent,e.next=22;break;case 19:return e.next=21,Rk(i,n.onProgress,.5,1);case 21:e.t1=e.sent;case 22:return e.abrupt("return",e.t1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dk(e){return Fk.apply(this,arguments)}function Fk(){return(Fk=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",Mk((function(e){return Nk(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mk(e){return function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){var r,a,i,o,s,u,c,l,h,f,d,p,v=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:"",a=v.length>2?v[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r=Pb["quantization"in e?e.quantization.dtype:e.dtype]*tv(e.shape),c=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:r})};null!=a?a.forEach((function(t,n){t===e.name&&(c(),s[n]=!0)})):c(),u.push(e.name),n+=r}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),h=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;h.push(t)}))})),t.next=10,e(h);case 10:return f=t.sent,d={},p=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=f[p+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(f[p+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=Ub(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),p+=t})),d));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}Kb.registerSaveRouter((function(e){return Dp().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ek.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Ek(e)}(e.slice(Ek.URL_SCHEME.length)):null}));var Lk=function(){function e(t,n){if(_classCallCheck(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,null!=n.fetchFunc?(Zp("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Dp().platform.fetch,Zp(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&Zp(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}var t,n,r;return _createClass(e,[{key:"save",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=6,this.fetch(this.path,n);case 6:if(!(r=e.sent).ok){e.next=9;break}return e.abrupt("return",{modelArtifactsInfo:Gb(t),responses:[r]});case 9:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(r.status,"."));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.userDefinedMetadata,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 18:if(null==i){e.next=25;break}return e.next=21,this.loadWeights(i);case 21:f=e.sent,d=_slicedToArray(f,2),l=d[0],h=d[1];case 25:return e.abrupt("return",{modelTopology:a,weightSpecs:l,weightData:h,userDefinedMetadata:c,generatedBy:o,convertedBy:s,format:u});case 26:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return n.apply(this,arguments)})},{key:"loadWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c,l,h,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,p=void 0,v=void 0,p=(d=n).lastIndexOf("/"),v=d.lastIndexOf("?"),r=[d.substring(0,p)+"/",v>p?d.substring(v):""],a=_slicedToArray(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=_createForOfIteratorHelper(t);try{for(c.s();!(l=c.n()).done;)h=l.value,u.push.apply(u,_toConsumableArray(h.weights))}catch(az){c.e(az)}finally{c.f()}return f=[],t.forEach((function(e){e.paths.forEach((function(e){f.push(s+e+o)}))})),e.t0=u,e.t1=Hb,e.next=9,Nk(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 9:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.abrupt("return",[e.t0,e.t3]);case 12:case"end":return e.stop()}var d,p,v}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function Pk(e){return null!=e.match(Lk.URL_SCHEME_REGEX)}Lk.URL_SCHEME_REGEX=/^https?:\/\//;var zk=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Pk(e)})):Pk(e))?Bk(e,t):null};function Bk(e,t){return new Lk(e,t)}function Uk(e,t){return Bk(e,t)}Kb.registerSaveRouter(zk),Kb.registerLoadRouter(zk);var Wk=function(){function e(t){_classCallCheck(this,e),this.modelArtifacts=t}var t;return _createClass(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelArtifacts);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Vk=function(){function e(t){_classCallCheck(this,e),this.saveHandler=t}var t;return _createClass(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveHandler(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function jk(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Wk(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Wk({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Wk({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Hk(e){return new Vk(e)}var qk,Gk=Nm({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a=bm(e,"indices","oneHot","int32"),i=[].concat(_toConsumableArray(a.shape),[t]);return a=a.flatten(),cm.runKernelFunc((function(e,o){return o([a]),ag(e.oneHot(a,t,n,r),i)}),{indices:a},null,"OneHot",{depth:t,onValue:n,offValue:r})}});function Kk(e,t){return Xk.apply(this,arguments)}function Xk(){return(Xk=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,k,_,w,x,C,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=bm(t,"img","toPixels"),t instanceof Kv||(r=(a=r).toInt(),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=_slicedToArray(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=7;break}throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(c));case 7:return e.next=9,r.data();case 9:return l=e.sent,h=r.min(),f=r.max(),e.next=14,Promise.all([h.data(),f.data()]);case 14:if(d=e.sent,p=d[0][0],v=d[1][0],h.dispose(),f.dispose(),"float32"!==r.dtype){e.next=22;break}if(!(p<0||v>1)){e.next=20;break}throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but got range [".concat(p," - ").concat(v,"]."));case 20:e.next=26;break;case 22:if("int32"===r.dtype){e.next=24;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.");case 24:if(!(p<0||v>255)){e.next=26;break}throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but got range [".concat(p," - ").concat(v,"]."));case 26:for(m="float32"===r.dtype?255:1,g=new Uint8ClampedArray(u*s*4),y=0;y<s*u;++y)b=void 0,k=void 0,_=void 0,w=void 0,1===c?(b=l[y]*m,k=l[y]*m,_=l[y]*m,w=255):3===c?(b=l[3*y]*m,k=l[3*y+1]*m,_=l[3*y+2]*m,w=255):4===c&&(b=l[4*y]*m,k=l[4*y+1]*m,_=l[4*y+2]*m,w=l[4*y+3]*m),g[(x=4*y)+0]=Math.round(b),g[x+1]=Math.round(k),g[x+2]=Math.round(_),g[x+3]=Math.round(w);return null!=n&&(n.width=u,n.height=s,C=n.getContext("2d"),S=new ImageData(g,u,s),C.putImageData(S,0,0)),e.abrupt("return",(r!==t&&r.dispose(),g));case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Nm({confusionMatrix_:function(e,t,n){var r=bm(e,"labels","confusionMatrix"),a=bm(t,"predictions","confusionMatrix");Zp(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(n)})),Zp(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),Zp(1===a.rank,(function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)})),Zp(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: "+"".concat(r.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."})),Zp(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+"".concat(n)}));var i=Gk(r.asType("int32"),n),o=Gk(a.asType("int32"),n);return i.transpose().matMul(o).asType("int32")}});var Yk=Nm({fromPixels_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));o=!0}if(a){var s=2;if(a&&e.readyState<s)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Up("FromPixels",cm.backendName))return cm.runKernel("FromPixels",{pixels:e},{numChannels:t});var u,c,l=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],h=_slicedToArray(l,2),f=h[0],d=h[1];if(o?u=e.getContext("2d").getImageData(0,0,f,d).data:r||n?u=e.data:(i||a)&&(null==qk&&(qk=document.createElement("canvas").getContext("2d")),qk.canvas.width=f,qk.canvas.height=d,qk.drawImage(e,0,0,f,d),u=qk.getImageData(0,0,f,d).data),4===t)c=new Int32Array(u);else{var p=f*d;c=new Int32Array(p*t);for(var v=0;v<p;v++)for(var m=0;m<t;++m)c[v*t+m]=u[4*v+m]}return Um(c,[d,f,t],"int32")}});function Qk(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[t.rank-1]," vs. ").concat(e.rank));if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var o=e.shape,s=n.slice();s.pop();for(var u=1,c=r;c<e.rank;++c)u*=o[c],s.push(o[c]);var l=[].concat(_toConsumableArray(Ev(e.shape).map((function(e){return e/u}))),[1]).slice(0,r);return[s,a,u,l]}function Zk(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function $k(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Zk(n,t,e)}function Jk(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:tv(t.shape)/u,sliceSize:o,strides:[].concat(_toConsumableArray(Ev(n.slice(0,a))),[1]),outputSize:tv(n)}}var e_=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),t_=function(){function e(){_classCallCheck(this,e),this.classNameMap={}}return _createClass(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function n_(e){Zp(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),Zp("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),Zp(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),t_.register(e)}var r_=Nm({addN_:function(e){Zp(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),Zp(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length)}));var t=e.map((function(e,t){return bm(e,"tensors".concat(t),"addN")})),n=t[0];return t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!rv(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),cm.runKernelFunc((function(e,n){var r=e.addN(t);return n(t),r}),t,null,"AddN")}});function a_(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}var i_=Nm({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=bm(e,"x","batchNorm"),c=bm(t,"mean","batchNorm"),l=bm(n,"variance","batchNorm");null!=a&&(o=bm(a,"scale","batchNorm")),null!=r&&(s=bm(r,"offset","batchNorm")),Zp(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Zp(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Zp(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h=function(e){return 0===e.rank||1===e.rank?e.as4D(1,1,1,e.size):2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}(u),f=cm.runKernelFunc((function(e,t){return t([h,c,l,o]),e.batchNorm(h,a_(c),a_(l),a_(s),a_(o),i)}),{x:h,scale:o,offset:s,mean:c,variance:l},null,"FusedBatchNorm",{varianceEpsilon:i});return ag(f,u.shape)}}),o_=Nm({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=bm(e,"x","batchNorm"),c=bm(t,"mean","batchNorm"),l=bm(n,"variance","batchNorm");return null!=a&&(o=bm(a,"scale","batchNorm")),null!=r&&(s=bm(r,"offset","batchNorm")),Zp(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),Zp(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),Zp(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&Zp(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&Zp(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),i_(u,c,l,s,o,i)}}),s_=Nm({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=bm(e,"x","batchNorm"),c=bm(t,"mean","batchNorm"),l=bm(n,"variance","batchNorm");return null!=a&&(o=bm(a,"scale","batchNorm")),null!=r&&(s=bm(r,"offset","batchNorm")),Zp(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),Zp(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),Zp(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&Zp(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&Zp(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),i_(u,c,l,s,o,i)}}),u_=Nm({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=bm(e,"x","batchNorm"),c=bm(t,"mean","batchNorm"),l=bm(n,"variance","batchNorm");return null!=a&&(o=bm(a,"scale","batchNorm")),null!=r&&(s=bm(r,"offset","batchNorm")),Zp(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),Zp(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),Zp(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&Zp(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&Zp(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),i_(u,c,l,s,o,i)}}),c_=Nm({clone_:function(e){var t=bm(e,"x","clone",null);return cm.runKernelFunc((function(){return cm.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,"Identity")}}),l_=Nm({broadcastTo_:function(e,t){var n=bm(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=ag(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));return 0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length?c_(n):cm.runKernelFunc((function(e){return e.tile(n,o)}),{x:n},null,"BroadcastTo",{shape:t,inputShape:i})}}),h_=Nm({concat1d_:function(e){return $m(e,0)}}),f_=Nm({concat2d_:function(e,t){return $m(e,t)}}),d_=Nm({concat3d_:function(e,t){return $m(e,t)}}),p_=Nm({concat4d_:function(e,t){return $m(e,t)}}),v_=Nm({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=bm(e,"x","conv1d"),u=bm(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=ag(s,[1,s.shape[0],s.shape[1]])),Zp(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),Zp(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),null!=o&&Zp(av(r),(function(){return"Error in conv1d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),Zp(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),Zp(zg(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),Zp("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=ag(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=ag(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=jg(f,h,[1,n],r,"NHWC",[1,i],o);return ag(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}}),m_=Nm({conv2dTranspose_:function(e,t,n,r,a,i){var o=bm(e,"x","conv2dTranspose"),s=bm(t,"filter","conv2dTranspose");return Wg(n,o,s,r,a,"NHWC",i)}}),g_=Nm({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=bm(e,"x","conv3d"),s=bm(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=ag(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Zp(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),Zp(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),Zp(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),Zp(zg(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),Zp("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l=cm.runKernelFunc((function(e,t){var a=Ng(u.shape,s.shape,n,i,r),o=e.conv3d(u,s,a);return t([u,s]),o}),{x:u,filter:s},null,"Conv3D",{strides:n,pad:r,dataFormat:a,dilations:i});return c?l.as4D(l.shape[1],l.shape[2],l.shape[3],l.shape[4]):l}}),y_=Nm({conv3dTranspose_:function(e,t,n,r,a){var i=bm(e,"x","conv3dTranspose"),o=bm(t,"filter","conv3dTranspose");return Gg(n,i,o,r,a)}}),b_=Nm({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=bm(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return Zp(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),Zp(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),Zp(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)})),cm.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{x:r},null,"DepthToSpace",{blockSize:t,dataFormat:n})}}),k_=Nm({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=bm(e,"x","depthwiseConv2d"),u=bm(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=ag(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Zp(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),Zp(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),Zp(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(c.shape[3],") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),null!=o&&Zp(av(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h=cm.runKernelFunc((function(e,t){null==i&&(i=[1,1]),Zp(zg(n,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var a=Rg(c.shape,u.shape,n,i,r,o,!0),s=e.depthwiseConv2D(c,u,a);return t([c,u]),s}),{x:c,filter:u},null,"DepthwiseConv2dNative",{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?ag(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),__=Nm({diag_:function(e){var t=bm(e,"x","diag").flatten();return cm.runKernelFunc((function(n){var r=n.diag(t),a=[].concat(_toConsumableArray(e.shape),_toConsumableArray(e.shape));return ag(r,a)}),{x:t},null,"Diag")}});function w_(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Jm(e,"int32"),i=Jm([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]);i.values.set(s,o*e.length)}return i.toTensor()}var x_=Nm({logicalAnd_:function(e,t){var n=bm(e,"a","logicalAnd","bool"),r=bm(t,"b","logicalAnd","bool");return vm(n.shape,r.shape),cm.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),C_=Nm({logicalNot_:function(e){var t=bm(e,"x","logicalNot","bool");return cm.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),S_=Nm({logicalOr_:function(e,t){var n=bm(e,"a","logicalOr","bool"),r=bm(t,"b","logicalOr","bool");return vm(n.shape,r.shape),cm.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),T_=Nm({logicalXor_:function(e,t){var n=bm(e,"a","logicalXor","bool"),r=bm(t,"b","logicalXor","bool");return vm(n.shape,r.shape),S_(e,t).logicalAnd(x_(e,t).logicalNot())}}),E_=Nm({where_:function(e,t,n){var r=bm(t,"a","where"),a=bm(n,"b","where"),i=bm(e,"condition","where","bool");return $p(r.shape,a.shape,"Error in where: "),1===i.rank?Zp(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):$p(i.shape,a.shape,"Error in where: "),cm.runKernelFunc((function(e,t){var n=e.select(i,r,a);return t([i]),n}),{$condition:i,$a:r,$b:a},(function(e,t){var n=_slicedToArray(t,1)[0];return{$condition:function(){return Zm(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),A_=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=bm(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=w_(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I_=Nm({divNoNan_:function(e,t){var n=bm(e,"a","div"),r=bm(t,"b","div"),a=_slicedToArray(rm(n,r),2);n=a[0],r=a[1];var i=tb(n,r),o=Zm(i),s=r.equal(o);return E_(s,o,i)}}),R_=Nm({dot_:function(e,t){var n=bm(e,"t1","dot"),r=bm(t,"t2","dot");Zp(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(Zp(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=ag(n,[1,-1]),s=ag(r,[-1,1]),u=cg(o,s);return ag(u,[])}if(1===n.rank&&2===r.rank){var c=ag(n,[1,-1]),l=ag(r,[r.shape[0],r.shape[1]]),h=cg(c,l);return ag(h,[h.size])}if(2===n.rank&&1===r.rank){var f=ag(r,[-1,1]),d=cg(n,f);return ag(d,[d.size])}var p=ag(r,[r.shape[0],r.shape[1]]);return cg(n,p)}}),N_=Nm({equal_:function(e,t){var n,r=bm(e,"a","equal"),a=bm(t,"b","equal");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e){return e.equal(r,a)}),{a:r,b:a},null,"Equal")}}),O_=Nm({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Jm([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=a.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return ib(rg(s,0),[n[0],1,1]);if(2===n.length)return ib(rg(rg(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ib(rg(rg(rg(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}}),D_=Nm({greater_:function(e,t){var n,r=bm(e,"a","greater"),a=bm(t,"b","greater");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e){return e.greater(r,a)}),{a:r,b:a},null,"Greater")}}),F_=Nm({greaterEqual_:function(e,t){var n,r=bm(e,"a","greaterEqual"),a=bm(t,"b","greaterEqual");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,"GreaterEqual")}}),M_=Nm({less_:function(e,t){var n,r=bm(e,"a","less"),a=bm(t,"b","less");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e){return e.less(r,a)}),{a:r,b:a},null,"Less")}}),L_=Nm({lessEqual_:function(e,t){var n,r=bm(e,"a","lessEqual"),a=bm(t,"b","lessEqual");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,"LessEqual")}}),P_=Nm({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=bm(e,"x","localResponseNormalization");Zp(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),Zp(av(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=ag(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u=cm.runKernelFunc((function(e,i){var s=e.localResponseNormalization4D(o,t,n,r,a);return i([o,s]),s}),{x:o},null,"LRN",{depthRadius:t,bias:n,alpha:r,beta:a});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),z_=Nm({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"x","max"),a=cm.runKernelFunc((function(e,n){var a=hv(t,r.shape),i=Tm(a,r.rank),o=r;null!=i&&(o=lb(r,i),a=Am(a.length,o.rank));var s=e.max(o,a);return n([r,s]),null!=i&&e.disposeData(o.dataId),s}),{x:r},null,"Max",{reductionIndices:t,keepDims:n});return n?ag(a,Cm(a.shape,hv(t,r.shape))):a}}),B_=Nm({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=bm(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s=1===o?a.as2D(1,-1):a,u=cm.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?u.as1D():u}}),U_=Nm({notEqual_:function(e,t){var n,r=bm(e,"a","notEqual"),a=bm(t,"b","notEqual");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e){return e.notEqual(r,a)}),{a:r,b:a},null,"NotEqual")}}),W_=Nm({outerProduct_:function(e,t){var n=bm(e,"v1","outerProduct"),r=bm(t,"v2","outerProduct");Zp(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=ag(n,[-1,1]),i=ag(r,[1,-1]);return cg(a,i)}}),V_=Nm({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Zp(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),bb(e,[t],n)}}),j_=Nm({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Zp(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),bb(e,t,n)}}),H_=Nm({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Zp(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),bb(e,t,n)}}),q_=Nm({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Zp(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),bb(e,t,n)}}),G_=Nm({rand_:function(e,t,n){var r=tv(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return cm.makeTensor(a,e,n)}}),K_=n("YSVl"),X_=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=K_.alea(o.toString())}return _createClass(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Y_=function(){function e(t,n,r,a){_classCallCheck(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=K_.alea(i.toString()),this.randn=new X_(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return _createClass(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i*=1/this.beta*this.d,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Q_=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(_classCallCheck(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=K_.alea(i)}return _createClass(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}(),Z_=Nm({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Y_(t,n,r,a),o=Jm(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),$_=Nm({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new X_(t,n,r,!1,a),o=Jm(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),J_=Nm({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=Jm(e,r),o=new Q_(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),ew=Nm({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=bm(e,"x","separableConv2d"),u=bm(t,"depthwiseFilter","separableConv2d"),c=bm(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Zp(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),Zp(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),Zp(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),Zp(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),Zp(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],d=u.shape[3];Zp(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(f*d,", ")+"but got ".concat(c.shape[2],".")}));var p=k_(l,u,r,a,o,i),v=jg(p,c,1,"valid",o);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),tw=Nm({squaredDifference_:function(e,t){var n,r=bm(e,"a","squaredDifference"),a=bm(t,"b","squaredDifference");return n=_slicedToArray(rm(r,a),2),r=n[0],a=n[1],vm(r.shape,a.shape),cm.runKernelFunc((function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n}),{a:r,b:a},null,"SquaredDifference",{})}}),nw=Nm({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new X_(t,n,r,!0,a),o=Jm(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),rw=30;function aw(e){return e<=rw?e:Tv(e,Math.floor(Math.sqrt(e)))}function iw(e,t){var n,r=!1;for(e<=rw?(n=e,r=!0):n=Tv(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Tv(e,n+1);return n}function ow(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)r.push(i!==t?e[i]:n);return r}function sw(e,t,n){for(var r=e.shape[n],a=[],i=1,o=1,s=0;s<n;s++)a.push(e.shape[s]),i*=e.shape[s];for(var u=0;u<t.rank;u++)a.push(t.shape[u]);for(var c=n+1;c<e.rank;c++)a.push(e.shape[c]),o*=e.shape[c];return{batchSize:i,sliceSize:o,dimSize:r,outputShape:a}}function uw(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function cw(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var lw=Nm({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=bm(e,"x","gather"),a=bm(t,"indices","gather","int32");n=hv(n,r.shape)[0];var i=sw(r,a,n);return cm.runKernelFunc((function(e,t){var i=e.gather(r,a.flatten(),n);return t([a]),i}),{x:r,indices:a},(function(e,t){var a=_slicedToArray(t,1)[0];return{x:function(){var t=r.shape,i=a.size,o=t.slice(0,n),s=o.length,u=t.slice(n,t.length).slice(1),c=u.length,l=uw(0,s),h=uw(s+1,s+1+c),f=cw([o,[i],u]),d=e.reshape(f),p=a.reshape([i]),v=cw([[s],l,h]),m=d.transpose(v),g=hw(m,p,r.shape[n]),y=Em(v);return g=g.transpose(y)},indices:function(){return a}}}),"Gather",{axis:n}).reshape(i.outputShape)}}),hw=Nm({unsortedSegmentSum_:function(e,t,n){var r=bm(e,"x","unsortedSegmentSum"),a=bm(t,"segmentIds","unsortedSegmentSum","int32");return Zp(av(n),(function(){return"numSegments must be of dtype int"})),cm.runKernelFunc((function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i}),{$x:r},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return function(e,t){for(var n=jy(t,Zm(t)),r=lw(e,n),a=F_(t,Pm(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=rg(a,o+1);a=x_(a,qm(r.shape,"bool"));var s=Zm(r);return E_(a,r,s)}(e,n)}}}))}}),fw=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=bm(t,"tensor","boolMask"),i=bm(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,Zp(s>0,(function(){return"mask cannot be scalar"})),$p(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return h=u.slice(0,o).concat([c],u.slice(o+s)),f=a.reshape(h),d=i.reshape([-1]),e.next=9,A_(d);case 9:return p=e.sent,v=p.squeeze([1]),m=lw(f,v,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),v.dispose(),f.dispose(),d.dispose(),p.dispose(),m));case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),dw=Nm({reverse_:function(e,t){var n=bm(e,"x","reverse");if(0===n.rank)return n.clone();var r=hv(t,n.shape);return cm.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),pw=Nm({reverse1d_:function(e){var t=bm(e,"x","reverse");return Zp(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),dw(t,0)}}),vw=Nm({reverse2d_:function(e,t){var n=bm(e,"x","reverse");return Zp(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),dw(n,t)}}),mw=Nm({reverse3d_:function(e,t){var n=bm(e,"x","reverse");return Zp(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),dw(n,t)}}),gw=Nm({reverse4d_:function(e,t){var n=bm(e,"x","reverse");return Zp(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),dw(n,t)}});function yw(e,t,n,r,a,i){var o=bm(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),null==r&&(r=[1,1]),Zp(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")})),Zp(zg(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(r,"'")})),null!=i&&Zp(av(a),(function(){return"Error in maxPool: pad must be an integer when using, "+"dimRoundingMode ".concat(i," but got pad ").concat(a,".")}));var c=Ag(s.shape,t,n,r,a,i);if(1===c.filterWidth&&1===c.filterHeight&&rv(c.inShape,c.outShape))return o.clone();var l=cm.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,i){var o=_slicedToArray(i,2),s=o[0],u=o[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var u=bm(e,"dy","maxPoolBackprop"),c=bm(t,"input","maxPoolBackprop"),l=bm(n,"output","maxPoolBackprop");Zp(c.rank===u.rank,(function(){return"Rank of input (".concat(c.rank,") does not match rank of dy ")+"(".concat(u.rank,")")})),null==i&&(i=[1,1]),Zp(zg(a,i),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(i,"'")})),Zp(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),Zp(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+"".concat(c.rank,".")}));var h=Ag(c.shape,r,a,i,o,void 0);return cm.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,h)}),{$dy:u,$input:c})}(e,s,u,t,n,r,a)}}}),"MaxPool",c,[s]);return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function bw(e,t,n,r,a,i){var o=bm(e,"x","avgPool","float32");null==r&&(r=[1,1]),Zp(zg(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(r,"'")}));var s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Zp(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")})),null!=i&&Zp(av(a),(function(){return"Error in avgPool: pad must be an integer when using, "+"dimRoundingMode ".concat(i," but got pad ").concat(a,".")}));var c=Ag(s.shape,t,n,r,a,i);if(1===c.filterWidth&&1===c.filterHeight&&rv(c.inShape,c.outShape))return o.clone();var l=cm.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,a,i){var o=bm(e,"dy","avgPoolBackprop"),s=bm(t,"input","avgPoolBackprop");Zp(s.rank===o.rank,(function(){return"Rank of input (".concat(s.rank,") does not match rank of dy (").concat(o.rank,")")})),null==a&&(a=[1,1]),Zp(zg(r,a),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(a,"'")}));var u=s,c=o,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Zp(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+"".concat(c.rank,".")})),Zp(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+"".concat(u.rank,".")}));var h=Ag(u.shape,n,r,a,i),f=cm.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,h)}),{dy4D:c,input4D:u});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}(e,s,t,n,r,a)}}}),"AvgPool",c);return l=l.cast(o.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var kw=Nm({maxPool_:function(e,t,n,r,a){return yw(e,t,n,1,r,a)}}),_w=Nm({avgPool_:function(e,t,n,r,a){return bw(e,t,n,1,r,a)}}),ww=Nm({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=bm(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2])),Zp(zg(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=Ag(s.shape,t,i,a,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var f=1===h[0]&&1===h[1],d=_slicedToArray(function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],h,c),2),p=d[0],v=d[1],m=f?r:"valid",g=f?s:hg(s,h,p),y=("avg"===n?function(){return bw(g,t,i,1,m)}:function(){return yw(g,t,i,1,m)})(),b=f?y:db(y,h,v);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),xw=Nm({maxPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0,s=bm(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),Zp(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),Zp("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Zp(zg(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&Zp(av(r),(function(){return"Error in maxPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l=Ig(u.shape,t,n,o,r,a,i),h=cm.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,i){var s=_slicedToArray(i,2),u=s[0],c=s[1];return{x:function(){return function(e,t,n,r,a,i,o,s){var u=bm(e,"dy","maxPool3dBackprop"),c=bm(t,"input","maxPool3dBackprop"),l=bm(n,"output","maxPool3dBackprop"),h=u,f=c,d=l,p=!1;4===c.rank&&(p=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),Zp(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+"".concat(h.rank,".")})),Zp(5===f.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+"".concat(f.rank,".")})),Zp(5===d.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+"".concat(d.rank,".")})),null==i&&(i=[1,1,1]),Zp(zg(a,i),(function(){return"Error in maxPool3dBackprop: Either strides or dilations "+"must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&Zp(av(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when "+"using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var v=Ig(f.shape,r,a,i,o,s),m=cm.runKernelFunc((function(e){return e.maxPool3dBackprop(h,f,d,v)}),{dy5D:h,input5D:f});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,u,c,t,n,o,r,a)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Cw=Nm({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0,s=bm(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==o&&(o=[1,1,1]),Zp(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),Zp("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),Zp(zg(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&Zp(av(r),(function(){return"Error in avgPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l=Ig(u.shape,t,n,o,r,a,i),h=cm.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,a,i,o){var s=bm(e,"dy","avgPool3dBackprop"),u=bm(t,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),Zp(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+"".concat(c.rank,".")})),Zp(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+"".concat(l.rank,".")})),null==a&&(a=[1,1,1]),Zp(zg(r,a),(function(){return"Error in avgPool3dBackprop: Either strides or dilations "+"must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&Zp(av(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when "+"using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var f=Ig(l.shape,n,r,a,i,o),d=cm.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,f)}),{dy5D:c,input5D:l});return h?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(e,u,t,n,o,r,a)}}}));return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Sw=Nm({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=bm(e,"x","maxPoolWithArgmax"),o=cm.runKernel("MaxPoolWithArgmax",{x:i},{filterSize:t,strides:n,pad:r,includeBatchInIndex:a});return{result:o[0],indexes:o[1]}}}),Tw=Nm({equalStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","equalStrict"),r=bm(t,"b","equalStrict");return $p(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Ew=Nm({greaterEqualStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","greaterEqualStrict"),r=bm(t,"b","greaterEqualStrict");return $p(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Aw=Nm({greaterStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","greaterStrict"),r=bm(t,"b","greaterStrict");return $p(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Iw=Nm({lessEqualStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","lessEqualStrict"),r=bm(t,"b","lessEqualStrict");return $p(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Rw=Nm({lessStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","lessStrict"),r=bm(t,"b","lessStrict");return $p(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Nw=Nm({notEqualStrict_:function(e,t){Zg("strict variants of ops have been deprecated and will be removed in future");var n=bm(e,"a","notEqualStrict"),r=bm(t,"b","notEqualStrict");return $p(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}}),Ow=1.7580993408473768,Dw=1.0507009873554805,Fw=Nm({elu_:function(e){var t=bm(e,"x","elu");return cm.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){return cm.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),Mw=Nm({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=bm(e,"x","leakyRelu");return jy(Pm(t).mul(n),n)}}),Lw=Nm({prelu_:function(e,t){var n=bm(e,"x","prelu"),r=bm(t,"alpha","prelu");return cm.runKernelFunc((function(e,t){var a=e.prelu(n,r);return t([n,r]),a}),{x:n,alpha:r},(function(e,t){var n=_slicedToArray(t,2),r=n[0],a=n[1],i=r.greater(0);return{x:function(){return E_(i,e,e.mul(a))},alpha:function(){var t=E_(i,Zm(e),e.mul(r)),n=pm(a.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(a.shape)}}}),"Prelu")}}),Pw=Nm({relu_:function(e){var t=bm(e,"x","relu");return"bool"===t.dtype?t.toInt():cm.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{x:function(){return Yy(e,n.step().toFloat())}}}),"Relu")}}),zw=Nm({relu6_:function(e){var t=bm(e,"x","relu6");return"bool"===t.dtype?t.toInt():cm.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=_slicedToArray(t,1)[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return Yy(e,r.toFloat())}}}),"Relu6")}}),Bw=Nm({selu_:function(e){var t=bm(e,"x","selu");return cm.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=_slicedToArray(t,1)[0];return{$x:function(){var t=n.greater(Pm(0)),r=Pm(Ow),a=Pm(Dw),i=e.mul(a),o=e.mul(r).mul(n.toFloat().exp());return E_(t,i,o)}}}))}}),Uw=Nm({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=bm(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));return cm.runKernelFunc((function(e,r){var a=e.softmax(n,t);return r([a]),a}),{logits:n},(function(e,n){var r=_slicedToArray(n,1)[0],a=e.mul(r);return{logits:function(){return a.sub(a.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),Ww=Nm({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=bm(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));return dg((function(e,n){var r=e.max(t,!0),a=e.sub(r),i=a.toFloat().sub(a.exp().sum(t,!0).log());return n([i]),{value:i,gradFunc:function(e,n){var r=_slicedToArray(n,1)[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),Vw=Nm({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(Pm(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: ".concat(n))}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: ".concat(n))}throw new Error("Error in norm: invalid axis: ".concat(r))}(e=bm(e,"x","norm"),t,n),i=a.shape;if(r){var o=hv(n,e.shape);i=Cm(a.shape,o)}return a.reshape(i)}}),jw=Nm({basicLSTMCell_:function(e,t,n,r,a,i){var o=bm(e,"forgetBias","basicLSTMCell"),s=bm(t,"lstmKernel","basicLSTMCell"),u=bm(n,"lstmBias","basicLSTMCell"),c=bm(r,"data","basicLSTMCell"),l=bm(a,"c","basicLSTMCell"),h=bm(i,"h","basicLSTMCell"),f=c.concat(h,1).matMul(s).add(u),d=f.shape[1]/4,p=[f.shape[0],d],v=f.slice([0,0],p),m=f.slice([0,d],p),g=f.slice([0,2*d],p),y=f.slice([0,3*d],p),b=v.sigmoid().mul(m.tanh()).add(l.mul(o.add(g).sigmoid())),k=b.tanh().mul(y.sigmoid());return[b,k]}}),Hw=Nm({multiRNNCell_:function(e,t,n,r){for(var a=bm(t,"data","multiRNNCell"),i=km(n,"c","multiRNNCell"),o=km(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var h=[],f=[],d=0;d<u.length;d+=2)h.push(u[d]),f.push(u[d+1]);return[h,f]}}),qw=Nm({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=bm(e,"v","movingAverage"),o=bm(t,"x","movingAverage"),s=bm(n,"decay","movingAverage");am(i,o),Zp(rv(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Pm(1),c=u.sub(s),l=o.sub(i).mul(c);if(a){Zp(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=bm(r,"step","movingAverage");l=l.div(u.sub(Zy(s,h)))}return i.add(l)}}),Gw=Nm({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;if(null==r&&(r=new Array(t.length)),0!==o)throw new Error("ellipsis mask is not yet supported");var c=bm(e,"x","stridedSlice"),l=_b(s),h=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,h.splice(e,0,1)})),c=c.reshape(h);for(var f=0;f<c.rank;f++)t[f]=xb(a,t,r,c.shape,f),n[f]=Cb(i,n,r,c.shape,f),r[f]=r[f]||1;var d=_b(u);d.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var p=wb(t,n,r),v=p.filter((function(e,t){return-1===d.indexOf(t)}));return r.every((function(e){return 1===e}))?Rb(c,t,p).reshape(v):cm.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(v)}}),Kw=Nm({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=bm(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i=cm.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r}),o=_slicedToArray(i,2),s=o[0],u=o[1];return{values:s,indices:u}}}),Xw=Nm({scatterND_:function(e,t,n){var r=bm(e,"indices","scatterND","int32"),a=bm(t,"updates","scatterND");return $k(a,r,n),cm.runKernelFunc((function(e){return e.scatterND(r,a,n)}),{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),Yw=Nm({fft_:function(e){Zp("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t=e.shape[e.shape.length-1],n=e.as2D(e.size/t,t);return cm.runKernelFunc((function(e){return e.fft(n)}),{input:e}).reshape(e.shape)}}),Qw=Nm({ifft_:function(e){Zp("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t=e.shape[e.shape.length-1],n=e.as2D(e.size/t,t);return cm.runKernelFunc((function(e){return e.ifft(n)}),{input:e}).reshape(e.shape)}}),Zw=Nm({rfft_:function(e,t){Zp("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=e.slice(i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(Gm(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=Om(n,u).as2D(a,r),l=Yw(c),h=Math.floor(r/2)+1,f=Dm(l),d=Fm(l),p=f.split([h,r-h],f.shape.length-1),v=d.split([h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,Om(p[0],v[0]).reshape(m)}}),$w=Nm({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),a=Qw(r);return Dm(a)}var i=[n,2*(t-1)],o=Dm(e).as2D(n,t),s=Fm(e).as2D(n,t),u=o.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(Pm(-1)),l=o.concat(u,1),h=s.concat(c,1),f=Om(l,h).as2D(i[0],i[1]),d=Qw(f);return Dm(d)}}),Jw=Nm({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=bm(e,"sparseIndices","sparseToDense","int32"),i=bm(t,"sparseValues","sparseToDense"),o=bm(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));if(0!==t.rank&&(1!==t.rank||t.size!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),cm.runKernelFunc((function(e){return e.sparseToDense(a,i,n,o)}),{$sparseIndices:a,$sparseValues:i,$defaultValue:o})}}),ex=Nm({gatherND_:function(e,t){var n=bm(t,"indices","gatherND","int32"),r=bm(e,"x","gatherND");return cm.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),tx=Nm({dropout_:function(e,t,n,r){var a=bm(e,"x","dropout");if(Zp("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),Zp(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof Kv?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(rv(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(a,n),o=1-t,s=J_(i,0,1,"float32",r).add(o).floor().div(o);return a.mul(s)}});function nx(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return zm(a,"float32")}var rx,ax=Nm({hannWindow_:function(e){return nx(e,.5,.5)}}),ix=Nm({hammingWindow_:function(e){return nx(e,.54,.46)}}),ox=Nm({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Rb(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=$m([Rb(e,i,t-s),Km([s],a)]);o.push(u),i+=n}return 0===o.length?Bm([],[0,t]):$m(o).as2D(o.length,t)}}),sx=Nm({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ax;null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var i=ox(e,t,n),o=Yy(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(Zw(o.slice([u,0],[1,t]),r));return $m(s)}}),ux=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=bm(t,"predictions","inTopK"),i=bm(n,"targets","inTopK"),Zp(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(a.rank)})),Zp(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(a.rank," and targets rank ").concat(i.rank)})),$p(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],Zp(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,h=dv("bool",c),f=0;case 15:if(!(f<c)){e.next=30;break}for(d=f*l,p=s.subarray(d,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});v.sort((function(e,t){return t.value-e.value})),h[f]=0,g=0;case 20:if(!(g<r)){e.next=27;break}if(v[g].index!==u[f]){e.next=24;break}return h[f]=1,e.abrupt("break",27);case 24:g++,e.next=20;break;case 27:f++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),Mm(h,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(rx||(rx={}));var cx=Nm({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rx.SUM_BY_NONZERO_WEIGHTS,a=bm(e,"labels","absoluteDifference"),i=bm(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=bm(n,"weights","absoluteDifference")),$p(a.shape,i.shape,"Error in absoluteDifference: ");var s=a.sub(i).abs();return lx(s,o,r)}}),lx=Nm({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rx.SUM_BY_NONZERO_WEIGHTS,r=bm(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=bm(t,"weights","computeWeightedLoss"));var i=null==a?r:r.mul(a);if(n===rx.NONE)return i;if(n===rx.SUM)return i.sum();if(n===rx.MEAN){if(null==a)return i.mean();var o=r.size/a.size,s=i.sum().div(a.sum());return o>1?s.div(Pm(o)):s}if(n===rx.SUM_BY_NONZERO_WEIGHTS){if(null==a)return i.sum().div(Pm(r.size));var u=a.mul(qm(r.shape)).notEqual(Pm(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: ".concat(n))}}),hx=Nm({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rx.SUM_BY_NONZERO_WEIGHTS,i=bm(e,"labels","cosineDistance"),o=bm(t,"predictions","cosineDistance"),s=null;null!=r&&(s=bm(r,"weights","cosineDistance")),$p(i.shape,o.shape,"Error in cosineDistance: ");var u=Pm(1).sub(i.mul(o).sum(n,!0));return lx(u,s,a)}}),fx=Nm({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rx.SUM_BY_NONZERO_WEIGHTS,a=bm(e,"labels","hingeLoss"),i=bm(t,"predictions","hingeLoss"),o=null;null!=n&&(o=bm(n,"weights","hingeLoss")),$p(a.shape,i.shape,"Error in hingeLoss: ");var s=Pm(1);a=Pm(2).mul(a).sub(s);var u=s.sub(a.mul(i)).relu();return lx(u,o,r)}}),dx=Nm({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rx.SUM_BY_NONZERO_WEIGHTS,i=bm(e,"labels","huberLoss"),o=bm(t,"predictions","huberLoss"),s=null;null!=n&&(s=bm(n,"weights","huberLoss")),$p(i.shape,o.shape,"Error in huberLoss: ");var u=Pm(r),c=o.sub(i).abs(),l=qy(c,u),h=c.sub(l),f=Pm(.5).mul(l.square()).add(u.mul(h));return lx(f,s,a)}}),px=Nm({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rx.SUM_BY_NONZERO_WEIGHTS,i=bm(e,"labels","logLoss"),o=bm(t,"predictions","logLoss"),s=null;null!=n&&(s=bm(n,"weights","logLoss")),$p(i.shape,o.shape,"Error in logLoss: ");var u=Pm(1),c=Pm(r),l=i.mul(o.add(c).log()).neg().sub(u.sub(i).mul(u.sub(o).add(c).log()));return lx(l,s,a)}}),vx=Nm({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rx.SUM_BY_NONZERO_WEIGHTS,a=bm(e,"labels","meanSquaredError"),i=bm(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=bm(n,"weights","meanSquaredError")),$p(a.shape,i.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(i);return lx(s,o,r)}}),mx=Nm({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rx.SUM_BY_NONZERO_WEIGHTS,i=bm(e,"multiClassLabels","sigmoidCrossEntropy"),o=bm(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=bm(n,"weights","sigmoidCrossEntropy")),$p(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Pm(r),c=Pm(1),l=Pm(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var h=function(e,t){var n=bm(e,"labels","sigmoidCrossEntropyWithLogits"),r=bm(t,"logits","sigmoidCrossEntropyWithLogits");$p(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=r.relu(),i=r.mul(n),o=r.abs().neg().exp().log1p();return a.sub(i).add(o)}(i,o);return lx(h,s,a)}}),gx=Nm({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rx.SUM_BY_NONZERO_WEIGHTS,i=bm(e,"onehotLabels","softmaxCrossEntropy"),o=bm(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=bm(n,"weights","softmaxCrossEntropy")),$p(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Pm(r),c=Pm(1),l=Pm(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));return dg((function(e,t,r){var a=t.logSumExp([n],!0),i=t.toFloat().sub(a);return r([e,i]),{value:i.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=_slicedToArray(t,2),a=r[0],i=r[1],o=Cm(e.shape,[n]);return[e.reshape(o).mul(a.toFloat().sub(i.exp())),e.reshape(o).mul(i.exp().sub(a.toFloat()))]}}}))(e,t)}(i,o);return lx(h,s,a)}});function yx(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return cm.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor."));for(var n=e.shape[0],r=e.shape[1],a=O_(n),i=e.clone(),o=Bm([[1]],[1,1]),s=o.clone(),u=n>=r?r:n,c=function(e){var t,u=i,c=s,l=a;t=_slicedToArray(cm.tidy((function(){var t=i.slice([e,e],[n-e,1]),u=t.norm(),c=i.slice([e,e],[1,1]),l=Bm([[-1]]).where(c.greater(0),Bm([[1]])),h=c.sub(l.mul(u)),f=t.div(h);s=1===f.shape[0]?o.clone():o.concat(f.slice([1,0],[f.shape[0]-1,f.shape[1]]),0);var d=l.matMul(h).div(u).neg(),p=i.slice([e,0],[n-e,r]),v=d.mul(s),m=s.transpose();if(0===e)i=p.sub(v.matMul(m.matMul(p)));else{var g=p.sub(v.matMul(m.matMul(p)));i=i.slice([0,0],[e,r]).concat(g,0)}var y=v.transpose(),b=a.slice([0,e],[n,a.shape[1]-e]);if(0===e)a=b.sub(b.matMul(s).matMul(y));else{var k=b.sub(b.matMul(s).matMul(y));a=a.slice([0,0],[n,e]).concat(k,1)}return[s,i,a]})),3),s=t[0],i=t[1],a=t[2],ty([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=a.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[a,i]}))}var bx=Nm({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got ".concat(t,"."));if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got ".concat(n,"."));var r=bm(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got ".concat(r.rank,"."));var a=r.shape,i=_slicedToArray(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=Ym(0,o,1,"int32").reshape([-1,1]),c=Ym(0,s,1,"int32"),l=ab(u,c),h=x_(l.lessEqual(Pm(+t,"int32")),l.greaterEqual(Pm(-n,"int32"))),f=Gm([o,s],r.dtype);return og(sg(r.reshape([-1,o,s])).map((function(e){return E_(h,e,f)}))).reshape(a)}}),kx=Nm({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,Zp(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){Zp(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=Tg(e,e.shape[0],0).map((function(e){return ig(e,[0])}))),Zp(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(cm.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=xg(n[a].mul(t)).mul(n[a]);t=t.sub(i)}return t.div(Vw(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?og(n,0):n}}),_x=Nm({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank));if(2===e.rank)return yx(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=sg(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=_slicedToArray(yx(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[og(a,0).reshape(e.shape),og(i,0).reshape(e.shape)]}});function wx(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||xx)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function xx(e,t){return e>t?1:e<t?-1:0}function Cx(e,t,n,r,a){var i=Tx(e,t,n,r,a,0);return i.selectedScores.dispose(),i.numValidOutputs.dispose(),i.selectedIndices}function Sx(e,t,n,r,a,i){var o=Tx(e,t,n,r,a,i,!0);return o.numValidOutputs.dispose(),{selectedIndices:o.selectedIndices,selectedScores:o.selectedScores}}function Tx(e,t,n,r,a,i){arguments.length>6&&void 0!==arguments[6]&&arguments[6];for(var o=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>a})).sort(Ix),u=i>0?-.5/i:0,c=[],l=[];c.length<n&&s.length>0;){var h=s.pop(),f=h.score,d=h.boxIndex,p=h.suppressBeginIndex;if(f<a)break;for(var v=!1,m=c.length-1;m>=p;--m){var g=Ex(e,d,c[m]);if(g>=r){v=!0;break}if(h.score=h.score*Ax(r,u,g),h.score<=a)break}h.suppressBeginIndex=c.length,v||(h.score===f?(c.push(d),l.push(h.score)):h.score>a&&wx(s,h,Ix))}var y=c.length;return o&&(c.fill(0,y),l.fill(0,y)),{selectedIndices:zm(c,"int32"),selectedScores:zm(l,"float32"),numValidOutputs:Pm(y,"int32")}}function Ex(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function Ax(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Ix(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Rx(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),Zp(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),Zp(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),Zp(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),Zp(1===t.rank,(function(){return"scores must be a 1D tensor"})),Zp(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),Zp(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Nx=Nm({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=bm(e,"boxes","nonMaxSuppression"),o=bm(t,"scores","nonMaxSuppression"),s=Rx(i,o,n,r,a);return cm.runKernelFunc((function(e){return e.nonMaxSuppression(i,o,n,r,a)}),{boxes:i,scores:o},null,"NonMaxSuppressionV3",{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold})}}),Ox=Nm({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"images","resizeBilinear");Zp(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(r.rank,".")})),Zp(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")}));var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=_slicedToArray(t,2),s=o[0],u=o[1],c=cm.runKernelFunc((function(e,t){return t([a]),e.resizeBilinear(a,s,u,n)}),{x:a},(function(e,t){return{x:function(){return cm.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:s,newWidth:u});return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),Dx=Nm({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=bm(e,"images","resizeNearestNeighbor");Zp(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(r.rank,".")})),Zp(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),Zp("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=r,i=!1;3===r.rank&&(i=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=_slicedToArray(t,2),s=o[0],u=o[1],c=cm.runKernelFunc((function(e,t){return t([a]),e.resizeNearestNeighbor(a,s,u,n)}),{batchImages:a},(function(e,t){return{batchImages:function(){return cm.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return i?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),Fx=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:.5,i=h.length>4&&void 0!==h[4]?h[4]:Number.NEGATIVE_INFINITY,o=bm(t,"boxes","nonMaxSuppressionAsync"),s=bm(n,"scores","nonMaxSuppressionAsync"),u=Rx(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=Cx(c[0],c[1],r,a,i),e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),l));case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Mx=Nm({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=bm(e,"boxes","nonMaxSuppression"),s=bm(t,"scores","nonMaxSuppression"),u=Rx(o,s,n,r,a,i),c=cm.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},{maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma});return{selectedIndices:c[0],selectedScores:c[1]}}}),Lx=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=f.length>5&&void 0!==f[5]?f[5]:0,s=bm(t,"boxes","nonMaxSuppressionAsync"),u=bm(n,"scores","nonMaxSuppressionAsync"),c=Rx(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,h=Sx(l[0],l[1],r,a,i,o),e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),h));case 10:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Px=Nm({cropAndResize_:function(e,t,n,r,a,i){var o=bm(e,"image","cropAndResize"),s=bm(t,"boxes","cropAndResize","float32"),u=bm(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var c=s.shape[0];return Zp(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),Zp(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),Zp(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),Zp(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),Zp(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),Zp("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)})),cm.runKernelFunc((function(e,t){return e.cropAndResize(o,s,u,r,a,i)}),{images:o,boxes:s,boxInd:u},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:r})}}),zx=function(e,t){return!(e>0)||"linear"===t},Bx=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation ".concat(n," has not been ")+"implemented yet.")},Ux=function(e,t){var n=t,r=pm(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},Wx=function(e,t,n){if("linear"===t)return e;if("relu"===t)return Pw(e);if("elu"===t)return Fw(e);if("relu6"===t)return zw(e);if("prelu"===t)return Lw(e,n);throw new Error("Unknown fused activation ".concat(t,"."))},Vx=Nm({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,h=e.preluActivationWeights;if(!1===zx(cm.state.gradientDepth,l)){var f=cg(n,r,i,s);return null!=u&&(f=ay(f,u)),Wx(f,l,h)}var d=bm(n,"a","fused matMul"),p=bm(r,"b","fused matMul"),v=_slicedToArray(rm(d,p),2);d=v[0],p=v[1];var m=i?d.shape[d.rank-2]:d.shape[d.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],y=i?d.shape[d.rank-1]:d.shape[d.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],k=d.shape.slice(0,-2),_=p.shape.slice(0,-2),w=tv(k),x=tv(_);Zp(d.rank>=2&&p.rank>=2&&d.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least "+"2, got ranks ".concat(d.rank," and ").concat(p.rank,".")})),Zp(rv(k,_),(function(){return"Error in fused matMul: outer dimensions (".concat(k,") and (")+"".concat(_,") of Tensors with shapes ").concat(d.shape," and ")+"".concat(p.shape," must match.")})),Zp(m===g,(function(){return"Error in fused matMul: inner shapes (".concat(m,") and (")+"".concat(g,") of Tensors with shapes ").concat(d.shape," and ")+"".concat(p.shape," and transposeA=").concat(i)+" and transposeB=".concat(s," must match.")}));var C,S,T=d.shape.slice(0,-2).concat([y,b]),E=i?d.as3D(w,m,y):d.as3D(w,y,m),A=s?p.as3D(x,b,g):p.as3D(x,g,b);null!=u&&(t=_slicedToArray(rm(C=bm(u,"bias","fused matMul"),d),1),vm(T,(C=t[0]).shape)),null!=h&&(S=bm(h,"prelu weights","fused matMul"));var I={a:E,b:A};return null!=u&&(I.bias=C),null!=h&&(I.preluActivationWeights=S),cm.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:E,b:A,transposeA:i,transposeB:s,bias:C,activation:l,preluActivationWeights:S});return t([E,A,n]),n}),I,(function(e,t){var n=_slicedToArray(t,3),r=n[0],a=n[1],o=n[2],c=Bx(e,o,l),h={};return null!=u&&(h={bias:function(){return Ux(C,c)}}),Object.assign(i||s?!i&&s?{a:function(){return c.matMul(a,!1,!1)},b:function(){return c.matMul(r,!0,!1)}}:i&&!s?{a:function(){return a.matMul(c,!1,!0)},b:function(){return r.matMul(c,!1,!1)}}:{a:function(){return a.matMul(c,!0,!0)},b:function(){return c.matMul(r,!0,!0)}}:{a:function(){return c.matMul(a,!1,!0)},b:function(){return r.matMul(c,!0,!1)}},h)}),"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},[E,A],[!0]).reshape(T)}}),jx=Nm({fusedConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,h=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights;if(!1===zx(cm.state.gradientDepth,d=d||"linear")){var v=jg(n,r,a,i,s,c,l);return null!=h&&(v=ay(v,h)),Wx(v,d,p)}var m=bm(n,"x","conv2d"),g=bm(r,"filter","conv2d"),y=m,b=!1;3===m.rank&&(b=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),Zp(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(y.rank,".")})),Zp(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(g.rank,".")})),null!=l&&Zp(av(i),(function(){return"Error in fused conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(l," but got pad ").concat(i,".")})),Zp(y.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input (".concat(y.shape[3],") must match ")+"input depth for filter ".concat(g.shape[2],".")})),Zp(zg(a,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")})),Zp("NHWC"===s,(function(){return"Error in conv2d: got dataFormat of ".concat(s," but only NHWC is currently supported.")}));var k,_,w=Rg(y.shape,g.shape,a,c,i,l);null!=h&&(t=_slicedToArray(rm(k=bm(h,"bias","fused conv2d"),m),1),k=t[0],vm(w.outShape,k.shape)),null!=p&&(_=bm(p,"prelu weights","fused conv2d"));var x={x:y,filter:g};null!=h&&(x.bias=k),null!=p&&(x.preluActivationWeights=_);var C=cm.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:y,filter:g,convInfo:w,bias:k,activation:d,preluActivationWeights:_});return t([g,y,n]),n}),x,(function(e,t){var n=_slicedToArray(t,3),r=n[0],o=n[1],s=n[2],u=Bx(e,s,d);Zp(Pg(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")}));var l={};return null!=h&&(l={bias:function(){return Ux(k,u)}}),Object.assign({x:function(){return Wg(o.shape,u,r,a,i)},filter:function(){return Ug(o,u,r.shape,a,i)}},l)}),"FusedConv2D",{convInfo:w,activation:d},[g,y],[!0]);return b?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Hx=Nm({fusedDepthwiseConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,h=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights;if(!1===zx(cm.state.gradientDepth,d)){var v=k_(n,r,a,i,s,c,l);return null!=h&&(v=ay(v,h)),Wx(v,d,p)}var m=bm(n,"x","depthwiseConv2d"),g=bm(r,"filter","depthwiseConv2d"),y=m,b=!1;3===m.rank&&(b=!0,y=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),Zp(4===y.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(y.rank,".")})),Zp(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(g.rank,".")})),Zp(y.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(y.shape[3],") must match the inChannels dimension in ")+"filter ".concat(g.shape[2],".")})),null==c&&(c=[1,1]),Zp(zg(a,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")})),null!=l&&Zp(av(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when "+"using dimRoundingMode ".concat(l," but got pad ").concat(i,".")}));var k,_,w=Rg(y.shape,g.shape,a,c,i,l,!0);null!=h&&(t=_slicedToArray(rm(k=bm(h,"bias","fused conv2d"),m),1),k=t[0],vm(w.outShape,k.shape)),null!=p&&(_=bm(p,"prelu weights","fused depthwiseConv2d"));var x={x:y,filter:g};null!=h&&(x.bias=k),null!=p&&(x.preluActivationWeights=_);var C=cm.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:y,filter:g,convInfo:w,bias:k,activation:d,preluActivationWeights:_});return t([g,y,n]),n}),x,(function(e,t){Zp(Pg(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")}));var n=_slicedToArray(t,3),r=n[0],a=n[1],i=n[2],o=Bx(e,i,d),s={};return null!=h&&(s={bias:function(){return Ux(k,o)}}),Object.assign({x:function(){return Yg(a.shape,o,r,w)},filter:function(){return Xg(a,o,r.shape,w)}},s)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},[g,y],[!0]);return b?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),qx=function(e){_inherits(o,e);var t,n,r,a,i=_createSuper(o);function o(){return _classCallCheck(this,o),i.apply(this,arguments)}return _createClass(o,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return ty(i),t?a:(a.dispose(),null)}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){Zp(Sv(e),(function(){return"The f passed in variableGrads(f) must be a function"})),Zp(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Jv})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],cm.registeredVariables)t.push(cm.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;Zp((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=cm.gradients(e,t,null,!0),s=o.value,u=o.grads;Zp(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),Zp(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&ty(this.iterations_)}},{key:"saveIterations",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Pm(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getWeights",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"setWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"extractIterations",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}}]),o}(e_);Object.defineProperty(qx,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Gx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return _classCallCheck(this,a),(n=r.call(this)).learningRate=e,n.rho=t,n.epsilon=i,n.accumulatedGrads=[],n.accumulatedUpdates=[],null==i&&(n.epsilon=cm.backend.epsilon()),n}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=cm.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:ey((function(){return Zm(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:ey((function(){return Zm(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;ey((function(){var e=o.mul(t.rho).add(i.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(o.add(t.epsilon).sqrt()).mul(i),r=s.mul(t.rho).add(n.square().mul(1-t.rho));o.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(ty(this.accumulatedGrads.map((function(e){return e.variable}))),ty(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedGrads),_toConsumableArray(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:e.t0=(t=e.sent).length,n=e.t0/2,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),a}(qx);Gx.className="Adadelta",n_(Gx);var Kx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return _classCallCheck(this,a),(t=r.call(this)).learningRate=e,t.initialAccumulatorValue=n,t.accumulatedGrads=[],t}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=cm.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:ey((function(){return Km(a.shape,t.initialAccumulatorValue).variable(!1)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;ey((function(){var e=o.add(i.square());o.assign(e);var n=i.div(e.add(cm.backend.epsilon()).sqrt()).mul(-t.learningRate).add(a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&ty(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),a}(qx);Kx.className="Adagrad",n_(Kx);var Xx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck(this,a),(i=r.call(this)).learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],ey((function(){i.accBeta1=Pm(t).variable(),i.accBeta2=Pm(n).variable()})),null==o&&(i.epsilon=cm.backend.epsilon()),i}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);ey((function(){var r=ab(1,t.accBeta1),a=ab(1,t.accBeta2);n.forEach((function(n,i){var o=cm.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:ey((function(){return Zm(o).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:ey((function(){return Zm(o).variable(!1)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),f=l.div(r),d=h.div(a);u.assign(l),c.assign(h);var p=f.div(d.sqrt().add(t.epsilon)).mul(-t.learningRate).add(o);o.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&ty(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&ty(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedFirstMoment),_toConsumableArray(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,ey((function(){r.accBeta1.assign(Zy(r.beta1,r.iterations_+1)),r.accBeta2.assign(Zy(r.beta2,r.iterations_+1))})),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),a}(qx);Xx.className="Adam",n_(Xx);var Yx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return _classCallCheck(this,a),(i=r.call(this)).learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],ey((function(){i.iteration=Pm(0).variable(),i.accBeta1=Pm(t).variable()})),null==o&&(i.epsilon=cm.backend.epsilon()),i}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);ey((function(){var r=ab(1,t.accBeta1),a=tb(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,i){var o=cm.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Zm(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Zm(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=c.mul(t.beta2),f=s.abs(),d=h.maximum(f);u.assign(l),c.assign(d);var p=a.div(r).mul(l.div(d.add(t.epsilon))).add(o);o.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&ty(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&ty(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),a}(qx);Yx.className="Adamax",n_(Yx);var Qx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t;return _classCallCheck(this,a),(t=r.call(this)).learningRate=e,t.setLearningRate(e),t}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=cm.registeredVariables[n];ey((function(){var e=t.c.mul(a).add(i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=ny(Pm(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(e.t0=(t=e.sent).length,0===e.t0){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),a}(qx);Qx.className="SGD",n_(Qx);var Zx=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _classCallCheck(this,a),(n=r.call(this,e)).learningRate=e,n.momentum=t,n.useNesterov=i,n.accumulations=[],n.m=Pm(n.momentum),n}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=cm.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:ey((function(){return Zm(a).variable(!1)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&ey((function(){var e,n=t.m.mul(i).add(o);e=t.useNesterov?t.c.mul(o.add(n.mul(t.m))).add(a):t.c.mul(n).add(a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&ty(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),a}(Qx);Zx.className="Momentum",n_(Zx);var $x=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,a),(t=r.call(this)).learningRate=e,t.decay=n,t.momentum=i,t.epsilon=o,t.accumulatedMeanSquares=[],t.accumulatedMoments=[],t.accumulatedMeanGrads=[],t.centered=s,null==o&&(t.epsilon=cm.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return _possibleConstructorReturn(t)}return _createClass(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=cm.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:ey((function(){return Zm(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:ey((function(){return Zm(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:ey((function(){return Zm(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;ey((function(){var e=o.mul(t.decay).add(i.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(i.mul(1-t.decay)),c=s.mul(t.momentum).add(i.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));o.assign(e),n.assign(u),s.assign(c);var l=a.sub(c);a.assign(l)}else{var h=o.mul(t.decay).add(i.square().mul(1-t.decay)),f=s.mul(t.momentum).add(i.mul(t.learningRate).div(h.add(t.epsilon).sqrt()));o.assign(h),s.assign(f);var d=a.sub(f);a.assign(d)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&ty(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&ty(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&ty(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedMeanSquares),_toConsumableArray(this.accumulatedMoments)),this.centered&&t.push.apply(t,_toConsumableArray(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),a}(qx);$x.className="RMSProp",n_($x);var Jx=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"sgd",value:function(e){return new Qx(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Zx(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new $x(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Xx(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Gx(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Yx(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new Kx(e,t)}}]),e}(),eC={sgd:Jx.sgd,momentum:Jx.momentum,adadelta:Jx.adadelta,adagrad:Jx.adagrad,rmsprop:Jx.rmsprop,adamax:Jx.adamax,adam:Jx.adam},tC="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function nC(){return new Promise((function(e){return tC((function(){return e()}))}))}function rC(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function aC(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2==1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function iC(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];a.push(r?e[0]/n:e[0]*n);for(var i=1;i<e.length;++i)a.push(i<=t.length?r?t[i-1]*e[i]:e[i]/t[i-1]:e[i]);return a}function oC(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function sC(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var uC=.3275911,cC=.254829592,lC=-.284496736,hC=1.421413741,fC=-1.453152027,dC=1.061405429;function pC(){var e;Dp().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}function vC(){var e;Dp().getBool("IS_TEST")||(e=console).log.apply(e,arguments)}function mC(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function gC(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function yC(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function bC(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function kC(e,t){return{real:e[2*t],imag:e[2*t+1]}}function _C(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function wC(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function xC(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function CC(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Gm(e.shape),a=e.toFloat(),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!gv(e.dtype,t))return cm.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e),s=o.cast(t);return o.dispose(),s}if("int32"===t)return n.int(e);if("bool"===t){var u=Pm(0,e.dtype),c=n.notEqual(e,u);return u.dispose(),c}throw new Error("Error in Cast: failed to cast ".concat(e.dtype," to ").concat(t))}function SC(e,t){return cm.makeTensorFromDataId(e.dataId,t,e.dtype)}function TC(e,t,n){var r=(t-e)/(n-1),a=Nv(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return zm(a,"float32")}function EC(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map((function(t){var i=_toConsumableArray(a);i[n]=t;var o=e.slice(r,i);return r[n]+=t,o}))}function AC(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=Jm(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a.toTensor()}function IC(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=dv(n,o*r),c=dv("int32",o*r),l=0;l<o;l++){for(var h=l*s,f=e.subarray(h,h+s),d=[],p=0;p<f.length;p++)d.push({value:f[p],index:p});d.sort((function(e,t){return t.value-e.value}));for(var v=l*r,m=u.subarray(v,v+r),g=c.subarray(v,v+r),y=0;y<r;y++)m[y]=d[y].value,g[y]=d[y].index}var b=t.slice();return b[b.length-1]=r,[Mm(u,b,n),Mm(c,b,"int32")]}var RC,NC=function(){function e(t,n){_classCallCheck(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return _createClass(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),OC=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"time",value:function(e){return DC("time")}},{key:"read",value:function(e){return DC("read")}},{key:"readSync",value:function(e){return DC("readSync")}},{key:"numDataIds",value:function(){return DC("numDataIds")}},{key:"disposeData",value:function(e){return DC("disposeData")}},{key:"write",value:function(e,t,n){return DC("write")}},{key:"move",value:function(e,t,n,r){return DC("move")}},{key:"memory",value:function(){return DC("memory")}},{key:"floatPrecision",value:function(){return DC("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return DC("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){return _objectDestructuringEmpty(e),DC("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return DC("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return DC("stridedSlice")}},{key:"unstack",value:function(e,t){return DC("unstack")}},{key:"reverse",value:function(e,t){return DC("reverse")}},{key:"concat",value:function(e,t){return DC("concat")}},{key:"neg",value:function(e){return DC("neg")}},{key:"add",value:function(e,t){return DC("add")}},{key:"addN",value:function(e){return DC("addN")}},{key:"subtract",value:function(e,t){return DC("subtract")}},{key:"multiply",value:function(e,t){return DC("multiply")}},{key:"realDivide",value:function(e,t){return DC("realDivide")}},{key:"floorDiv",value:function(e,t){return DC("floorDiv")}},{key:"sum",value:function(e,t){return DC("sum")}},{key:"prod",value:function(e,t){return DC("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return DC("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return DC("argMin")}},{key:"argMax",value:function(e,t){return DC("argMax")}},{key:"equal",value:function(e,t){return DC("equal")}},{key:"notEqual",value:function(e,t){return DC("notEqual")}},{key:"less",value:function(e,t){return DC("less")}},{key:"lessEqual",value:function(e,t){return DC("lessEqual")}},{key:"greater",value:function(e,t){return DC("greater")}},{key:"greaterEqual",value:function(e,t){return DC("greaterEqual")}},{key:"logicalNot",value:function(e){return DC("logicalNot")}},{key:"logicalAnd",value:function(e,t){return DC("logicalAnd")}},{key:"logicalOr",value:function(e,t){return DC("logicalOr")}},{key:"where",value:function(e){return DC("where")}},{key:"select",value:function(e,t,n){return DC("select")}},{key:"topk",value:function(e,t,n){return DC("topk")}},{key:"min",value:function(e,t){return DC("min")}},{key:"minimum",value:function(e,t){return DC("minimum")}},{key:"mod",value:function(e,t){return DC("mod")}},{key:"max",value:function(e,t){return DC("max")}},{key:"maximum",value:function(e,t){return DC("maximum")}},{key:"all",value:function(e,t){return DC("all")}},{key:"any",value:function(e,t){return DC("any")}},{key:"squaredDifference",value:function(e,t){return DC("squaredDifference")}},{key:"ceil",value:function(e){return DC("ceil")}},{key:"floor",value:function(e){return DC("floor")}},{key:"round",value:function(e){return DC("round")}},{key:"sign",value:function(e){return DC("sign")}},{key:"isNaN",value:function(e){return DC("isNaN")}},{key:"isInf",value:function(e){return DC("isInf")}},{key:"isFinite",value:function(e){return DC("isFinite")}},{key:"pow",value:function(e,t){return DC("pow")}},{key:"exp",value:function(e){return DC("exp")}},{key:"expm1",value:function(e){return DC("expm1")}},{key:"softmax",value:function(e,t){return DC("softmax")}},{key:"log",value:function(e){return DC("log")}},{key:"log1p",value:function(e){return DC("log1p")}},{key:"sqrt",value:function(e){return DC("sqrt")}},{key:"rsqrt",value:function(e){return DC("rsqrt")}},{key:"square",value:function(e){return DC("square")}},{key:"reciprocal",value:function(e){return DC("reciprocal")}},{key:"relu",value:function(e){return DC("relu")}},{key:"relu6",value:function(e){return DC("relu6")}},{key:"prelu",value:function(e,t){return DC("prelu")}},{key:"elu",value:function(e){return DC("elu")}},{key:"eluDer",value:function(e,t){return DC("eluDer")}},{key:"selu",value:function(e){return DC("selu")}},{key:"int",value:function(e){return DC("int")}},{key:"clip",value:function(e,t,n){return DC("clip")}},{key:"abs",value:function(e){return DC("abs")}},{key:"complexAbs",value:function(e){return DC("complexAbs")}},{key:"sigmoid",value:function(e){return DC("sigmoid")}},{key:"softplus",value:function(e){return DC("softplus")}},{key:"sin",value:function(e){return DC("sin")}},{key:"cos",value:function(e){return DC("cos")}},{key:"tan",value:function(e){return DC("tan")}},{key:"asin",value:function(e){return DC("asin")}},{key:"acos",value:function(e){return DC("acos")}},{key:"atan",value:function(e){return DC("atan")}},{key:"atan2",value:function(e,t){return DC("atan2")}},{key:"sinh",value:function(e){return DC("sinh")}},{key:"cosh",value:function(e){return DC("cosh")}},{key:"tanh",value:function(e){return DC("tanh")}},{key:"asinh",value:function(e){return DC("asinh")}},{key:"acosh",value:function(e){return DC("acosh")}},{key:"atanh",value:function(e){return DC("atanh")}},{key:"erf",value:function(e){return DC("erf")}},{key:"step",value:function(e,t){return DC("step")}},{key:"fusedConv2d",value:function(e){return _objectDestructuringEmpty(e),DC("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return DC("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return DC("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return DC("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){return _objectDestructuringEmpty(e),DC("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return DC("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return DC("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return DC("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return DC("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return DC("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return DC("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return DC("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return DC("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return DC("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return DC("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return DC("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return DC("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return DC("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return DC("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return DC("reshape")}},{key:"cast",value:function(e,t){return DC("cast")}},{key:"tile",value:function(e,t){return DC("tile")}},{key:"pad",value:function(e,t,n){return DC("pad")}},{key:"transpose",value:function(e,t){return DC("transpose")}},{key:"gather",value:function(e,t,n){return DC("gather")}},{key:"gatherND",value:function(e,t){return DC("gatherND")}},{key:"scatterND",value:function(e,t,n){return DC("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return DC("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return DC("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r){return DC("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return DC("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){return DC("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return DC("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,i){return DC("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return DC("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){return DC("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return DC("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return DC("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return DC("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return DC("nonMaxSuppression")}},{key:"fft",value:function(e){return DC("fft")}},{key:"ifft",value:function(e){return DC("ifft")}},{key:"complex",value:function(e,t){return DC("complex")}},{key:"real",value:function(e){return DC("real")}},{key:"imag",value:function(e){return DC("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,i){return DC("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return DC("depthToSpace")}},{key:"split",value:function(e,t,n){return DC("split")}},{key:"sparseToDense",value:function(e,t,n,r){return DC("sparseToDense")}},{key:"diag",value:function(e){return DC("diag")}},{key:"fill",value:function(e,t,n){return DC("fill")}},{key:"onesLike",value:function(e){return DC("onesLike")}},{key:"zerosLike",value:function(e){return DC("zerosLike")}},{key:"linspace",value:function(e,t,n){return DC("linspace")}},{key:"dispose",value:function(){return DC("dispose")}}]),e}();function DC(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"Did you forget to import the kernel?")}function FC(){return null==RC&&(RC=cm.backend.epsilon()),RC}Kv.prototype.add=function(e){return this.throwIfDisposed(),ay(this,e)},Kv.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),i_(this,e,t,n,r,a)},Kv.prototype.broadcastTo=function(e){return this.throwIfDisposed(),l_(this,e)},Kv.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),db(this,e,t)},Kv.prototype.max=function(e,t){return this.throwIfDisposed(),z_(this,e,t)},Kv.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Kv&&(e=[e]),$m([this].concat(_toConsumableArray(e)),t)},Kv.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),v_(this,e,t,n,r,a,i)},Kv.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),jg(this,e,t,n,r,a,i)},Kv.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),m_(this,e,t,n,r,a)},Kv.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),b_(this,e,t)},Kv.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),k_(this,e,t,n,r,a,i)},Kv.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return Zg("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),k_(this,e,t,n,r,a,i)},Kv.prototype.div=function(e){return this.throwIfDisposed(),tb(this,e)},Kv.prototype.divNoNan=function(e){return this.throwIfDisposed(),I_(this,e)},Kv.prototype.dot=function(e){return this.throwIfDisposed(),R_(this,e)},Kv.prototype.equal=function(e){return this.throwIfDisposed(),N_(this,e)},Kv.prototype.greater=function(e){return this.throwIfDisposed(),D_(this,e)},Kv.prototype.greaterEqual=function(e){return this.throwIfDisposed(),F_(this,e)},Kv.prototype.less=function(e){return this.throwIfDisposed(),M_(this,e)},Kv.prototype.lessEqual=function(e){return this.throwIfDisposed(),L_(this,e)},Kv.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),P_(this,e,t,n,r)},Kv.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),cg(this,e,t,n)},Kv.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Gk(this,e,t,n)},Kv.prototype.notEqual=function(e){return this.throwIfDisposed(),U_(this,e)},Kv.prototype.pad=function(e,t){return this.throwIfDisposed(),bb(this,e,t)},Kv.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),ew(this,e,t,n,r,a,i)},Kv.prototype.split=function(e,t){return this.throwIfDisposed(),Tg(this,e,t)},Kv.prototype.squaredDifference=function(e){return this.throwIfDisposed(),tw(this,e)},Kv.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),hg(this,e,t)},Kv.prototype.sub=function(e){return this.throwIfDisposed(),ab(this,e)},Kv.prototype.tile=function(e){return this.throwIfDisposed(),ib(this,e)},Kv.prototype.transpose=function(e){return this.throwIfDisposed(),lb(this,e)},Gv=g;var MC=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),LC=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),PC=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),zC=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),BC=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}();function UC(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function WC(e,t){if(!e)throw new BC(t)}function VC(e,t){var n,r=0,a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(az){a.e(az)}finally{a.f()}return r}function jC(e){return 1===e.length?e[0]:e}function HC(e){return Array.isArray(e)?e:[e]}function qC(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function GC(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}Error;var KC={};function XC(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function YC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in KC)i=KC[o];else if(null==(i=t[o]))throw new PC("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s,u,c,l=e;if(null==l.className||null==l.config)throw new PC("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(l),".\n")+"'className' and 'config' must set.");var h,f,d=l.className;if(d in n?(h=(s=_slicedToArray(n[d],2))[0],f=s[1]):d in KC?(h=(u=_slicedToArray(KC.className,2))[0],f=u[1]):d in t&&(h=(c=_slicedToArray(t[d],2))[0],f=c[1]),null==h)throw new PC("Unknown ".concat(r,": ").concat(d,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=f){for(var p={},v=0,m=Object.keys(KC);v<m.length;v++){var g=m[v];p[g]=KC[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var k=b[y];p[k]=n[k]}l.config.customObjects=p;for(var _=Object.assign({},KC),w=0,x=Object.keys(n);w<x.length;w++){var C=x[w];KC[C]=n[C]}!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return e(t)}));else for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n],i=t[a];null!=i&&"object"==typeof i&&(Array.isArray(i)||"ndarray"!==i.type||"number"!=typeof i.value?e(i):t[a]=i.value)}}(l.config);var S=f(h,l.config,n,a);return KC=Object.assign({},_),S}for(var T=Object.assign({},KC),E=0,A=Object.keys(n);E<A.length;E++){var I=A[E];KC[I]=n[I]}var R=new h(l.config);return KC=Object.assign({},T),R}function QC(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function ZC(e){if(null==e)return e;var t,n=[],r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(az){r.e(az)}finally{r.f()}return n}function $C(e){if(null==e)throw new PC("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function JC(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new PC("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function eS(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return WC(n>=0),WC(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function tS(e,t){Array.isArray(e)?(r.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return tS(e,"element ".concat(n+1," of ").concat(t))}))):r.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"==typeof t?'"'.concat(t,'"'):"".concat(t)}(e),".")}))}function nS(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function rS(e,t){return ey((function(){return My(xg(Yy(e,e),t,!0))}))}var aS=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getConfig",value:function(){return{}}}]),n}(c.Serializable),iS=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return ey((function(){var n=rS(e,t.axis),r=dy(n,0,t.maxValue);return Yy(e,tb(r,ay(FC(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(aS);iS.className="MaxNorm",c.registerClass(iS);var oS=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return ey((function(){return tb(e,ay(FC(),rS(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(aS);oS.className="UnitNorm",c.registerClass(oS);var sS=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Pw(e)}}]),n}(aS);sS.className="NonNeg",c.registerClass(sS);var uS=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return ey((function(){var n=rS(e,t.axis),r=ay(Yy(t.rate,dy(n,t.minValue,t.maxValue)),Yy(1-t.rate,n));return Yy(e,tb(r,ay(FC(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(aS);uS.className="MinMaxNorm",c.registerClass(uS);var cS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function lS(e){return XC(e)}function hS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return YC(e,c.SerializationMap.getMap().classNameMap,t,"constraint")}function fS(e){return null==e?null:"string"==typeof e?hS({className:e in cS?cS[e]:e,config:{}}):e instanceof aS?e:hS(e)}var dS=["channelsFirst","channelsLast"],pS=["valid","same","causal"],vS=["max","avg"],mS=["sum","mul","concat","ave"],gS=new Map;function yS(e){JC(dS,"DataFormat",e)}function bS(e){JC(pS,"PaddingMode",e)}function kS(e){JC(vS,"PoolMode",e)}var _S=[];function wS(e,t){_S.push(e);try{var n=t();return _S.pop(),n}catch(r){throw _S.pop(),r}}function xS(e){if(!TS(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===_S.length?"":_S.join("/")+"/")+e}function CS(e){if(!TS(e))throw new Error("Not a valid tensor name: '"+e+"'");gS.has(e)||gS.set(e,0);var t=gS.get(e);if(gS.set(e,gS.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return gS.set(n,1),n}return e}var SS=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function TS(e){return!!e.match(SS)}function ES(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function AS(e){return zm(e=Array.isArray(e)?new Float32Array(e):e)}function IS(e){return _g(AS(e)).dataSync()[0]}function RS(e){return z_(AS(e)).dataSync()[0]}function NS(e,t){if(t<e)throw new PC("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function OS(e,t){return e.asType(t)}function DS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function FS(e,t,n){return ey((function(){switch(e.rank){case 1:return Nb(e,t,n);case 2:return Ob(e,[t,0],[n,e.shape[1]]);case 3:return Db(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Fb(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Rb(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Rb(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new PC("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function MS(e,t,n){return ey((function(){switch(e.rank){case 1:return Nb(e,t,n);case 2:return Ob(e,[0,t],[e.shape[0],n]);case 3:return Db(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Fb(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new PC("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function LS(e,t,n,r){return ey((function(){switch(e.rank){case 1:return Nb(e,t,n);case 2:switch(r){case 1:return FS(e,t,n);case 2:return MS(e,t,n);default:throw new PC("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return FS(e,t,n);case 2:return Db(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return MS(e,t,n);default:throw new PC("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return FS(e,t,n);case 2:return Fb(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Fb(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return MS(e,t,n);default:throw new PC("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new PC("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function PS(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),$m(e,n)}function zS(e,t){switch(e.rank){case 1:return h_([e,t]);case 2:return f_([e,t],0);case 3:return d_([e,t],0);case 4:return p_([e,t],0);default:throw new PC("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function BS(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new PC("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return ib(e,t)}function US(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return $_(e,t,n,r,a)}function WS(e,t,n,r){if(e.rank<2||t.rank<2)throw new zC("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new zC("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank)return m.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?HS(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=e.reshape([-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(_toConsumableArray(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(l).reshape([u,-1]);var h=[].concat(_toConsumableArray(a),_toConsumableArray(c));return m.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?HS(e.rank,r,"channelsLast"):null,activation:n}).reshape(h)}function VS(e,t,n){return ey((function(){return t=Array.isArray(t)?zm(t,"int32"):t.toInt(),lw(e,t,n)}))}function jS(e){return Yy(e,e)}function HS(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new PC("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new PC("Unsupported input rank by biasAdd: ".concat(t.rank))}function qS(e,t,n){return ey((function(){return null==n&&(n="channelsLast"),yS(n),e.add(HS(e.rank,t,n))}))}function GS(e,t,n,r){return ey((function(){return tx(e,t,n,r)}))}function KS(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var XS=["fanIn","fanOut","fanAvg"],YS=["normal","uniform","truncatedNormal"],QS=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(c.Serializable),ZS=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){return Gm(e,t)}}]),n}(QS);ZS.className="Zeros",c.registerClass(ZS);var $S=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){return qm(e,t)}}]),n}(QS);$S.className="Ones",c.registerClass($S);var JS=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),r=t.call(this),"object"!=typeof e)throw new PC("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new PC("config must have value set but got ".concat(e));return r.value=e.value,_possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){var n=this;return ey((function(){return Yy(Pm(n.value),qm(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(QS);JS.className="Constant",c.registerClass(JS);var eT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return _createClass(n,[{key:"apply",value:function(e,t){return J_(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(QS);eT.className="RandomUniform",c.registerClass(eT);var tT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return _createClass(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new zC("randomNormal does not support dType ".concat(t,"."));return US(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(QS);tT.className="RandomNormal",c.registerClass(tT);var nT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return _createClass(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new zC("truncatedNormal does not support dType ".concat(t,"."));return nw(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(QS);nT.className="TruncatedNormal",c.registerClass(nT);var rT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return _createClass(n,[{key:"apply",value:function(e,t){var n=this;return ey((function(){if(2!==e.length||e[0]!==e[1])throw new PC("Identity matrix initializer can only be used for 2D square matrices.");return Yy(n.gain,O_(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(QS);rT.className="Identity",c.registerClass(rT);var aT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a;if(_classCallCheck(this,n),r=t.call(this),e.scale<0)throw new PC("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,JC(XS,"FanMode",r.mode),r.distribution=null==e.distribution?"normal":e.distribution,a=r.distribution,JC(YS,"Distribution",a),r.seed=e.seed,_possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(yS(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=ES(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=ES(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=ES(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if(i/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,a):Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new zC("".concat(this.getClassName()," does not support dType ").concat(t,"."));return nw(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return J_(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(QS);aT.className="VarianceScaling",c.registerClass(aT);var iT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return aT.className}}]),n}(aT);iT.className="GlorotUniform",c.registerClass(iT);var oT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return aT.className}}]),n}(aT);oT.className="GlorotNormal",c.registerClass(oT);var sT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return aT.className}}]),n}(aT);sT.className="HeNormal",c.registerClass(sT);var uT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return aT.className}}]),n}(aT);uT.className="HeUniform",c.registerClass(uT);var cT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return aT.className}}]),n}(aT);cT.className="LeCunNormal",c.registerClass(cT);var lT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass(n,[{key:"getClassName",value:function(){return aT.className}}]),n}(aT);lT.className="LeCunNormal",c.registerClass(lT);var hT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new zC("Random seed is not implemented for Orthogonal Initializer yet.");return _possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){var n=this;return ey((function(){if(2!==e.length)throw new zC("The Orthogonal Initializer does not support non-2D shapes yet.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");var t=US(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=p.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),Yy(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(QS);hT.className="Orthogonal",c.registerClass(hT);var fT={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function dT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return YC(e,c.SerializationMap.getMap().classNameMap,t,"initializer")}function pT(e){return XC(e)}function vT(e){if("string"==typeof e){var t=e in fT?fT[e]:e;if("GlorotNormal"===t)return new oT;if("GlorotUniform"===t)return new iT;if("HeNormal"===t)return new sT;if("HeUniform"===t)return new uT;if("LeCunNormal"===t)return new cT;if("LeCunUniform"===t)return new lT;var n={};return n.className=t,n.config={},dT(n)}return e instanceof QS?e:dT(e)}var mT=0;function gT(){return mT++}var yT={};function bT(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in yT||(yT[e]=0),yT[e]+=1,e+yT[e].toString()}function kT(e){return Array.isArray(e)&&Array.isArray(e[0])}function _T(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function wT(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new PC("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function xT(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new PC("Expected exactly 1 Shape; got ".concat(e.length))}return e}function CT(e){var t,n=0,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=0===a.shape.length?1:a.shape.reduce((function(e,t){return e*t}))}}catch(az){r.e(az)}finally{r.f()}return n}var ST=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Variable",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=gT(),this.originalName=xS(r=null==r?"Variable":r),this.name=CS(this.originalName),this.trainable_=a,this.constraint=i,this.val=Hm(t,this.trainable_,this.name,this.dtype)}return _createClass(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function TT(e){return e.map((function(e){return e.read()}))}function ET(e){e.forEach((function(e){e[0].write(e[1])}))}var AT,IT=function e(t){_classCallCheck(this,e),this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},RT=function e(t,n,r,a,i,o,s){_classCallCheck(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=gT(),null!=o&&(this.originalName=xS(o),this.name=CS(this.originalName)),this.rank=n.length},NT=0,OT=function(){function e(t,n){_classCallCheck(this,e),this.callArgs=n,this.id=NT++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=_createForOfIteratorHelper(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(az){a.e(az)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return _createClass(e,[{key:"getConfig",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(null!=r?r.name:null)}}catch(az){n.e(az)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),DT=0,FT=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=DT++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=qC(i)+"_"+bT(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return e.initialWeights=null!=r.weights?r.weights:null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return _createClass(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new LC("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new PC("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return jC(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return jC(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=HC(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=HC(this.inputSpec);if(e.length!==t.length)throw new PC("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new PC("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new PC("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new PC("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new PC("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new PC("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var f=a.shape[h],d=r.shape[h];if(null!=f&&null!=d&&f!==d)throw new PC("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=HC(e),i=!0,o=_createForOfIteratorHelper(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof RT)){i=!1;break}}}catch(az){o.e(az)}finally{o.f()}var s,u=!0,c=_createForOfIteratorHelper(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof RT){u=!1;break}}}catch(az){c.e(az)}finally{c.f()}if(i===u)throw new PC("Arguments to apply() must be all SymbolicTensors or all Tensors");return wS(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=_createForOfIteratorHelper(HC(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(az){o.e(az)}finally{o.f()}n.build(jC(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),h=[],f=_createForOfIteratorHelper(HC(l));try{for(f.s();!(c=f.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),h.push(d)}}catch(az){f.e(az)}finally{f.f()}if(l=jC(h),null!=n.activityRegularizer)throw new zC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var p,v=function(e){var t,n=[],r=_createForOfIteratorHelper(e=HC(e));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(az){r.e(az)}finally{r.f()}return jC(n)}(e),m=n.computeOutputShape(v);if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),p=null!=m&&m.length>0&&Array.isArray(m[0])?m.map((function(r,a){return new RT("float32",r,n,HC(e),t,n.name,a)})):new RT("float32",m,n,HC(e),t,n.name),n.addInboundNode(e,p,null,null,v,m,t),n._refCount++,null!=n.activityRegularizer)throw new zC("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"countParams",value:function(){if(!this.built)throw new LC("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return CT(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return TT(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;ey((function(){var n=t.weights;if(n.length!==e.length)throw new PC('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var a=[],i=TT(n),o=0;o<i.length;++o){var s=i[o],u=n[o],c=e[o];if(!r.arraysEqual(s.shape,c.shape))throw new PC("Layer weight shape ".concat(s.shape," ")+"not compatible with provided weight shape ".concat(c.shape));a.push([u,c])}ET(a)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o){if(-1!==this._addedWeightNames.indexOf(e))throw new PC("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=vT("zeros"));var s=r.apply(t,n),u=new ST(s,n,e,i,o);return s.dispose(),null!=a&&this.addLoss((function(){return a.apply(u.read())})),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=HC(e),null!=this._losses&&(t=this.losses).push.apply(t,_toConsumableArray(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=HC(e);t=HC(t),n=HC(n),r=HC(r),a=_T(a),i=_T(i);var u,c=[],l=[],h=[],f=_createForOfIteratorHelper(s);try{for(f.s();!(u=f.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),h.push(d.tensorIndex)}}catch(az){f.e(az)}finally{f.f()}new OT({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new MC("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new MC("Layer ".concat(this.name)+" is not connected, no input to return.");return jC(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new MC("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new MC("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return jC(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new MC("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=_createForOfIteratorHelper(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(az){n.e(az)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new MC("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(c.Serializable),MT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:bT("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new PC("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new PC("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new PC("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new RT(r.dtype,r.batchInputShape,_assertThisInitialized(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new OT({outboundLayer:_assertThisInitialized(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),_possibleConstructorReturn(r)}return _createClass(n,[{key:"apply",value:function(e,t){throw new PC("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(FT);function LT(e){return PT.apply(this,arguments)}function PT(){return(PT=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];ty(a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zT(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}MT.className="InputLayer",c.registerClass(MT),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(AT||(AT={}));var BT=function(){function e(){_classCallCheck(this,e),this.validationData=null}var t,n,r,a,i,o;return _createClass(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"onEpochEnd",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchBegin",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"onBatchEnd",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"setModel",value:function(e){}}]),e}(),UT=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;_classCallCheck(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}var t,n,r,a,i,o;return _createClass(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=_createForOfIteratorHelper(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(az){n.e(az)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=_createForOfIteratorHelper(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(az){n.e(az)}finally{n.f()}}},{key:"onEpochBegin",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return o.apply(this,arguments)})},{key:"onEpochEnd",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchBegin",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return a.apply(this,arguments)})},{key:"onBatchEnd",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return r.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=_createForOfIteratorHelper(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=_createForOfIteratorHelper(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return t.apply(this,arguments)})}]),e}(),WT=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(){return _classCallCheck(this,i),a.call(this)}return _createClass(i,[{key:"onEpochBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onBatchEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"==typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=ey((function(){return ay(o.totals[e],Yy(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onEpochEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){r=_createForOfIteratorHelper(this.params.metrics);try{for(i=function(){var e=a.value;null!=o.totals[e]&&("number"==typeof o.totals[e]?n[e]=o.totals[e]/o.seen:ey((function(){var t=Yy(tb(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),ny(n[e])})))},r.s();!(a=r.n()).done;)i()}catch(az){r.e(az)}finally{r.f()}}case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(BT),VT=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(){return _classCallCheck(this,i),a.apply(this,arguments)}return _createClass(i,[{key:"onTrainBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onEpochEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"syncData",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(t.push(i[o].data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(s=e.sent,u=0;u<s.length;++u)this.history[n[u]][r[u]].dispose(),this.history[n[u]][r[u]]=s[u][0];case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(BT),jT=function(e){_inherits(l,e);var t,n,a,i,o,s,u,c=_createSuper(l);function l(e,t){var n,a,i,o,s;if(_classCallCheck(this,l),(n=c.call(this)).currentEpoch=0,n.yieldEvery=t||"auto","auto"===n.yieldEvery&&(n.yieldEvery=125),"never"===n.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return r.isNumber(n.yieldEvery)&&(n.maybeWait=(a=n.maybeWait.bind(_assertThisInitialized(n)),i=n.yieldEvery,s=r.now(),function(){var e=r.now();return e-s<i||(s=e,o=a.apply(void 0,arguments)),o})),n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n.yield=e.onYield,_possibleConstructorReturn(n)}return _createClass(l,[{key:"maybeWait",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,LT(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(nC()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"onEpochBegin",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,LT(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"onEpochEnd",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,LT(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(nC()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"onBatchBegin",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,LT(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchEnd",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,LT(n);case 5:a.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?a.push(nC()):r.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,LT(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,LT(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l}(BT);function HT(e,t){return null==e&&(e={}),e instanceof BT?[e]:Array.isArray(e)&&e[0]instanceof BT?e:HC(e).map((function(e){return new jT(e,t)}))}var qT=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"registerCallbackConstructor",value:function(t,n){r.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new PC("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,_toConsumableArray(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function GT(e,t,n,r,a,i,o,s,u){var c=new VT,l=[new WT].concat(_toConsumableArray(qT.createCallbacks(t)));null!=e&&l.push.apply(l,_toConsumableArray(e)),l.push(c);var h=new UT(l);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:c}}function KT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return YC(e,c.SerializationMap.getMap().classNameMap,t,"layer",n)}function XT(e,t){return ey((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=xg(jS(e),t,!0),r=Km(n.shape,FC()),a=My(jy(n,r));return tb(e,a)}))}function YT(e,t){return ey((function(){return kg(jS(ab(t,e)),-1)}))}function QT(e,t){return ey((function(){return kg(iy(ab(t,e)),-1)}))}function ZT(e,t){return ey((function(){var n=ab(e,t),r=dy(iy(e),FC(),Number.MAX_VALUE),a=iy(tb(n,r));return Yy(100,kg(a,-1))}))}function $T(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ey((function(){if(n)t=Uw(t);else{var r=xg(t,t.shape.length-1,!0);t=tb(t,r)}return t=dy(t,FC(),1-FC()),xy(xg(Yy(e.toFloat(),ky(t)),t.shape.length-1))}))}function JT(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ey((function(){var r,a,i=by((r=e,a=[ES(r.shape)],r.reshape(a))).toInt(),o=(t=dy(t,FC(),1-FC())).shape;return $T(Gk(i,o[o.length-1]).reshape(o),t,n)}))}function eE(e,t){return ey((function(){var n;return n=dy(t,FC(),1-FC()),n=ky(tb(n,ab(1,n))),kg(function(e,t){if(!r.arraysEqual(e.shape,t.shape))throw new PC("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return ey((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function tE(e,t){return ey((function(){var n=XT(e,-1),r=XT(t,-1),a=Yy(n,r);return xy(xg(a,-1))}))}qT.constructors={};var nE={meanSquaredError:YT,meanAbsoluteError:QT,meanAbsolutePercentageError:ZT,meanSquaredLogarithmicError:function(e,t){return ey((function(){var n=dy(t,FC(),Number.MAX_VALUE),r=ky(ay(1,n)),a=dy(e,FC(),Number.MAX_VALUE),i=ky(ay(1,a));return kg(jS(ab(r,i)),-1)}))},squaredHinge:function(e,t){return ey((function(){var n=jy(0,ab(1,Yy(e,t)));return kg(jS(n),-1)}))},hinge:function(e,t){return ey((function(){var n=jy(0,ab(1,Yy(e,t)));return kg(n,-1)}))},categoricalHinge:function(e,t){return ey((function(){var n=xg(Yy(e,t),-1),r=z_(Yy(ab(1,e),t),-1);return jy(0,ay(1,ab(r,n)))}))},logcosh:function(e,t){return ey((function(){var n=Math.log(2),r=ab(t,e),a=ab(ay(r,Fy(Yy(-2,r))),n);return kg(a,-1)}))},categoricalCrossentropy:$T,sparseCategoricalCrossentropy:JT,binaryCrossentropy:eE,kullbackLeiblerDivergence:function(e,t){return ey((function(){var n=dy(e,FC(),1),r=dy(t,FC(),1);return xg(Yy(e,ky(tb(n,r))),-1)}))},poisson:function(e,t){return ey((function(){var n=ky(ay(FC(),t));return kg(ab(t,Yy(e,n)),-1)}))},cosineProximity:tE};function rE(e){if("string"==typeof e){if(e in nE)return nE[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new PC(t)}return e}function aE(e,t){return ey((function(){var n=Yy(.5,Qm(t)),r=OS(D_(t,n),e.dtype);return kg(N_(e,r),-1)}))}function iE(e,t){return ey((function(){return OS(N_(gg(e,-1),gg(t,-1)),"float32")}))}function oE(e,t){return eE(e,t)}function sE(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),N_(e,t).asType("float32")}var uE=$T,cE=JT,lE={binaryAccuracy:aE,categoricalAccuracy:iE,precision:function(e,t){return ey((function(){var n=function(e,t){return ey((function(){return x_(e.equal(1),t.equal(1)).sum().cast("float32")}))}(e,t),r=function(e,t){return ey((function(){return x_(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),a=n.add(r);return E_(D_(a,0),n.div(a),0).cast("float32")}))},categoricalCrossentropy:uE,sparseCategoricalCrossentropy:cE,mse:YT,MSE:YT,mae:QT,MAE:QT,mape:ZT,MAPE:ZT,cosine:tE};function hE(e){if("string"==typeof e&&e in lE)return lE[e];if("string"!=typeof e&&null!=e)return e;throw new PC("Unknown metric ".concat(e))}function fE(e){if(WC(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(nE);n<r.length;n++){var a=r[n];if(nE[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(lE);i<o.length;i++){var s=o[i];if(lE[s]===e){t=s;break}}return void 0!==t?t:e.name}function dE(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("string"!=typeof a)return!1;if(!e(t[a]))return!1}return!0}if(Array.isArray(t)){var i,o=_createForOfIteratorHelper(t);try{for(o.s();!(i=o.n()).done;){if(!e(i.value))return!1}}catch(az){o.e(az)}finally{o.f()}return!0}return!1}var s=typeof t;return"string"===s||"number"===s||"boolean"===s}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.")}}function pE(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function vE(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(az){r="multiple"}pE(["".concat(e.name," (").concat(e.getClassName(),")"),r,e.countParams().toString()],t,n)}function mE(e,t,n,r){var a;try{a=JSON.stringify(e.outputShape)}catch(az){a="multiple"}var i,o=[],s=_createForOfIteratorHelper(e.inboundNodes);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var c=0;c<u.inboundLayers.length;++c)o.push("".concat(u.inboundLayers[c].name,"[").concat(u.nodeIndices[c],"][").concat(u.tensorIndices[c],"]"))}}catch(az){s.e(az)}finally{s.f()}var l=e.name,h=e.getClassName(),f=0===o.length?"":o[0];pE(["".concat(l," (").concat(h,")"),a,e.countParams().toString(),f],t,r);for(var d=1;d<o.length;++d)pE(["","","",o[d]],t,r)}function gE(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function yE(e,t){if(null===e)return null;if("string"==typeof e)return GC(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];gE(t,a,i)?n.push(i):n.push(yE(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var h=GC(c);o[h]=yE(l,h)}}return o}var bE=function(){function e(t){if(_classCallCheck(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(az){a.e(az)}finally{a.f()}}}return _createClass(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new PC("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return tg(t,e.dtype)}catch(az){throw new PC("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof RT){if(null==this.id2Value[e.id])throw new PC("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new PC("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof RT){if(null==this.id2Value[e.id])throw new PC("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new PC("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&ty(this.id2Mask)}}]),e}(),kE={},_E={};function wE(e,t,n,a){var i,o=null!=n&&n.training,s=Array.isArray(e),u=s?e:[e],c=u.map((function(e){return e.name})),l=[],h=t.names(),f=_createForOfIteratorHelper(c);try{for(f.s();!(i=f.n()).done;){var d=i.value;-1!==h.indexOf(d)?l.push(t.getValue(d)):l.push(null)}}catch(az){f.e(az)}finally{f.f()}null!=a&&(a.maxNumTensors=-1/0,a.minNumTensors=1/0);var p,v,m=c.join(",")+"|"+t.names().join(",");if(null==kE[m]){var g=function(e,t){r.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],a={};if(1===e.length){var i=CE(e[0],t);n=i.sorted,a=i.recipientMap}else{var o,s=new Set,u=_createForOfIteratorHelper(e);try{for(u.s();!(o=u.n()).done;){var c,l=CE(o.value,t),h=l.sorted,f=l.recipientMap,d=_createForOfIteratorHelper(h);try{for(d.s();!(c=d.n()).done;){var p=c.value;s.has(p.name)||(n.push(p),s.add(p.name))}}catch(az){d.e(az)}finally{d.f()}var v=function(e){null==a[e]&&(a[e]=new Set),f[e].forEach((function(t){return a[e].add(t)}))};for(var m in f)v(m)}}catch(az){u.e(az)}finally{u.f()}}return{sorted:n,recipientCounts:xE(a)}}(u,t);p=g.sorted,v=g.recipientCounts,kE[m]=p,_E[m]=v}p=kE[m],v={},o||Object.assign(v,_E[m]);for(var y=new bE(t),b=0;b<p.length;++b){if(null!=a){var k=Jg().numTensors;k>a.maxNumTensors&&(a.maxNumTensors=k),k<a.minNumTensors&&(a.minNumTensors=k)}var _=p[b],w=_.sourceLayer;if(!(w instanceof MT)){var x,C=[],S=[],T=[],E=!1,A=_createForOfIteratorHelper(_.inputs);try{for(A.s();!(x=A.n()).done;){var I=x.value,R=y.getValue(I),N=y.getMask(I);C.push(R),S.push(N),null!=N&&(E=!0),o||(v[I.name]--,0!==v[I.name]||t.hasKey(I)||-1!==c.indexOf(I.name)||R.isDisposed||!0===I.sourceLayer.stateful||T.push(R))}}catch(az){A.e(az)}finally{A.f()}E&&((n=n||{}).mask=S[0]);var O=HC(w.apply(C,n)),D=null;w.supportsMasking&&(D=w.computeMask(C,S));for(var F=SE(_),M=Array.isArray(F)?F:[F],L=0;L<M.length;++L){y.hasKey(M[L])||y.add(M[L],O[L],Array.isArray(D)?D[0]:D);var P=c.indexOf(M[L].name);-1!==P&&(l[P]=O[L])}o||ty(T)}}return y.disposeMasks(),s?l:l[0]}function xE(e){var t={};for(var n in e)t[n]=e[n].size;return t}function CE(e,t){var n,r=new Set,a=[],i={},o=_createForOfIteratorHelper(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(az){o.e(az)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var h=c[c.length-1]===u.length-1;if(0===l.inputs.length||h)u.pop(),a.push(l),r.add(l.name),h&&c.pop();else{c.push(u.length-1);var f,d=_createForOfIteratorHelper(l.inputs);try{for(d.s();!(f=d.n()).done;){var p=f.value;null==i[p.name]&&(i[p.name]=new Set),i[p.name].add(l.name),r.has(p.name)||u.push(p)}}catch(az){d.e(az)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function SE(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=_createForOfIteratorHelper(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(az){i.e(az)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function TE(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided classWeight is an array of ".concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){a.push(t in e?e[t]:null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so classWeight must be either an array with "+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided classWeight not understood: ".concat(JSON.stringify(e)))}(e,t)}function EE(e,t,n,r){return AE.apply(this,arguments)}function AE(){return(AE=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=12;break}return i=ey((function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),ty(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),zm(s,"float32")));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function IE(e,t){return Yy(e,t)}function RE(e,t){var n,a;n=t.xs,a=t.ys,r.assert(null!=n&&null!=a,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=NE("input",e.inputNames,n),o=NE("output",e.outputNames,a),s=i[0].shape[0];r.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),r.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){r.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){r.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)l(h);return{xs:i,ys:o}}function NE(e,t,n){if(n instanceof Kv)return[n];if(Array.isArray(n))return r.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var a,i=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(null==n[s])throw new PC("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(s,"'."));i.push(n[s])}}catch(az){o.e(az)}finally{o.f()}return i}function OE(e){return"function"==typeof e.iterator}function DE(e){r.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function FE(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return FS(e,t,n-t)})):FS(e,t,n-t)}function ME(e,t){return ey((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return ME(e,t)})):VS(e,"int32"===t.dtype?t:t.toInt())}))}function LE(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function PE(e){var t=[];e instanceof Kv&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(DS(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function zE(e,t){if(null!=e){var n=[];if(t instanceof Kv)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t)n.push(t[r].id);var a=[];if(e instanceof Kv)-1===n.indexOf(e.id)&&a.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&a.push(e)}));else if(null!=e)for(var i in e){var o=e[i];-1===n.indexOf(o.id)&&a.push(o)}a.forEach((function(e){e.isDisposed||e.dispose()}))}}function BE(e){return Array.isArray(e)}function UE(e){return!function(e){return e instanceof Kv}(e)&&!BE(e)}function WE(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(BE(e)&&e.length>0)o=!0;else if(UE(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new PC("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(UE(e)){e=e,r=[];var u,c=_createForOfIteratorHelper(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new PC('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch(az){c.e(az)}finally{c.f()}}else if(BE(e)){if((e=e).length!==t.length)throw new PC("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(e=e,t.length>1)throw new PC("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=PE(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var f=r[h];if(f.shape.length!==n[h].length)throw new PC("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have ".concat(n[h].length," dimension(s). but got array with ")+"shape ".concat(f.shape));for(var d=0;d<n[h].length;++d)if(0!==d||a){var p=f.shape[d],v=n[h][d];if(null!=v&&v>=0&&p!==v)throw new PC("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have shape [".concat(n[h],"], but got array with shape ")+"[".concat(f.shape,"]."))}}return r}function VE(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new PC("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new PC("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new PC("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new PC("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var jE=function(e){_inherits(l,e);var t,n,a,i,o,u,c=_createSuper(l);function l(e){var t;return _classCallCheck(this,l),(t=c.call(this,e)).isTraining=!1,t}return _createClass(l,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new PC("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,_toConsumableArray(s))}if(t){var u,c=_createForOfIteratorHelper(e.layers);try{for(c.s();!(u=c.n()).done;){var l,h=u.value,f=!1,d=_createForOfIteratorHelper(h.inboundNodes);try{for(d.s();!(l=d.n()).done;){var p=l.value;if(-1!==r.indexOf(p)){if(f){t=!1;break}f=!0}}}catch(az){d.e(az)}finally{d.f()}if(!t)break}}catch(az){c.e(az)}finally{c.f()}}return t}(e),o=["Layer (type)","Output shape","Param #"];if(i?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,_toConsumableArray(e.nodesByDepth[s]))}a("_".repeat(t)),pE(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?vE(c[l],n,a):mE(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=function(e){return CT(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights)}(e),f=CT(e.nonTrainableWeights);a("Total params: ".concat(h+f)),a("Trainable params: ".concat(h)),a("Non-trainable params: ".concat(f)),a("_".repeat(t))}(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return eC.adagrad(.01)},Adadelta:function(){return eC.adadelta(1,.95,FC())},Adam:function(){return eC.adam(.001,.9,.999,FC())},Adamax:function(){return eC.adamax(.002,.9,.999,FC(),0)},RMSProp:function(){return eC.rmsprop(.001,.9,0,FC())},SGD:function(){return eC.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new PC("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof qx))throw new PC("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new PC("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));n=e.loss.map((function(e){return rE(e)}))}else{var r=rE(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new PC('Unknown entry in loss dictionary: "'.concat(a,'". ')+"Only expected the following keys: ".concat(this.outputNames));var i,o=_createForOfIteratorHelper(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),n.push(rE(e.loss[s]))}}catch(az){o.e(az)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u];this.feedOutputNames.push(this.outputNames[u]),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var l=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],wS("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===l.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=_createForOfIteratorHelper(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(az){i.e(az)}finally{i.f()}return a}(e.metrics,this.outputNames),f=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};wS("metric",(function(){for(var e=function(e){-1===l.indexOf(e)&&function(n){var r,a,i,o,s=_createForOfIteratorHelper(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"==typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e],l=void 0;1===c[c.length-1]||t.lossFunctions[e]===eE?-1!==["accuracy","acc"].indexOf(u)?a=aE:-1!==["crossentropy","ce"].indexOf(u)&&(a=oE):t.lossFunctions[e]===JT?-1!==["accuracy","acc"].indexOf(u)?a=sE:-1!==["crossentropy","ce"].indexOf(u)&&(a=cE):-1!==["accuracy","acc"].indexOf(u)?a=iE:-1!==["crossentropy","ce"].indexOf(u)&&(a=uE),-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var h=hE(u);i=h,r=""+fE(u)}var d=void 0;wS(r,(function(){d=i})),f(e,r,d)}}catch(az){s.e(az)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;DE(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);return this.makeTestFunction(),jC(this.testLoop(this.testFunction,i,r,n.verbose,n.steps))}finally{zE(a[0],e),zE(a[1],t)}}},{key:"evaluateDataset",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=(a=a||{}).batches,o=t.testFunction,s=[],!(a.verbose>0)){e.next=4;break}throw new zC("Verbose mode is not implemented yet.");case 4:if(r.assert(!i||a.batches>0&&Number.isInteger(a.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(a.batches))})),"function"!=typeof n.next){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:u=e.t0,c=0,l=0,h=regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.next();case 2:if(n=e.sent,s=ey((function(){return n.value&&function(){var e=RE(t,n.value),r=e.xs,a=e.ys,i=r.concat(a),u=ey((function(){return o(i)}));if(ty(i),0===l)for(var h=0;h<u.length;++h)s.push(Pm(0));for(var f=i[0].shape[0],d=function(e){var t=u[e],n=s[e];s[e]=ey((function(){return ay(s[e],Yy(f,t))})),l>0&&ty(n)},p=0;p<u.length;++p)d(p);ty(u),c+=f,++l}(),s})),!n.done){e.next=6;break}return i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(a.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 15:if(i&&!(l<a.batches)){e.next=22;break}return e.delegateYield(h(),"t1",17);case 17:if("break"!==e.t1){e.next=20;break}return e.abrupt("break",22);case 20:e.next=15;break;case 22:for(f=0;f<s.length;++f)d=s[f],s[f]=tb(s[f],c),ty(d);return e.abrupt("return",jC(s));case 24:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new PC("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new PC("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new PC("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),a=new bE;if(e instanceof Kv&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new PC("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var i=0;i<this.inputs.length;++i)a.add(this.inputs[i],e[i])}else{var o,s=_createForOfIteratorHelper(this.inputs);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=e[u.name];if(null==c)throw new PC("No value is provided for the model's input ".concat(u.name));a.add(u,c)}}catch(az){s.e(az)}finally{s.f()}}var l=wE(r,a);return n?l:l[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=UC(null,e.length),r=e.length,a=_createForOfIteratorHelper(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(az){a.e(az)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new PC("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ey((function(){var a=t.checkNumSamples(e);if(r)throw new zC("Verbose predictLoop() is not implemented yet.");for(var i=LE(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){ey((function(){var r=FE(e,i[n][0],i[n][1]),a=[];if(Array.isArray(r))for(var o=0;o<r.length;++o)a.push({key:t.inputs[o],value:r[o]});else a.push({key:t.inputs[0],value:r});var s=new bE(a);return wE(t.outputs,s)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return jC(o.map((function(e){return $m(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=PE(e);VE(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return DE(r),this.predictLoop(n,r)}finally{zE(n,e)}}},{key:"predictOnBatch",value:function(e){VE(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new LC("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],i=0;i<this.feedOutputShapes.length;++i){var o=this.feedOutputShapes[i];a.push(this.feedLossFns[i]===JT?o.slice(0,o.length-1).concat([1]):o)}if(function(e,t,n){var a=ZC(e.map((function(e){return e.shape[0]})));a.sort();var i=ZC(t.map((function(e){return e.shape[0]})));if(i.sort(),a.length>1)throw new PC("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(i.length>1)throw new PC("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(a.length>0&&i.length>0&&!r.arraysEqual(a,i))throw new PC("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(a[0]," input sample(s) and ").concat(i[0]," target ")+"sample(s).")}(e=WE(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=WE(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){for(var r=[YT,eE,$T],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===$T&&1===i.shape[i.shape.length-1])throw new PC("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],f=c[l];if(null!=f&&h!==f)throw new PC("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!=0)throw new PC("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,f,d,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(p.length>4&&void 0!==p[4])||p[4],o=p.length>5?p[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=_slicedToArray(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(h=null,null==a){e.next=19;break}f=TE(a,this.outputNames),h=[],d=0;case 10:if(!(d<f.length)){e.next=19;break}return e.t0=h,e.next=14,EE(l[d],null,f[d]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++d,e.next=10;break;case 19:return e.abrupt("return",[c,l,h]);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return ey((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new zC("Verbose mode is not implemented yet.");if(null!=i)throw new zC("steps mode in testLoop() is not implemented yet");for(var u=LE(o,n),c=zm(NS(0,o)),l=0;l<u.length;++l){var h=u[l][0],f=u[l][1],d=FS(c,h,f-h),p=ME(t,d),v=e(p);if(0===l)for(var m=0;m<v.length;++m)s.push(Pm(0));for(var g=0;g<v.length;++g)s[g]=ay(s[g],Yy(f-h,v[g]))}for(var y=0;y<s.length;++y)s[y]=tb(s[y],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;VC(e,r)>1&&(a+="_".concat(VC(e.slice(0,n),r))),t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new bE(t),l=wE(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var f=(0,e.lossFunctions[h])(a[h],l[h]);null!=i[h]&&(f=IE(f,i[h]));var d=kg(f);n.push(d),u=0===h?f:ay(u,f)}for(var p=0;p<e.metricsTensors.length;++p){var v=void 0;if(e.outputs.length>1&&p<e.outputs.length)v=n[p];else{var m=e.metricsTensors[p][1];v=kg((0,e.metricsTensors[p][0])(a[m],l[m]))}ny(v),o.push(v)}return u=kg(u),e.calculateLosses().forEach((function(e){u=ay(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return ey((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new bE(o),c=wE(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=kg((0,e.lossFunctions[l])(i[l],c[l]));n=0===l?h:ay(n,h),r.push(n)}for(var f=0;f<e.metricsTensors.length;++f){var d=e.metricsTensors[f][1],p=kg((0,e.metricsTensors[f][0])(i[d],c[d]));r.push(p)}return r}))}}},{key:"fit",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:{},e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,k,_,w,x,C,S,T,E,A=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=A.length>3&&void 0!==A[3]?A[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,DE(d=null==i.batchSize?32:i.batchSize),p=!1,e.next=10,t.standardizeUserData(n,a,i.sampleWeight,i.classWeight,p,d);case 10:if(v=e.sent,o=v[0],s=v[1],f=v[2],g=!1,!(null!=i.validationData&&i.validationData.length>0)){e.next=24;break}if(g=!0,2===i.validationData.length){e.next=16;break}throw 3===i.validationData.length?new zC("validationData including sample weights is not supported yet."):new PC("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(i.validationData," is invalid."));case 16:return u=i.validationData[0],c=i.validationData[1],y=!0,e.next=20,t.standardizeUserData(u,c,null,null,y,d);case 20:b=e.sent,l=b[0],h=b[1],m=l.concat(h),e.next=25;break;case 24:null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(g=!0,k=Math.floor(o[0].shape[0]*(1-i.validationSplit)),_=o[0].shape[0],l=FE(o,k,_),o=FE(o,0,k),h=FE(s,k,_),s=FE(s,0,k),m=l.concat(h)):null!=i.validationSteps&&(g=!0);case 25:return w=o.concat(s).concat(f),t.checkTrainableWeightsConsistency(),x=t.makeTrainFunction(),C=t.getDedupedMetricsNames(),g?(t.makeTestFunction(),S=t.testFunction,T=C.slice().concat(C.map((function(e){return"val_"+e})))):(S=null,m=[],T=C.slice()),E=HT(i.callbacks,i.yieldEvery),e.next=32,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i,o,s,u,c,l,h,f,d,p,v,m){var g,y,b,k,_,w,x,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==o&&(o=32),null==s&&(s=1),null==f&&(f=!0),null==p&&(p=0),g=!1,null!=l&&null!=h&&(g=!0),null!=(y=t.checkNumSamples(a,o,null,"steps_per_epoch"))&&(b=NS(0,y)),null==u&&(u=1),k=GT(c,u,s,p,y,null,o,g,d),_=k.callbackList,w=k.history,_.setModel(t),t.history=w,e.next=10,_.onTrainBegin();case 10:t.stopTraining_=!1,x=regeneratorRuntime.mark((function e(s){var u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.onEpochBegin(s);case 2:return u={},e.delegateYield(regeneratorRuntime.mark((function e(){var s,c,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==f){e.next=2;break}throw new zC("batch shuffling is not implemneted yet");case 2:f&&r.shuffle(b),s=zm(b),c=LE(y,o),d=regeneratorRuntime.mark((function e(r){var f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={},e.next=3,_.onBatchBegin(r,f);case 3:return ey((function(){var e=c[r][0],d=c[r][1],p=FS(s,e,d-e);f.batch=r,f.size=d-e;for(var v=ME(a,p),m=n(v),y=0;y<i.length;++y){var b=m[y];f[i[y]]=b,ny(b)}if(r===c.length-1&&g)for(var k=t.testLoop(l,h,o),_=0;_<i.length;++_){var w=i[_],x=k[_];ny(x),u["val_"+w]=x}})),e.next=6,_.onBatchEnd(r,f);case 6:if(zT(f),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),p=0;case 6:if(!(p<c.length)){e.next=14;break}return e.delegateYield(d(p),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:++p,e.next=6;break;case 14:s.dispose();case 15:case"end":return e.stop()}}),e)}))(),"t0",4);case 4:return e.next=6,_.onEpochEnd(s,u);case 6:if(!t.stopTraining_){e.next=8;break}return e.abrupt("return","break");case 8:case"end":return e.stop()}}),e)})),C=p;case 13:if(!(C<s)){e.next=21;break}return e.delegateYield(x(C),"t0",15);case 15:if("break"!==e.t0){e.next=18;break}return e.abrupt("break",21);case 18:++C,e.next=13;break;case 21:return e.next=23,_.onTrainEnd();case 23:return e.next=25,t.history.syncData();case 25:return e.abrupt("return",t.history);case 26:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i,o,s,u,c,l,h,f,d,p,v){return e.apply(this,arguments)}}()(t,x,w,C,d,i.epochs,i.verbose,E,S,m,i.shuffle,T,i.initialEpoch);case 32:return e.abrupt("return",e.sent);case 33:return e.prev=33,t.isTraining=!1,zE(o,n),zE(s,a),zE(l,u),zE(h,c),null!=f&&ty(f),e.finish(33);case 36:case"end":return e.stop()}}),e,null,[[4,,33,36]])})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n,a));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fitDataset",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,k,_,w,x,C,S,T,E,A,I,R,N,O,D,F,M,L;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=a.batchesPerEpoch,r.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),r.assert(null!=a,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),r.assert(null!=a.epochs&&a.epochs>0&&Number.isInteger(a.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(a.epochs)})),r.assert(!i||a.batchesPerEpoch>0&&Number.isInteger(a.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(a.batchesPerEpoch)})),r.assert(null==a.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(o=null!=a.validationData)&&(OE(a.validationData)?r.assert(null==a.validationBatches||a.validationBatches>0&&Number.isInteger(a.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(a.validationBatches)})):(c=function(e){if(3===e.length)throw new zC("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(a.validationData),s=c.xs,u=c.ys)),l=t.makeTrainFunction(),h=t.getDedupedMetricsNames(),f=o?h.slice().concat(h.map((function(e){return"val_"+e}))):h.slice(),d=HT(a.callbacks,a.yieldEvery),p=null==a.verbose?1:a.verbose,v=GT(d,p,a.epochs,null,null,function(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(n,a),null,o,f),m=v.callbackList,g=v.history,m.setModel(t),t.history=g,e.next=14,m.onTrainBegin();case 14:return t.stopTraining_=!1,y=null==a.initialEpoch?0:a.initialEpoch,e.next=18,n.iterator();case 18:b=e.sent;case 19:if(!(y<a.epochs)){e.next=89;break}return k={},e.next=23,m.onEpochBegin(y);case 23:if(_=0,w=0,e.t0=i,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:b=e.sent;case 29:if(i&&!(_<a.batchesPerEpoch)){e.next=82;break}return e.next=32,b.next();case 32:if(x=e.sent,!i||!x.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(a.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(_," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(a.batchesPerEpoch*a.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",82);case 36:if(null==x.value){e.next=63;break}return C=RE(t,x.value),S=C.xs,T=C.ys,(E={}).batch=w,E.size=S[0].shape[0],e.next=42,m.onBatchBegin(w,E);case 42:if(A=[],null==a.classWeight){e.next=55;break}I=TE(a.classWeight,t.outputNames),R=0;case 46:if(!(R<I.length)){e.next=55;break}return e.t1=A,e.next=50,EE(T[R],null,I[R]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++R,e.next=46;break;case 55:for(N=S.concat(T).concat(A),O=l(N),ty(N),D=0;D<h.length;++D)F=O[D],E[h[D]]=F,ny(F);return e.next=60,m.onBatchEnd(w,E);case 60:zT(E),w++,_++;case 63:if(!(i?_>=a.batchesPerEpoch:x.done)){e.next=78;break}if(!o){e.next=77;break}if(M=void 0,!OE(a.validationData)){e.next=74;break}return e.t4=HC,e.next=70,t.evaluateDataset(a.validationData,{batches:a.validationBatches});case 70:e.t5=e.sent,e.t3=(0,e.t4)(e.t5),e.next=75;break;case 74:e.t3=HC(t.evaluate(s,u,{batchSize:null==a.validationBatchSize?32:a.validationBatchSize,verbose:0}));case 75:for(M=e.t3,L=0;L<t.metricsNames.length;++L)k["val_".concat(t.metricsNames[L])]=M[L];case 77:return e.abrupt("break",82);case 78:if(!t.stopTraining_){e.next=80;break}return e.abrupt("break",82);case 80:e.next=29;break;case 82:return e.next=84,m.onEpochEnd(y,k);case 84:if(y++,!t.stopTraining_){e.next=87;break}return e.abrupt("break",89);case 87:e.next=19;break;case 89:return e.next=91,m.onTrainEnd();case 91:return e.next=93,t.history.syncData();case 93:return e.abrupt("return",t.history);case 94:return e.prev=94,t.isTraining=!1,e.finish(94);case 97:case"end":return e.stop()}}),e,null,[[4,,94,97]])})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"trainOnBatch",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=_createForOfIteratorHelper(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:h=e.sent,s.push(h[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(ty(o),jC(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(e,t){return n.apply(this,arguments)})},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"dispose",value:function(){var e=_get(_getPrototypeOf(l.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=Jg().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Jg().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=qC(this.loss);else if(Array.isArray(this.loss)){var t,n=_createForOfIteratorHelper(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(az){n.e(az)}finally{n.f()}e=this.loss.map((function(e){return qC(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=qC(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[qC(fE(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return qC(fE(e))}));var e={};for(var t in this.metrics)e[t]=qC(fE(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=KT(yE(e.optimizer_config));if("string"==typeof e.loss)t=GC(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return GC(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=GC(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return GC(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=GC(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=s.getSaveHandlers(t)).length){e.next=4;break}throw new PC("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new PC("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new PC("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,s.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v2.0.0",convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=27;break}return i.trainingConfig=this.getTrainingConfig(),u="optimizer",e.t0=s,e.next=19,this.optimizer.getWeights();case 19:return e.t1=e.sent,e.t2=u,e.next=23,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 23:c=e.sent,l=c.data,h=c.specs,(o=a.specs).push.apply(o,_toConsumableArray(h)),a.data=s.concatenateArrayBuffers([a.data,l]);case 27:return e.abrupt("return",(null!=this.userDefinedMetadata&&(dE(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 28:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setUserDefinedMetadata",value:function(e){dE(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}},{key:"stopTraining",set:function(e){this.stopTraining_=e},get:function(){return this.stopTraining_}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}}]),l}(function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=bT(a)}if(r.supportsMasking=!1,r.trainable_=!0,r.inputs=Array.isArray(e.inputs)?e.inputs.slice():[e.inputs],r.outputs=Array.isArray(e.outputs)?e.outputs.slice():[e.outputs],ZC(r.inputs).length!==r.inputs.length)throw new PC("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));ZC(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=_createForOfIteratorHelper(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.nodeIndex,c=s.tensorIndex;r.outputLayers.push(s.sourceLayer),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(c)}}catch(az){o.e(az)}finally{o.f()}var l,h=_createForOfIteratorHelper(r.inputs);try{for(h.s();!(l=h.n()).done;){var f=l.value,d=f.sourceLayer,p=f.nodeIndex,v=f.tensorIndex;WC(0===p,"input layer has >1 nodes"),WC(0===v,"input layer has >1 tensors"),r.inputLayers.push(d),r.inputLayersNodeIndices.push(p),r.inputLayersTensorIndices.push(v)}}catch(az){h.e(az)}finally{h.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var m=0;m<r.inputLayers.length;m++){var g=r.inputLayers[m];if(!(g instanceof MT))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(m," (0-based) originates ")+"from layer type ".concat(g.getClassName(),"."));r.inputNames.push(g.name),r.feedInputShapes.push(g.batchInputShape),r.feedInputNames.push(g.name)}var y,b=_createForOfIteratorHelper(r.outputLayers);try{for(b.s();!(y=b.n()).done;){var k=y.value;r.outputNames.push(k.name)}}catch(az){b.e(az)}finally{b.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var _,w={},x={},C={},S={},T={},E=[],A=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new LC("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in T||(T[o.id]=Object.keys(T).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++)e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h]);for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},I=[],R=[],N=_createForOfIteratorHelper(r.outputs);try{for(N.s();!(_=N.n()).done;){A(_.value,I,R)}}catch(az){N.e(az)}finally{N.f()}var O,D=_createForOfIteratorHelper(E.slice().reverse());try{for(D.s();!(O=D.n()).done;){var F=O.value;x[F.id]=F,F.id in w||(w[F.id]=0);var M=w[F.id];M=Math.max(M,null==C[F.outboundLayer.id]?0:C[F.outboundLayer.id]),C[F.outboundLayer.id]=M,S[F.outboundLayer.id]=F.outboundLayer,w[F.id]=M;for(var L=0;L<F.inboundLayers.length;L++){var P=F.inboundLayers[L].inboundNodes[F.nodeIndices[L]];w[P.id]=Math.max(M+1,null==w[P.id]?0:w[P.id]),x[P.id]=P}}}catch(az){D.e(az)}finally{D.f()}var z={};for(var B in w){var U=w[B];U in z||(z[U]=[]),z[U].push(x[B])}var W={};for(var V in C){var j=C[V];j in W||(W[j]=[]),W[j].push(S[V])}var H=Object.keys(W).map((function(e){return parseInt(e,10)})).sort(QC);r.layers=[];var q,G=_createForOfIteratorHelper(H);try{for(G.s();!(q=G.n()).done;){var K=W[q.value];K.sort((function(e,t){var n=T[e.id],r=T[t.id];return n<r?-1:n>r?1:0}));var X,Y=_createForOfIteratorHelper(K);try{for(Y.s();!(X=Y.n()).done;){var Q=X.value;Q instanceof n&&r.internalContainerRefs.push(Q),r.layers.push(Q)}}catch(az){Y.e(az)}finally{Y.f()}}}catch(az){G.e(az)}finally{G.f()}r.layersByDepth=W,H=Object.keys(z).map((function(e){return parseInt(e,10)})).sort(QC);var Z,$=r.inputs.slice(),J=[],ee=_createForOfIteratorHelper(H);try{for(ee.s();!(Z=ee.n()).done;){var te,ne=_createForOfIteratorHelper(z[Z.value]);try{for(ne.s();!(te=ne.n()).done;){var re=te.value,ae=re.outboundLayer;if(null!=ae){var ie,oe=_createForOfIteratorHelper(re.inputTensors);try{for(oe.s();!(ie=oe.n()).done;){var se=ie.value;if(-1===$.indexOf(se))throw new LC("Graph disconnected: cannot obtain value for tensor ".concat(se)+' at layer "'.concat(ae.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(J))}}catch(az){oe.e(az)}finally{oe.f()}var ue,ce=_createForOfIteratorHelper(re.outputTensors);try{for(ce.s();!(ue=ce.n()).done;){var le=ue.value;$.push(le)}}catch(az){ce.e(az)}finally{ce.f()}J.push(ae.name)}}}catch(az){ne.e(az)}finally{ne.f()}}}catch(az){ee.e(az)}finally{ee.f()}r.nodesByDepth=z;var he,fe=r.layers.map((function(e){return e.name})),de=_createForOfIteratorHelper(fe);try{var pe=function(){var e=he.value,t=fe.filter((function(t){return t===e})).length;if(1!==t)throw new LC('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(fe))};for(de.s();!(he=de.n()).done;)pe()}catch(az){de.e(az)}finally{de.f()}return r.outboundNodes=[],r.inboundNodes=[],new OT({outboundLayer:_assertThisInitialized(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,_possibleConstructorReturn(r)}return _createClass(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){var t,n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(az){n.e(az)}finally{n.f()}var a,i=_createForOfIteratorHelper(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(az){i.e(az)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=_createForOfIteratorHelper(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new PC("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(az){u.e(az)}finally{u.f()}}}catch(az){i.e(az)}finally{i.f()}var l=[];for(var h in e){if(null!=r[h])l.push([r[h],e[h]]);else if(n)throw new PC("Provided weight data has no target variable: ".concat(h));delete r[h]}if(n){var f=[];for(var d in r)f.push(d);if(f.length>0)throw new PC("".concat(f.length," of ").concat(a," weights are not set: ")+"".concat(f))}ET(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 2.0.0",t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function e(t,n){if(null==t)return null;if("string"==typeof t)return qC(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],a=t.length,i=0;i<a;++i){var o=t[i];gE(n,i,o)?r.push(o):r.push(e(o,n))}return r}for(var s={},u=0,c=Object.keys(t);u<c.length;u++){var l=c[u],h=t[l];s[qC(l)]="name"!==l&&"className"!==l||"string"!=typeof h?e(h,l):h}return s}(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return ey((function(){e=HC(e);for(var r=new bE,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return wE(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return ey((function(){var r;return e=HC(e),r=null==t?UC(null,e.length):HC(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=_T(e);if(t.length!==this.inputLayers.length)throw new PC("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++)n[this.inputLayers[r].name+"_0_0"]=t[r];var a=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(QC);if(a.length>1){var i,o=_createForOfIteratorHelper(a);try{for(o.s();!(i=o.n()).done;){var s,u=i.value,c=_createForOfIteratorHelper(this.nodesByDepth[u]);try{for(c.s();!(s=c.n()).done;){var l=s.value,h=l.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var f=[],d=0;d<l.inboundLayers.length;d++)f.push(n["".concat(l.inboundLayers[d].name,"_").concat(l.nodeIndices[d],"_").concat(l.tensorIndices[d])]);for(var p=_T(h.computeOutputShape(jC(f))),v=h.inboundNodes.indexOf(l),m=0;m<p.length;m++)n["".concat(h.name,"_").concat(v,"_").concat(m)]=p[m]}}}catch(az){c.e(az)}finally{c.f()}}}catch(az){o.e(az)}finally{o.f()}}for(var g=[],y=[],b=0;b<this.outputLayers.length;b++)y.push("".concat(this.outputLayers[b].name,"_").concat(this.outputLayersNodeIndices[b],"_").concat(this.outputLayersTensorIndices[b]));for(var k=0;k<y.length;k++){var _=y[k];WC(_ in n),g.push(n[_])}return jC(g)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=UC(null,e.length));for(var n={},r=0;r<this.inputs.length;++r)n[this.inputs[r].id]=[e[r],t[r]];var a,i=_createForOfIteratorHelper(Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(QC));try{for(i.s();!(a=i.n()).done;){var o,s=a.value,u=_createForOfIteratorHelper(this.nodesByDepth[s]);try{for(u.s();!(o=u.n()).done;){var c,l=o.value,h=l.outboundLayer,f=l.inputTensors,d=l.outputTensors,p=new Array,v=_createForOfIteratorHelper(f);try{for(v.s();!(c=v.n()).done;){var m=c.value;m.id in n&&p.push(n[m.id])}}catch(az){v.e(az)}finally{v.f()}if(p.length===f.length){var g=void 0,y=void 0,b=void 0,k=void 0,_={};if(null!=l.callArgs&&(_=l.callArgs),1===p.length){var w=_slicedToArray(p[0],2),x=w[0],C=w[1];null==_.mask&&(_.mask=C),b=HC(h.call(x,_)),k=HC(h.computeMask(x,C)),g=[x],y=[C]}else g=p.map((function(e){return e[0]})),y=p.map((function(e){return e[1]})),null==_.mask&&(_.mask=y),b=HC(h.call(g,_)),k=HC(h.computeMask(g,y));if(h.activityRegularizer)throw new zC("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var S=0;S<d.length;++S)n[d[S].id]=[b[S],k[S]]}}}catch(az){u.e(az)}finally{u.f()}}}catch(az){i.e(az)}finally{i.f()}var T,E=[],A=[],I=[],R=_createForOfIteratorHelper(this.outputs);try{for(R.s();!(T=R.n()).done;){var N=T.value;WC(N.id in n,"Could not compute output ".concat(N.name," : ").concat(N.id));var O=_slicedToArray(n[N.id],2),D=O[0],F=O[1];I.push(D.shape),E.push(D),A.push(F)}}catch(az){R.e(az)}finally{R.f()}return[E,A,I]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(az){i.e(az)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new PC("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new PC("Provide either a layer name or layer index");var n,r=_createForOfIteratorHelper(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(az){r.e(az)}finally{r.f()}throw new PC("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return ey((function(){var t,r=[],a=_createForOfIteratorHelper(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,_toConsumableArray(i.calculateLosses()))}}catch(az){a.e(az)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var h=o.inboundNodes[l],f=n.nodeKey(o,l),d={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),d=h.callArgs}catch(az){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(h.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),d={}}if(h.inboundLayers.length>0){for(var p=[],v=0;v<h.inboundLayers.length;v++){var m=h.inboundLayers[v],g=h.tensorIndices[v],y=r[n.nodeKey(m,h.nodeIndices[v])];null==y&&(y=0),p.push([m.name,y,g,d])}c.push(p)}}}var b={};b.name=o.name,b.className=s,b.config=u,b.inboundNodes=c,a.push(b)}}catch(az){i.e(az)}finally{i.f()}t.layers=a;for(var k=[],_=0;_<this.inputLayers.length;_++){var w=this.inputLayers[_],x=n.nodeKey(w,this.inputLayersNodeIndices[_]);if(this.containerNodes.has(x)){var C=r[x];null==C&&(C=0),k.push([w.name,C,this.inputLayersTensorIndices[_]])}}t.inputLayers=k;for(var S=[],T=0;T<this.outputLayers.length;T++){var E=this.outputLayers[T],A=n.nodeKey(E,this.outputLayersNodeIndices[T]);if(this.containerNodes.has(A)){var I=r[A];null==I&&(I=0),S.push([E.name,I,this.outputLayersTensorIndices[T]])}}return t.outputLayers=S,t}},{key:"resetStates",value:function(){var e=this;ey((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new PC("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(az){n.e(az)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.nonTrainableWeights))}}catch(az){n.e(az)}finally{n.f()}if(!this.trainable){var a,i=[],o=_createForOfIteratorHelper(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,_toConsumableArray(s.trainableWeights))}}catch(az){o.e(az)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){if(this._stateful)throw new PC("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=_createForOfIteratorHelper(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(az){t.e(az)}finally{t.f()}return!1}}],[{key:"fromConfig",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=_createForOfIteratorHelper(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var f=r[c];if(f.inboundNodes.length<=l)return void i(e,t);o.push(f.inboundNodes[l].outputTensors[h])}}catch(az){s.e(az)}finally{s.f()}o.length>0&&e.apply(jC(o),n)}function s(e){var a=e.name,o=KT(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new PC("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,h=_createForOfIteratorHelper(l);try{for(h.s();!(u=h.n()).done;){var f=u.value;s(f)}}catch(az){h.e(az)}finally{h.f()}for(;!$C(a);){var d,p=_createForOfIteratorHelper(l);try{for(p.s();!(d=p.n()).done;){var v=d.value,m=r[v.name];if(m.name in a){var g=a[m.name];delete a[m.name];var y,b=_createForOfIteratorHelper(g);try{for(b.s();!(y=b.n()).done;){var k=y.value;o(m,k)}}catch(az){b.e(az)}finally{b.f()}}}}catch(az){p.e(az)}finally{p.f()}}var _,w=[],x=[],C=t.inputLayers,S=_createForOfIteratorHelper(C);try{for(S.s();!(_=S.n()).done;){var T=_.value,E=T[0],A=T[1],I=T[2];WC(E in r),w.push(r[E].inboundNodes[A].outputTensors[I])}}catch(az){S.e(az)}finally{S.f()}var R,N=t.outputLayers,O=_createForOfIteratorHelper(N);try{for(O.s();!(R=O.n()).done;){var D=R.value,F=D[0],M=D[1],L=D[2];WC(F in r),x.push(r[F].inboundNodes[M].outputTensors[L])}}catch(az){O.e(az)}finally{O.f()}return new e({inputs:w,outputs:x,name:c})}}]),n}(FT));jE.className="Model",c.registerClass(jE);var HE=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e){var t;if(_classCallCheck(this,s),e=e||{},(t=o.call(this,{inputs:[],outputs:[]})).trainable=!0,t.built=!1,t.name=null!=e.name?e.name:bT("sequential_"),null!=e.layers){var n,r=_createForOfIteratorHelper(e.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;t.add(a)}}catch(az){r.e(az)}finally{r.f()}}return _possibleConstructorReturn(t)}return _createClass(s,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new PC("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,n=e instanceof s||e instanceof jE;if(n){if(1!==(t=e).outputs.length)throw new PC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new PC("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new PC("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var r=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new PC("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new MT({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new PC("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new PC("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var a=n.inboundNodes[r];if(0===a.inboundLayers.length)return a.inputTensors;for(var i=[],o=0;o<a.inboundLayers.length;o++){var s,u=_createForOfIteratorHelper(e(a.inputTensors[o],a.inboundLayers[o],a.nodeIndices[o]));try{for(u.s();!(s=u.n()).done;){var c=s.value;-1===i.indexOf(c)&&i.push(c)}}catch(az){u.e(az)}finally{u.f()}}return i}(this.outputs[0])}this.inboundNodes=[],new OT({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:UC(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(xT(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new jE({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),_get(_getPrototypeOf(s.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),_get(_getPrototypeOf(s.prototype),"summary",this).call(this,e,t,n)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new LC("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new LC("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"fit",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new LC("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"fitDataset",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new LC("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"trainOnBatch",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getConfig",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(az){n.e(az)}finally{n.f()}return{name:this.name,layers:t}}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"stopTraining",set:function(e){if(null==this.model)throw new PC("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},get:function(){if(null==this.model)throw new PC("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}}],[{key:"fromConfig",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new PC("Legacy serialization format not supported yet.");n=t}else r.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),n=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof s))throw new zC("Sequential.fromConfig called on non-Sequential input: ".concat(o));var u,c=_createForOfIteratorHelper(n);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=KT(l,void 0,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}}catch(az){c.e(az)}finally{c.f()}return o}}]),s}(jE);HE.className="Sequential",c.registerClass(HE);var qE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getConfig",value:function(){return{}}}]),n}(c.Serializable),GE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new zC("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Fw(e)}(e,t)}}]),n}(qE);GE.className="elu",c.registerClass(GE);var KE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Bw(e)}}]),n}(qE);KE.className="selu",c.registerClass(KE);var XE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Pw(e)}}]),n}(qE);XE.className="relu",c.registerClass(XE);var YE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return ey((function(){return qy(6,Pw(e))}))}}]),n}(qE);YE.className="relu6",c.registerClass(YE);var QE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return e}}]),n}(qE);QE.className="linear",c.registerClass(QE);var ZE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Ey(e)}}]),n}(qE);ZE.className="sigmoid",c.registerClass(ZE);var $E=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return function(e){return ey((function(){var t=ay(.5,Yy(.2,e));return dy(t,0,1)}))}(e)}}]),n}(qE);$E.className="hardSigmoid",c.registerClass($E);var JE=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return Fy(e)}}]),n}(qE);JE.className="softplus",c.registerClass(JE);var eA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return function(e){return ey((function(){return tb(e,iy(e).add(1))}))}(e)}}]),n}(qE);eA.className="softsign",c.registerClass(eA);var tA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){return zy(e)}}]),n}(qE);tA.className="tanh",c.registerClass(tA);var nA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Uw(e,t)}}]),n}(qE);nA.className="softmax",c.registerClass(nA);var rA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Ww(e,t)}}]),n}(qE);function aA(e){return e.getClassName()}function iA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return YC(e,c.SerializationMap.getMap().classNameMap,t,"activation")}function oA(e){if(null==e)return iA({className:"linear",config:{}});if("string"==typeof e){var t={};return t.className=e,t.config={},iA(t)}return e instanceof qE?e:iA(e)}rA.className="logSoftmax",c.registerClass(rA);var sA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(c.Serializable),uA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this),function(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return _createClass(n,[{key:"apply",value:function(e){var t=this;return ey((function(){var n=Gm([1]);return t.hasL1&&(n=ay(n,xg(Yy(t.l1,iy(e))))),t.hasL2&&(n=ay(n,xg(Yy(t.l2,jS(e))))),n.asScalar()}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(sA);uA.className="L1L2",c.registerClass(uA);var cA={l1l2:"L1L2"};function lA(e){return XC(e)}function hA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return YC(e,c.SerializationMap.getMap().classNameMap,t,"regularizer")}function fA(e){return null==e?null:"string"==typeof e?hA({className:e in cA?cA[e]:e,config:{}}):e instanceof sA?e:hA(e)}var dA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return _createClass(n,[{key:"call",value:function(e,t){e=wT(e);var n=Pw(e);return null!=this.maxValue&&(n=dy(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);dA.className="ReLU",c.registerClass(dA);var pA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return _createClass(n,[{key:"call",value:function(e,t){var n=wT(e);return Mw(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);pA.className="LeakyReLU",c.registerClass(pA);var vA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=vT(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=fA(e.alphaRegularizer),r.alphaConstraint=fS(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new PC("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return _possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){var t=(e=xT(e)).slice(1);if(null!=this.sharedAxes){var n,r=_createForOfIteratorHelper(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(az){r.e(az)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new IT({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=wT(e),Lw(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:pT(this.alphaInitializer),alphaRegularizer:lA(this.alphaRegularizer),alphaConstraint:lS(this.alphaConstraint),sharedAxes:this.sharedAxes},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);vA.className="PReLU",c.registerClass(vA);var mA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new zC("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,_possibleConstructorReturn(r)}return _createClass(n,[{key:"call",value:function(e,t){var n=wT(e);return Fw(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);mA.className="ELU",c.registerClass(mA);var gA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return _createClass(n,[{key:"call",value:function(e,t){var n=wT(e);return n.mul(OS(n.greater(this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);gA.className="ThresholdedReLU",c.registerClass(gA);var yA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new nA).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return _createClass(n,[{key:"call",value:function(e,t){var n=wT(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);function bA(e,t,n){if("number"==typeof e)return UC(e,t);if(e.length!==t)throw new PC("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new PC("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e;var i}function kA(e,t,n,r){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return null==e?e:(a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r))}function _A(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+RS([n-t,0]);else{if("same"!==r)throw new PC("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function wA(e,t){return ey((function(){return yS(t),"channelsFirst"===t?lb(e,[0,2,3,1]):e}))}function xA(e,t){return ey((function(){return yS(t),"channelsFirst"===t?lb(e,[0,2,3,4,1]):e}))}function CA(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return ey((function(){if(null==i&&(i="channelsLast"),yS(i),3!==e.rank&&4!==e.rank)throw new PC("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new PC("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=wA(e,i);if("causal"===a)throw new zC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=m.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=lb(u,[0,3,1,2])),u}))}yA.className="Softmax",c.registerClass(yA);var SA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,tS(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new zC("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=bA(r.kernelSize,e,"kernelSize"),a.strides=bA(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,bS(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,yS(a.dataFormat),a.activation=oA(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=vT(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=fS(r.biasConstraint),a.biasRegularizer=fA(r.biasRegularizer),a.activityRegularizer=fA(r.activityRegularizer),a.dilationRate=bA(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new PC("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new PC("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new PC("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return _possibleConstructorReturn(a)}return _createClass(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:aA(this.activation),useBias:this.useBias,biasInitializer:pT(this.biasInitializer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),biasConstraint:lS(this.biasConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(WC("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!eS(e.kernelSize,"number",1,3))throw new PC("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(FT),TA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,tS(a.filters,"filters"),a.kernelInitializer=vT(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=fS(r.kernelConstraint),a.kernelRegularizer=fA(r.kernelRegularizer),a}return _createClass(n,[{key:"build",value:function(e){e=xT(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new PC("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:_defineProperty({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){var t;e=wT(e);var r=null==n.bias?null:n.bias.read(),a=nS(n.activation.getClassName());if(null!=a&&2===n.rank)t=CA(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return ey((function(){if(null==i&&(i="channelsLast"),yS(i),3!==e.shape.length)throw new PC("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new PC("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new PC("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=lb(e,[0,2,1])),"causal"===a)throw new zC("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=v_(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=qS(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=CA(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new zC("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return ey((function(){if(null==i&&(i="channelsLast"),yS(i),4!==e.rank&&5!==e.rank)throw new PC("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new PC("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=xA(e,i);if("causal"===a)throw new zC("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=g_(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=qS(s,n)),"channelsFirst"===i&&(s=lb(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=xT(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=kA(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:pT(this.kernelInitializer),kernelRegularizer:lA(this.kernelRegularizer),kernelConstraint:lS(this.kernelConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new PC("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(SA),EA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return _createClass(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!eS(e.kernelSize,"number",1,2))throw new PC("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(TA);EA.className="Conv2D",c.registerClass(EA);var AA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return _createClass(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new PC("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(TA);AA.className="Conv3D",c.registerClass(AA);var IA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).inputSpec=[new IT({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new PC("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return _possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){if(4!==(e=xT(e)).length)throw new PC("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new PC("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new IT({ndim:4,axes:_defineProperty({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){var t=wT(e);if(4!==t.shape.length)throw new PC("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape;"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var o=i[a],s=n.kernelSize[1],u=n.strides[1],c=[i[0],_A(i[r],n.strides[0],n.kernelSize[0],n.padding),_A(o,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=lb(t,[0,2,3,1]));var l=m_(t,n.kernel.read(),c,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(l=lb(l,[0,3,1,2])),null!=n.bias&&(l=qS(l,n.bias.read(),n.dataFormat)),null!=n.activation&&(l=n.activation.apply(l)),l}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=xT(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=_A(a[n],s,i,this.padding),a[r]=_A(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(EA);IA.className="Conv2DTranspose",c.registerClass(IA);var RA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new PC("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new PC("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new PC("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=vT(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=fA(r.depthwiseRegularizer),a.depthwiseConstraint=fS(r.depthwiseConstraint),a.pointwiseInitializer=vT(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=fA(r.pointwiseRegularizer),a.pointwiseConstraint=fS(r.pointwiseConstraint),_possibleConstructorReturn(a)}return _createClass(n,[{key:"build",value:function(e){if((e=xT(e)).length<this.rank+2)throw new PC("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new PC("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new IT({ndim:this.rank+2,axes:_defineProperty({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){var t;if(e=wT(e),1===n.rank)throw new zC("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=lb(e,[0,2,3,1])),t=ew(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=qS(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=lb(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=pT(this.depthwiseInitializer),e.pointwiseInitializer=pT(this.pointwiseInitializer),e.depthwiseRegularizer=lA(this.depthwiseRegularizer),e.pointwiseRegularizer=lA(this.pointwiseRegularizer),e.depthwiseConstraint=lS(this.depthwiseConstraint),e.pointwiseConstraint=lS(this.pointwiseConstraint),e}}]),n}(TA);RA.className="SeparableConv";var NA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,2,e)}return n}(RA);NA.className="SeparableConv2D",c.registerClass(NA);var OA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return _createClass(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!eS(e.kernelSize,"number",1,1))throw new PC("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(TA);OA.className="Conv1D",c.registerClass(OA);var DA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return ey((function(){if(e=wT(e),"channelsLast"===n.dataFormat){var t=LS(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return LS(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=LS(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return LS(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);DA.className="Cropping2D",c.registerClass(DA);var FA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],null==e[2]?null:this.size[0]*e[2],null==e[3]?null:this.size[1]*e[3]]:[e[0],null==e[1]?null:this.size[0]*e[1],null==e[2]?null:this.size[1]*e[2],e[3]]}},{key:"call",value:function(e,t){var n=this;return ey((function(){var t=wT(e),r=t.shape;if("channelsFirst"===n.dataFormat){var a=(t=lb(t,[0,2,3,1])).resizeNearestNeighbor([n.size[0]*r[2],n.size[1]*r[3]]);return lb(a,[0,3,1,2])}return t.resizeNearestNeighbor([n.size[0]*r[1],n.size[1]*r[2]])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);FA.className="UpSampling2D",c.registerClass(FA);var MA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=vT(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=fS(e.depthwiseConstraint),r.depthwiseRegularizer=fA(e.depthwiseRegularizer),r}return _createClass(n,[{key:"build",value:function(e){if((e=xT(e)).length<4)throw new PC("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new PC("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return ey((function(){null==a&&(a="channelsLast"),yS(a);var o=wA(e,a);if(4!==e.rank)throw new PC("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new PC("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=k_(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=lb(o,[0,3,1,2])),o}))}(e=wT(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=qS(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=xT(e);var t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=kA("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),a=kA(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,a]:[e[0],r,a,n]}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=pT(this.depthwiseInitializer),e.depthwiseRegularizer=lA(this.depthwiseRegularizer),e.depthwiseConstraint=lS(this.depthwiseRegularizer),e}}]),n}(SA);MA.className="DepthwiseConv2D",c.registerClass(MA);var LA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return _createClass(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return KS((function(){return GS(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this)}}]),n}(FT);LA.className="Dropout",c.registerClass(LA);var PA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return _createClass(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(LA);PA.className="SpatialDropout1D",c.registerClass(PA);var zA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,tS(r.units,"units"),r.activation=oA(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=vT(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=vT(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=fS(e.kernelConstraint),r.biasConstraint=fS(e.biasConstraint),r.kernelRegularizer=fA(e.kernelRegularizer),r.biasRegularizer=fA(e.biasRegularizer),r.activityRegularizer=fA(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){var t=(e=xT(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:_defineProperty({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=xT(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r,a=wT(e),i=nS(n.activation.getClassName());return null!=i?r=WS(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=WS(a,n.kernel.read()),null!=n.bias&&(r=qS(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),biasInitializer:pT(this.biasInitializer),kernelRegularizer:lA(this.kernelRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),biasConstraint:lS(this.biasConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);zA.className="Dense",c.registerClass(zA);var BA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e=e||{})).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t,n=_createForOfIteratorHelper((e=xT(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new PC('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(az){n.e(az)}finally{n.f()}return[e[0],ES(e,1)]}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=r.transpose(a)}return function(e){if(e.rank<=1)throw new PC("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],ES(e.shape,1)];return e.reshape(t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);BA.className="Flatten",c.registerClass(BA);var UA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=oA(e.activation),r}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:aA(this.activation)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);UA.className="Activation",c.registerClass(UA);var WA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return ey((function(){return e=wT(e),t=e,r=n.n,ey((function(){if(2!==t.shape.length)throw new PC("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(t.shape.length," tensor."));return BS(DS(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);WA.className="RepeatVector",c.registerClass(WA);var VA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return _createClass(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new PC("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=ES(e);if(null!==i){if(0===a||u%a!=0)throw new PC(n);r[i]=u/a}else if(u!==a)throw new PC(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return r.reshape(i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);VA.className="Reshape",c.registerClass(VA);var jA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;if(_classCallCheck(this,n),a=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var i=NS(1,e.dims.length+1);if(!r.arraysEqual(e.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return a.dims=e.dims,a.dimsIncludingBatch=[0].concat(a.dims),a.inputSpec=[new IT({ndim:a.dims.length+1})],_possibleConstructorReturn(a)}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t=(e=xT(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return lb(wT(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);jA.className="Permute",c.registerClass(jA);var HA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=wT(e);return mg(U_(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e),a=mg(U_(r,n.maskValue),-1,!0);return r.mul(a.asType(r.dtype))}))}}]),n}(FT);HA.className="Masking",c.registerClass(HA);var qA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=null==e.inputLength?[a,null]:[a].concat(HC(e.inputLength))}return r.inputDim=e.inputDim,tS(r.inputDim,"inputDim"),r.outputDim=e.outputDim,tS(r.outputDim,"outputDim"),r.embeddingsInitializer=vT(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=fA(e.embeddingsRegularizer),r.activityRegularizer=fA(e.activityRegularizer),r.embeddingsConstraint=fS(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return ey((function(){return n.maskZero?(e=wT(e),U_(e,Zm(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=xT(e),null==this.inputLength)return[].concat(_toConsumableArray(e),[this.outputDim]);var t=HC(this.inputLength);if(t.length!==e.length-1)throw new PC('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new PC('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(_toConsumableArray(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e);return"int32"!==r.dtype&&(r=OS(r,"int32")),VS(n.embeddings.read(),r.as1D()).reshape(xT(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:pT(this.embeddingsInitializer),embeddingsRegularizer:lA(this.embeddingsRegularizer),activityRegularizer:lA(this.activityRegularizer),embeddingsConstraint:lS(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);qA.className="Embedding",c.registerClass(qA);var GA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return _createClass(n,[{key:"mergeFunction",value:function(e){throw new zC}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new PC("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[xT(e)]),(e=e).length<2)throw new PC("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(az){r.e(az)}finally{r.f()}if((n=ZC(n)).length>1)throw new PC("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));this.reshapeRequired=-1!==e.indexOf(null)||1!==ZC(u).length}},{key:"call",value:function(e,t){var n=this;return ey((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=RS(r),o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=DS(s,1);t.push(s)}}catch(az){o.e(az)}finally{o.f()}return n.mergeFunction(t)}var l,h=!1,f=_createForOfIteratorHelper(e);try{for(f.s();!(l=f.n()).done;){var d=l.value,p=d.rank;if(null==p){var v=d.shape,m=v[0],g=v.slice(1).concat([m]),y=d.reshape([m].concat(ES(v.slice(1))));y=(y=lb(y,[1,0])).reshape(g),t.push(y),h=!0}else if(p>1){var b=NS(1,p).concat([0]);t.push(lb(d,b)),h=!0}else t.push(d)}}catch(az){f.e(az)}finally{f.f()}var k=n.mergeFunction(t),_=k.rank;if(h)if(null==_){var w=k.shape,x=w[w.length-1],C=[x].concat(w.slice(0,w.length-1));k=lb(k.reshape([-1,x]),[1,0]).reshape(C)}else if(_>1){var S=[_-1].concat(NS(0,_-1));k=lb(k,S)}return k}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(az){o.e(az)}finally{o.f()}return t=1===(i=ZC(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return ey((function(){if(null==t)return null;if(!Array.isArray(t))throw new PC("`mask` should be an Array");if(!Array.isArray(e))throw new PC("`inputs` should be an Array");if(t.length!==e.length)throw new PC("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:rg(e,0)})))[0],r=1;r<t.length-1;++r)n=x_(n,t[r]);return n}))}}]),n}(FT),KA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return ey((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ay(t,e[n]);return t}))}}]),n}(GA);KA.className="Add",c.registerClass(KA);var XA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return ey((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Yy(t,e[n]);return t}))}}]),n}(GA);XA.className="Multiply",c.registerClass(XA);var YA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return ey((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ay(t,e[n]);return Yy(1/e.length,t)}))}}]),n}(GA);YA.className="Average",c.registerClass(YA);var QA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return ey((function(){for(var t=e[0],n=1;n<e.length;++n)t=jy(t,e[n]);return t}))}}]),n}(GA);QA.className="Maximum",c.registerClass(QA);var ZA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"mergeFunction",value:function(e){return ey((function(){for(var t=e[0],n=1;n<e.length;++n)t=qy(t,e[n]);return t}))}}]),n}(GA);ZA.className="Minimum",c.registerClass(ZA);var $A=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return _createClass(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new PC("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,a=_createForOfIteratorHelper(e=e);try{for(a.s();!(t=a.n()).done;){if(null!=t.value){n=!1;break}}}catch(az){a.e(az)}finally{a.f()}if(!n){for(var i=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);var u,c=!1,l=_createForOfIteratorHelper(i);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(r.arraysEqual(h,s)){c=!0;break}}}catch(az){l.e(az)}finally{l.f()}c||i.push(s)}if(i.length>1)throw new PC("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return ey((function(){return PS(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new PC("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=_createForOfIteratorHelper(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(az){i.e(az)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new PC("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new PC("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new PC("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return ey((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)a.push(null==t[i]?Qm(e[i]).asType("bool"):t[i].rank<e[i].rank?rg(t[i],-1):t[i]);var o=$m(a,n.axis);return vg(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(GA);function JA(e,t){for(;e<0;)e+=t;return e}$A.className="Concatenate",c.registerClass($A);var eI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return _createClass(n,[{key:"build",value:function(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new zC("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(t,n);if(t[a[0]]!==n[a[1]])throw new PC("Dimension incompatibility: "+"".concat(t[a[0]]," !== ").concat(n[a[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new PC("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],a=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return JA(t,e[n].shape.length)})):[JA(this.axes,n.shape.length),JA(this.axes,a.shape.length)],this.normalize&&(n=XT(n,t[0]),a=XT(a,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new zC("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),r.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new zC("batchDot is not implemented for complex64-type Tensors yet.");var a=e.shape.length,i=t.shape.length;null==n&&(n=[a-1,i-2]);var o=n;return ey((function(){var n,r;if(a>i){n=a-i;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(i>a){n=i-a;for(var c=[],l=0;l<n;++l)c.push(1);e=e.reshape(e.shape.concat(c))}else n=0;if(r=2===e.shape.length&&2===t.shape.length?o[0]===o[1]?e.mul(t).sum(o[0]):e.transpose([1,0]).mul(t).sum(o[1]):e.matMul(t,o[0]!==e.shape.length-1,o[1]===t.shape.length-1),n>0){for(var h,f=[],d=h=a>i?a+i-3:a-1;d<h+n;++d)f.push(d);r=r.squeeze(f)}return 1===r.shape.length&&(r=r.expandDims(1)),r}))}(n,a,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[JA(this.axes,e.length),JA(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new zC("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(t,n);t.splice(a[0],1),n.splice(a[1],1),n.splice(0,1);var i=t.concat(n);return 1===i.length&&i.push(1),i}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(GA);eI.className="Dot",c.registerClass(eI);var tI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e);return KS((function(){return US(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))}}]),n}(FT);tI.className="GaussianNoise",c.registerClass(tI);var nI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t);var r=wT(e);return n.rate>0&&n.rate<1?KS((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(US(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(FT);nI.className="GaussianDropout",c.registerClass(nI);var rI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return _createClass(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||wT(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return ey((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return KS((function(){var t=wT(e),a=-1.7580993408473766,i=F_(J_(r),n.rate);i=OS(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate;return t.mul(i).add(i.add(-1).mul(a)).mul(o).add(s)}),(function(){return wT(e)}),t.training||!1)}return e}))}}]),n}(FT);function aI(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=o_(e,t,n,r,a,o);else if(3===e.rank)i=s_(e,t,n,r,a,o);else{if(4!==e.rank)throw new zC("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=u_(e,t,n,r,a,o)}return i}rI.className="AlphaDropout",c.registerClass(rI);var iI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=vT(e.betaInitializer||"zeros"),r.gammaInitializer=vT(e.gammaInitializer||"ones"),r.movingMeanInitializer=vT(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=vT(e.movingVarianceInitializer||"ones"),r.betaConstraint=fS(e.betaConstraint),r.gammaConstraint=fS(e.gammaConstraint),r.betaRegularizer=fA(e.betaRegularizer),r.gammaRegularizer=fA(e.gammaRegularizer),r}return _createClass(n,[{key:"build",value:function(e){e=xT(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new PC("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new IT({ndim:e.length,axes:_defineProperty({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){var a=null!=t.training&&t.training,i=wT(e),o=i.shape,s=o.length,u=NS(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=UC(1,s);l[c]=o[c];var h=u.slice();h.sort();var f=!r.arraysEqual(h,NS(0,s).slice(0,s-1));if(!a)return function(){if(f){var e=n.movingMean.read().reshape(l),t=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,a=n.scale?n.gamma.read().reshape(l):null;return aI(i,e,t,r,a,n.epsilon)}return aI(i,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=_slicedToArray(function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return r.arraysEqual(a.slice().sort(),NS(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return ey((function(){var i=wg(e,r),o=i.mean,s=i.variance;return[aI(e,o,s,n,t,a),o,s]}))}(e,t,n,a,i):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return ey((function(){var i,o=wg(e,r),s=o.mean,u=o.variance,c=[],l=_createForOfIteratorHelper(NS(0,e.rank));try{for(l.s();!(i=l.n()).done;){var h=i.value;-1!==r.indexOf(h)?c.push(1):c.push(e.shape[h])}}catch(az){l.e(az)}finally{l.f()}var f=s.reshape(c),d=u.reshape(c),p=null==t?null:t.reshape(c),v=null==n?null:n.reshape(c);return[aI(e,f,d,v,p,a),s,u]}))}(e,t,n,a,i)}(i,n.gamma.read(),n.beta.read(),u,n.epsilon),3),p=d[0],v=d[1],m=d[2],g=function(e,t,n){ey((function(){var r=1-n,a=e.read(),i=a.sub(t).mul(r);e.write(a.sub(i))}))};return g(n.movingMean,v,n.momentum),g(n.movingVariance,m,n.momentum),p}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pT(this.betaInitializer),gammaInitializer:pT(this.gammaInitializer),movingMeanInitializer:pT(this.movingMeanInitializer),movingVarianceInitializer:pT(this.movingVarianceInitializer),betaRegularizer:lA(this.betaRegularizer),gammaRegularizer:lA(this.gammaRegularizer),betaConstraint:lS(this.betaConstraint),gammaConstraint:lS(this.gammaConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);iI.className="BatchNormalization",c.registerClass(iI);var oI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=_createForOfIteratorHelper(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch(az){i.e(az)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=vT(e.betaInitializer||"zeros"),r.gammaInitializer=vT(e.gammaInitializer||"ones"),r.betaRegularizer=fA(e.betaRegularizer),r.gammaRegularizer=fA(e.gammaRegularizer),r.supportsMasking=!0,_possibleConstructorReturn(r)}return _createClass(n,[{key:"build",value:function(e){var t=(e=xT(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=_createForOfIteratorHelper(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(az){a.e(az)}finally{a.f()}if(this.axis.length!==ZC(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.gamma=this.scale?this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=wT(e),a=r.shape,i=a.length;return ey((function(){var e,t=wg(r,n.axis,!0),o=t.mean,s=t.variance,u=UC(1,i),c=_createForOfIteratorHelper(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(az){c.e(az)}finally{c.f()}for(var h=function(e){return null!=e&&e.shape.length!==i&&n.axis!==[i-1]?e.reshape(u):e},f=h(n.gamma.read()),d=h(n.beta.read()),p=[],v=[],m=0;m<i;++m)-1!==n.axis.indexOf(m)?(p.push(a[m]),v.push(1)):(p.push(1),v.push(a[m]));return o=o.tile(p),s=s.tile(p),f=f.tile(v),d=d.tile(v),aI(r,o,s,d,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:pT(this.betaInitializer),gammaInitializer:pT(this.gammaInitializer),betaRegularizer:lA(this.betaRegularizer),gammaRegularizer:lA(this.gammaRegularizer)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);oI.className="LayerNormalization",c.registerClass(oI);var sI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new PC("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new PC("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new PC("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new IT({ndim:4})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=xT(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return ey((function(){return t=wT(e),r=n.padding,a=n.dataFormat,ey((function(){if(4!==t.rank)throw new PC("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(t.rank,"-D tensor."));if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new PC("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new PC("Unknown data format: ".concat(a,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],bb(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT);function uI(e,t,n,r,a,i){return ey((function(){var o;yS(a),kS(i),bS(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=wA(e,a);var s="same"===r?"same":"valid";return o="max"===i?kw(e,t,n,s):_w(e,t,n,s),"channelsFirst"===a&&(o=lb(o,[0,3,1,2])),o}))}function cI(e,t,n,r,a,i){return ey((function(){var o;yS(a),kS(i),bS(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=xA(e,a);var s="same"===r?"same":"valid";return o="max"===i?xw(e,t,n,s):Cw(e,t,n,s),"channelsFirst"===a&&(o=lb(o,[0,4,1,2,3])),o}))}sI.className="ZeroPadding2D",c.registerClass(sI);var lI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new PC("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(tS(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new PC("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return tS(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,bS(r.padding),r.inputSpec=[new IT({ndim:3})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){var t=kA((e=xT(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return ey((function(){n.invokeCallHook(e,t),e=DS(wT(e),2);var r=n.poolingFunction(wT(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return ig(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT),hI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yS(a),bS(r),uI(e,t,n,r,a,"max")}}]),n}(lI);hI.className="MaxPooling1D",c.registerClass(hI);var fI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yS(a),bS(r),uI(e,t,n,r,a,"avg")}}]),n}(lI);fI.className="AveragePooling1D",c.registerClass(fI);var dI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new PC("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return tS(r.poolSize,"poolSize"),tS(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yS(r.dataFormat),bS(r.padding),r.inputSpec=[new IT({ndim:4})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){e=xT(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=kA(t,this.poolSize[0],this.padding,this.strides[0]),n=kA(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return ey((function(){return n.invokeCallHook(e,t),n.poolingFunction(wT(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT),pI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yS(a),bS(r),uI(e,t,n,r,a,"max")}}]),n}(dI);pI.className="MaxPooling2D",c.registerClass(pI);var vI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yS(a),bS(r),uI(e,t,n,r,a,"avg")}}]),n}(dI);vI.className="AveragePooling2D",c.registerClass(vI);var mI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new PC("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return tS(r.poolSize,"poolSize"),tS(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yS(r.dataFormat),bS(r.padding),r.inputSpec=[new IT({ndim:5})],_possibleConstructorReturn(r)}return _createClass(n,[{key:"computeOutputShape",value:function(e){e=xT(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=kA(t,this.poolSize[0],this.padding,this.strides[0]),n=kA(n,this.poolSize[1],this.padding,this.strides[1]),r=kA(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return ey((function(){return n.invokeCallHook(e,t),n.poolingFunction(wT(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT),gI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yS(a),bS(r),cI(e,t,n,r,a,"max")}}]),n}(mI);gI.className="MaxPooling3D",c.registerClass(gI);var yI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return yS(a),bS(r),cI(e,t,n,r,a,"avg")}}]),n}(mI);yI.className="AveragePooling3D",c.registerClass(yI);var bI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).inputSpec=[new IT({ndim:3})],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new zC}}]),n}(FT),kI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e||{})}return _createClass(n,[{key:"call",value:function(e,t){return ey((function(){var t=wT(e);return kg(t,1)}))}}]),n}(bI);kI.className="GlobalAveragePooling1D",c.registerClass(kI);var _I=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e||{})}return _createClass(n,[{key:"call",value:function(e,t){return ey((function(){var t=wT(e);return z_(t,1)}))}}]),n}(bI);_I.className="GlobalMaxPooling1D",c.registerClass(_I);var wI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,yS(r.dataFormat),r.inputSpec=[new IT({ndim:4})],r}return _createClass(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new zC}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(FT),xI=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return ey((function(){var t=wT(e);return kg(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))}}]),n}(wI);xI.className="GlobalAveragePooling2D",c.registerClass(xI);var CI=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return ey((function(){var t=wT(e);return z_(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))}}]),n}(wI);function SI(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new PC("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function TI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return ey((function(){var u=t.shape.length;if(u<3)throw new PC("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(NS(2,u));if(t=lb(t,c),null!=i)throw new zC("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===u-1&&(a=rg(a,-1)),a=lb(a,c)),r&&(t=dw(t,0),null!=a&&(a=dw(a,0)));var l,h,f,d=[],p=n,v=t.shape[0],m=sg(t);null!=a&&(h=sg(a));for(var g=function(t){var n=m[t],r=ey((function(){return e(n,p)}));if(null==a)l=r[0],p=r[1];else{var i=ey((function(){var e=h[t],n=Qm(e).sub(e);return{output:r[0].mul(e).add(p[0].mul(n)),newStates:p.map((function(t,a){return r[1][a].mul(e).add(t.mul(n))}))}}));l=i.output,p=i.newStates}s&&d.push(l)},y=0;y<v;++y)g(y);return s&&(f=og(d,1)),[l,f,p]}))}CI.className="GlobalMaxPooling2D",c.registerClass(CI);var EI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a;if(_classCallCheck(this,n),r=t.call(this,e),null==e.cell)throw new PC("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new MI({cells:e.cell}):e.cell).stateSize)throw new PC("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new IT({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],_possibleConstructorReturn(r)}return _createClass(n,[{key:"getStates",value:function(){return null==this.states_?NS(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){kT(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(az){o.e(az)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return ey((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"build",value:function(e){if(null!=this.numConstants)throw new zC("Constants support is not implemented in RNN yet.");kT(e)&&(e=e[0]),e=e,this.inputSpec[0]=new IT({shape:[this.stateful?e[0]:null,null,e[e.length-1]]});var t,n=[e[0]].concat(e.slice(2));if(this.cell.build(n),t=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),t))throw new PC("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=t.map((function(e){return new IT({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ey((function(){if(!t.stateful)throw new MC("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=t.inputSpec[0].shape[0];if(null==a)throw new PC("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return Gm([a,e])})):[Gm([a,t.cell.stateSize])];else if(null==e)ty(t.states_),null!=t.keptStates&&(ty(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Gm([a,e])})):t.states_[0]=Gm([a,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new PC("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):ty(t.states_);for(var i=0;i<t.states_.length;++i){var o=e[i],s=Array.isArray(t.cell.stateSize)?t.cell.stateSize[i]:t.cell.stateSize,u=[a,s];if(!r.arraysEqual(o.shape,u))throw new PC("State ".concat(i," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(o.shape));t.states_[i]=o}}t.states_=t.states_.map((function(e){return ny(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=SI(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=_createForOfIteratorHelper(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new IT({shape:l.shape}))}}catch(az){c.e(az)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof RT){var h=[e].concat(o),f=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=f;var p=_get(_getPrototypeOf(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=d,p}return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return ey((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=wT(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new PC("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=TI((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var f=n.returnSequences?l:c;return n.returnState?[f].concat(h):f}))}},{key:"getInitialState",value:function(e){var t=this;return ey((function(){var n=Gm(e.shape);return n=DS(n=xg(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?BS(n,[1,e]):n})):t.cell.stateSize>1?[BS(n,[1,t.cell.stateSize])]:[n]}))}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var t=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:t};var r=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,r),e}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=KT(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(FT);EI.className="RNN",c.registerClass(EI);var AI=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(FT),II=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,tS(r.units,"units"),r.activation=oA(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=vT(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=vT(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=vT(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=fA(e.kernelRegularizer),r.recurrentRegularizer=fA(e.recurrentRegularizer),r.biasRegularizer=fA(e.biasRegularizer),r.kernelConstraint=fS(e.kernelConstraint),r.recurrentConstraint=fS(e.recurrentConstraint),r.biasConstraint=fS(e.biasConstraint),r.dropout=IS([1,RS([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=IS([1,RS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass(n,[{key:"build",value:function(e){e=xT(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){if(2!==(e=e).length)throw new PC("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=LI((function(){return Qm(e)}),n.dropout,i)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=LI((function(){return Qm(r)}),n.recurrentDropout,i));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=WS(null!=o?Yy(e,o):e,n.kernel.read()),null!=n.bias&&(a=qS(a,n.bias.read())),null!=s&&(r=Yy(r,s));var u=ay(a,WS(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),recurrentInitializer:pT(this.recurrentInitializer),biasInitializer:pT(this.biasInitializer),kernelRegularizer:lA(this.kernelRegularizer),recurrentRegularizer:lA(this.recurrentRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),recurrentConstraint:lS(this.recurrentConstraint),biasConstraint:lS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(AI);II.className="SimpleRNNCell",c.registerClass(II);var RI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),e.cell=new II(e),t.call(this,e)}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return ey((function(){return null!=r.cell.dropoutMask&&(ty(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ty(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),recurrentInitializer:pT(this.recurrentInitializer),biasInitializer:pT(this.biasInitializer),kernelRegularizer:lA(this.kernelRegularizer),recurrentRegularizer:lA(this.recurrentRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),recurrentConstraint:lS(this.recurrentConstraint),biasConstraint:lS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete t.cell,Object.assign(e,t),e}},{key:"units",get:function(){return this.cell.units}},{key:"activation",get:function(){return this.cell.activation}},{key:"useBias",get:function(){return this.cell.useBias}},{key:"kernelInitializer",get:function(){return this.cell.kernelInitializer}},{key:"recurrentInitializer",get:function(){return this.cell.recurrentInitializer}},{key:"biasInitializer",get:function(){return this.cell.biasInitializer}},{key:"kernelRegularizer",get:function(){return this.cell.kernelRegularizer}},{key:"recurrentRegularizer",get:function(){return this.cell.recurrentRegularizer}},{key:"biasRegularizer",get:function(){return this.cell.biasRegularizer}},{key:"kernelConstraint",get:function(){return this.cell.kernelConstraint}},{key:"recurrentConstraint",get:function(){return this.cell.recurrentConstraint}},{key:"biasConstraint",get:function(){return this.cell.biasConstraint}},{key:"dropout",get:function(){return this.cell.dropout}},{key:"recurrentDropout",get:function(){return this.cell.recurrentDropout}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(EI);RI.className="SimpleRNN",c.registerClass(RI);var NI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,tS(r.units,"units"),r.activation=oA(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=oA(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=vT(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=vT(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=vT(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=fA(e.kernelRegularizer),r.recurrentRegularizer=fA(e.recurrentRegularizer),r.biasRegularizer=fA(e.biasRegularizer),r.kernelConstraint=fS(e.kernelConstraint),r.recurrentConstraint=fS(e.recurrentConstraint),r.biasConstraint=fS(e.biasConstraint),r.dropout=IS([1,RS([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=IS([1,RS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass(n,[{key:"build",value:function(e){e=xT(e),this.kernel=this.addWeight("kernel",[e[e.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){if(2!==(e=e).length)throw new PC("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=LI((function(){return Qm(e)}),n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=LI((function(){return Qm(a)}),n.recurrentDropout,r,3));var i,o,s,u=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Yy(e,n.dropoutMask[0]));var c=WS(e,n.kernel.read());n.useBias&&(c=qS(c,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Yy(a,u[0]));var l=n.recurrentKernel.read(),h=_slicedToArray(Tg(l,[2*n.units,n.units],l.rank-1),2),f=h[0],d=h[1],p=WS(a,f),v=_slicedToArray(Tg(c,3,c.rank-1),3),m=v[0],g=v[1],y=v[2],b=_slicedToArray(Tg(p,2,p.rank-1),2),k=b[0],_=b[1];i=n.recurrentActivation.apply(ay(m,k)),o=n.recurrentActivation.apply(ay(g,_));var w=WS(Yy(o,a),d);s=n.activation.apply(ay(y,w));var x=ay(Yy(i,a),Yy(ay(1,xy(i)),s));return[x,x]}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),recurrentActivation:aA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),recurrentInitializer:pT(this.recurrentInitializer),biasInitializer:pT(this.biasInitializer),kernelRegularizer:lA(this.kernelRegularizer),recurrentRegularizer:lA(this.recurrentRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),recurrentConstraint:lS(this.recurrentConstraint),biasConstraint:lS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(AI);NI.className="GRUCell",c.registerClass(NI);var OI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new NI(e),t.call(this,e)}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return ey((function(){return null!=r.cell.dropoutMask&&(ty(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ty(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),recurrentActivation:aA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),recurrentInitializer:pT(this.recurrentInitializer),biasInitializer:pT(this.biasInitializer),kernelRegularizer:lA(this.kernelRegularizer),recurrentRegularizer:lA(this.recurrentRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),recurrentConstraint:lS(this.recurrentConstraint),biasConstraint:lS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete t.cell,Object.assign(e,t),e}},{key:"units",get:function(){return this.cell.units}},{key:"activation",get:function(){return this.cell.activation}},{key:"recurrentActivation",get:function(){return this.cell.recurrentActivation}},{key:"useBias",get:function(){return this.cell.useBias}},{key:"kernelInitializer",get:function(){return this.cell.kernelInitializer}},{key:"recurrentInitializer",get:function(){return this.cell.recurrentInitializer}},{key:"biasInitializer",get:function(){return this.cell.biasInitializer}},{key:"kernelRegularizer",get:function(){return this.cell.kernelRegularizer}},{key:"recurrentRegularizer",get:function(){return this.cell.recurrentRegularizer}},{key:"biasRegularizer",get:function(){return this.cell.biasRegularizer}},{key:"kernelConstraint",get:function(){return this.cell.kernelConstraint}},{key:"recurrentConstraint",get:function(){return this.cell.recurrentConstraint}},{key:"biasConstraint",get:function(){return this.cell.biasConstraint}},{key:"dropout",get:function(){return this.cell.dropout}},{key:"recurrentDropout",get:function(){return this.cell.recurrentDropout}},{key:"implementation",get:function(){return this.cell.implementation}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(EI);OI.className="GRU",c.registerClass(OI);var DI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,tS(r.units,"units"),r.activation=oA(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=oA(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=vT(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=vT(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=vT(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=fA(e.kernelRegularizer),r.recurrentRegularizer=fA(e.recurrentRegularizer),r.biasRegularizer=fA(e.biasRegularizer),r.kernelConstraint=fS(e.kernelConstraint),r.recurrentConstraint=fS(e.recurrentConstraint),r.biasConstraint=fS(e.biasConstraint),r.dropout=IS([1,RS([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=IS([1,RS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass(n,[{key:"build",value:function(e){var t,n;if(e=xT(e),this.kernel=this.addWeight("kernel",[e[e.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var r=this.biasInitializer,a=this.units;n=new((t=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"apply",value:function(e,t){var n=r.apply([a]),i=(new $S).apply([a]),o=r.apply([2*a]);return zS(zS(n,i),o)}}]),n}(QS)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return ey((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new PC("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=LI((function(){return Qm(e)}),n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=LI((function(){return Qm(a)}),n.recurrentDropout,r,4));var o,s,u,c,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Yy(e,n.dropoutMask[0]));var h=WS(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Yy(a,l[0])),h=ay(h,WS(a,n.recurrentKernel.read())),n.useBias&&(h=qS(h,n.bias.read()));var f=_slicedToArray(Tg(h,4,h.rank-1),4),d=f[0],p=f[1],v=f[2],m=f[3];o=n.recurrentActivation.apply(d),s=n.recurrentActivation.apply(p),u=ay(Yy(s,i),Yy(o,n.activation.apply(v))),c=n.recurrentActivation.apply(m);var g=Yy(c,n.activation.apply(u));return[g,g,u]}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),recurrentActivation:aA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),recurrentInitializer:pT(this.recurrentInitializer),biasInitializer:pT(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:lA(this.kernelRegularizer),recurrentRegularizer:lA(this.recurrentRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),recurrentConstraint:lS(this.recurrentConstraint),biasConstraint:lS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(AI);DI.className="LSTMCell",c.registerClass(DI);var FI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new DI(e),t.call(this,e)}return _createClass(n,[{key:"call",value:function(e,t){var r=this;return ey((function(){return null!=r.cell.dropoutMask&&(ty(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ty(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:aA(this.activation),recurrentActivation:aA(this.recurrentActivation),useBias:this.useBias,kernelInitializer:pT(this.kernelInitializer),recurrentInitializer:pT(this.recurrentInitializer),biasInitializer:pT(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:lA(this.kernelRegularizer),recurrentRegularizer:lA(this.recurrentRegularizer),biasRegularizer:lA(this.biasRegularizer),activityRegularizer:lA(this.activityRegularizer),kernelConstraint:lS(this.kernelConstraint),recurrentConstraint:lS(this.recurrentConstraint),biasConstraint:lS(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete t.cell,Object.assign(e,t),e}},{key:"units",get:function(){return this.cell.units}},{key:"activation",get:function(){return this.cell.activation}},{key:"recurrentActivation",get:function(){return this.cell.recurrentActivation}},{key:"useBias",get:function(){return this.cell.useBias}},{key:"kernelInitializer",get:function(){return this.cell.kernelInitializer}},{key:"recurrentInitializer",get:function(){return this.cell.recurrentInitializer}},{key:"biasInitializer",get:function(){return this.cell.biasInitializer}},{key:"unitForgetBias",get:function(){return this.cell.unitForgetBias}},{key:"kernelRegularizer",get:function(){return this.cell.kernelRegularizer}},{key:"recurrentRegularizer",get:function(){return this.cell.recurrentRegularizer}},{key:"biasRegularizer",get:function(){return this.cell.biasRegularizer}},{key:"kernelConstraint",get:function(){return this.cell.kernelConstraint}},{key:"recurrentConstraint",get:function(){return this.cell.recurrentConstraint}},{key:"biasConstraint",get:function(){return this.cell.biasConstraint}},{key:"dropout",get:function(){return this.cell.dropout}},{key:"recurrentDropout",get:function(){return this.cell.recurrentDropout}},{key:"implementation",get:function(){return this.cell.implementation}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(EI);FI.className="LSTM",c.registerClass(FI);var MI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).cells=e.cells,r}return _createClass(n,[{key:"call",value:function(e,t){var n=this;return ey((function(){var r,a=(e=e).slice(1),i=[],o=_createForOfIteratorHelper(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(az){o.e(az)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var h=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),c.push(u.slice(1))}a=[];var f,d=_createForOfIteratorHelper(c.slice().reverse());try{for(d.s();!(f=d.n()).done;){var p,v=f.value;(p=a).push.apply(p,_toConsumableArray(v))}}catch(az){d.e(az)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;kT(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){wS("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e,t=[],r=_createForOfIteratorHelper(this.cells);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push({className:a.getClassName(),config:a.getConfig()})}}catch(az){r.e(az)}finally{r.f()}var i={cells:t},o=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(i,o),i}},{key:"getWeights",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.weights))}}catch(az){n.e(az)}finally{n.f()}return TT(t)}},{key:"setWeights",value:function(e){var t,n=[],r=_createForOfIteratorHelper(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=e.splice(a.weights.length),o=0;o<a.weights.length;++o)n.push([a.weights[o],i[o]])}catch(az){r.e(az)}finally{r.f()}ET(n)}},{key:"stateSize",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,_toConsumableArray(r.stateSize)):t.push(r.stateSize)}}catch(az){n.e(az)}finally{n.f()}return t}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.trainableWeights))}}catch(az){n.e(az)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.nonTrainableWeights))}}catch(az){n.e(az)}finally{n.f()}if(!this.trainable){var a,i=[],o=_createForOfIteratorHelper(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,_toConsumableArray(s.trainableWeights))}}catch(az){o.e(az)}finally{o.f()}return i.concat(t)}return t}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=_createForOfIteratorHelper(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(KT(o,r))}}catch(az){i.e(az)}finally{i.f()}return new e({cells:a})}}]),n}(AI);function LI(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;function a(){return GS(e(),t)}if(r>1){for(var i=[],o=0;o<r;o++)i.push(KS(a,e,n));return i.map((function(e){return ny(e.clone())}))}return ny(KS(a,e,n).clone())}MI.className="StackedRNNCells",c.registerClass(MI);var PI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).layer=e.layer,r}return _createClass(n,[{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=KT(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(FT),zI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return _createClass(n,[{key:"build",value:function(e){if((e=xT(e)).length<3)throw new PC("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),_get(_getPrototypeOf(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=xT(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return ey((function(){return TI((function(e,r){return[wT(n.layer.call(e,t)),[]]}),e=wT(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(PI);zI.className="TimeDistributed",c.registerClass(zI);var BI,UI,WI=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=KT(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=KT(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,JC(mS,"BidirectionalMergeMode",r.mergeMode),e.weights)throw new zC("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return _createClass(n,[{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState?(r=a.slice(1),t=a[0]):t=a[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):jC(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=SI(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new PC("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,_toConsumableArray(r));var c=r.map((function(e){return new IT({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,_toConsumableArray(c))}if(null!=a)throw new zC("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof RT,h=0,f=o;h<f.length;h++){if(f[h]instanceof RT!==l)throw new PC("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),p=this.inputSpec.concat(s),v=this.inputSpec;this.inputSpec=p;var m=_get(_getPrototypeOf(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=v,m}return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return ey((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=dw(a,1)),"concat"===n.mergeMode?o=PS([r,a]):"sum"===n.mergeMode?o=ay(r,a):"ave"===n.mergeMode?o=Yy(.5,ay(r,a)):"mul"===n.mergeMode?o=Yy(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;wS(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),wS(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}}],[{key:"fromConfig",value:function(e,t){var n=KT(t.layer);if(delete t.layer,null!=t.numConstants)throw new zC("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(PI);WI.className="Bidirectional",c.registerClass(WI),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(BI||(BI={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(UI||(UI={}));var VI=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],jI=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],HI=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}],qI=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}],GI=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],KI=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],XI=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}],YI=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],QI=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],ZI=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],$I=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],JI=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],eR=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}],tR=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],nR=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],rR=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}];function aR(e){return null===e?null:iR(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function iR(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof Kv))}function oR(e){return e instanceof Kv?{value:e.clone(),recurse:!1}:iR(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}(function(){function e(t,n,r,a,i,o,s){_classCallCheck(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=e.nextId++}return _createClass(e,[{key:"clearAndClose",value:function(){this.tensors.forEach((function(e){return e.tensor.dispose()})),this.tensors=[],this.closed_=!0}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n&&n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n&&n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Mm([],[0].concat(this.elementShape));var r=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),og(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Mm([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),$m(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,_toConsumableArray(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,sg(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:t.size/r,o=[];ey((function(){t=t.reshape([1,r,i]);for(var s=0;s<e.length;++s)o[s]=Rb(t,[0,0===s?0:a[s-1],0],[1,e[s],i]).reshape(n.elementShape);return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}},{key:"assertShapesMatchAllowUndefinedSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r.assert(this.shapesEqualAllowUndefinedSize(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}},{key:"shapesEqualAllowUndefinedSize",value:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0}},{key:"closed",get:function(){return this.closed_}}]),e}()).nextId=0;var sR=function(){function e(t){if(_classCallCheck(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return _createClass(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(az){n.e(az)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),uR=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.call(this,n.INITIAL_CAPACITY)}return _createClass(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){_get(_getPrototypeOf(n.prototype),"isFull",this).call(this)&&this.expand(),_get(_getPrototypeOf(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){_get(_getPrototypeOf(n.prototype),"isFull",this).call(this)&&this.expand(),_get(_getPrototypeOf(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(sR);uR.INITIAL_CAPACITY=32;var cR,lR=function(){function e(){_classCallCheck(this,e)}var t,n,r,a,i,o;return _createClass(e,[{key:"toArray",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"toArrayForTest",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=3,t.next();case 3:r=e.sent;case 4:if(r.done){e.next=11;break}return n.push(r.value),e.next=8,t.next();case 8:r=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"resolveFully",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"resolveWhile",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleErrors",value:function(e){return new bR(this,e)}},{key:"filter",value:function(e){return new gR(this,e)}},{key:"map",value:function(e){return new yR(this,e)}},{key:"mapAsync",value:function(e){return new kR(this,e)}},{key:"serialMapAsync",value:function(e){return new kR(this,e).serial()}},{key:"flatmap",value:function(e){return new _R(this,e)}},{key:"forEachAsync",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"serialForEach",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new mR(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:aR;return this.rowMajorBatch(e,t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:aR;return function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,a=t[0];if(r.has(a))throw new Error("Circular references are not supported.");var i=n(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(iR(a)){var o=Array.isArray(a)?[]:{};r.add(a);var s=function(a){var i=e(t.map((function(e){return e[a]})),n,r);o[a]=i};for(var u in a)s(u);return r.delete(a),o}throw new Error("Can't recurse into non-iterable type: ".concat(a))}return i.value}(e,t)}(e,n)}))}},{key:"concatenate",value:function(e,t){return new wR(new hR([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new vR(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new pR(this,e)}},{key:"prefetch",value:function(e){return new xR(this,e)}},{key:"shuffle",value:function(e,t){return new CR(this,e,t)}},{key:"serial",value:function(){return new dR(this)}}]),e}(),hR=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).items=e,t.trav=0,t}return _createClass(r,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:(n=t,function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==t)return null;if(a.has(t))throw new Error("Circular references are not supported.");if(r.has(t))return r.get(t);var i=n(t);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(iR(t)){var o=Array.isArray(t)?[]:{};for(var s in a.add(t),t){var u=e(t[s],n,r,a);o[s]=u}return a.delete(t),o}throw new Error("Can't recurse into non-iterable type: ".concat(t))}return r.set(t,i.value),i.value}(n,oR)),done:!1}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(lR),fR=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck(this,r),(t=n.call(this)).nextFn=e,t}return _createClass(r,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(){return t.apply(this,arguments)})}]),r}(lR),dR=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t;return _classCallCheck(this,a),(t=r.call(this)).upstream=e,t.lastRead=Promise.resolve({value:null,done:!1}),t}return _createClass(a,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(lR),pR=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.maxCount=t,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:ty(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(lR),vR=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.maxCount=t,a.count=0,a}return _createClass(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(lR),mR=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.batchSize=t,n.enableSmallLastBatch=i,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(lR),gR=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.predicate=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:ty(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(lR),yR=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=a.getTensorsInContainer(t.value),r=this.transform(t.value),i=a.getTensorsInContainer(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(az){o.e(az)}finally{o.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(lR),bR=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).upstream=e,n.handler=t,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass(a,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return t.apply(this,arguments)})}]),a}(lR),kR=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=a.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,i=a.getTensorsInContainer(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(az){o.e(az)}finally{o.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(lR),_R=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=a.getTensorsInContainer(t.value),r=this.transform(t.value),i=a.getTensorsInContainer(r),this.outputQueue.pushAll(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(az){o.e(az)}finally{o.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(){var e;return _classCallCheck(this,a),(e=r.call(this)).outputQueue=new uR,e.lastRead=Promise.resolve({value:null,done:!1}),e}return _createClass(a,[{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(lR)),wR=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck(this,a),(n=r.call(this)).baseErrorHandler=t,n.lastRead=null,n.iterator=null,n.moreIterators=e,n}return _createClass(a,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"readFromChain",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(lR);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(cR||(cR={}));var xR=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new sR(r),a}return _createClass(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(lR),CR=function(e){_inherits(i,e);var t,n,a=_createSuper(i);function i(e,t,n){var o;return _classCallCheck(this,i),(o=a.call(this,e,t)).upstream=e,o.windowSize=t,o.upstreamExhausted=!1,o.random=K_.alea(n||r.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return _createClass(i,[{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=11;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if((n=e.sent).done){e.next=8;break}return e.abrupt("return",(this.refill(),n));case 8:this.upstreamExhausted=!0;case 9:e.next=1;break;case 11:return e.abrupt("return",{value:null,done:!0});case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(xR),SR=function(){function e(){_classCallCheck(this,e),this.size=null}var t,n,a;return _createClass(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this;return r.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,ER));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return ey((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"map",value:function(e){var t=this;return TR(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return ey((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return TR(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return TR(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(r=(a=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),new fR(a)).take(e),new wR(r,void 0)));case 1:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var a=this,i=K_.alea(t||r.now().toString());return TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.int32(),n&&(r+=i.int32()),t.next=4,a.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,r.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,TR(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"toArrayForTest",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function TR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){_inherits(i,n);var r,a=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=a.apply(this,arguments)).size=t,e}return _createClass(i,[{key:"iterator",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}]),i}(SR))}function ER(e){return null===e?null:null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof Kv||r.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Kv?og(e):Mm(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}function AR(e,t,n,a){for(var i=r.getTypedArrayFromDType(a,r.sizeFromShape(n)),o=0;o<i.length;++o){for(var s=o*t,u=e[s],c=0;c<t;++c){var l=e[s+c];l>u&&(u=l)}i[o]=u}return i}function IR(e,t,n,a,i){for(var o=t.length,s=r.sizeFromShape(t),u=r.computeStrides(t),c=r.computeStrides(i),l=r.getTypedArrayFromDType(n,r.sizeFromShape(i)),h=0;h<s;++h){for(var f=r.indexToLoc(h,o,u),d=new Array(f.length),p=0;p<d.length;p++)d[p]=f[a[p]];l[r.locToIndex(d,o,c)]=e[h]}return l}function RR(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&r.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}function NR(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,f=a.padInfo.top,d=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=Jm(a.outShape,n),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],k=0;k<a.batchSize;++k)for(var _=k*g,w=k*r[0],x=0;x<a.inChannels;++x)for(var C=0;C<a.outHeight;++C)for(var S=C*o-f,T=Math.max(0,S),E=Math.min(a.inHeight,l+S),A=_+C*y,I=0;I<a.outWidth;++I){for(var R=I*s-d,N=Math.max(0,R),O=Math.min(a.inWidth,h+R),D=p,F=0,M=0,L=T;L<E;L+=u){for(var P=w+L*r[1],z=N;z<O;z+=c){var B=e[P+z*r[2]+x];"max"===i&&B>D?D=B:"avg"===i&&(F+=B,M++)}if(isNaN(D))break}m[A+I*b+x]="avg"===i?F/M:D}return v}function OR(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Jm(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=Jm(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,k=b;k<0;)k+=c;for(var _=Math.min(r.inHeight,h+b),w=0;w<r.outWidth;++w){for(var x=w*u-p,C=x;C<0;)C+=l;for(var S=Math.min(r.inWidth,f+x),T=Number.NEGATIVE_INFINITY,E=-1,A=k;A<_;A+=c)for(var I=A-b,R=C;R<S;R+=l){var N=R-x,O=v.get(m,A,R,g);O>T&&(T=O,E=a?i?((m*r.inHeight+A)*r.inWidth+R)*r.inChannels+g:(A*r.inWidth+R)*r.inChannels+g:I*f+N)}o.set(E,m,y,w,g)}}return o}SR.MAX_BUFFER_SIZE=1e4,Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");var DR=b.nonMaxSuppressionV3,FR=b.split,MR=b.tile,LR=b.topkImpl,PR=b.whereImpl;function zR(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}var BR=function(e){_inherits(i,e);var t,n,a=_createSuper(i);function i(){var e;return _classCallCheck(this,i),(e=a.call(this)).blockSize=48,e.firstUse=!0,e.data=new NC(_assertThisInitialized(e),$g()),e}return _createClass(i,[{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,Dp().get("IS_NODE")&&y.warn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r}},{key:"move",value:function(e,t,n,r){this.data.set(e,{values:t,dtype:r})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensors;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return y.mergeRealAndImagArrays(a,i)}return this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return r.decodeString(e)}))}catch(a){throw new Error("Failed to decode encoded string bytes into utf-8")}return Jm(e.shape,e.dtype,n)}},{key:"makeOutput",value:function(e,t,n){var r=this.write(e,t,n);return $g().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.now(),e.abrupt("return",(t(),{kernelMs:r.now()-n}));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"complex",value:function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:$g().keep(e.clone()),imag:$g().keep(t.clone())},n}},{key:"real",value:function(e){return this.data.get(e.dataId).complexTensors.real.clone()}},{key:"imag",value:function(e){return this.data.get(e.dataId).complexTensors.imag.clone()}},{key:"slice",value:function(e,t,n){if(RR(e,"slice"),o.isSliceContinous(e.shape,t,n)){var a=o.computeFlatOffset(t,e.strides),i=r.sizeFromShape(n);return Mm(this.readSync(e.dataId).subarray(a,a+i),n,e.dtype)}for(var s=Jm(n,e.dtype),u=this.bufferSync(e),c=0;c<s.size;++c){var l=s.indexToLoc(c).map((function(e,n){return e+t[n]}));s.values[c]=u.get.apply(u,_toConsumableArray(l))}return s.toTensor()}},{key:"stridedSlice",value:function(e,t,n,r){RR(e,"stridedSlice");var a=o.computeOutShape(t,n,r);if(a.some((function(e){return 0===e})))return Mm([],a);for(var i=Jm(a,e.dtype),s=this.bufferSync(e),u=0;u<i.size;u++){for(var c=i.indexToLoc(u),l=new Array(c.length),h=0;h<l.length;h++)l[h]=c[h]*r[h]+t[h];i.set.apply(i,[s.get.apply(s,l)].concat(_toConsumableArray(c)))}return i.toTensor()}},{key:"diag",value:function(e){for(var t=this.readSync(e.dataId),n=Jm([e.size,e.size],e.dtype),r=n.values,a=0;a<t.length;a++)r[a*e.size+a]=t[a];return n.toTensor()}},{key:"unstack",value:function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;for(var u=new Array(n),c=0;c<u.length;c++)o[t]=c,u[c]=this.slice(e,o,s).reshape(r);return u}},{key:"reverse",value:function(e,t){RR(e,"reverse");for(var n=Jm(e.shape,e.dtype),r=this.bufferSync(e),a=function(a){var i=n.indexToLoc(a),o=i.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,_toConsumableArray(o))].concat(_toConsumableArray(i)))},i=0;i<n.size;i++)a(i);return n.toTensor()}},{key:"concat",value:function(e,t){var n=this;if("complex64"===e[0].dtype){var a=e.map((function(e){return Dm(e)})),i=e.map((function(e){return Fm(e)}));return Om(this.concat(a,t),this.concat(i,t))}var o=e.map((function(e){var n=r.sizeFromShape(e.shape.slice(t));return e.as2D(-1,n)})),s=y.computeOutShape(o.map((function(e){return e.shape})),1),u=Jm(s,e[0].dtype).values;if(1===o[0].shape[0]){var c=0;o.forEach((function(e){u.set(n.readSync(e.dataId),c),c+=e.size}))}else{var l=0;o.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,a=0;a<e.shape[0];++a)for(var i=a*s[1]+l,o=0;o<e.shape[1];++o)u[i+o]=t[r++];l+=e.shape[1]}))}var h=y.computeOutShape(e.map((function(e){return e.shape})),t);return Mm(u,h,e[0].dtype)}},{key:"neg",value:function(e){return RR(e,"neg"),this.multiply(Pm(-1),e)}},{key:"add",value:function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,tm(e.dtype,t.dtype),(function(e,t){return e+t}))}},{key:"addN",value:function(e){var t=this;RR(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=Jm(e[0].shape,e[0].dtype),a=r.values,i=0;i<e.length;i++)for(var o=n[i],s=0;s<a.length;s++)a[s]+=o[s];return r.toTensor()}},{key:"softmax",value:function(e,t){var n=r.parseAxisParam([t],e.shape),a=z_(e,n),i=y.expandShapeToKeepDim(a.shape,n),o=this.subtract(e,a.reshape(i)),s=this.exp(o),u=this.sum(s,n).reshape(i);return tb(s,u)}},{key:"subtract",value:function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,tm(e.dtype,t.dtype),(function(e,t){return e-t}))}},{key:"pow",value:function(e,t){return RR([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))}},{key:"batchMatMul",value:function(e,t,n,r){RR([e,t],"matMul");for(var a=n?e.shape[1]:e.shape[2],i=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=_slicedToArray(n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],3),h=l[0],f=l[1],d=l[2],p=_slicedToArray(r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],3),v=p[0],m=p[1],g=p[2],y=i*o,b=Jm([s,i,o],e.dtype),k=b.values,_=this.blockSize,w=0;w<s;w++)for(var x=0;x<i;x+=_)for(var C=0;C<o;C+=_)for(var S=0;S<a;S+=_)for(var T=Math.min(x+_,i),E=Math.min(C+_,o),A=Math.min(S+_,a),I=x;I<T;I++)for(var R=C;R<E;R++){for(var N=0,O=S;O<A;O++)N+=u[w*h+I*f+O*d]*c[O*v+R*m+w*g];k[w*y+(I*o+R)]+=N}return b.toTensor()}},{key:"fusedBatchMatMul",value:function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=this.batchMatMul(t,n,r,a);return i&&(u=this.add(u,i)),o&&(u=zR(this,u,o,s)),u}},{key:"multiply",value:function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,tm(e.dtype,t.dtype),(function(e,t){return e*t}))}},{key:"floorDiv",value:function(e,t){return RR([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))}},{key:"sum",value:function(e,t){RR(e,"sum"),y.assertAxesAreInnerMostDims("sum",t,e.rank);for(var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=Gm(a,tm(e.dtype,"int32")),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=0,d=0;d<s;++d)f+=c[h+d];u[l]=f}return o}},{key:"prod",value:function(e,t){RR(e,"sum");for(var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=Gm(a,tm(e.dtype,"int32")),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=1,d=0;d<s;++d)f*=c[h+d];u[l]=f}return o}},{key:"unsortedSegmentSum",value:function(e,t,n){RR(e,"unsortedSegmentSum");for(var r=[],a=e.rank-t.rank,i=0;i<a;++i)t=t.expandDims(i+1);for(var o=0;o<n;++o){var s=Pm(o,"int32"),u=N_(s,t).asType("float32").mul(e).sum(0);r.push(u)}return og(r)}},{key:"argMin",value:function(e,t){RR(e,"argMin");var n=[t];y.assertAxesAreInnerMostDims("argMin",n,e.rank);for(var a=_slicedToArray(y.computeOutAndReduceShapes(e.shape,n),2),i=a[0],o=a[1],s=Gm(i,"int32"),u=r.sizeFromShape(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),h=0;h<c.length;++h){for(var f=h*u,d=l[f],p=0,v=0;v<u;++v){var m=l[f+v];m<d&&(d=m,p=v)}c[h]=p}return s}},{key:"argMax",value:function(e,t){RR(e,"argMax");var n=[t];y.assertAxesAreInnerMostDims("argMax",n,e.rank);for(var a=_slicedToArray(y.computeOutAndReduceShapes(e.shape,n),2),i=a[0],o=a[1],s=Gm(i,"int32"),u=r.sizeFromShape(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),h=0;h<c.length;++h){for(var f=h*u,d=l[f],p=0,v=0;v<u;++v){var m=l[f+v];m>d&&(d=m,p=v)}c[h]=p}return s}},{key:"cumsum",value:function(e,t,n,r){if(RR(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(e.rank-1," ")+"but got axis=".concat(t));for(var a=tm(e.dtype,"int32"),i=Gm(e.shape,a),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var f=c(l,h);if(0===h)o[f]=n?0:s[f];else{var d=c(l,h-1);o[f]=n?s[d]+o[d]:s[f]+o[d]}}return i}},{key:"equal",value:function(e,t){return RR([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))}},{key:"notEqual",value:function(e,t){return RR([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))}},{key:"less",value:function(e,t){return RR([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))}},{key:"lessEqual",value:function(e,t){return RR([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))}},{key:"greater",value:function(e,t){return RR([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))}},{key:"greaterEqual",value:function(e,t){return RR([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))}},{key:"logicalNot",value:function(e){RR(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")}},{key:"logicalAnd",value:function(e,t){return RR([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))}},{key:"logicalOr",value:function(e,t){return RR([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))}},{key:"select",value:function(e,t,n){RR([e,t,n],"select");for(var a=this.readSync(e.dataId),i=this.readSync(t.dataId),o=this.readSync(n.dataId),s=Gm(t.shape,tm(t.dtype,n.dtype)),u=this.readSync(s.dataId),c=0,l=0===e.rank||e.rank>1||1===t.rank?1:r.sizeFromShape(t.shape.slice(1)),h=0;h<a.length;h++)for(var f=0;f<l;f++)u[c++]=1===a[h]?i[h]:o[h];return s}},{key:"where",value:function(e){RR([e],"where");var t=this.readSync(e.dataId);return PR(e.shape,t)}},{key:"topk",value:function(e,t,n){RR(e,"topk");var r=this.readSync(e.dataId);return LR(r,e.shape,e.dtype,t,n)}},{key:"min",value:function(e,t){RR(e,"min"),y.assertAxesAreInnerMostDims("min",t,e.rank);for(var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=Gm(a,e.dtype),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0;d<s;++d){var p=c[h+d];p<f&&(f=p)}u[l]=f}return o}},{key:"minimum",value:function(e,t){return RR([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))}},{key:"mod",value:function(e,t){return RR([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))}},{key:"maximum",value:function(e,t){return RR([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))}},{key:"all",value:function(e,t){RR(e,"all"),y.assertAxesAreInnerMostDims("all",t,e.rank);for(var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=Gm(a,e.dtype),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0;d<s;++d){var p=c[h+d];f=f&&p}u[l]=f}return o}},{key:"any",value:function(e,t){RR(e,"any"),y.assertAxesAreInnerMostDims("any",t,e.rank);for(var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=Gm(a,e.dtype),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0;d<s;++d){var p=c[h+d];f=f||p}u[l]=f}return o}},{key:"squaredDifference",value:function(e,t){return RR([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))}},{key:"ceil",value:function(e){RR(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"floor",value:function(e){RR(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"sign",value:function(e){RR(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=t[r]<0?-1:t[r]>0?1:0;return this.makeOutput(n,e.shape,"float32")}},{key:"isNaN",value:function(e){RR(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")}},{key:"isInf",value:function(e){RR(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")}},{key:"isFinite",value:function(e){RR(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")}},{key:"round",value:function(e){RR(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var a=Math.floor(t[r]);n[r]=t[r]-a<.5?Math.floor(t[r]):t[r]-a>.5?Math.ceil(t[r]):a%2==0?a:a+1}return this.makeOutput(n,e.shape,"float32")}},{key:"exp",value:function(e){RR(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"expm1",value:function(e){RR(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"log",value:function(e){RR(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.log(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"log1p",value:function(e){RR(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.log1p(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"sqrt",value:function(e){RR(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.sqrt(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"rsqrt",value:function(e){RR(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/Math.sqrt(t[r]);return this.makeOutput(n,e.shape,"float32")}},{key:"reciprocal",value:function(e){RR(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")}},{key:"linear",value:function(e){return e}},{key:"relu",value:function(e){RR(e,"relu");for(var t=Gm(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.max(0,r[a]);return t}},{key:"relu6",value:function(e){RR(e,"relu");for(var t=Gm(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),a=0;a<r.length;++a)n[a]=Math.min(Math.max(0,r[a]),6);return t}},{key:"prelu",value:function(e,t){return RR([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))}},{key:"elu",value:function(e){RR(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var a=n[r];t[r]=a>=0?a:Math.exp(a)-1}return this.makeOutput(t,e.shape,"float32")}},{key:"eluDer",value:function(e,t){RR([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];n[i]=o>=1?a[i]:a[i]*(o+1)}return this.makeOutput(n,t.shape,"float32")}},{key:"selu",value:function(e){RR(e,"selu");for(var t=y.SELU_SCALEALPHA,n=y.SELU_SCALE,r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>=0?n*o:t*(Math.exp(o)-1)}return this.makeOutput(r,e.shape,"float32")}},{key:"clip",value:function(e,t,n){RR(e,"clip");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),i=0;i<a.length;++i){var o=a[i];r[i]=o>n?n:o<t?t:o}return this.makeOutput(r,e.shape,"float32")}},{key:"abs",value:function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"complexAbs",value:function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r)t[r]=Math.hypot(n[2*r],n[2*r+1]);return this.makeOutput(t,e.shape,"float32")}},{key:"int",value:function(e){RR(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")}},{key:"sigmoid",value:function(e){RR(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")}},{key:"softplus",value:function(e){RR(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i,o=r[a]>-t,s=r[a]<t,u=Math.exp(r[a]);i=s?u:o?r[a]:Math.log(1+u),n[a]=i}return this.makeOutput(n,e.shape,"float32")}},{key:"sin",value:function(e){RR(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"cos",value:function(e){RR(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"tan",value:function(e){RR(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"asin",value:function(e){RR(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"acos",value:function(e){RR(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"atan",value:function(e){RR(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"atan2",value:function(e,t){return RR([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))}},{key:"sinh",value:function(e){RR(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"cosh",value:function(e){RR(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"tanh",value:function(e){RR(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),a=0;a<n.length;++a)t[a]=r.tanh(n[a]);return this.makeOutput(t,e.shape,"float32")}},{key:"asinh",value:function(e){RR(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"acosh",value:function(e){RR(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"atanh",value:function(e){RR(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")}},{key:"erf",value:function(e){RR(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=y.ERF_P,a=y.ERF_A1,i=y.ERF_A2,o=y.ERF_A3,s=y.ERF_A4,u=y.ERF_A5,c=0;c<n.length;++c){var l=Math.sign(n[c]),h=Math.abs(n[c]),f=1/(1+r*h);t[c]=l*(1-((((u*f+s)*f+o)*f+i)*f+a)*f*Math.exp(-h*h))}return this.makeOutput(t,e.shape,"float32")}},{key:"step",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;RR(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=isNaN(i)?NaN:i>0?1:t}return this.makeOutput(n,e.shape,"float32")}},{key:"fusedConv2d",value:function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.conv2d(t,n,r);return a&&(s=this.add(s,a)),i&&(s=zR(this,s,i,o)),s}},{key:"conv2d",value:function(e,t,n){RR([e,t],"conv2d");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Jm(n.outShape,e.dtype),h=e.strides[0],f=c?e.strides[1]:e.strides[2],d=c?e.strides[2]:1,p=c?1:e.strides[1],v=l.strides[0],m=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),k=this.readSync(t.dataId),_=l.values,w=0;w<n.batchSize;++w)for(var x=w*h,C=w*v,S=0;S<n.outHeight;++S)for(var T=C+S*m,E=S*n.strideHeight-u,A=0;A<r;A++){var I=E+A*i;if(!(I<0||I>=n.inHeight))for(var R=A*t.strides[0],N=x+I*f,O=0;O<n.outWidth;++O)for(var D=T+O*g,F=O*n.strideWidth-s,M=0;M<a;M++){var L=F+M*o;if(!(L<0||L>=n.inWidth))for(var P=N+L*d,z=R+M*t.strides[1],B=0;B<n.inChannels;++B){for(var U=b[P+B*p],W=0;W<n.outChannels;++W)_[D+W*y]+=U*k[z+W];z+=n.outChannels}}}return l.toTensor()}},{key:"conv3d",value:function(e,t,n){for(var r=n.filterDepth,a=n.filterHeight,i=n.filterWidth,o=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,f=Jm(n.outShape,e.dtype),d=this.readSync(e.dataId),p=this.readSync(t.dataId),v=f.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*f.strides[0],b=0;b<n.outDepth;++b)for(var k=y+b*f.strides[1],_=b*n.strideDepth-c,w=0;w<r;w++){var x=_+w*o;if(!(x<0||x>=n.inDepth))for(var C=w*t.strides[0],S=g+x*e.strides[1],T=0;T<n.outHeight;++T)for(var E=k+T*f.strides[2],A=T*n.strideHeight-h,I=0;I<a;I++){var R=A+I*s;if(!(R<0||R>=n.inHeight))for(var N=C+I*t.strides[1],O=S+R*e.strides[2],D=0;D<n.outWidth;++D)for(var F=E+D*n.outChannels,M=D*n.strideWidth-l,L=0;L<i;L++){var P=M+L*u;if(!(P<0||P>=n.inWidth))for(var z=O+P*n.inChannels,B=N+L*t.strides[2],U=0;U<n.inChannels;++U){for(var W=d[z+U],V=0;V<n.outChannels;++V)v[F+V]+=W*p[B+V];B+=n.outChannels}}}}return f.toTensor()}},{key:"conv2dDerInput",value:function(e,t,n){RR([e,t],"conv2dDerInput");for(var r=Jm(n.inShape,"float32"),a=r.values,i=this.readSync(e.dataId),o=this.readSync(t.dataId),s=_slicedToArray(t.strides,3),u=s[0],c=s[1],l=s[2],h=n.batchSize,f=n.filterHeight,d=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,k=n.strideHeight,_=n.strideWidth,w=n.dataFormat,x=f-1-n.padInfo.top,C=d-1-n.padInfo.left,S="channelsLast"===w,T=r.strides[0],E=S?r.strides[1]:r.strides[2],A=S?r.strides[2]:1,I=S?1:r.strides[1],R=e.strides[0],N=S?e.strides[1]:e.strides[2],O=S?e.strides[2]:1,D=S?1:e.strides[1],F=0;F<h;++F)for(var M=0;M<p;++M)for(var L=0;L<v;++L)for(var P=L-x,z=Math.max(0,Math.ceil(P/k)),B=Math.min(y,(f+P)/k),U=0;U<m;++U){for(var W=U-C,V=Math.max(0,Math.ceil(W/_)),j=Math.min(b,(d+W)/_),H=0,q=z;q<B;++q)for(var G=q*k-P,K=V;K<j;++K)for(var X=R*F+N*q+O*K,Y=u*(f-1-G)+c*(d-1-(K*_-W))+l*M,Q=0;Q<g;++Q)H+=i[X+D*Q]*o[Y+Q];a[T*F+E*L+A*U+I*M]=H}return r.toTensor()}},{key:"conv3dDerInput",value:function(e,t,n){for(var r=Jm(n.inShape,"float32"),a=r.values,i=_slicedToArray(r.strides,4),o=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(e.dataId),h=_slicedToArray(e.strides,4),f=h[0],d=h[1],p=h[2],v=h[3],m=this.readSync(t.dataId),g=_slicedToArray(t.strides,4),y=g[0],b=g[1],k=g[2],_=g[3],w=n.batchSize,x=n.filterDepth,C=n.filterHeight,S=n.filterWidth,T=n.inChannels,E=n.inDepth,A=n.inHeight,I=n.inWidth,R=n.outChannels,N=n.outDepth,O=n.outHeight,D=n.outWidth,F=n.strideDepth,M=n.strideHeight,L=n.strideWidth,P=x-1-n.padInfo.front,z=C-1-n.padInfo.top,B=S-1-n.padInfo.left,U=0;U<w;++U)for(var W=0;W<T;++W)for(var V=0;V<E;++V)for(var j=V-P,H=Math.max(0,Math.ceil(j/F)),q=Math.min(N,(x+j)/F),G=0;G<A;++G)for(var K=G-z,X=Math.max(0,Math.ceil(K/M)),Y=Math.min(O,(C+K)/M),Q=0;Q<I;++Q){for(var Z=Q-B,$=Math.max(0,Math.ceil(Z/L)),J=Math.min(D,(S+Z)/L),ee=0,te=H;te<q;++te)for(var ne=te*F-j,re=X;re<Y;++re)for(var ae=re*M-K,ie=$;ie<J;++ie)for(var oe=f*U+d*te+p*re+v*ie,se=y*(x-1-ne)+b*(C-1-ae)+k*(S-1-(ie*L-Z))+_*W,ue=0;ue<R;++ue)ee+=l[oe+ue]*m[se+ue];a[o*U+s*V+u*G+c*Q+W]=ee}return r.toTensor()}},{key:"conv2dDerFilter",value:function(e,t,n){RR([e,t],"conv2dDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s="channelsLast"===n.dataFormat,u=Jm(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(e),f=this.bufferSync(t),d=0;d<i;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<o;++m)for(var g=Math.max(0,Math.ceil((c-m)/a)),y=Math.min(n.outWidth,(n.inWidth+c-m)/a),b=0;b<n.inChannels;++b)for(var k=0;k<n.outChannels;++k){for(var _=0,w=0;w<n.batchSize;++w)for(var x=p;x<v;++x)for(var C=d+x*r-l,S=g;S<y;++S){var T=m+S*a-c;_+=s?h.get(w,C,T,b)*f.get(w,x,S,k):h.get(w,b,C,T)*f.get(w,k,x,S)}u.set(_,d,m,b,k)}return u.toTensor()}},{key:"conv3dDerFilter",value:function(e,t,n){for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Jm(n.filterShape,"float32"),l=c.values,h=_slicedToArray(c.strides,4),f=h[0],d=h[1],p=h[2],v=h[3],m=this.readSync(t.dataId),g=_slicedToArray(t.strides,4),y=g[0],b=g[1],k=g[2],_=g[3],w=this.readSync(e.dataId),x=_slicedToArray(e.strides,4),C=x[0],S=x[1],T=x[2],E=x[3],A=n.padInfo.front,I=n.padInfo.left,R=n.padInfo.top,N=0;N<o;++N)for(var O=Math.max(0,Math.ceil((A-N)/r)),D=Math.min(n.outDepth,(n.inDepth+A-N)/r),F=N*f,M=0;M<s;++M)for(var L=Math.max(0,Math.ceil((R-M)/a)),P=Math.min(n.outHeight,(n.inHeight+R-M)/a),z=M*d+F,B=0;B<u;++B)for(var U=Math.max(0,Math.ceil((I-B)/i)),W=Math.min(n.outWidth,(n.inWidth+I-B)/i),V=B*p+z,j=0;j<n.inChannels;++j)for(var H=j*v+V,q=0;q<n.outChannels;++q){for(var G=0,K=0;K<n.batchSize;++K)for(var X=K*C,Y=K*y,Q=O;Q<D;++Q)for(var Z=(N+Q*r-A)*S+X,$=Q*b+Y,J=L;J<P;++J)for(var ee=(M+J*a-R)*T+Z,te=J*k+$,ne=U;ne<W;++ne)G+=w[(B+ne*i-I)*E+ee+j]*m[ne*_+te+q];l[H+q]=G}return c.toTensor()}},{key:"fusedDepthwiseConv2D",value:function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights,s=this.depthwiseConv2D(t,n,r);return a&&(s=this.add(s,a)),i&&(s=zR(this,s,i,o)),s}},{key:"depthwiseConv2D",value:function(e,t,n){RR([e,t],"depthwiseConv2D");for(var r=n.filterHeight,a=n.filterWidth,i=n.dilationHeight,o=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Jm(n.outShape,e.dtype),h=this.readSync(e.dataId),f=this.readSync(t.dataId),d=l.values,p=0;p<n.batchSize;++p)for(var v=p*e.strides[0],m=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],b=g*n.strideHeight-s,k=0;k<r;++k){var _=b+k*i;if(!(_<0||_>=n.inHeight))for(var w=k*t.strides[0],x=v+_*e.strides[1],C=0;C<n.outWidth;++C)for(var S=y+C*l.strides[2],T=C*n.strideWidth-u,E=0;E<a;++E){var A=T+E*o;if(!(A<0||A>=n.inWidth))for(var I=x+A*n.inChannels,R=S,N=w+E*t.strides[1],O=0;O<n.inChannels;++O){for(var D=h[I+O],F=0;F<c;++F)d[R+F]+=D*f[N+F];R+=c,N+=c}}}return l.toTensor()}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){RR([e,t],"depthwiseConv2DDerInput");for(var r=Jm(n.inShape,"float32"),a=r.values,i=_slicedToArray(r.strides,3),o=i[0],s=i[1],u=i[2],c=this.readSync(e.dataId),l=_slicedToArray(e.strides,3),h=l[0],f=l[1],d=l[2],p=this.readSync(t.dataId),v=_slicedToArray(t.strides,3),m=v[0],g=v[1],y=v[2],b=n.batchSize,k=n.filterHeight,_=n.filterWidth,w=n.inChannels,x=n.inHeight,C=n.inWidth,S=n.outChannels,T=n.outHeight,E=n.outWidth,A=n.strideHeight,I=n.strideWidth,R=k-1-n.padInfo.top,N=_-1-n.padInfo.left,O=S/w,D=0;D<b;++D)for(var F=0;F<w;++F)for(var M=0;M<x;++M)for(var L=M-R,P=Math.max(0,Math.ceil(L/A)),z=Math.min(T,(k+L)/A),B=0;B<C;++B){for(var U=B-N,W=Math.max(0,Math.ceil(U/I)),V=Math.min(E,(_+U)/I),j=0,H=P;H<z;++H)for(var q=H*A-L,G=W;G<V;++G)for(var K=h*D+f*H+d*G,X=m*(k-1-q)+g*(_-1-(G*I-U))+y*F,Y=0;Y<O;++Y)j+=c[K+(F*O+Y)]*p[X+Y];a[o*D+s*M+u*B+F]=j}return r.toTensor()}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){RR([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=Jm(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(e),f=this.bufferSync(t),d=0;d<i;++d)for(var p=Math.max(0,Math.ceil((c-d)/r)),v=Math.min(n.outHeight,(n.inHeight+c-d)/r),m=0;m<o;++m)for(var g=Math.max(0,Math.ceil((u-m)/a)),y=Math.min(n.outWidth,(n.inWidth+u-m)/a),b=0;b<n.outChannels;++b){for(var k=Math.trunc(b/l),_=b%l,w=0,x=0;x<n.batchSize;++x)for(var C=p;C<v;++C)for(var S=d+C*r-c,T=g;T<y;++T)w+=h.get(x,S,m+T*a-u,k)*f.get(x,C,T,b);s.set(w,d,m,k,_)}return s.toTensor()}},{key:"tile",value:function(e,t){return RR(e,"tile"),MR(this.bufferSync(e),t)}},{key:"pad",value:function(e,t,n){RR(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),a=t.map((function(e){return e[0]})),i=this.bufferSync(e),o=Jm(r,e.dtype);0!==n&&o.values.fill(n);for(var s=0;s<e.size;s++){var u=i.indexToLoc(s),c=u.map((function(e,t){return e+a[t]}));o.set.apply(o,[i.get.apply(i,_toConsumableArray(u))].concat(_toConsumableArray(c)))}return o.toTensor()}},{key:"gather",value:function(e,t,n){RR([e,t],"gather");var r=e.shape.slice(),a=this.readSync(t.dataId);r[n]=a.length;for(var i=Jm(r,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=a[u[n]];var l=o.locToIndex(c);i.values[s]=o.values[l]}return i.toTensor()}},{key:"batchToSpaceND",value:function(e,t,n){RR([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),a=y.getReshaped(e.shape,t,r),i=y.getPermuted(a.length,t.length),o=y.getReshapedPermuted(e.shape,t,r),s=y.getSliceBeginCoords(n,t.length),u=y.getSliceSize(o,n,t.length);return lb(e.reshape(a),i).reshape(o).slice(s,u)}},{key:"spaceToBatchND",value:function(e,t,n){RR([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),a=[[0,0]];a.push.apply(a,_toConsumableArray(n));for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),s=y.getReshaped(o.shape,t,r,!1),u=y.getPermuted(s.length,t.length,!1),c=y.getReshapedPermuted(o.shape,t,r,!1);return lb(o.reshape(s),u).reshape(c)}},{key:"maxPool",value:function(e,t){return RR(e,"maxPool"),NR(this.readSync(e.dataId),0,e.dtype,e.strides,t,"max").toTensor()}},{key:"maxPoolBackprop",value:function(e,t,n,r){RR([t,n],"maxPoolBackprop");for(var a=this.readSync(t.dataId),i=Jm(r.outShape,t.dtype,OR(a,t.shape,t.dtype,r).values),o=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=h-1-r.padInfo.left,d=l-1-r.padInfo.top,p=Jm(t.shape,"float32"),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var k=y-d,_=b-f,w=0,x=0;x<l;x+=u){var C=(k+x)/o;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var S=0;S<h;S+=c){var T=(_+S)/s;if(!(T<0||T>=r.outWidth||Math.floor(T)!==T)){var E=l*h-1-i.get(m,C,T,g)===x*h+S?1:0;0!==E&&(w+=v.get(m,C,T,g)*E)}}}p.set(w,m,y,b,g)}return p.toTensor()}},{key:"avgPoolBackprop",value:function(e,t,n){RR([e,t],"avgPoolBackprop");for(var r=n.strideHeight,a=n.strideWidth,i=n.filterHeight,o=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,f=c-1-n.padInfo.top,d=Jm(t.shape,"float32"),p=1/(i*o),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var k=y-f,_=b-h,w=0,x=0;x<c;x+=s){var C=(k+x)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var S=0;S<l;S+=u){var T=(_+S)/a;T<0||T>=n.outWidth||Math.floor(T)!==T||(w+=v.get(m,C,T,g))}}d.set(w*p,m,y,b,g)}return d.toTensor()}},{key:"pool3d",value:function(e,t,n){RR(e,"pool3d");for(var r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=Jm(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],k=t.outShape[2]*t.outShape[3]*t.outShape[4],_=t.outShape[3]*t.outShape[4],w=t.outShape[4],x=0;x<t.batchSize;++x)for(var C=x*b,S=x*e.strides[0],T=0;T<t.inChannels;++T)for(var E=0;E<t.outDepth;++E){for(var A=E*r-f,I=A;I<0;)I+=o;for(var R=Math.min(t.inDepth,c+A),N=C+E*k,O=0;O<t.outHeight;++O){for(var D=O*a-d,F=D;F<0;)F+=s;for(var M=Math.min(t.inHeight,l+D),L=N+O*_,P=0;P<t.outWidth;++P){for(var z=P*i-p,B=z;B<0;)B+=u;for(var U=Math.min(t.inWidth,h+z),W=L+P*w,V=v,j=0,H=0,q=I;q<R;q+=o){for(var G=S+q*e.strides[1],K=F;K<M;K+=s){for(var X=G+K*e.strides[2],Y=B;Y<U;Y+=u){var Q=m[X+Y*e.strides[3]+T];if("max"===n&&Q>V?V=Q:"avg"===n&&(j+=Q,H++),isNaN(V))break}if(isNaN(V))break}if(isNaN(V))break}y[W+T]="avg"===n?j/H:V}}}return g.toTensor()}},{key:"avgPool3d",value:function(e,t){return RR(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()}},{key:"avgPool3dBackprop",value:function(e,t,n){RR([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=f-1-n.padInfo.front,m=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=Jm(t.shape,"float32"),b=1/(o*s*u),k=this.bufferSync(e),_=0;_<n.batchSize;++_)for(var w=0;w<n.inChannels;++w)for(var x=0;x<n.inDepth;++x)for(var C=0;C<n.inHeight;++C)for(var S=0;S<n.inWidth;++S){for(var T=x-v,E=C-g,A=S-m,I=0,R=0;R<f;R+=c){var N=(T+R)/r;if(!(N<0||N>=n.outDepth||Math.floor(N)!==N))for(var O=0;O<d;O+=l){var D=(E+O)/a;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var F=0;F<p;F+=h){var M=(A+F)/i;M<0||M>=n.outWidth||Math.floor(M)!==M||(I+=k.get(_,N,D,M,w))}}}y.set(I*b,_,x,C,S,w)}return y.toTensor()}},{key:"maxPool3d",value:function(e,t){return RR(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()}},{key:"maxPool3dPositions",value:function(e,t){for(var n=Jm(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-f,k=b;k<0;)k+=o;for(var _=Math.min(t.inDepth,c+b),w=0;w<t.outHeight;++w){for(var x=w*a-d,C=x;C<0;)C+=s;for(var S=Math.min(t.inHeight,l+x),T=0;T<t.outWidth;++T){for(var E=T*i-p,A=E;A<0;)A+=u;for(var I=Math.min(t.inWidth,h+E),R=Number.NEGATIVE_INFINITY,N=-1,O=k;O<_;O+=o)for(var D=O-b,F=C;F<S;F+=s)for(var M=F-x,L=A;L<I;L+=u){var P=L-E,z=v.get(m,O,F,L,g);z>=R&&(R=z,N=D*l*h+M*l+P)}n.set(N,m,y,w,T,g)}}}return n.toTensor()}},{key:"maxPool3dBackprop",value:function(e,t,n,r){RR([t,n],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(t,r),i=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=h-1-r.padInfo.front,v=d-1-r.padInfo.left,m=f-1-r.padInfo.top,g=Jm(t.shape,"float32"),y=this.bufferSync(a),b=this.bufferSync(e),k=0;k<r.batchSize;++k)for(var _=0;_<r.inChannels;++_)for(var w=0;w<r.inDepth;++w)for(var x=0;x<r.inHeight;++x)for(var C=0;C<r.inWidth;++C){for(var S=w-p,T=x-m,E=C-v,A=0,I=0;I<h;I+=u){var R=(S+I)/i;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var N=0;N<f;N+=c){var O=(T+N)/o;if(!(O<0||O>=r.outHeight||Math.floor(O)!==O))for(var D=0;D<d;D+=l){var F=(E+D)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var M=h*f*d-1-y.get(k,R,O,F,_)===I*f*d+N*d+D?1:0;0!==M&&(A+=b.get(k,R,O,F,_)*M)}}}}g.set(A,k,w,x,C,_)}return g.toTensor()}},{key:"cast",value:function(e,t){return y.castTensor(e,t,this)}},{key:"reshape",value:function(e,t){return y.reshapeTensor(e,t)}},{key:"avgPool",value:function(e,t){return RR(e,"avgPool"),RR(e,"maxPool"),NR(this.readSync(e.dataId),0,e.dtype,e.strides,t,"avg").toTensor().toFloat()}},{key:"resizeBilinear",value:function(e,t,n,a){RR(e,"resizeBilinear");for(var i=_slicedToArray(e.shape,4),o=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(e.dataId),h=new Float32Array(r.sizeFromShape([o,t,n,c])),f=[a&&t>1?s-1:s,a&&n>1?u-1:u],d=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=0,v=f[0]/d[0],m=f[1]/d[1],g=0;g<o;g++)for(var y=0;y<t;y++)for(var b=v*y,k=Math.floor(b),_=b-k,w=Math.min(s-1,Math.ceil(b)),x=g*e.strides[0]+k*e.strides[1],C=g*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var T=m*S,E=Math.floor(T),A=T-E,I=Math.min(u-1,Math.ceil(T)),R=x+E*e.strides[2],N=C+E*e.strides[2],O=x+I*e.strides[2],D=C+I*e.strides[2],F=0;F<c;F++){var M=l[R+F],L=l[N+F],P=M+(l[O+F]-M)*A;h[p++]=P+(L+(l[D+F]-L)*A-P)*_}return Mm(h,[o,t,n,c])}},{key:"resizeBilinearBackprop",value:function(e,t,n){RR([e,t],"resizeBilinearBackprop");for(var r=_slicedToArray(t.shape,4),a=r[0],i=r[1],o=r[2],s=r[3],u=_slicedToArray(e.shape,3),c=u[1],l=u[2],h=new Float32Array(a*i*o*s),f=[n&&c>1?i-1:i,n&&l>1?o-1:o],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=f[0]/d[0],v=f[1]/d[1],m=this.readSync(e.dataId),g=0,y=0;y<a;y++)for(var b=y*t.strides[0],k=0;k<c;k++)for(var _=k*p,w=Math.floor(_),x=Math.min(Math.ceil(_),i-1),C=b+w*t.strides[1],S=b+x*t.strides[1],T=_-w,E=1-T,A=0;A<l;A++)for(var I=A*v,R=Math.floor(I),N=Math.min(Math.ceil(I),o-1),O=I-R,D=1-O,F=C+R*t.strides[2],M=C+N*t.strides[2],L=S+R*t.strides[2],P=S+N*t.strides[2],z=E*D,B=E*O,U=T*D,W=T*O,V=0;V<s;V++){var j=m[g++];h[F+V]+=j*z,h[M+V]+=j*B,h[L+V]+=j*U,h[P+V]+=j*W}return Wm(h,[a,o,i,s],t.dtype)}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){RR(e,"resizeNearestNeighbor");for(var a=_slicedToArray(e.shape,4),i=a[0],o=a[1],s=a[2],u=a[3],c=this.readSync(e.dataId),l=new Float32Array(i*t*n*u),h=[r&&t>1?o-1:o,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=h[0]/f[0],p=h[1]/f[1],v=0,m=0;m<i;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=d*y,k=g+Math.min(o-1,r?Math.round(b):Math.floor(b))*e.strides[1],_=0;_<n;_++)for(var w=p*_,x=k+Math.min(s-1,r?Math.round(w):Math.floor(w))*e.strides[2],C=0;C<u;C++)l[v++]=c[x+C];return Mm(l,[i,t,n,u],e.dtype)}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){RR([e,t],"resizeNearestNeighborBackprop");for(var r=_slicedToArray(t.shape,4),a=r[0],i=r[1],o=r[2],s=r[3],u=_slicedToArray(e.shape,3),c=u[1],l=u[2],h=new Float32Array(a*i*o*s),f=this.readSync(e.dataId),d=[n&&c>1?i-1:i,n&&l>1?o-1:o],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,k=2*Math.ceil(y)+2,_=0;_<a;_++)for(var w=_*t.strides[0],x=0;x<i;x++)for(var C=w+x*t.strides[1],S=Math.floor(x*g),T=Math.floor(S-b/2),E=0;E<o;E++)for(var A=C+E*t.strides[2],I=Math.floor(E*y),R=Math.floor(I-k/2),N=0;N<s;N++){for(var O=0,D=0;D<b;D++){var F=D+T;if(!(F<0||F>=c)){var M=w+F*e.strides[1],L=F*v;if(x===Math.min(i-1,n?Math.round(L):Math.floor(L)))for(var P=0;P<k;P++){var z=P+R;if(!(z<0||z>=l)){var B=M+z*e.strides[2],U=z*m;E===Math.min(o-1,n?Math.round(U):Math.floor(U))&&(O+=f[B+N])}}}}h[A+N]=O}return Wm(h,t.shape,t.dtype)}},{key:"batchNorm",value:function(e,t,n,r,a,i){RR([e,t,n,a,r],"batchNorm");for(var o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=a?this.readSync(a.dataId):new Float32Array([1]),l=r?this.readSync(r.dataId):new Float32Array([0]),h=new Float32Array(o.length),f=l.length,d=c.length,p=u.length,v=s.length,m=0,g=0,y=0,b=0,k=0;k<o.length;++k)h[k]=l[m++]+(o[k]-s[g++])*c[y++]/Math.sqrt(u[b++]+i),m>=f&&(m=0),g>=v&&(g=0),y>=d&&(y=0),b>=p&&(b=0);return Wm(h,e.shape)}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){RR(e,"localResponseNormalization4D");var i=e.shape[3],o=i-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%i,r=e-n+Math.max(0,n-t),a=e-n+Math.min(n+t,o),u=0;r<=a;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var f=l(h),d=s[h]*Math.pow(n+r*f,-a);c[h]=d}return Wm(c,e.shape)}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){RR(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),h=new Float32Array(e.size),f=e.size,d=0;d<f;d++){for(var p=d%s,v=d-p+Math.max(0,p-r),m=d-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);g=i*g+a;for(var b=v;b<m;b++){var k=-2*i*o*c[b]*l[d]/g;d===b&&(k+=Math.pow(g,-o)),k*=u[d],h[b]+=k}}return Wm(h,e.shape)}},{key:"multinomial",value:function(e,t,n,r){RR(e,"multinomial");for(var a=t?e:Uw(e),i=a.shape[0],o=a.shape[1],s=Gm([i,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(a.dataId),l=0;l<i;++l){var h=l*o,f=new Float32Array(o-1);f[0]=c[h];for(var d=1;d<f.length;++d)f[d]=f[d-1]+c[h+d];for(var p=K_.alea(r.toString()),v=l*n,m=0;m<n;++m){var g=p();u[v+m]=f.length;for(var y=0;y<f.length;y++)if(g<f[y]){u[v+m]=y;break}}}return s}},{key:"oneHot",value:function(e,t,n,r){RR(e,"oneHot");var a=new Float32Array(e.size*t);a.fill(r);for(var i=this.readSync(e.dataId),o=0;o<e.size;++o)i[o]>=0&&i[o]<t&&(a[o*t+i[o]]=n);return Bm(a,[e.size,t],"int32")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){RR(e,"nonMaxSuppression");var i=this.readSync(e.dataId),o=this.readSync(t.dataId);return DR(i,o,n,r,a)}},{key:"fft",value:function(e){return this.fftBatch(e,!1)}},{key:"ifft",value:function(e){return this.fftBatch(e,!0)}},{key:"fftBatch",value:function(e,t){for(var n=e.shape[0],r=e.shape[1],a=Jm(e.shape,"float32"),i=Jm(e.shape,"float32"),o=Dm(e).as2D(n,r),s=Fm(e).as2D(n,r),u=0;u<n;u++)for(var c=o.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=Om(c,l),f=this.readSync(this.fftImpl(h,t).dataId),d=0;d<r;d++){var p=y.getComplexWithIndex(f,d);a.values[u*r+d]=p.real,i.values[u*r+d]=p.imag}return Om(a.toTensor(),i.toTensor()).as2D(n,r)}},{key:"fftImpl",value:function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var a=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(a=Om(Dm(a).div(Pm(r)),Fm(a).div(Pm(r)))),a}var i=this.readSync(e.dataId),o=this.fourierTransformByMatmul(i,r,t),s=y.splitRealAndImagArrays(o);return Om(s.real,s.imag).as2D(e.shape[0],e.shape[1])}},{key:"isExponentOf2",value:function(e){return 0==(e&e-1)}},{key:"fftRadix2",value:function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),a=t/2,i=y.complexWithEvenIndex(r),o=Om(i.real,i.imag).as1D(),s=y.complexWithOddIndex(r),u=Om(s.real,s.imag).as1D();o=this.fftRadix2(o,a,n),u=this.fftRadix2(u,a,n);var c=y.exponents(t,n),l=Om(c.real,c.imag).mul(u),h=o.add(l),f=o.sub(l),d=Dm(h).concat(Dm(f)),p=Fm(h).concat(Fm(f));return Om(d,p).as1D()}},{key:"fourierTransformByMatmul",value:function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=y.exponent(a*s,t,n),c=y.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),y.assignToTypedArray(r,i,o,a)}return r}},{key:"depthToSpace",value:function(e,t,n){r.assert("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(n)})),r.assert(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)}));for(var a=e.shape[0],i=e.shape[1],o=e.shape[2],s=e.shape[3],u=i*t,c=o*t,l=s/(t*t),h=this.readSync(e.dataId),f=new Float32Array(a*u*c*l),d=0,p=0;p<a;++p)for(var v=0;v<u;++v)for(var m=Math.floor(v/t),g=v%t,y=0;y<c;++y)for(var b=Math.floor(y/t),k=(g*t+y%t)*l,_=0;_<l;++_)f[d++]=h[_+k+s*(b+o*(m+i*p))];return Wm(f,[a,u,c,l])}},{key:"broadcastedBinaryOp",value:function(e,t,n,r){var a=y.assertAndGetBroadcastShape(e.shape,t.shape),i=Jm(a,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=y.getBroadcastDims(e.shape,a),c=y.getBroadcastDims(t.shape,a),l=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(o[h%o.length],s[h%s.length]);else for(var f=this.bufferSync(e),d=this.bufferSync(t),p=function(n){var a=i.indexToLoc(n),h=a.slice(-e.rank);u.forEach((function(e){return h[e]=0}));var p=f.locToIndex(h),v=a.slice(-t.rank);c.forEach((function(e){return v[e]=0}));var m=d.locToIndex(v);l[n]=r(o[p],s[m])},v=0;v<l.length;++v)p(v);return i.toTensor()}},{key:"broadcastedBinaryComplexOp",value:function(e,t,n){var r=y.assertAndGetBroadcastShape(e.shape,t.shape),a=Jm(r,"float32"),i=Jm(r,"float32"),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=y.getBroadcastDims(e.shape,r),c=y.getBroadcastDims(t.shape,r),l=a.values,h=i.values;if(u.length+c.length===0)for(var f=0;f<l.length;f++){var d=f%o.length,p=f%s.length,v=n(o[2*d],o[2*d+1],s[2*p],s[2*p+1]);l[f]=v.real,h[f]=v.imag}else for(var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),b=function(r){var i=a.indexToLoc(r),f=i.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var d=m.locToIndex(f),p=i.slice(-t.rank);c.forEach((function(e){return p[e]=0}));var v=g.locToIndex(p),y=n(o[2*d],o[2*d+1],s[2*v],s[2*v+1]);l[r]=y.real,h[r]=y.imag},k=0;k<l.length;k++)b(k);return this.complex(a.toTensor(),i.toTensor())}},{key:"split",value:function(e,t,n){return FR(e,t,n)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return _get(_getPrototypeOf(i.prototype),"epsilon",this).call(this)}},{key:"cropAndResize",value:function(e,t,n,r,a,i){for(var o=_slicedToArray(e.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],h=t.shape[0],f=_slicedToArray(r,2),d=f[0],p=f[1],v=Jm([h,d,p,l],"float32"),m=this.readSync(t.dataId),g=this.readSync(n.dataId),y=this.readSync(e.dataId),b=e.strides,k=v.strides,_=0;_<h;_++){var w=4*_,x=m[w],C=m[w+1],S=m[w+2],T=m[w+3],E=g[_];if(!(E>=s))for(var A=d>1?(S-x)*(u-1)/(d-1):0,I=p>1?(T-C)*(c-1)/(p-1):0,R=0;R<d;R++){var N=d>1?x*(u-1)+R*A:.5*(x+S)*(u-1);if(N<0||N>u-1)for(var O=0;O<p;O++)for(var D=0;D<l;D++)v.values[D+O*k[2]+R*k[1]+_*k[0]]=i;else if("bilinear"===a)for(var F=Math.floor(N),M=Math.ceil(N),L=N-F,P=0;P<p;P++){var z=p>1?C*(c-1)+P*I:.5*(C+T)*(c-1);if(z<0||z>c-1)for(var B=0;B<l;B++)v.values[B+P*k[2]+R*k[1]+_*k[0]]=i;else for(var U=Math.floor(z),W=Math.ceil(z),V=z-U,j=0;j<l;j++){var H=j+U*b[2]+F*b[1]+E*b[0],q=y[H],G=y[H=j+W*b[2]+F*b[1]+E*b[0]],K=y[H=j+U*b[2]+M*b[1]+E*b[0]],X=y[H=j+W*b[2]+M*b[1]+E*b[0]],Y=q+(G-q)*V;H=j+P*k[2]+R*k[1]+_*k[0],v.values[H]=Y+(K+(X-K)*V-Y)*L}}else for(var Q=0;Q<p;++Q){var Z=p>1?C*(c-1)+Q*I:.5*(C+T)*(c-1);if(Z<0||Z>c-1)for(var $=0;$<l;$++)v.values[$+Q*k[2]+R*k[1]+_*k[0]]=i;else for(var J=Math.round(Z),ee=Math.round(N),te=0;te<l;te++)v.values[te+Q*k[2]+R*k[1]+_*k[0]]=y[te+J*b[2]+ee*b[1]+E*b[0]]}}}return v.toTensor()}},{key:"sparseToDense",value:function(e,t,n,r){var a=y.calculateShapes(t,e,n),i=a.sliceRank,o=a.numUpdates,s=a.sliceSize,u=a.strides,c=a.outputSize;return this.scatter(e,t,n,c,s,o,i,u,r,!1)}},{key:"gatherND",value:function(e,t){var n=t.shape,r=n[n.length-1],a=_slicedToArray(y.prepareAndValidate(e,t),4),i=a[0],o=a[1],s=a[2],u=a[3];if(0===o)return Mm([],i,e.dtype);for(var c=new Hv([o,s],e.dtype),l=this.readSync(t.dataId),h=this.readSync(e.dataId),f=0;f<o;f++){for(var d=[],p=0,v=0;v<r;v++){var m=l[f*r+v];p+=m*u[v],d.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(e.shape));for(var g=0;g<s;g++)c.values[f*s+g]=h[p*s+g]}return c.toTensor().reshape(i)}},{key:"scatterND",value:function(e,t,n){var r=y.calculateShapes(t,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=Pm(0);return this.scatter(e,t,n,u,o,i,a,s,c,!0)}},{key:"fill",value:function(e,t,n){n=n||r.inferDtype(t);var a=r.getArrayFromDType(n,r.sizeFromShape(e));return a.fill(t),$g().makeTensor(a,e,n,this)}},{key:"onesLike",value:function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)}},{key:"zerosLike",value:function(e){var t=r.getArrayFromDType(e.dtype,r.sizeFromShape(e.shape));return this.makeOutput(t,e.shape,e.dtype)}},{key:"linspace",value:function(e,t,n){return y.linspaceImpl(e,t,n)}},{key:"scatter",value:function(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=this.readSync(e.dataId),f=this.readSync(t.dataId);if(0===r)return Mm([],n,t.dtype);var d=new Hv(l,t.dtype);d.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=h[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[m*a+b]+=f[p*a+b]:d.values[m*a+b]=0===t.rank?f[0]:f[p*a+b]}return d.toTensor().reshape(n)}}]),i}(OC);function UR(e,t){return{kernelName:e,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,a=n.backend,i=r.a,o=r.b,s=a;RR([i,o],e);var u=s.data.get(i.dataId).values,c=s.data.get(o.dataId).values,l=_slicedToArray(t(i.shape,o.shape,u,c,i.dtype),2),h=l[0],f=l[1];return{dataId:s.write(h,f,i.dtype),shape:f,dtype:i.dtype}}}}function WR(e){return function(t,n,a,i,o){var s=y.assertAndGetBroadcastShape(t,n),u=s.length,c=r.computeStrides(s),l=r.sizeFromShape(s),h=r.getTypedArrayFromDType(o,l),f=t.length,d=n.length,p=r.computeStrides(t),v=r.computeStrides(n),m=y.getBroadcastDims(t,s),g=y.getBroadcastDims(n,s);if(m.length+g.length===0)for(var b=0;b<h.length;++b)h[b]=e(a[b%a.length],i[b%i.length]);else for(var k=function(t){var n=r.indexToLoc(t,u,c),o=n.slice(-f);m.forEach((function(e){return o[e]=0}));var s=r.locToIndex(o,f,p),l=n.slice(-d);g.forEach((function(e){return l[e]=0}));var y=r.locToIndex(l,d,v);h[t]=e(a[s],i[y])},_=0;_<h.length;++_)k(_);return[h,s]}}for(var VR=UR("Div",WR((function(e,t){return e/t}))),jR={kernelName:"Max",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.reductionIndices,s=a,u=i.shape,c=u.length,l=r.parseAxisParam(o,u),h=y.getAxesPermutation(l,c),f=s.data.get(i.dataId).values;if(null!=h){for(var d=new Array(c),p=0;p<d.length;p++)d[p]=u[h[p]];f=IR(f,u,i.dtype,h,d),l=y.getInnerMostAxes(l.length,c),u=d}RR(i,"max"),y.assertAxesAreInnerMostDims("max",l,c);var v=_slicedToArray(y.computeOutAndReduceShapes(u,l),2),m=v[0],g=v[1],b=AR(f,r.sizeFromShape(g),m,i.dtype);return{dataId:s.write(b,m,i.dtype),shape:m,dtype:i.dtype}}},HR={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=a;RR(i,"MaxPoolWithArgmax");var h=l.data.get(i.dataId).values,f=y.computePool2DInfo(i.shape,o,s,[1,1],u),d=_slicedToArray(function(e,t,n,a,i){var o=NR(e,0,n,r.computeStrides(t),i,"max"),s=OR(e,t,n,i,!0,a);return[o.values,s.values]}(h,i.shape,i.dtype,c,f),2),p=d[0],v=d[1],m=l.write(p,f.outShape,i.dtype),g=l.write(v,f.outShape,i.dtype);return[{dataId:m,shape:f.outShape,dtype:i.dtype},{dataId:g,shape:f.outShape,dtype:"int32"}]}},qR=b.nonMaxSuppressionV5,GR=0,KR=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n;RR(a,"NonMaxSuppressionWithScore");var h=l.data.get(a.dataId).values,f=l.data.get(i.dataId).values,d=qR(h,f,o,s,u,c);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;RR(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},UR("SquaredDifference",WR((function(e,t){var n=e-t;return n*n}))),VR,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm,o=r;RR(a,"transpose");for(var s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=IR(o.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:o.write(c,s,a.dtype),shape:s,dtype:a.dtype}}},HR,jR];GR<KR.length;GR++){jp(KR[GR])}ry("cpu",(function(){return new BR}),1);var XR,YR,QR,ZR={},$R={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function JR(e){e in ZR||(ZR[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete ZR[e]}),!1),1===e?t.getContext("webgl",$R)||t.getContext("experimental-webgl",$R):t.getContext("webgl2",$R)}(e));var t=ZR[e];return t.isContextLost()?(delete ZR[e],JR(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),ZR[e])}function eN(e,t){return[t,e]}function tN(e){var t=r.sizeFromShape(e),n=Math.ceil(t/4);return r.sizeToSquarishShape(n)}function nN(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function rN(e,t){var n,r,a,i,o,s,u,c,l,h=e;return 2===Dp().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function aN(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),r}function iN(e){return!!(Dp().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function oN(e,t,n){return vN(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(XR||(XR={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(YR||(YR={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(QR||(QR={}));var sN,uN,cN=/ERROR: [0-9]+:([0-9]+):/g;function lN(e,t,n){if(aN(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function hN(e,t,n,r,a,i,o,s){var u=e.getAttribLocation(n,r);return-1!==u&&(aN(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,a)})),aN(e,t,(function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,o,s)})),aN(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function fN(e,t,n,r){aN(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),aN(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function dN(e,t,n){aN(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),aN(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function pN(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function vN(e,t,n,r){var a=aN(e,t,(function(){return n()}));if(null==a)throw new Error(r);return a}function mN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return r.sizeFromShape(e.slice(0,e.length-t))}function gN(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function yN(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[mN(e)].concat(_toConsumableArray(gN(e)))),t}function bN(e){return e%2==0}function kN(e,t){if(e=e.slice(-2),t=t.slice(-2),r.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],a=t.slice(-1)[0];if(n===a)return!0;if(bN(n)&&bN(a)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&bN(e[0])&&bN(t[0])}function _N(e,t){return null!=e.getExtension(t)}function wN(e){try{if(null!=JR(e))return!0}catch(t){return!1}return!1}function xN(e){var t=rN(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}var CN=Dp();CN.registerFlag("HAS_WEBGL",(function(){return CN.getNumber("WEBGL_VERSION")>0})),CN.registerFlag("WEBGL_VERSION",(function(){return wN(2)?2:wN(1)?1:0})),CN.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===CN.get("WEBGL_VERSION")})),CN.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),CN.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),CN.registerFlag("WEBGL_PACK",(function(){return CN.getBool("HAS_WEBGL")})),CN.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_PACK_CLIP",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),CN.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_PACK_REDUCE",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_CONV_IM2COL",(function(){return CN.getBool("WEBGL_PACK")})),CN.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==sN){var t=JR(e);sN=t.getParameter(t.MAX_TEXTURE_SIZE)}return sN}(CN.getNumber("WEBGL_VERSION"))})),CN.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==uN){var t=JR(e);uN=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,uN)}(CN.getNumber("WEBGL_VERSION"))})),CN.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=CN.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=JR(e);return _N(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:_N(t,"EXT_disjoint_timer_query")?1:0}(e)})),CN.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return CN.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!i.isMobile()})),CN.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=JR(e);if(1===e){if(!_N(t,"OES_texture_float"))return!1}else if(!_N(t,"EXT_color_buffer_float"))return!1;return xN(t)}(CN.getNumber("WEBGL_VERSION"))})),CN.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!CN.getBool("WEBGL_FORCE_F16_TEXTURES")&&CN.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),CN.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return function(e){if(0===e)return!1;var t=JR(e);if(1!==e){if(_N(t,"EXT_color_buffer_float"))return xN(t);if(_N(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=rN(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!_N(t,"OES_texture_float")&&!!_N(t,"WEBGL_color_buffer_float")&&xN(t)}(CN.getNumber("WEBGL_VERSION"))})),CN.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=CN.getNumber("WEBGL_VERSION"))&&null!=JR(e).fenceSync;var e})),CN.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return CN.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}));var SN=function e(t,n){_classCallCheck(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},TN=function e(t,n){_classCallCheck(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},EN=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=Math.ceil(t.inSize/a);r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));",";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat("max"===n?">":"<"," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")};function AN(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function IN(e,t){return 1===t?[e]:AN(e,t)}function RN(){var e,t,n,r,a,i,o,s,u,c;return 2===Dp().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function NN(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",a=r.computeStrides(t);return a.map((function(t,r){return"".concat("int ".concat(e[r]," = ").concat(n," / ").concat(t),"; ",r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(t):"index -= ".concat(e[r]," * ").concat(t),";")})).join("")}function ON(e){var t=r.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}var DN="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",FN=y.getBroadcastDims,MN="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",LN="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",PN="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zN="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function BN(e){return"offset".concat(e)}function UN(e){var t=e.name,n=r.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function WN(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function VN(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function jN(e,t){return t.map((function(t){return e[t]})).join(", ")}var HN=function e(t,n,a,i){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.assert(t.length>2,(function(){return"Packed arg".concat(a.charAt(0).toUpperCase()+a.slice(1)," supports only inputs with rank above 2.")}));var o=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=WN(l),f=IN("coords",l);if(1===o){var d=WN(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(f[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(f[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(f[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(f[l-2],";");var p=["x","y","z","w","u","v"].slice(0,u),v="."+p[u-1],m=p.map((function(e){return"int "+e})),g=IN("sourceLocR",u-1).concat("inIdx.r"),y=IN("sourceLocG",u-1).concat("inIdx.g"),b=IN("sourceLocB",u-1).concat("inIdx.b"),k=IN("sourceLocA",u-1).concat("inIdx.a"),_="max"===a?"greaterThan":"lessThan",w=i?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),x="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),C=i?"":"\n      float getBestIndicesAChannel(".concat(m.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(m.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(C,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(f[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(_,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")},qN=function e(t){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n            wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,";\n            wC+= ").concat(t.dilationWidth,") {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},GN=function e(t){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterDepth*t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n            wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},KN=function e(t,n,r,a,i,o){_classCallCheck(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],y.assertAndGetBroadcastShape(t,n),y.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(y.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(y.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},XN=function e(t,n,r,a,i,o){_classCallCheck(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],y.assertAndGetBroadcastShape(t,n),y.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(y.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(y.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},YN=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=y.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},QN="return a + b;",ZN="return a - b;",$N="return a * b;",JN="return (a < 0.) ? b * a : a;",eO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A","B"],this.outputShape=y.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},tO="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",nO=function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=y.assertAndGetBroadcastShape(n,a);var o=this.outputShape.length,s="";if(i)if(0===o||1===r.sizeFromShape(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(s="\n          ".concat(WN(o)," coords = getOutputCoords();\n        "),1===o)s+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=IN("coords",o);s+="\n            bool nextRowOutOfBounds =\n              (".concat(u[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(s,"\n\n        setOutput(result);\n      }\n    ")},rO=function(){function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),aO=function(){function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),iO=function e(t){_classCallCheck(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},oO=function e(t){_classCallCheck(this,e),this.outputShape=[],this.outputShape=y.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++)a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(n[i-1],"));"));a.push("else setOutput(getT".concat(n.length,"(yR, yC-").concat(n[n.length-1],"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")},sO=function e(t,n){_classCallCheck(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=y.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=WN(a),o=IN("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),f=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(h.join(),"));\n        }"),p=1;p<u.length;p++){var v=u[p-1];d+="\n        if (".concat(l," < ").concat(u[p],"  && ").concat(l," >= ").concat(u[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(uO(s,l,v),"),\n            vec2(").concat(uO(h,l,v),"));\n        }")}var m=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(u.length,"(").concat(uO(s,l,m),"),\n          vec2(").concat(uO(h,l,m),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function uO(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}var cO=function e(t){_classCallCheck(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat("channelsLast"===t.dataFormat,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},lO=function e(t){_classCallCheck(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(a?3:1,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(a?1:2,"], coords[").concat(a?2:3,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},hO=function e(t){_classCallCheck(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t.strideDepth," - ").concat(t.padInfo.front,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},fO=function e(t){_classCallCheck(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(t.strideDepth,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},dO=function e(t){_classCallCheck(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(t.outChannels/t.inChannels," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},pO=function e(t){_classCallCheck(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(a,"; dm++) {\n              int d2 = d1 * ").concat(a," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},vO=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4,v="channelsLast"===t.dataFormat,m=v?1:2,g=v?2:3,y=v?3:1,b="",k="";r&&(b=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(b,"\n\n      const ivec2 strides = ivec2(").concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(m,"], coords[").concat(g,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(d,") *\n                    getW(wR, wC, ").concat(d,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(d,", xR, xC) *\n                    getW(wR, wC, ").concat(d,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2),\n                getW(wR, wC, ").concat(d," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1),\n                  getX(batch, xR, xC, ").concat(d," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC),\n                  getX(batch, ").concat(d," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(_,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")},mO=function e(t){_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},gO=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,u=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,f=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,v=t.outChannels/t.inChannels,m="",g="";r&&(m=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),g="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(m,"\n\n      const ivec2 strides = ivec2(").concat(c,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(v,";\n        int q = d2 - d1 * ").concat(v,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(h,";\n\n          if (xR < 0 || xR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(f,";\n\n            if (xC < 0 || xC >= ").concat(o,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(y,"\n        ").concat(g,"\n        setOutput(result);\n      }\n    ")},yO=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,v=t.filterWidth,m=v,g="int xR; int xC; int xCOffset;",y=0;y<p;y++)for(var b=0;b<v;b++)g+="\n          vec4 xTexelR".concat(y,"C").concat(2*b," = vec4(0.);\n          vec4 wR").concat(y,"C").concat(b," = vec4(0.);\n          vec4 xR").concat(y,"C").concat(b," = vec4(0.);");for(var k=0;k<p;k++)for(var _=0;_<m;_++){var w=2*_;if(g+="\n          xR = xRCorner + ".concat(k*f,";\n          xC = xCCorner + ").concat(w*d,";\n        "),1===h){if(w<v&&(g+=c%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(k,"C").concat(w,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(k,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(k,"C").concat(w," = vec4(previous.zw, xTexelR").concat(k,"C").concat(w,".xy);\n                } else {\n                  xR").concat(k,"C").concat(w," = vec4(0, 0, xTexelR").concat(k,"C").concat(w,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(w," = vec4(0.);\n                }\n\n                xR").concat(k,"C").concat(w," = xTexelR").concat(k,"C").concat(w,";\n              "),w+1<v)){var x=c%2==0?r.nearestLargerEven(d):d;d%2==0&&c%2==1||d%2!=0&&c%2!=1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(x,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(k,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(k,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(k,"C").concat(w," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(k,"C").concat(w+1," = vec4(\n                    xTexelR").concat(k,"C").concat(w,".zw, xTexelR").concat(k,"C").concat(w+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(x,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(k,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(k,"C").concat(w+1," = xTexelR").concat(k,"C").concat(w+2,";\n                ")}}else w<v&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),c%2==1?(g+="\n                xCOffset = xC + 1 - ".concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(w," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(w+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(k,"C").concat(w," = vec4(\n                  xTexelR").concat(k,"C").concat(w,".zw, xTexelR").concat(k,"C").concat(w+2,".zw);\n              "),w+1<v&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(h,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(k,"C").concat(w+1," = vec4(xTexelR").concat(k,"C").concat(w+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(k,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(k,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(k,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(k,"C").concat(w," = vec4(\n                  xTexelR").concat(k,"C").concat(w,".xy, xTexelR").concat(k,"C").concat(w+2,".xy);\n              "),w+1<v&&(g+="\n                  xR".concat(k,"C").concat(w+1," = vec4(\n                    xTexelR").concat(k,"C").concat(w,".zw, xTexelR").concat(k,"C").concat(w+2,".zw);\n                "))),g+="}");w<v&&(g+="\n            vec4 wTexelR".concat(k,"C").concat(w," = getW(").concat(k,", ").concat(w,", d1, q);\n            wR").concat(k,"C").concat(w," = vec4(wTexelR").concat(k,"C").concat(w,".xz, wTexelR").concat(k,"C").concat(w,".xz);\n          "),w+1<v&&(g+="\n              vec4 wTexelR".concat(k,"C").concat(w+1," = getW(").concat(k,", ").concat(w+1,", d1, q);\n              wR").concat(k,"C").concat(w+1," =\n                vec4(wTexelR").concat(k,"C").concat(w+1,".xz, wTexelR").concat(k,"C").concat(w+1,".xz);")))}for(var C=0;C<p;C++)for(var S=0;S<v;S++)g+="dotProd += xR".concat(C,"C").concat(S," * wR").concat(C,"C").concat(S,";");var T="",E="";a&&(T=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(a,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(a,"\n        }"),E="result = activation(result);");var A=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(A,"\n        ").concat(E,"\n        setOutput(result);\n      }\n    ")},bO=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=_slicedToArray(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=_slicedToArray(n,1)[0],f=_slicedToArray(r,2),d=f[0],p=f[1];this.outputShape=[h,d,p,l];var v="bilinear"===a?1:0,m="".concat(u-1,".0"),g="".concat(c-1,".0"),y=_slicedToArray(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(m," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(m)],3),b=y[0],k=y[1],_=y[2],w=_slicedToArray(p>1?["".concat((c-1)/(p-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],3),x=w[0],C=w[1],S=w[2];this.userCode="\n      const float height_ratio = float(".concat(b,");\n      const float width_ratio = float(").concat(x,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(k,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(_,";\n        if( in_y < 0.0 || in_y > ").concat(m," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(S,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},kO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=t[t.length-1],o=r?"<":">";this.userCode="\n      int getIndex(int i) {\n        ".concat(r?"return ".concat(i," -i - 1;"):"return i;","\n      }\n\n      void main() {\n        ").concat(WN(a)," coords = getOutputCoords();\n        int end = ").concat(_O(a,"coords"),";\n        float val = 0.0;\n        for (int i = ").concat(i," - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx ").concat(o," end) {\n            continue;\n          }\n          if (idx == end && ").concat(n,") {\n            continue;\n          }\n          ").concat(_O(a,"coords")," = idx;\n          val += getX(").concat(function(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")};function _O(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var wO=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=XR.DENSE;var n=tN(t),r=RN();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(NN(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},xO=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=XR.DENSE;var n=tN(t),r=RN();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(NN(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},CO=function(){function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return _createClass(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}(),SO=function e(t){_classCallCheck(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},TO=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.outTexUsage=YR.DOWNLOAD;var n=RN();this.outputShape=t,this.userCode="\n      ".concat(DN,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},EO=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=YR.DOWNLOAD;var n=RN();this.outputShape=t,this.userCode="\n      ".concat(DN,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},AO=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.variableNames=["A"];var a=RN(),i=_slicedToArray(n,2),o=i[0],s=i[1];this.outputShape=t;var u="result";r&&(u="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(ON(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / ").concat(s,";\n        int c = imod(flatIndex, ").concat(s,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n        vec4 values = ").concat(a.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(a.output," = vec4(").concat(u,", 0., 0., 0.);\n      }\n    ")},IO=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var a=RN(),i=_slicedToArray(n,2),o=i[0],s=i[1];this.outputShape=t;var u="",c="result";r&&(c="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var f=2*l+h;u+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(h," < ").concat(t[2],") {\n            localCoords[2] += ").concat(h,";\n            if(localCoords[1] + ").concat(l," < ").concat(t[1],") {\n              localCoords[1] += ").concat(l,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(s,";\n              c = imod(flatIndex, ").concat(s,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n              values = ").concat(a.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(f,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(f,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(f,"] = values[2];\n              } else {\n                result[").concat(f,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(ON(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(u,"\n\n        ").concat(a.output," = ").concat(c,";\n      }\n    ")},RO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI);this.userCode="\n      const float exponentMultiplier = ".concat(i,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(t,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(r?"".concat(a,".0"):"1.0",";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")},NO=function(){function e(t,n){_classCallCheck(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}(),OO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A","indices"];var a=t.slice();a[r]=n,this.outputShape=a,this.rank=a.length;var i=WN(this.rank),o=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank ".concat(n," is not yet supported"));if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)a.push(i===t?"int(getIndices(".concat(r[i],"))"):"".concat(r[i]));return a.join()}(t,r);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")},DO=function e(t,n,r){_classCallCheck(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=WN(n.length),i=WN(r.length);this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(this.sliceDim>1?"strides[j]":"strides",";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")};function FO(e,t,n,r,a,i,o){!function(e,t){var n=Dp().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size "+"[".concat(e,"x").concat(t,"]")+" is invalid.");if(e>n||t>n)throw new Error("Requested texture size "+"[".concat(e,"x").concat(t,"]")+" greater than WebGL maximum on this browser / GPU "+"[".concat(n,"x").concat(n,"]")+".")}(n,r);var s=function(e,t){return vN(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e,t),u=e.TEXTURE_2D;return aN(e,t,(function(){return e.bindTexture(u,s)})),aN(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),aN(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),aN(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),aN(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),aN(e,t,(function(){return e.texImage2D(u,0,a,n,r,0,i,o,null)})),aN(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}var MO=function(){function e(t){_classCallCheck(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Dp().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){ZR[e]=t}(n,t)):this.gl=JR(n);var r="WEBGL_color_buffer_float";if(1===Dp().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=oN(this.gl,this.debug,"OES_texture_float"),_N(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=oN(this.gl,this.debug,"OES_texture_half_float");else if(Dp().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),_N(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=oN(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Dp().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",_N(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!_N(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=function(e,t){return function(e,t,n){var r=vN(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return aN(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),aN(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl,this.debug),this.indexBuffer=function(e,t){return function(e,t,n){var r=vN(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return aN(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),aN(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}(e,t,new Uint16Array([0,1,2,2,1,3]))}(this.gl,this.debug),this.framebuffer=function(e,t){return vN(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl,this.debug),this.textureConfig=rN(this.gl,this.textureHalfFloatExtension)}var t;return _createClass(e,[{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;aN(t,this.debug,(function(){return t.finish()})),aN(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),aN(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),aN(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),aN(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),aN(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=_slicedToArray(eN(n,r),2);return FO(e,t,i[0],i[1],a.internalFormatFloat,a.textureFormatFloat,e.FLOAT)}(this.gl,this.debug,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=_slicedToArray(eN(n,r),2);return FO(e,t,i[0],i[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}(this.gl,this.debug,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=_slicedToArray(eN(n,r),2);return FO(e,t,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}(this.gl,this.debug,e,t)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n,r){aN(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?aN(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):aN(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),aN(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,this.debug,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i,o){var s,u,c;aN(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),i instanceof Uint8Array?(s=new Uint8Array(r*a*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*a*4),u=e.FLOAT,c=o.internalFormatPackedFloat),s.set(i),aN(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,a,0,e.RGBA,u,s)})),aN(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,this.debug,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=_slicedToArray(nN(n,r),2);return FO(e,t,i[0],i[1],a.internalFormatPackedHalfFloat,e.RGBA,a.textureTypeHalfFloat)}(this.gl,this.debug,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r,a){var i=_slicedToArray(nN(n,r),2);return FO(e,t,i[0],i[1],a.internalFormatPackedFloat,e.RGBA,e.FLOAT)}(this.gl,this.debug,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(dN(this.gl,this.debug,this.framebuffer),this.outputTexture=null),aN(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r,a){var i=_slicedToArray(eN(n,r),2),o=i[0],s=i[1],u=new Uint8Array(n*r*4);return aN(e,t,(function(){return e.readPixels(0,0,o,s,a.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}(r.gl,r.debug,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return function(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=_slicedToArray(nN(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}(this.gl,e,0,0,0,a,i)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r,a){var i=e.createBuffer();aN(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)}));var o=16*n*r;return aN(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),aN(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),aN(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),i}(this.gl,this.debug,t,n);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Dp().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=new Float32Array(n*r*4);return aN(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,a)})),a}(r.gl,r.debug,t,n)}))}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=function(e,t,n){var a=vN(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(aN(e,t,(function(){return e.shaderSource(a,n)})),aN(e,t,(function(){return e.compileShader(a)})),!1===e.getShaderParameter(a,e.COMPILE_STATUS))throw function(e,t){var n=cN.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var a=+n[1],i=e.split("\n"),o=i.length.toString().length+2,s=i.map((function(e,t){return r.rightPad((t+1).toString(),o)+e})),u=0,c=0;c<s.length;c++)u=Math.max(s[c].length,u);var l=s.slice(0,a-1),h=s.slice(a-1,a),f=s.slice(a);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(r.rightPad(h[0],u)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(n,e.getShaderInfoLog(a)),new Error("Failed to compile fragment shader.");return a}(t,this.debug,e),a=function(e,t){var n=RN();return function(e,t,n){var r=vN(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(aN(e,t,(function(){return e.shaderSource(r,n)})),aN(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}(e,t,"".concat(n.version,"\n    precision highp float;\n    ").concat(n.attribute," vec3 clipSpacePos;\n    ").concat(n.attribute," vec2 uv;\n    ").concat(n.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(t,this.debug),i=function(e,t){return vN(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t,this.debug);return aN(t,this.debug,(function(){return t.attachShader(i,a)})),aN(t,this.debug,(function(){return t.attachShader(i,n)})),function(e,t,n){if(aN(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}(t,this.debug,i),this.debug&&lN(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(e,t,n,r){return aN(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),hN(e,t,n,"clipSpacePos",r,3,20,0)&&hN(e,t,n,"uv",r,2,20,12)}(t,this.debug,this.program,this.vertexBuffer)),i}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&aN(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&lN(this.gl,this.debug,this.program),aN(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n,r){return vN(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}(this.gl,this.debug,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),aN(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r,a,i){aN(e,t,(function(){return function(e,t,n,r){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in ".concat("[gl.TEXTURE0, gl.TEXTURE".concat(n,"]"),"."))})(e,r),aN(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),aN(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}(e,t,r,i)})),aN(e,t,(function(){return e.uniform1i(a,i)}))}(this.gl,this.debug,0,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=_slicedToArray(nN(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&lN(this.gl,this.debug,this.program),pN(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),aN(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),aN(this.gl,this.debug,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=oN(this.gl,this.debug,2===Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||r.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),fN(this.gl,this.debug,e,this.framebuffer),this.debug&&pN(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(fN(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&pN(this.gl)):dN(this.gl,this.debug,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;fN(r,this.debug,e,this.framebuffer),this.debug&&pN(r),this.outputTexture=e,aN(r,this.debug,(function(){return r.viewport(0,0,t,n)})),aN(r,this.debug,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),aN(this.gl,this.debug,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function(){return Dp().getBool("DEBUG")}}]),e}();function LO(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var a=e.logicalShape,i=t[n],o=i.shape;if(!r.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!r.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}}))}var PO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,f=r.dataFormat,d=u.left,p=u.top,v=i*a,m=RN(),g="channelsLast"===f,y=g?0:1,b=g?1:2,k="",_=0;_<=1;_++)for(var w=0;w<=1;w++)k+="\n          blockIndex = rc.y + ".concat(w,";\n          pos = rc.x + ").concat(_,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(p,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(v,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(v,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[b]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*_+w,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*_+w,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(k,"\n\n        ").concat(m.output," = result;\n      }\n    ")},zO=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")},BO=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},UO=function e(t,n,r,a,i){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")},WO=function e(t){_classCallCheck(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n          wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(n*r-1," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(r," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},VO=function e(t){_classCallCheck(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n           wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(n*r*a-1," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(r," * ").concat(a," +\n                  wR * ").concat(a," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},jO=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];_classCallCheck(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var u=Math.ceil((r?t[1]:t[2])/2),c=r?"i * 2, rc.y":"rc.y, i * 2",l=a?"rc.z, i * 2":"i * 2, rc.z",h=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";o&&(d=s?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(o,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(o,"\n        }"),p="result = activation(result);");var v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(d,"\n\n      const float sharedDimension = ").concat(u,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(u,"; i++) {\n          vec4 a = getMatrixA(rc.x, ").concat(c,");\n          vec4 b = getMatrixB(rc.x, ").concat(l,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(h[0]," * ").concat(f[0],");\n          result += (").concat(h[1]," * ").concat(f[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(v,"\n\n        ").concat(p,"\n\n        setOutput(result);\n      }\n    ")},HO=function(){function e(t,n,r){_classCallCheck(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),qO=function e(t,n,r,a){_classCallCheck(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},GO=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=IN("rc",n),a=WN(n),i=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i="".concat(t[t.length-1-o],",")+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}},KO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=WN(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(r,"));\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(r,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")},XO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=WN(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=IN("rc",a),c=IN("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=1===a?2:4;v<m;v++)p+="\n        ".concat(f[v],"\n        if (").concat(d,") {\n          result[").concat(v,"] = float(").concat(r,");\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");p+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")},YO=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,m="0.0";if(v||(m="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?"((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var g="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(g="avgValue / count");var y=4*Math.floor(o/4),b=o%4,k="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(m,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(m,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(k,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(2===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(k,"\n          } else if (").concat(3===b,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(k,"\n          }\n        }\n        setOutput(").concat(g,");\n      }\n    ")}},QO=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,v=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,k="0.0";if(b||(k="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(p," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var _="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(_="avgValue / count");var w=4*Math.floor(o/4),x=o%4,C="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(k,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(k,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(C,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(2===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(3===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(C,"\n            }\n          }\n          setOutput(").concat(_,");\n        }\n      }\n    ")}},ZO=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=Math.ceil(i/r);this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,f="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===n?(s="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")},$O=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r,a="",i=0;i<4;i++){var o="thisRC = rc;";i%2==1&&(o+="thisRC.z += 1;"),i>1&&(o+="thisRC.y += 1;"),a+="\n        ".concat(o,"\n        ").concat(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(i,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(i>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=n,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(NN(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(ON(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(a,"\n\n        setOutput(result);\n      }\n    ")},JO=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var a=_slicedToArray(n.shape,3),i=a[1],o=a[2],s=_slicedToArray(t.shape,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/h[0],d=l[1]/h[1],p=1/f,v=1/d,m=2*Math.ceil(p)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(m,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},eD=function e(t,n,r,a){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=[];var i=_slicedToArray(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(u,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},tD=function e(t,n,r,a){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=_slicedToArray(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],",\n          ").concat(l[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(u,".0,\n                                     ").concat(u,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},nD=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var a=_slicedToArray(n.shape,3),i=a[1],o=a[2],s=_slicedToArray(t.shape,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/h[0],d=l[1]/h[1],p=1/f,v=1/d,m=2*Math.ceil(p)+2,g=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(m,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},rD=function e(t,n,r,a){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=[];var i=_slicedToArray(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(u,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(a?"0.5":"0.0",")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},aD=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=WN(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},iD=function e(t,n){_classCallCheck(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=IN("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=WN(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},oD=function e(t,n,r,a,i,o){!(arguments.length>6&&void 0!==arguments[6])||arguments[6];_classCallCheck(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=WN(i.length),u=WN(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="";1===a?l="i":2===a&&(l="i, coords[1]"),this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(","getIndices(".concat(c,")"),");\n              flattenedIndex += index * ").concat(n>1?"strides[j]":"strides",";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ","getUpdates(".concat(l,")"),";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},sD=function e(t,n){_classCallCheck(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},uD=function e(t,n,r){var a,i;if(_classCallCheck(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=WN(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")},cD=function(){function e(t){_classCallCheck(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=WN(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return lD.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(t.map((function(e,t){return"sourceLoc.".concat(lD[t]," = start[").concat(t,"] + coords.").concat(lD[t],";")})).join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),lD=["x","y","z","w","u","v"],hD=function(){function e(t){_classCallCheck(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=WN(this.rank),r=IN("coords",this.rank),a=IN("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return _createClass(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),fD=function e(t,n,r){_classCallCheck(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=WN(r.length),o=WN(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},dD=function(){function e(t){_classCallCheck(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _createClass(e,[{key:"acquireTexture",value:function(e,t,n){var r,a=pD(t,n),i=vD(e,a,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var o=this.freeTextures[i].shift();return this.usedTextures[i].push(o),o}return this.numUsedTextures++,this.log(),a===QR.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===QR.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===QR.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===QR.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===QR.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(r),r}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=vD(t,pD(n,r),r);a in this.freeTextures||(this.freeTextures[a]=[]),this.freeTextures[a].push(e),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[a],o=i.indexOf(e);if(o<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(o,1),this.log()}}},{key:"log",value:function(){this.logEnabled&&console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(this.numFreeTextures+this.numUsedTextures,")"))}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}}}]),e}();function pD(e,t){if(e===YR.UPLOAD)return QR.PACKED_2X2_FLOAT32;if(e===YR.RENDER||null==e)return function(e){return Dp().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?QR.PACKED_2X2_FLOAT32:QR.UNPACKED_FLOAT32:e?QR.PACKED_2X2_FLOAT16:QR.UNPACKED_FLOAT16}(t);if(e===YR.DOWNLOAD||e===YR.PIXELS)return QR.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function vD(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var mD=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=WN(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")},gD=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},yD="return abs(x);",bD="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",kD="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",_D="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(y.SELU_SCALEALPHA,";\n  float scale = ").concat(y.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"),wD="return -x;",xD="return ceil(x);",CD="return floor(x);",SD="return exp(x);",TD="return exp(x) - 1.0;",ED='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(y.ERF_P,";\n  float a1 = ").concat(y.ERF_A1,";\n  float a2 = ").concat(y.ERF_A2,";\n  float a3 = ").concat(y.ERF_A3,";\n  float a4 = ").concat(y.ERF_A4,";\n  float a5 = ").concat(y.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n"),AD="return x;",ID="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",RD="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",ND="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",OD=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},DD=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=IN("rc",n),a=WN(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},FD=y.segment_util,MD=b.split,LD=b.tile,PD=b.topkImpl,zD=b.whereImpl,BD={};function UD(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?ID:bD;if("elu"===e)return t?ND:"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?RD:kD;if("prelu"===e)return t?tO:JN;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var WD,VD=function(e){_inherits(s,e);var t,n,a,i=_createSuper(s);function s(e){var t,n;if(_classCallCheck(this,s),(t=i.call(this)).pendingRead=new WeakMap,t.pendingDisposal=new WeakSet,t.dataRefCount=new WeakMap,t.numBytesInGPU=0,t.uploadWaitMs=0,t.downloadWaitMs=0,t.warnedAboutMemory=!1,t.pendingDeletes=0,t.disposed=!1,!Dp().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var r=JR(Dp().getNumber("WEBGL_VERSION"));t.binaryCache=((n=Dp().getNumber("WEBGL_VERSION"))in BD||(BD[n]={}),BD[n]),t.gpgpu=new MO(r),t.canvas=r.canvas,t.gpgpuCreatedLocally=!0}else t.gpgpu=e,t.binaryCache={},t.gpgpuCreatedLocally=!1,t.canvas=e.gl.canvas;return t.textureManager=new dD(t.gpgpu),t.numMBBeforeWarning=null==Dp().global.screen?1024:Dp().global.screen.height*Dp().global.screen.width*window.devicePixelRatio*600/1024/1024,t.texData=new NC(_assertThisInitialized(t),$g()),_possibleConstructorReturn(t)}return _createClass(s,[{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if(Dp().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:YR.UPLOAD}),r}},{key:"move",value:function(e,t,n,r){if(Dp().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:YR.UPLOAD})}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,a=t.dtype,i=t.complexTensors,o=t.slice,s=t.shape,u=t.isPacked;if(null!=o){var c;c=u?new OD(s,AD):new gD(s,AD);var l=this.runWebGLProgram(c,[{dataId:e,shape:s,dtype:a}],a),h=this.readSync(l.dataId);return this.disposeData(l.dataId),h}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===a)return n;var f,d,p=null!=this.activeTimers;if(p&&(f=r.now()),"complex64"===a){var v=i.real.dataSync(),m=i.imag.dataSync();d=y.mergeRealAndImagArrays(v,m)}else d=this.getValuesFromTexture(e);return p&&(this.downloadWaitMs+=r.now()-f),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c,l,h,f,d,p,v,m,g,b,k,_,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensors,l=a.isPacked,null==s){e.next=8;break}return h=l?new OD(o,AD):new gD(o,AD),f=this.runWebGLProgram(h,[{dataId:t,shape:o,dtype:u}],u),d=this.read(f.dataId),e.abrupt("return",(this.disposeData(f.dataId),d));case 8:if(null==i){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(Dp().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Dp().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(m=null,"complex64"!==u&&Dp().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(t),b=this.texData.get(p.dataId),m=(g=this.gpgpu).createBufferFromTexture.apply(g,[b.texture].concat(_toConsumableArray(tN(o))))),this.pendingRead.set(t,[]),e.t0="complex64"!==u,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==u){e.next=26;break}return e.next=22,Promise.all([c.real.data(),c.imag.data()]);case 22:k=e.sent,v=y.mergeRealAndImagArrays(k[0],k[1]),e.next=27;break;case 26:null==m?v=this.getValuesFromTexture(t):(_=r.sizeFromShape(o),v=this.gpgpu.downloadFloat32MatrixFromBuffer(m,_));case 27:return null!=p&&this.disposeData(p.dataId),w=this.convertAndCacheOnCPU(t,v),x=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),x.forEach((function(e){return e(w)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),w));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!iN(n)){if(Dp().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,a=t.dtype,i=t.isPacked,o=r.sizeFromShape(n);if(Dp().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s,u=this.decode(e),c=this.texData.get(u.dataId),l=(s=this.gpgpu).downloadMatrixFromPackedTexture.apply(s,[c.texture].concat(_toConsumableArray(tN(n)))).subarray(0,o);return this.disposeData(u.dataId),l}var h=Dp().getBool("WEBGL_PACK")&&!0===i,f=h?yN(n):n,d=h?new EO(f):new TO(f),p=this.runWebGLProgram(d,[{shape:f,dtype:a,dataId:e}],"float32"),v=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,o);return this.disposeData(p.dataId),m}},{key:"time",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.activeTimers,a=[],i=!1,null==this.programTimersStack?(this.programTimersStack=a,i=!0):this.activeTimers.push(a),this.activeTimers=a,t(),o=r.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),s=r.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=13;break}return e.next=9,Promise.all(o);case 9:c=e.sent,u.kernelMs=r.sum(c),u.getExtraProfileInfo=function(){return c.map((function(e,t){return{name:s[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=14;break;case 13:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return e.abrupt("return",(this.uploadWaitMs=0,this.downloadWaitMs=0,u));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}}},{key:"startTimer",value:function(){return Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.now(),endMs:null}}},{key:"endTimer",value:function(e){return Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=r.now(),e)}},{key:"getQueryTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Dp().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(t):t.endMs-t.startMs);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disposeData",value:function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return Dp().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=$g().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128;return null!=this.getCPUBackend()&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&r.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"complex",value:function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:$g().keep(e.clone()),imag:$g().keep(t.clone())},n}},{key:"real",value:function(e){return this.texData.get(e.dataId).complexTensors.real.clone()}},{key:"imag",value:function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()}},{key:"slice",value:function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===r.sizeFromShape(n))return Mm([],n,e.dtype);var a=this.texData.get(e.dataId).isPacked,i=o.isSliceContinous(e.shape,t,n);if(a||!i){var s=Dp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hD(n):new cD(n),u=s.getCustomSetupFunc(t);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)}},{key:"shallowSlice",value:function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var s=o.computeFlatOffset(t,e.strides);r.slice&&(s+=r.slice.flatOffset),i.slice={flatOffset:s,origDataId:r.slice&&r.slice.origDataId||e.dataId};var u=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,u+1),a}},{key:"stridedSlice",value:function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var a=o.computeOutShape(t,n,r);if(a.some((function(e){return 0===e})))return Mm([],a);var i=new fD(t,r,a);return this.compileAndRun(i,[e])}},{key:"reverse",value:function(e,t){var n=Dp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iD(e.shape,t):new aD(e.shape,t);return this.compileAndRun(n,[e])}},{key:"concat",value:function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return Dm(e)})),a=e.map((function(e){return Fm(e)}));return Om(this.concat(n,t),this.concat(a,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>Dp().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),o=this.concat(e.slice(0,i),t),s=this.concat(e.slice(i),t);return this.concat([o,s],t)}if(Dp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var u=new sO(e.map((function(e){return e.shape})),t);return this.compileAndRun(u,e)}var c=y.computeOutShape(e.map((function(e){return e.shape})),t),l=e.map((function(e){return e.as2D(-1,r.sizeFromShape(e.shape.slice(t)))})),h=new oO(l.map((function(e){return e.shape})));return this.compileAndRun(h,l).reshape(c)}},{key:"neg",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wD,e.dtype);var t=new gD(e.shape,wD);return this.compileAndRun(t,[e])}},{key:"batchMatMul",value:function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=_slicedToArray(e.shape,2)[0];if((1===a||1===i)&&o>1e3){n&&(e=lb(e,[0,2,1])),r&&(t=lb(t,[0,2,1]));var u=1===i?e:e.as3D(s,o,1),c=1===i?2:1,l=1===i?t.as3D(s,1,o):t;return this.multiply(u,l).sum(c,!0)}var h=tm(e.dtype,t.dtype),f=new jO(e.shape,[s,a,i],n,r);return this.compileAndRun(f,[e,t],h)}},{key:"fusedBatchMatMul",value:function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=a?n.shape[1]:n.shape[2],l=_slicedToArray(t.shape,2)[0],h=tm(t.dtype,n.dtype),f=null!=i,d=null!=s,p=o?UD(o,!0):null,v=new jO(t.shape,[l,u,c],r,a,f,p,d),m=[t,n];return i&&m.push(i),s&&m.push(s),this.compileAndRun(v,m,h)}},{key:"multiply",value:function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),a=new YN("return areal * breal - aimag * bimag;",e.shape,t.shape),i=new YN("return areal * bimag + aimag * breal;",e.shape,t.shape),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(a,o),u=this.compileAndRun(i,o),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,$N,e.dtype);var l=new eO($N,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)}},{key:"batchNorm",value:function(e,t,n,r,a,i){var o=[e,t,n],s=null;null!=r&&(s=r.shape,o.push(r));var u=null;if(null!=a&&(u=a.shape,o.push(a)),Dp().getBool("WEBGL_PACK_NORMALIZATION")){var c=new XN(e.shape,t.shape,n.shape,s,u,i);return this.compileAndRun(c,o)}var l=new KN(e.shape,t.shape,n.shape,s,u,i);return this.compileAndRun(l,o)}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){var i=Dp().getBool("WEBGL_PACK_NORMALIZATION")?new UO(e.shape,t,n,r,a):new zO(e.shape,t,n,r,a);return this.compileAndRun(i,[e])}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){var s=new BO(t.shape,r,a,i,o);return this.compileAndRun(s,[t,n,e])}},{key:"tile",value:function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return r.decodeString(e)})),a=Jm(e.shape,e.dtype,n);return LD(a,t)}var i=new mD(e.shape,t);return this.compileAndRun(i,[e])}},{key:"pad",value:function(e,t,n){var r=Dp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new XO(e.shape,t,n):new KO(e.shape,t,n);return this.compileAndRun(r,[e])}},{key:"gather",value:function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new OO(e.shape,t.size,n);return this.compileAndRun(r,[e,t])}},{key:"batchToSpaceND",value:function(e,t,n){r.assert(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var a=t.reduce((function(e,t){return e*t})),i=y.getReshaped(e.shape,t,a),o=y.getPermuted(i.length,t.length),s=y.getReshapedPermuted(e.shape,t,a),u=y.getSliceBeginCoords(n,t.length),c=y.getSliceSize(s,n,t.length);return lb(e.reshape(i),o).reshape(s).slice(u,c)}},{key:"spaceToBatchND",value:function(e,t,n){r.assert(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var a=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,_toConsumableArray(n));for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var s=e.pad(i),u=y.getReshaped(s.shape,t,a,!1),c=y.getPermuted(u.length,t.length,!1),l=y.getReshapedPermuted(s.shape,t,a,!1);return lb(s.reshape(u),c).reshape(l)}},{key:"reduce",value:function(e,t,n){var r=e.shape[0],a=e.shape[1],i=y.computeOptimalWindowSize(a),o=new ZO({windowSize:i,inSize:a,batchSize:r},t),s=this.compileAndRun(o,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)}},{key:"argReduce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=y.computeOptimalWindowSize(a),o=new EN({windowSize:i,inSize:a,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(o,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)}},{key:"argReducePacked",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null!=n?n.shape:e.shape,a=y.computeOptimalWindowSize(r[r.length-1]),i=new HN(r,a,t,null==n),o=this.compileAndRun(i,null==n?[e]:[e,n],"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o}},{key:"sum",value:function(e,t){y.assertAxesAreInnerMostDims("sum",t,e.rank);var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o),u=nm(e.dtype);return this.reduce(s,"sum",u).reshape(a)}},{key:"prod",value:function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o),u=nm(e.dtype);return this.reduce(s,"prod",u).reshape(a)}},{key:"unsortedSegmentSum",value:function(e,t,n){var a=0,i=y.getAxesPermutation([a],e.rank),o=e;null!=i&&(o=lb(e,i),a=y.getInnerMostAxes(1,e.rank)[0]);var s=FD.computeOutShape(o.shape,a,n),u=r.sizeFromShape([o.shape[a]]),c=o.as2D(-1,u),l=nm(e.dtype),h=this.segOpCompute(c,"unsortedSegmentSum",t,l,n).reshape(s);return null!=i&&(h=lb(h,y.getUndoAxesPermutation(i))),h}},{key:"segOpCompute",value:function(e,t,n,r,a){var i=e.shape[0],o=e.shape[1],s=FD.segOpComputeOptimalWindowSize(o,a),u=new sD({windowSize:s,inSize:o,batchSize:i,numSegments:a},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===a?c:(n=Ym(0,a).tile([o/s]),this.segOpCompute(c,t,n,r,a))}},{key:"argMinMaxReduce",value:function(e,t,n){var a=[t];if(y.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.rank),!Dp().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=_slicedToArray(y.computeOutAndReduceShapes(e.shape,a),2),o=i[0],s=i[1],u=r.sizeFromShape(s),c=e.as2D(-1,u);return this.argReduce(c,n).reshape(o)}return this.argReducePacked(e,n)}},{key:"argMin",value:function(e,t){return this.argMinMaxReduce(e,t,"min")}},{key:"argMax",value:function(e,t){return this.argMinMaxReduce(e,t,"max")}},{key:"cumsum",value:function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(e.rank-1," ")+"but got axis=".concat(t));var a=new kO(e.shape,n,r);return this.compileAndRun(a,[e])}},{key:"equal",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new eO("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"notEqual",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new eO("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"less",value:function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new eO("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"lessEqual",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new eO("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"greater",value:function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new eO("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"greaterEqual",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new eO("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"logicalNot",value:function(e){var t=new gD(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])}},{key:"logicalAnd",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new eO("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"logicalOr",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new eO("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"select",value:function(e,t,n){var r=new uD(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],tm(t.dtype,n.dtype))}},{key:"where",value:function(e){y.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return zD(e.shape,t)}},{key:"topk",value:function(e,t,n){var r=e.dataSync();return PD(r,e.shape,e.dtype,t,n)}},{key:"min",value:function(e,t){y.assertAxesAreInnerMostDims("min",t,e.rank);var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o);return this.reduce(s,"min",s.dtype).reshape(a)}},{key:"minimum",value:function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new eO("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"mod",value:function(e,t){var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new eO("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"maximum",value:function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new eO("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"all",value:function(e,t){y.assertAxesAreInnerMostDims("all",t,e.rank);var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o);return this.reduce(s,"all",s.dtype).reshape(a)}},{key:"any",value:function(e,t){y.assertAxesAreInnerMostDims("any",t,e.rank);var n=_slicedToArray(y.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o);return this.reduce(s,"any",s.dtype).reshape(a)}},{key:"floorDiv",value:function(e,t){if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new eO("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")}},{key:"add",value:function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,QN);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=tm(e.dtype,t.dtype);if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,QN,n);var r=new eO(QN,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new OD(e.shape,t);return this.compileAndRun(r,[e],n)}},{key:"packedBinaryOp",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new nO(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)}},{key:"complexSeparableBinaryOp",value:function(e,t,n){var r=this,a=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=[[a.complexTensors.real,i.complexTensors.real],[a.complexTensors.imag,i.complexTensors.imag]].map((function(a){var i=_slicedToArray(a,2),o=i[0],s=i[1],u=r.makeComplexComponentTensorInfo(e,o),c=r.makeComplexComponentTensorInfo(t,s),l=new eO(n,e.shape,t.shape);return r.compileAndRun(l,[u,c],tm(o.dtype,s.dtype))})),s=_slicedToArray(o,2),u=s[0],c=s[1],l=this.complex(u,c);return u.dispose(),c.dispose(),l}},{key:"makeComplexComponentTensorInfo",value:function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}},{key:"addN",value:function(e){if(1===e.length)return e[0];if(e.length>Dp().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map((function(e){return e.dtype})).reduce((function(e,t){return tm(e,t)})),i=e.map((function(e){return e.shape})),o=Dp().getBool("WEBGL_PACK")?new TN(e[0].shape,i):new SN(e[0].shape,i);return this.compileAndRun(o,e,a)}},{key:"subtract",value:function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,ZN);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=tm(e.dtype,t.dtype);if(Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ZN,e.dtype);var r=new eO(ZN,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)}},{key:"pow",value:function(e,t){var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new eO("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=tm(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)}},{key:"ceil",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xD,e.dtype);var t=new gD(e.shape,xD);return this.compileAndRun(t,[e])}},{key:"floor",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,CD,e.dtype);var t=new gD(e.shape,CD);return this.compileAndRun(t,[e])}},{key:"sign",value:function(e){var t=new gD(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])}},{key:"isNaN",value:function(e){var t=new gD(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")}},{key:"isInf",value:function(e){var t=new gD(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")}},{key:"isFinite",value:function(e){var t=new gD(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")}},{key:"round",value:function(e){var t=new gD(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])}},{key:"exp",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,SD,e.dtype);var t=new gD(e.shape,SD);return this.compileAndRun(t,[e])}},{key:"expm1",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,TD,e.dtype);var t=new gD(e.shape,TD);return this.compileAndRun(t,[e])}},{key:"softmax",value:function(e,t){var n=r.parseAxisParam([t],e.shape),a=z_(e,n),i=y.expandShapeToKeepDim(a.shape,n),o=this.subtract(e,a.reshape(i)),s=this.exp(o),u=this.sum(s,n).reshape(i);return tb(s,u)}},{key:"log",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new gD(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])}},{key:"log1p",value:function(e){var t=new gD(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])}},{key:"sqrt",value:function(e){var t=new gD(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])}},{key:"rsqrt",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new gD(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])}},{key:"reciprocal",value:function(e){var t=new gD(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])}},{key:"relu",value:function(e){var t;return t=Dp().getBool("WEBGL_PACK")?new OD(e.shape,ID):new gD(e.shape,bD),this.compileAndRun(t,[e])}},{key:"relu6",value:function(e){var t;return t=Dp().getBool("WEBGL_PACK")?new OD(e.shape,RD):new gD(e.shape,kD),this.compileAndRun(t,[e])}},{key:"prelu",value:function(e,t){var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO(tO,e.shape,t.shape):new eO(JN,e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"elu",value:function(e){if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ND,e.dtype);var t=new gD(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])}},{key:"eluDer",value:function(e,t){var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new eO("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"selu",value:function(e){var t=new gD(e.shape,_D);return this.compileAndRun(t,[e])}},{key:"int",value:function(e){var t=new gD(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")}},{key:"clip",value:function(e,t,n){var r,a=(r=Dp().getBool("WEBGL_PACK_CLIP")?new aO(e.shape):new rO(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(Dp().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yD,e.dtype);var t=new gD(e.shape,yD);return this.compileAndRun(t,[e])}},{key:"complexAbs",value:function(e){var t=this.texData.get(e.dataId),n=new iO(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)}},{key:"sigmoid",value:function(e){var t=new gD(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])}},{key:"softplus",value:function(e){var t=new gD(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])}},{key:"sin",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])}},{key:"cos",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])}},{key:"tan",value:function(e){var t=new gD(e.shape,"return tan(x);");return this.compileAndRun(t,[e])}},{key:"asin",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])}},{key:"acos",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])}},{key:"atan",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])}},{key:"atan2",value:function(e,t){var n=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new eO("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"sinh",value:function(e){var t=new gD(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}},{key:"cosh",value:function(e){var t=new gD(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}},{key:"tanh",value:function(e){var t=new gD(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])}},{key:"asinh",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])}},{key:"acosh",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])}},{key:"atanh",value:function(e){var t=new gD(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])}},{key:"erf",value:function(e){var t=new gD(e.shape,ED);return this.compileAndRun(t,[e])}},{key:"step",value:function(e,t){var n=new gD(e.shape,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"if (isnan(x)) return x;"+"\n    return x > 0.0 ? 1.0 : float(".concat(e,");\n  ")}(t));return this.compileAndRun(n,[e])}},{key:"conv2dByMatMul",value:function(e,t,n,a,i,o){var s=e.shape,u=this.texData.get(e.dataId),c="channelsLast"===n.dataFormat,l=s[2]%2!=0&&!!u.isPacked;if((1==s[0]*s[1]*s[2]||1===n.outChannels)&&n.inChannels>1e3||!Dp().getBool("WEBGL_LAZILY_UNPACK")||!Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var h=this.reshape(e,[1,c?s[0]*s[1]*s[2]:s[0]*s[2]*s[3],n.inChannels]),f=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:h,b:f,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o}),n.outShape)}var d={dataId:e.dataId,shape:[1,c?s[0]*s[1]*(s[2]+1):s[0]*s[2]*(s[3]+1),n.inChannels],dtype:e.dtype},p=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,r.assert(kN(u.shape,d.shape),(function(){return"packed reshape ".concat(u.shape," to ").concat(d.shape," isn't free")}));var v=this.reshape(t,[1,n.inChannels,n.outChannels]),m=this.fusedBatchMatMul({a:d,b:v,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o}),g=this.texData.get(m.dataId);return r.assert(g.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=p,g.shape=n.outShape,$g().makeTensorFromDataId(m.dataId,n.outShape,m.dtype)}},{key:"conv2dWithIm2Row",value:function(e,t,n,r,a,i){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,f=o*s*u,d=l*c,p=[f,d],v=e.squeeze([0]),m=t.reshape([1,f,-1]),g=new PO(p,v.shape,n),y=this.compileAndRun(g,[v]).reshape([1,p[0],p[1]]),b=null!=r,k=null!=i,_=a?UD(a,!0):null,w=new jO(y.shape,[1,d,n.outChannels],!0,!1,b,_,k),x=[y,m];return r&&x.push(r),k&&x.push(i),this.compileAndRun(w,x).reshape(h?[1,l,c,n.outChannels]:[1,n.outChannels,l,c])}},{key:"fusedConv2d",value:function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,i,o);if(Dp().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,i,o);var s=null!=a,u=null!=o,c=i?UD(i,!1):null,l=new vO(r,s,c,u),h=[t,n];return a&&h.push(a),o&&h.push(o),this.compileAndRun(l,h)}},{key:"conv2d",value:function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Dp().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new vO(n);return this.compileAndRun(r,[e,t])}},{key:"conv2dDerInput",value:function(e,t,n){var r=new lO(n);return this.compileAndRun(r,[e,t])}},{key:"conv2dDerFilter",value:function(e,t,n){var r=new cO(n);return this.compileAndRun(r,[e,t])}},{key:"fusedDepthwiseConv2D",value:function(e){var t,n=e.input,r=e.filter,a=e.convInfo,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=Dp().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,c=o?UD(o,u):null,l=[n,r],h=null!=i,f=null!=s;return h&&l.push(i),f&&l.push(s),u?(t=new yO(a,h,c,f),this.compileAndRun(t,l)):(t=new gO(a,h,c,f),this.compileAndRun(t,l))}},{key:"depthwiseConv2D",value:function(e,t,n){var r;return Dp().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new yO(n),this.compileAndRun(r,[e,t])):(r=new gO(n),this.compileAndRun(r,[e,t]))}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){var r=new pO(n);return this.compileAndRun(r,[e,t])}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){var r=new dO(n);return this.compileAndRun(r,[e,t])}},{key:"conv3d",value:function(e,t,n){var r=new mO(n);return this.compileAndRun(r,[e,t])}},{key:"conv3dDerInput",value:function(e,t,n){var r=new fO(n);return this.compileAndRun(r,[e,t])}},{key:"conv3dDerFilter",value:function(e,t,n){var r=new hO(n);return this.compileAndRun(r,[e,t])}},{key:"maxPool",value:function(e,t){var n=new YO(t,"max",!1);return this.compileAndRun(n,[e])}},{key:"avgPool",value:function(e,t){var n=new YO(t,"avg",!1);return this.compileAndRun(n,[e],"float32")}},{key:"maxPoolBackprop",value:function(e,t,n,r){var a=new YO(r,"max",!0),i=this.compileAndRun(a,[t]),o=new WO(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s}},{key:"avgPoolBackprop",value:function(e,t,n){var r=new qN(n);return this.compileAndRun(r,[e],t.dtype)}},{key:"cast",value:function(e,t){return y.castTensor(e,t,this)}},{key:"unstack",value:function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;for(var u=new Array(n),c=0;c<u.length;c++)o[t]=c,u[c]=this.slice(e,o,s).reshape(r);return u}},{key:"avgPool3d",value:function(e,t){var n=new QO(t,"avg",!1);return this.compileAndRun(n,[e],"float32")}},{key:"avgPool3dBackprop",value:function(e,t,n){var r=new GN(n);return this.compileAndRun(r,[e],t.dtype)}},{key:"maxPool3d",value:function(e,t){var n=new QO(t,"max",!1);return this.compileAndRun(n,[e],"float32")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){var a=new QO(r,"max",!0),i=this.compileAndRun(a,[t]),o=new VO(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s}},{key:"reshape",value:function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!kN(e.shape,t)&&(null===n.texture||!kN(n.shape,t))){var r=this.packedReshape(e,t);return $g().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return y.reshapeTensor(e,t)}},{key:"resizeBilinear",value:function(e,t,n,r){var a=Dp().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new tD(e.shape,t,n,r):new eD(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")}},{key:"resizeBilinearBackprop",value:function(e,t,n){var r=new JO(e,t,n);return this.compileAndRun(r,[e])}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){var a=new rD(e.shape,t,n,r);return this.compileAndRun(a,[e])}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){var r=new nD(e,t,n);return this.compileAndRun(r,[e])}},{key:"multinomial",value:function(e,t,n,r){var a=t?e:Uw(e),i=new HO(a.shape[0],a.shape[1],n),o=i.getCustomSetupFunc(r);return this.compileAndRun(i,[a],"int32",o)}},{key:"oneHot",value:function(e,t,n,r){var a=new qO(e.size,t,n,r);return this.compileAndRun(a,[e])}},{key:"diag",value:function(e){var t=new SO(e.size);return this.compileAndRun(t,[e])}},{key:"cropAndResize",value:function(e,t,n,r,a,i){var o=new bO(e.shape,t.shape,r,a,i);return this.compileAndRun(o,[e,t,n],"float32")}},{key:"depthToSpace",value:function(e,t,n){r.assert(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)}));var a=e.shape[0],i=("NHWC"===n?e.shape[1]:e.shape[2])*t,o=("NHWC"===n?e.shape[2]:e.shape[3])*t,s=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),u=new CO("NHWC"===n?[a,i,o,s]:[a,s,i,o],t,n);return this.compileAndRun(u,[e])}},{key:"split",value:function(e,t,n){return MD(e,t,n)}},{key:"scatterND",value:function(e,t,n){var r=y.calculateShapes(t,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([i,a]),h=t.reshape([i,o]);if(0===u)return y.reshapeTensor(Mm([]),n);var f=Pm(0),d=new oD(i,a,l.rank,h.rank,s,c);return this.compileAndRun(d,[h,l,f]).reshape(n)}},{key:"sparseToDense",value:function(e,t,n,r){var a=y.calculateShapes(t,e,n),i=a.sliceRank,o=a.numUpdates,s=a.strides,u=a.outputSize,c=new oD(o,i,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)}},{key:"fft",value:function(e){return this.fftImpl(e,!1)}},{key:"ifft",value:function(e){return this.fftImpl(e,!0)}},{key:"fftImpl",value:function(e,t){var n=this.texData.get(e.dataId),r=new RO("return real * expR - imag * expI;",e.shape,t),a=new RO("return real * expI + imag * expR;",e.shape,t),i=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],o=this.compileAndRun(r,i),s=this.compileAndRun(a,i),u=this.complex(o,s).as2D(e.shape[0],e.shape[1]);return o.dispose(),s.dispose(),u}},{key:"gatherND",value:function(e,t){var n=t.shape,r=n[n.length-1],a=_slicedToArray(y.prepareAndValidate(e,t),4),i=a[0],o=a[1],s=a[2],u=a[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),h=new DO(r,u,[o,s]);return this.compileAndRun(h,[l,c]).reshape(i)}},{key:"fill",value:function(e,t,n){if("string"===(n=n||r.inferDtype(t))){var a=r.getArrayFromDType(n,r.sizeFromShape(e));return a.fill(t),$g().makeTensor(a,e,n,this)}var i=new NO(e,t),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,o)}},{key:"onesLike",value:function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)}},{key:"zerosLike",value:function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)}},{key:"linspace",value:function(e,t,n){return y.linspaceImpl(e,t,n)}},{key:"makeTensorInfo",value:function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t){var n=this.makeTensorInfo(e,t).dataId;return $g().makeTensorFromDataId(n,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new DD(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new GO(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[mN(e.shape)].concat(_toConsumableArray(gN(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[mN(t)].concat(_toConsumableArray(gN(t))),i=new $O(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=yN(a);return t=r?new xO(o):new wO(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,a){var i=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===XR.DENSE){var c=tN(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===r.sizeFromShape(s.shape))return u.values=r.getTypedArrayFromDType(s.dtype,0),s;var l=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&r.sizeFromShape(t.shape)<=Dp().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),l.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!kN(n.shape,t.shape)){var a=t,o=t.shape;t.shape=n.shape,t=i.packedReshape(t,o),l.push(t),n=i.texData.get(t.dataId),a.shape=o}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var f,d={shape:s.shape,texData:u,isUniform:!1},p=function(e,t,n){var r="";t.concat(n).forEach((function(e){r+="".concat(e.shape,"_").concat(e.isUniform?"uniform":e.texData.texShape,"_").concat(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)}));var a=e.constructor.name;return a+="_"+r+"_"+e.userCode}(e,h,d),v=this.getAndSaveBinary(p,(function(){return function(e,t,n,a){var i=t.userCode,o=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=o.map((function(e){return e.shapeInfo})),u={logicalShape:a.shape,texShape:a.texData.texShape,isUniform:!1,isPacked:a.texData.isPacked,flatOffset:null},c=function(e,t,n,a){var i=[];e.forEach((function(e){var t=r.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(i.push("uniform sampler2D ".concat(e.name,";")),i.push("uniform int offset".concat(e.name,";")))}));var o,s,u=i.join("\n"),c=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="";return a+=n?function e(t){switch(t.shapeInfo.logicalShape.length){case 0:return n=t.name,"\n    vec4 ".concat("get"+n.charAt(0).toUpperCase()+n.slice(1),"() {\n      return ").concat(RN().texture2D,"(").concat(n,", halfCR);\n    }\n  ");case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=RN();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=RN();if(null!=i&&r.arraysEqual(t,i))return"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(n,", uv);\n      }\n    ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(Math.ceil(t[1]/2),", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(n,", uv);\n    }\n  ")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=VN(t,n.slice(1));return"\n        ".concat(e(s),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(jN(["b","row","col"],[1,2]),");\n        }\n      ")}var u=o[0],c=o[1],l=Math.ceil(n[2]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(u,", ").concat(c,", ").concat(l*Math.ceil(n[1]/2),", ").concat(l,", b, row, col);\n      return ").concat(RN().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",f="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),d=2;d<n-1;d++)h="int b".concat(d,", ")+h,l*=t[n-d-1],f="b".concat(d," * ").concat(l," + ")+f;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(RN().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t)}var n}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var r=_slicedToArray(e.shapeInfo.texShape,2),a=r[0],i=r[1];if(1===a&&1===i)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=_slicedToArray(e.shapeInfo.texShape,2),s=o[0],u=o[1];return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(u,", ").concat(BN(t),");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(UN(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=BN(t);return 1===i?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t.shapeInfo.texShape;if(null!=o&&r.arraysEqual(n,o))return"\n    float ".concat(i,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o[1],".0, ").concat(o[0],".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ");var s=r.squeezeShape(n),u=s.newShape,c=s.keptDims;if(u.length<n.length){var l=VN(t,u);return"\n      ".concat(e(l),"\n      float ").concat(i,"(int row, int col) {\n        return ").concat(i,"(").concat(jN(["row","col"],c),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(UN(t),"\n      }\n    ");var h=o[0],f=o[1],d=BN(a);return 1===f?"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):1===h?"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(f,".0, 0.5);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n  float ".concat(i,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(d,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(f,", index);\n    return sampleTexture(").concat(a,", uv);\n  }\n")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[1]*n[2],s=n[2],u=r.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=VN(t,c);return"\n        ".concat(e(h),"\n        float ").concat(i,"(int row, int col, int depth) {\n          return ").concat(i,"(").concat(jN(["row","col","depth"],l),");\n        }\n      ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(o,", ").concat(s,", 1)));\n        ").concat(UN(t),"\n      }\n    ");var f=t.shapeInfo.texShape,d=f[0],p=f[1],v=t.shapeInfo.flatOffset;return p===o&&null==v?"\n        float ".concat(i,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(s,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(p,".0, ").concat(d,".0);\n          return sampleTexture(").concat(a,", uv);\n        }\n      "):p===s&&null==v?"\n    float ".concat(i,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(p,".0, ").concat(d,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n      float ".concat(i,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(o," + col * ").concat(s," + depth + ").concat(BN(a),";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n        return sampleTexture(").concat(a,", uv);\n      }\n  ")}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[3],s=n[2]*o,u=n[1]*s,c=r.squeezeShape(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var f=VN(t,l);return"\n      ".concat(e(f),"\n      float ").concat(i,"(int row, int col, int depth, int depth2) {\n        return ").concat(i,"(").concat(jN(["row","col","depth","depth2"],h),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(u,", ").concat(s,", ").concat(o,", 1)));\n        ").concat(UN(t),"\n      }\n    ");var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],m=p[1];return m===u&&null==d?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):m===o&&null==d?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(s," +\n          depth * ").concat(o," + depth2;\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(m,", index + ").concat(BN(a),");\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[4],s=n[3]*o,u=n[2]*s,c=n[1]*u,l=r.squeezeShape(n),h=l.newShape,f=l.keptDims;if(h.length<n.length){var d=VN(t,h);return"\n      ".concat(e(d),"\n      float ").concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(i,"(").concat(jN(["row","col","depth","depth2","depth3"],f),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(c,", ").concat(u,", ").concat(s,", ").concat(o,")) +\n          depth3;\n        ").concat(UN(t),"\n      }\n    ");var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,m=v[0],g=v[1];return g===c&&null==p?"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(u,", ").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):g===o&&null==p?"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3],",\n               ").concat(n[2]*n[3],", ").concat(n[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(c," + col * ").concat(u," + depth * ").concat(s," +\n          depth2 * ").concat(o," + depth3 + ").concat(BN(a),";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(g,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r.squeezeShape(n),s=o.newShape,u=o.keptDims;if(s.length<n.length){var c=VN(t,s);return"\n      ".concat(e(c),"\n      float ").concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(i,"(").concat(jN(["row","col","depth","depth2","depth3","depth4"],u),");\n      }\n    ")}var l=n[5],h=n[4]*l,f=n[3]*h,d=n[2]*f,p=n[1]*d;if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(p,", ").concat(d,", ").concat(f,", ").concat(h,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(l,", 1)));\n        ").concat(UN(t),"\n      }\n    ");var v=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],y=m[1];return y===p&&null==v?"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(f,", ").concat(h,", ").concat(l,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):y===l&&null==v?"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3]*n[4],",\n               ").concat(n[2]*n[3]*n[4],",\n               ").concat(n[3]*n[4],",\n               ").concat(n[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(p," + col * ").concat(d," + depth * ").concat(f," +\n          depth2 * ").concat(h," + depth3 * ").concat(l," + depth4 + ").concat(BN(a),";\n      vec2 uv = uvFromFlat(").concat(g,", ").concat(y,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(a+=n?function(e,t){var n,a=e.name,i=a.charAt(0).toUpperCase()+a.slice(1),o="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=FN(e.shapeInfo.logicalShape,t.logicalShape),l=WN(u),h=u-s,f=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var d;d=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+h])})).join(", ");var p="return outputValue;",v=1===r.sizeFromShape(e.shapeInfo.logicalShape),m=1===r.sizeFromShape(t.logicalShape);if(1!==s||v||m){if(v&&!m)p=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=s-2,y=s-1;c.indexOf(g)>-1&&c.indexOf(y)>-1?p="return vec4(outputValue.x);":c.indexOf(g)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(y)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(i,"(").concat(d,");\n      ").concat(p,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,a=n.charAt(0).toUpperCase()+n.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===s&&null==e.shapeInfo.flatOffset&&r.arraysEqual(e.shapeInfo.texShape,t.texShape))return"\n      float ".concat(i,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var u,c=WN(s),l=FN(e.shapeInfo.logicalShape,t.logicalShape),h=s-o,f=["x","y","z","w","u","v"];u=0===o?"":s<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var d;return d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+h])})).join(", "),"\n    float ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(u,"\n      return get").concat(a,"(").concat(d,");\n    }\n  ")}(e,t)),a}(e,t,a)})).join("\n"),l=t.texShape,h=RN(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(h),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(MN,"\n    ").concat(LN,"\n    ").concat(PN,"\n  ")}(h);return t.isPacked?(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return n=t,1===(a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(a[1],".0);\n      }\n    "):1===a[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(a[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      return 2 * (resTexRC.x * ").concat(a[1]," + resTexRC.y);\n    }\n  ");case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(r.arraysEqual(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}var n,a}(t.logicalShape,l),s=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(h)):(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return resTexRC.x * ").concat(n[1]," + resTexRC.y;\n    }\n  ");case 2:return function(e,t){return r.arraysEqual(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=NN(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=NN(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=NN(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=NN(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}var n}(t.logicalShape,l),s=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(h)),a&&(d+=zN),[d,f,s,u,o,c,n].join("\n")}(o,u,i,t.packedInputs),l=e.createProgram(c),h=null,f=e.getUniformLocation(l,"NAN",!1);1===Dp().getNumber("WEBGL_VERSION")&&(h=e.getUniformLocation(l,"INFINITY",!1));for(var d={},p=0;p<t.variableNames.length;p++){var v=t.variableNames[p];d[v]=e.getUniformLocation(l,v,!1),d["offset".concat(v)]=e.getUniformLocation(l,"offset".concat(v),!1)}return{program:t,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:s,outShapeInfo:u,infLoc:h,nanLoc:f}}(i.gpgpu,e,h,d)})),m=null!=this.activeTimers;if(m&&(f=this.startTimer()),function(e,t,n,a,i){LO(t.inShapeInfos,n),LO([t.outShapeInfo],[a]);var o=a.texData.texture,s=a.texData.texShape;a.texData.isPacked?e.setOutputPackedMatrixTexture(o,s[0],s[1]):e.setOutputMatrixTexture(o,s[0],s[1]),e.setProgram(t.webGLProgram),1===Dp().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,a){var i=t.program.variableNames[a],o=t.uniformLocations[i],s=t.uniformLocations["offset".concat(i)];if(null!=o)if(n.isUniform)if(r.sizeFromShape(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var u=n.uniformValues;u instanceof Float32Array||(u=new Float32Array(u)),e.gl.uniform1fv(o,u)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,a)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,v,h,d,a),l.forEach((function(e){return i.disposeData(e.dataId)})),m&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!Dp().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var g=this.unpackTensor(s);return this.disposeData(s.dataId),g}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,a);return $g().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(Dp().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=ey((function(){if(!Dp().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Dp().getBool("DEBUG");Dp().set("DEBUG",!1);var n=e.abs(Pm(1e-8)).dataSync()[0];if(Dp().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,a=t.dtype,i=t.values,o=t.texture,s=t.usage,u=t.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=r.now());var h=t.texShape;if(null==h&&(h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Dp().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?r.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=r.squeezeShape(e);e=a.newShape}var i=r.sizeFromShape(e);if(e.length<=1&&i<=n)return[1,i];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var o,s=mN(e),u=2,c=2;return e.length&&(u=(o=_slicedToArray(gN(e),2))[0],c=o[1]),i=s*(u/2)*(c/2),r.sizeToSquarishShape(i).map((function(e){return 2*e}))}return r.sizeToSquarishShape(i)}(n,u),t.texShape=h),null!=i){var f,d,p=yN(n),v=h[1],m=h[0],g=i instanceof Uint8Array;u?(v=(f=_slicedToArray(nN(h[0],h[1]),2))[0],m=f[1],d=new IO(p,[m,v],g)):d=new AO(p,[m,v],g);var y=this.makeTensorInfo([m,v],a);this.texData.get(y.dataId).usage=g?YR.PIXELS:YR.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),v,m,i);var b=this.runWebGLProgram(d,[y],a,null,!0),k=this.texData.get(b.dataId);t.texture=k.texture,t.texShape=k.texShape,t.isPacked=k.isPacked,t.usage=k.usage,this.disposeData(y.dataId),this.texData.delete(b.dataId),t.values=null,l&&(this.uploadWaitMs+=r.now()-c)}else{var _=this.acquireTexture(h,s,a,u);t.texture=_}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*r.bytesPerElement(t)}}]),s}(OC),jD={kernelName:"Div",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return function(e,t,n){var r=new eO("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new nO("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",e.shape,t.shape,!0)),n.runWebGLProgram(r,[e,t],"float32")}(t.a,t.b,n)}},HD=function e(t){_classCallCheck(this,e),this.variableNames=["A"];var n=RN(),r=_slicedToArray(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},qD=function e(t){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=RN(),r=_slicedToArray(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},GD={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=_slicedToArray(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],h=[l,c],f=[l,c,i];(s||o)&&(null==WD&&(WD=document.createElement("canvas").getContext("2d")),WD.canvas.width=c,WD.canvas.height=l,WD.drawImage(a,0,0,c,l),a=WD.canvas);var d=n.makeTensorInfo(h,"int32");n.texData.get(d.dataId).usage=YR.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);var p=Dp().getBool("WEBGL_PACK")?new qD(f):new HD(f),v=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),v}},KD=L.maxImpl,XD=L.transposeImpl;function YD(e,t,n){var r=n.texData.get(e.dataId);return!r.isPacked||kN(e.shape,t)||null!==r.texture&&kN(r.shape,t)?{dataId:e.dataId,shape:t,dtype:e.dtype}:function(e,t,n){var r=[mN(e.shape)].concat(_toConsumableArray(gN(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[mN(t)].concat(_toConsumableArray(gN(t))),o=new $O(i,r),s=n.runWebGLProgram(o,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(e,t,n)}var QD=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=WN(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")},ZD=function e(t,n){_classCallCheck(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=WN(this.rank),o=AN("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function $D(e,t,n){var r=Dp().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ZD(e.shape,t):new QD(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}for(var JD={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;y.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n,l=c.readSync(a.dataId),h=c.readSync(i.dataId);return b.nonMaxSuppressionV3(l,h,o,s,u)}},eF=b.nonMaxSuppressionV5,tF=0,nF=[{kernelName:"Max",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.reductionIndices,s=a,u=i.shape.length,c=r.parseAxisParam(o,i.shape),l=y.getAxesPermutation(c,u),h=null!=l,f=s.shouldExecuteOnCPU([i]),d=i;if(h){if(f){for(var p=s.texData.get(d.dataId).values,v=new Array(u),m=0;m<v.length;m++)v[m]=i.shape[l[m]];var g=XD(p,i.shape,i.dtype,l,v);d=s.makeTensorInfo(v,i.dtype),s.texData.get(d.dataId).values=g}else d=$D(i,l,s);c=y.getInnerMostAxes(c.length,u)}y.assertAxesAreInnerMostDims("max",c,u);var b,k=_slicedToArray(y.computeOutAndReduceShapes(d.shape,c),2),_=k[0],w=k[1];if(f){var x=s.texData.get(d.dataId),C=KD(x.values,r.sizeFromShape(w),_,i.dtype);b=s.makeTensorInfo(_,i.dtype),s.texData.get(b.dataId).values=C}else b=function(e,t,n,a){var i=r.sizeFromShape(t),o=YD(e,[r.sizeFromShape(e.shape)/i,i],a),s=function e(t,n,r,a){var i=_slicedToArray(t.shape,2),o=i[0],s=i[1],u=y.computeOptimalWindowSize(s),c=new ZO({windowSize:u,inSize:s,batchSize:o},r),l=a.runWebGLProgram(c,[t],n);return 1===l.shape[1]?l:e(l,n,r,a)}(o,e.dtype,"max",a);return o.dataId!==e.dataId&&a.disposeData(o.dataId),YD(s,n,a)}(d,w,_,s);return h&&s.disposeData(d.dataId),b}},GD,jD,JD,{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;y.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n,h=l.readSync(a.dataId),f=l.readSync(i.dataId),d=eF(h,f,o,s,u,c);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n,i=new gD(r.shape,"return x * x;");return a.runWebGLProgram(i,[r],r.dtype)}},{kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.a,a=t.b,i=n,o=Dp().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new nO("return (a - b) * (a - b);",r.shape,a.shape):new eO("return (a - b) * (a - b);",r.shape,a.shape);return i.compileAndRun(o,[r,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,a=e.backend,i=n.x,o=r.perm,s=a,u=new Array(i.shape.length),c=0;c<u.length;c++)u[c]=i.shape[o[c]];if(s.shouldExecuteOnCPU([i])){var l=s.texData.get(i.dataId),h=XD(l.values,i.shape,i.dtype,o,u);t=s.makeTensorInfo(u,i.dtype),s.texData.get(t.dataId).values=h}else t=$D(i,o,s);return t}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=a;r.assert(4===i.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(i.shape.length,".")}));var h=[1,1];r.assert(y.eitherStridesOrDilationsAreOne(s,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(s," and dilations '").concat(h,"'")}));var f=y.computePool2DInfo(i.shape,o,s,h,u),d=_slicedToArray(function(e,t,n,r){var a=new YO(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new YO(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(i,c,f,l),2);return[d[0],d[1]]}}];tF<nF.length;tF++){jp(nF[tF])}i.isBrowser()&&ry("webgl",(function(){return new VD}),2);var rF,aF=n("EVdn");function iF(e){return null!=e&&"false"!=="".concat(e)}function oF(e){return e instanceof ys?e.nativeElement:e}try{rF="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(iz){rF=!1}var sF,uF,cF,lF,hF=((lF=function e(t){_classCallCheck(this,e),this._platformId=t,this.isBrowser=this._platformId?"browser"===this._platformId:"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!rF)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}).\u0275fac=function(e){return new(e||lF)(It(Su,8))},lF.\u0275prov=Ge({factory:function(){return new lF(It(Su,8))},token:lF,providedIn:"root"}),lF),fF=((cF=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:cF}),cF.\u0275inj=Ke({factory:function(e){return new(e||cF)}}),cF);function dF(e){return function(){if(null==sF&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){return sF=!0}}))}finally{sF=sF||!1}return sF}()?e:!!e.capture}function pF(e){return 0===e.buttons}"undefined"!=typeof Element&&Element;var vF,mF=new kt("cdk-focus-monitor-default-options"),gF=dF({passive:!0,capture:!0}),yF=((vF=function(){function e(t,n,r,a){var i=this;_classCallCheck(this,e),this._ngZone=t,this._platform=n,this._origin=null,this._windowFocused=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._documentKeydownListener=function(){i._lastTouchTarget=null,i._setOriginForCurrentEventQueue("keyboard")},this._documentMousedownListener=function(e){if(!i._lastTouchTarget){var t=pF(e)?"keyboard":"mouse";i._setOriginForCurrentEventQueue(t)}},this._documentTouchstartListener=function(e){null!=i._touchTimeoutId&&clearTimeout(i._touchTimeoutId),i._lastTouchTarget=bF(e),i._touchTimeoutId=setTimeout((function(){return i._lastTouchTarget=null}),650)},this._windowFocusListener=function(){i._windowFocused=!0,i._windowFocusTimeoutId=setTimeout((function(){return i._windowFocused=!1}))},this._rootNodeFocusAndBlurListener=function(e){for(var t=bF(e),n="focus"===e.type?i._onFocus:i._onBlur,r=t;r;r=r.parentElement)n.call(i,e,r)},this._document=r,this._detectionMode=(null==a?void 0:a.detectionMode)||0}return _createClass(e,[{key:"monitor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._platform.isBrowser)return jl(null);var n=oF(e),r=function(e){if(function(){if(null==uF){var e="undefined"!=typeof document?document.head:null;uF=!(!e||!e.createShadowRoot&&!e.attachShadow)}return uF}()){var t=e.getRootNode?e.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(n)||this._getDocument(),a=this._elementInfo.get(n);if(a)return t&&(a.checkChildren=!0),a.subject.asObservable();var i={checkChildren:t,subject:new ue,rootNode:r};return this._elementInfo.set(n,i),this._registerGlobalListeners(i),i.subject.asObservable()}},{key:"stopMonitoring",value:function(e){var t=oF(e),n=this._elementInfo.get(t);n&&(n.subject.complete(),this._setClasses(t),this._elementInfo.delete(t),this._removeGlobalListeners(n))}},{key:"focusVia",value:function(e,t,n){var r=oF(e);this._setOriginForCurrentEventQueue(t),"function"==typeof r.focus&&r.focus(n)}},{key:"ngOnDestroy",value:function(){var e=this;this._elementInfo.forEach((function(t,n){return e.stopMonitoring(n)}))}},{key:"_getDocument",value:function(){return this._document||document}},{key:"_getWindow",value:function(){return this._getDocument().defaultView||window}},{key:"_toggleClass",value:function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}},{key:"_getFocusOrigin",value:function(e){return this._origin?this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:this._wasCausedByTouch(e)?"touch":"program"}},{key:"_setClasses",value:function(e,t){this._toggleClass(e,"cdk-focused",!!t),this._toggleClass(e,"cdk-touch-focused","touch"===t),this._toggleClass(e,"cdk-keyboard-focused","keyboard"===t),this._toggleClass(e,"cdk-mouse-focused","mouse"===t),this._toggleClass(e,"cdk-program-focused","program"===t)}},{key:"_setOriginForCurrentEventQueue",value:function(e){var t=this;this._ngZone.runOutsideAngular((function(){t._origin=e,0===t._detectionMode&&(t._originTimeoutId=setTimeout((function(){return t._origin=null}),1))}))}},{key:"_wasCausedByTouch",value:function(e){var t=bF(e);return this._lastTouchTarget instanceof Node&&t instanceof Node&&(t===this._lastTouchTarget||t.contains(this._lastTouchTarget))}},{key:"_onFocus",value:function(e,t){var n=this._elementInfo.get(t);if(n&&(n.checkChildren||t===bF(e))){var r=this._getFocusOrigin(e);this._setClasses(t,r),this._emitOrigin(n.subject,r),this._lastFocusOrigin=r}}},{key:"_onBlur",value:function(e,t){var n=this._elementInfo.get(t);!n||n.checkChildren&&e.relatedTarget instanceof Node&&t.contains(e.relatedTarget)||(this._setClasses(t),this._emitOrigin(n.subject,null))}},{key:"_emitOrigin",value:function(e,t){this._ngZone.run((function(){return e.next(t)}))}},{key:"_registerGlobalListeners",value:function(e){var t=this;if(this._platform.isBrowser){var n=e.rootNode,r=this._rootNodeFocusListenerCount.get(n)||0;r||this._ngZone.runOutsideAngular((function(){n.addEventListener("focus",t._rootNodeFocusAndBlurListener,gF),n.addEventListener("blur",t._rootNodeFocusAndBlurListener,gF)})),this._rootNodeFocusListenerCount.set(n,r+1),1==++this._monitoredElementCount&&this._ngZone.runOutsideAngular((function(){var e=t._getDocument(),n=t._getWindow();e.addEventListener("keydown",t._documentKeydownListener,gF),e.addEventListener("mousedown",t._documentMousedownListener,gF),e.addEventListener("touchstart",t._documentTouchstartListener,gF),n.addEventListener("focus",t._windowFocusListener)}))}}},{key:"_removeGlobalListeners",value:function(e){var t=e.rootNode;if(this._rootNodeFocusListenerCount.has(t)){var n=this._rootNodeFocusListenerCount.get(t);n>1?this._rootNodeFocusListenerCount.set(t,n-1):(t.removeEventListener("focus",this._rootNodeFocusAndBlurListener,gF),t.removeEventListener("blur",this._rootNodeFocusAndBlurListener,gF),this._rootNodeFocusListenerCount.delete(t))}if(!--this._monitoredElementCount){var r=this._getDocument(),a=this._getWindow();r.removeEventListener("keydown",this._documentKeydownListener,gF),r.removeEventListener("mousedown",this._documentMousedownListener,gF),r.removeEventListener("touchstart",this._documentTouchstartListener,gF),a.removeEventListener("focus",this._windowFocusListener),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._touchTimeoutId),clearTimeout(this._originTimeoutId)}}}]),e}()).\u0275fac=function(e){return new(e||vF)(It(Wu),It(hF),It(kc,8),It(mF,8))},vF.\u0275prov=Ge({factory:function(){return new vF(It(Wu),It(hF),It(kc,8),It(mF,8))},token:vF,providedIn:"root"}),vF);function bF(e){return e.composedPath?e.composedPath()[0]:e.target}var kF,_F,wF=((_F=function(){function e(t,n){_classCallCheck(this,e),this._platform=t,this._document=n}return _createClass(e,[{key:"getHighContrastMode",value:function(){if(!this._platform.isBrowser)return 0;var e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);var t=this._document.defaultView||window,n=t&&t.getComputedStyle?t.getComputedStyle(e):null,r=(n&&n.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(e),r){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}},{key:"_applyBodyHighContrastModeCssClasses",value:function(){if(this._platform.isBrowser&&this._document.body){var e=this._document.body.classList;e.remove("cdk-high-contrast-active"),e.remove("cdk-high-contrast-black-on-white"),e.remove("cdk-high-contrast-white-on-black");var t=this.getHighContrastMode();1===t?(e.add("cdk-high-contrast-active"),e.add("cdk-high-contrast-black-on-white")):2===t&&(e.add("cdk-high-contrast-active"),e.add("cdk-high-contrast-white-on-black"))}}}]),e}()).\u0275fac=function(e){return new(e||_F)(It(hF),It(kc))},_F.\u0275prov=Ge({factory:function(){return new _F(It(hF),It(kc))},token:_F,providedIn:"root"}),_F),xF=((kF=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:kF}),kF.\u0275inj=Ke({factory:function(e){return new(e||kF)}}),kF),CF=new Ss("9.2.4"),SF=function e(){_classCallCheck(this,e)};function TF(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:2,steps:e,options:t}}function EF(e){return{type:6,styles:e,offset:null}}function AF(e){Promise.resolve(null).then(e)}var IF=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this.parentPlayer=null,this.totalTime=t+n}return _createClass(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"init",value:function(){}},{key:"play",value:function(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}},{key:"triggerMicrotask",value:function(){var e=this;AF((function(){return e._onFinish()}))}},{key:"_onStart",value:function(){this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[]}},{key:"pause",value:function(){}},{key:"restart",value:function(){}},{key:"finish",value:function(){this._onFinish()}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"reset",value:function(){}},{key:"setPosition",value:function(e){}},{key:"getPosition",value:function(){return 0}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}}]),e}(),RF=function(){function e(t){var n=this;_classCallCheck(this,e),this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;var r=0,a=0,i=0,o=this.players.length;0==o?AF((function(){return n._onFinish()})):this.players.forEach((function(e){e.onDone((function(){++r==o&&n._onFinish()})),e.onDestroy((function(){++a==o&&n._onDestroy()})),e.onStart((function(){++i==o&&n._onStart()}))})),this.totalTime=this.players.reduce((function(e,t){return Math.max(e,t.totalTime)}),0)}return _createClass(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"init",value:function(){this.players.forEach((function(e){return e.init()}))}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"_onStart",value:function(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[])}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach((function(e){return e.play()}))}},{key:"pause",value:function(){this.players.forEach((function(e){return e.pause()}))}},{key:"restart",value:function(){this.players.forEach((function(e){return e.restart()}))}},{key:"finish",value:function(){this._onFinish(),this.players.forEach((function(e){return e.finish()}))}},{key:"destroy",value:function(){this._onDestroy()}},{key:"_onDestroy",value:function(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach((function(e){return e.destroy()})),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"reset",value:function(){this.players.forEach((function(e){return e.reset()})),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"setPosition",value:function(e){var t=e*this.totalTime;this.players.forEach((function(e){var n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)}))}},{key:"getPosition",value:function(){var e=0;return this.players.forEach((function(t){var n=t.getPosition();e=Math.min(n,e)})),e}},{key:"beforeDestroy",value:function(){this.players.forEach((function(e){e.beforeDestroy&&e.beforeDestroy()}))}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}}]),e}();function NF(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function OF(e){switch(e.length){case 0:return new IF;case 1:return e[0];default:return new RF(e)}}function DF(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=[],s=[],u=-1,c=null;if(r.forEach((function(e){var n=e.offset,r=n==u,l=r&&c||{};Object.keys(e).forEach((function(n){var r=n,s=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),s){case"!":s=a[n];break;case"*":s=i[n];break;default:s=t.normalizeStyleValue(n,r,s,o)}l[r]=s})),r||s.push(l),c=l,u=n})),o.length){var l="\n - ";throw new Error("Unable to animate due to the following errors:".concat(l).concat(o.join(l)))}return s}function FF(e,t,n,r){switch(t){case"start":e.onStart((function(){return r(n&&MF(n,"start",e))}));break;case"done":e.onDone((function(){return r(n&&MF(n,"done",e))}));break;case"destroy":e.onDestroy((function(){return r(n&&MF(n,"destroy",e))}))}}function MF(e,t,n){var r=n.totalTime,a=LF(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,null==r?e.totalTime:r,!!n.disabled),i=e._data;return null!=i&&(a._data=i),a}function LF(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6?arguments[6]:void 0;return{element:e,triggerName:t,fromState:n,toState:r,phaseName:a,totalTime:i,disabled:!!o}}function PF(e,t,n){var r;return e instanceof Map?(r=e.get(t))||e.set(t,r=n):(r=e[t])||(r=e[t]=n),r}function zF(e){var t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}var BF=function(e,t){return!1},UF=function(e,t){return!1},WF=function(e,t,n){return[]},VF=NF();(VF||"undefined"!=typeof Element)&&(BF=function(e,t){return e.contains(t)},UF=function(){if(VF||Element.prototype.matches)return function(e,t){return e.matches(t)};var e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?function(e,n){return t.apply(e,[n])}:UF}(),WF=function(e,t,n){var r=[];if(n)r.push.apply(r,_toConsumableArray(e.querySelectorAll(t)));else{var a=e.querySelector(t);a&&r.push(a)}return r});var jF=null,HF=!1;function qF(e){jF||(jF=("undefined"!=typeof document?document.body:null)||{},HF=!!jF.style&&"WebkitAppearance"in jF.style);var t=!0;return jF.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(!(t=e in jF.style)&&HF)&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in jF.style),t}var GF=UF,KF=BF,XF=WF;function YF(e){var t={};return Object.keys(e).forEach((function(n){var r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]})),t}var QF,ZF=((QF=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"validateStyleProperty",value:function(e){return qF(e)}},{key:"matchesElement",value:function(e,t){return GF(e,t)}},{key:"containsElement",value:function(e,t){return KF(e,t)}},{key:"query",value:function(e,t,n){return XF(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return n||""}},{key:"animate",value:function(e,t,n,r,a){return arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&arguments[6],new IF(n,r)}}]),e}()).\u0275fac=function(e){return new(e||QF)},QF.\u0275prov=Ge({token:QF,factory:QF.\u0275fac}),QF),$F=function(){var e=function e(){_classCallCheck(this,e)};return e.NOOP=new ZF,e}();function JF(e){if("number"==typeof e)return e;var t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:eM(parseFloat(t[1]),t[2])}function eM(e,t){switch(t){case"s":return 1e3*e;default:return e}}function tM(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){var r,a=0,i="";if("string"==typeof e){var o=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===o)return t.push('The provided timing value "'.concat(e,'" is invalid.')),{duration:0,delay:0,easing:""};r=eM(parseFloat(o[1]),o[2]);var s=o[3];null!=s&&(a=eM(parseFloat(s),o[4]));var u=o[5];u&&(i=u)}else r=e;if(!n){var c=!1,l=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),c=!0),a<0&&(t.push("Delay values below 0 are not allowed for this animation step."),c=!0),c&&t.splice(l,0,'The provided timing value "'.concat(e,'" is invalid.'))}return{duration:r,delay:a,easing:i}}(e,t,n)}function nM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).forEach((function(n){t[n]=e[n]})),t}function rM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)for(var r in e)n[r]=e[r];else nM(e,n);return n}function aM(e,t,n){return n?t+":"+n+";":""}function iM(e){for(var t="",n=0;n<e.style.length;n++){var r=e.style.item(n);t+=aM(0,r,e.style.getPropertyValue(r))}for(var a in e.style)e.style.hasOwnProperty(a)&&!a.startsWith("_")&&(t+=aM(0,a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e.style[a]));e.setAttribute("style",t)}function oM(e,t,n){e.style&&(Object.keys(t).forEach((function(r){var a=pM(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[a]),e.style[a]=t[r]})),NF()&&iM(e))}function sM(e,t){e.style&&(Object.keys(t).forEach((function(t){var n=pM(t);e.style[n]=""})),NF()&&iM(e))}function uM(e){return Array.isArray(e)?1==e.length?e[0]:TF(e):e}var cM=new RegExp("{{\\s*(.+?)\\s*}}","g");function lM(e){var t=[];if("string"==typeof e){for(var n;n=cM.exec(e);)t.push(n[1]);cM.lastIndex=0}return t}function hM(e,t,n){var r=e.toString(),a=r.replace(cM,(function(e,r){var a=t[r];return t.hasOwnProperty(r)||(n.push("Please provide a value for the animation param ".concat(r)),a=""),a.toString()}));return a==r?e:a}function fM(e){for(var t=[],n=e.next();!n.done;)t.push(n.value),n=e.next();return t}var dM=/-+([a-z0-9])/g;function pM(e){return e.replace(dM,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[1].toUpperCase()}))}function vM(e,t){return 0===e||0===t}function mM(e,t,n){var r=Object.keys(n);if(r.length&&t.length){var a=t[0],i=[];if(r.forEach((function(e){a.hasOwnProperty(e)||i.push(e),a[e]=n[e]})),i.length)for(var o=function(){var n=t[s];i.forEach((function(t){n[t]=yM(e,t)}))},s=1;s<t.length;s++)o()}return t}function gM(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error("Unable to resolve animation metadata node #".concat(t.type))}}function yM(e,t){return window.getComputedStyle(e)[t]}var bM=new Set(["true","1"]),kM=new Set(["false","0"]);function _M(e,t){var n=bM.has(e)||kM.has(e),r=bM.has(t)||kM.has(t);return function(a,i){var o="*"==e||e==a,s="*"==t||t==i;return!o&&n&&"boolean"==typeof a&&(o=a?bM.has(e):kM.has(e)),!s&&r&&"boolean"==typeof i&&(s=i?bM.has(t):kM.has(t)),o&&s}}var wM=new RegExp("s*:selfs*,?","g");function xM(e,t,n){return new CM(e).build(t,n)}var CM=function(){function e(t){_classCallCheck(this,e),this._driver=t}return _createClass(e,[{key:"build",value:function(e,t){var n=new SM(t);return this._resetContextStyleTimingState(n),gM(this,uM(e),n)}},{key:"_resetContextStyleTimingState",value:function(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}},{key:"visitTrigger",value:function(e,t){var n=this,r=t.queryCount=0,a=t.depCount=0,i=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach((function(e){if(n._resetContextStyleTimingState(t),0==e.type){var s=e,u=s.name;u.toString().split(/\s*,\s*/).forEach((function(e){s.name=e,i.push(n.visitState(s,t))})),s.name=u}else if(1==e.type){var c=n.visitTransition(e,t);r+=c.queryCount,a+=c.depCount,o.push(c)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")})),{type:7,name:e.name,states:i,transitions:o,queryCount:r,depCount:a,options:null}}},{key:"visitState",value:function(e,t){var n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){var a=new Set,i=r||{};if(n.styles.forEach((function(e){if(TM(e)){var t=e;Object.keys(t).forEach((function(e){lM(t[e]).forEach((function(e){i.hasOwnProperty(e)||a.add(e)}))}))}})),a.size){var o=fM(a.values());t.errors.push('state("'.concat(e.name,'", ...) must define default values for all the following style substitutions: ').concat(o.join(", ")))}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}},{key:"visitTransition",value:function(e,t){t.queryCount=0,t.depCount=0;var n,r,a,i=gM(this,uM(e.animation),t);return{type:1,matchers:(n=e.expr,r=t.errors,a=[],"string"==typeof n?n.split(/\s*,\s*/).forEach((function(e){return function(e,t,n){if(":"==e[0]){var r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return function(e,t){return parseFloat(t)>parseFloat(e)};case":decrement":return function(e,t){return parseFloat(t)<parseFloat(e)};default:return t.push('The transition alias value "'.concat(e,'" is not supported')),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}var a=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==a||a.length<4)return n.push('The provided transition expression "'.concat(e,'" is not supported')),t;var i=a[1],o=a[2],s=a[3];t.push(_M(i,s)),"<"!=o[0]||"*"==i&&"*"==s||t.push(_M(s,i))}(e,a,r)})):a.push(n),a),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:EM(e.options)}}},{key:"visitSequence",value:function(e,t){var n=this;return{type:2,steps:e.steps.map((function(e){return gM(n,e,t)})),options:EM(e.options)}}},{key:"visitGroup",value:function(e,t){var n=this,r=t.currentTime,a=0,i=e.steps.map((function(e){t.currentTime=r;var i=gM(n,e,t);return a=Math.max(a,t.currentTime),i}));return t.currentTime=a,{type:3,steps:i,options:EM(e.options)}}},{key:"visitAnimate",value:function(e,t){var n,r=function(e,t){var n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return AM(tM(e,t).duration,0,"");var r=e;if(r.split(/\s+/).some((function(e){return"{"==e.charAt(0)&&"{"==e.charAt(1)}))){var a=AM(0,0,"");return a.dynamic=!0,a.strValue=r,a}return AM((n=n||tM(r,t)).duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=r;var a=e.styles?e.styles:EF({});if(5==a.type)n=this.visitKeyframes(a,t);else{var i=e.styles,o=!1;if(!i){o=!0;var s={};r.easing&&(s.easing=r.easing),i=EF(s)}t.currentTime+=r.duration+r.delay;var u=this.visitStyle(i,t);u.isEmptyStep=o,n=u}return t.currentAnimateTimings=null,{type:4,timings:r,style:n,options:null}}},{key:"visitStyle",value:function(e,t){var n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}},{key:"_makeStyleAst",value:function(e,t){var n=[];Array.isArray(e.styles)?e.styles.forEach((function(e){"string"==typeof e?"*"==e?n.push(e):t.errors.push("The provided style string value ".concat(e," is not allowed.")):n.push(e)})):n.push(e.styles);var r=!1,a=null;return n.forEach((function(e){if(TM(e)){var t=e,n=t.easing;if(n&&(a=n,delete t.easing),!r)for(var i in t)if(t[i].toString().indexOf("{{")>=0){r=!0;break}}})),{type:6,styles:n,easing:a,offset:e.offset,containsDynamicStyles:r,options:null}}},{key:"_validateStyleAst",value:function(e,t){var n=this,r=t.currentAnimateTimings,a=t.currentTime,i=t.currentTime;r&&i>0&&(i-=r.duration+r.delay),e.styles.forEach((function(e){"string"!=typeof e&&Object.keys(e).forEach((function(r){if(n._driver.validateStyleProperty(r)){var o,s,u,c,l,h=t.collectedStyles[t.currentQuerySelector],f=h[r],d=!0;f&&(i!=a&&i>=f.startTime&&a<=f.endTime&&(t.errors.push('The CSS property "'.concat(r,'" that exists between the times of "').concat(f.startTime,'ms" and "').concat(f.endTime,'ms" is also being animated in a parallel animation between the times of "').concat(i,'ms" and "').concat(a,'ms"')),d=!1),i=f.startTime),d&&(h[r]={startTime:i,endTime:a}),t.options&&(o=e[r],s=t.options,u=t.errors,c=s.params||{},(l=lM(o)).length&&l.forEach((function(e){c.hasOwnProperty(e)||u.push("Unable to resolve the local animation param ".concat(e," in the given list of values"))})))}else t.errors.push('The provided animation property "'.concat(r,'" is not a supported CSS property for animations'))}))}))}},{key:"visitKeyframes",value:function(e,t){var n=this,r={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),r;var a=0,i=[],o=!1,s=!1,u=0,c=e.steps.map((function(e){var r=n._makeStyleAst(e,t),c=null!=r.offset?r.offset:function(e){if("string"==typeof e)return null;var t=null;if(Array.isArray(e))e.forEach((function(e){if(TM(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}}));else if(TM(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}return t}(r.styles),l=0;return null!=c&&(a++,l=r.offset=c),s=s||l<0||l>1,o=o||l<u,u=l,i.push(l),r}));s&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),o&&t.errors.push("Please ensure that all keyframe offsets are in order");var l=e.steps.length,h=0;a>0&&a<l?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==a&&(h=1/(l-1));var f=l-1,d=t.currentTime,p=t.currentAnimateTimings,v=p.duration;return c.forEach((function(e,a){var o=h>0?a==f?1:h*a:i[a],s=o*v;t.currentTime=d+p.delay+s,p.duration=s,n._validateStyleAst(e,t),e.offset=o,r.styles.push(e)})),r}},{key:"visitReference",value:function(e,t){return{type:8,animation:gM(this,uM(e.animation),t),options:EM(e.options)}}},{key:"visitAnimateChild",value:function(e,t){return t.depCount++,{type:9,options:EM(e.options)}}},{key:"visitAnimateRef",value:function(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:EM(e.options)}}},{key:"visitQuery",value:function(e,t){var n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;var a=_slicedToArray(function(e){var t=!!e.split(/\s*,\s*/).find((function(e){return":self"==e}));return t&&(e=e.replace(wM,"")),[e=e.replace(/@\*/g,".ng-trigger").replace(/@\w+/g,(function(e){return".ng-trigger-"+e.substr(1)})).replace(/:animating/g,".ng-animating"),t]}(e.selector),2),i=a[0],o=a[1];t.currentQuerySelector=n.length?n+" "+i:i,PF(t.collectedStyles,t.currentQuerySelector,{});var s=gM(this,uM(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:s,originalSelector:e.selector,options:EM(e.options)}}},{key:"visitStagger",value:function(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");var n="full"===e.timings?{duration:0,delay:0,easing:"full"}:tM(e.timings,t.errors,!0);return{type:12,animation:gM(this,uM(e.animation),t),timings:n,options:null}}}]),e}(),SM=function e(t){_classCallCheck(this,e),this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null};function TM(e){return!Array.isArray(e)&&"object"==typeof e}function EM(e){var t;return e?(e=nM(e)).params&&(e.params=(t=e.params)?nM(t):null):e={},e}function AM(e,t,n){return{duration:e,delay:t,easing:n}}function IM(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:a,delay:i,totalTime:a+i,easing:o,subTimeline:s}}var RM=function(){function e(){_classCallCheck(this,e),this._map=new Map}return _createClass(e,[{key:"consume",value:function(e){var t=this._map.get(e);return t?this._map.delete(e):t=[],t}},{key:"append",value:function(e,t){var n,r=this._map.get(e);r||this._map.set(e,r=[]),(n=r).push.apply(n,_toConsumableArray(t))}},{key:"has",value:function(e){return this._map.has(e)}},{key:"clear",value:function(){this._map.clear()}}]),e}(),NM=new RegExp(":enter","g"),OM=new RegExp(":leave","g");function DM(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];return(new FM).buildKeyframes(e,t,n,r,a,i,o,s,u,c)}var FM=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"buildKeyframes",value:function(e,t,n,r,a,i,o,s,u){var c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];u=u||new RM;var l=new LM(e,t,u,r,a,c,[]);l.options=s,l.currentTimeline.setStyles([i],null,l.errors,s),gM(this,n,l);var h=l.timelines.filter((function(e){return e.containsAnimation()}));if(h.length&&Object.keys(o).length){var f=h[h.length-1];f.allowOnlyTimelineStyles()||f.setStyles([o],null,l.errors,s)}return h.length?h.map((function(e){return e.buildKeyframes()})):[IM(t,[],[],[],0,0,"",!1)]}},{key:"visitTrigger",value:function(e,t){}},{key:"visitState",value:function(e,t){}},{key:"visitTransition",value:function(e,t){}},{key:"visitAnimateChild",value:function(e,t){var n=t.subInstructions.consume(t.element);if(n){var r=t.createSubContext(e.options),a=t.currentTimeline.currentTime,i=this._visitSubInstructions(n,r,r.options);a!=i&&t.transformIntoNewTimeline(i)}t.previousNode=e}},{key:"visitAnimateRef",value:function(e,t){var n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}},{key:"_visitSubInstructions",value:function(e,t,n){var r=t.currentTimeline.currentTime,a=null!=n.duration?JF(n.duration):null,i=null!=n.delay?JF(n.delay):null;return 0!==a&&e.forEach((function(e){var n=t.appendInstructionToTimeline(e,a,i);r=Math.max(r,n.duration+n.delay)})),r}},{key:"visitReference",value:function(e,t){t.updateOptions(e.options,!0),gM(this,e.animation,t),t.previousNode=e}},{key:"visitSequence",value:function(e,t){var n=this,r=t.subContextCount,a=t,i=e.options;if(i&&(i.params||i.delay)&&((a=t.createSubContext(i)).transformIntoNewTimeline(),null!=i.delay)){6==a.previousNode.type&&(a.currentTimeline.snapshotCurrentStyles(),a.previousNode=MM);var o=JF(i.delay);a.delayNextStep(o)}e.steps.length&&(e.steps.forEach((function(e){return gM(n,e,a)})),a.currentTimeline.applyStylesToKeyframe(),a.subContextCount>r&&a.transformIntoNewTimeline()),t.previousNode=e}},{key:"visitGroup",value:function(e,t){var n=this,r=[],a=t.currentTimeline.currentTime,i=e.options&&e.options.delay?JF(e.options.delay):0;e.steps.forEach((function(o){var s=t.createSubContext(e.options);i&&s.delayNextStep(i),gM(n,o,s),a=Math.max(a,s.currentTimeline.currentTime),r.push(s.currentTimeline)})),r.forEach((function(e){return t.currentTimeline.mergeTimelineCollectedStyles(e)})),t.transformIntoNewTimeline(a),t.previousNode=e}},{key:"_visitTiming",value:function(e,t){if(e.dynamic){var n=e.strValue;return tM(t.params?hM(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}},{key:"visitAnimate",value:function(e,t){var n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());var a=e.style;5==a.type?this.visitKeyframes(a,t):(t.incrementTime(n.duration),this.visitStyle(a,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}},{key:"visitStyle",value:function(e,t){var n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();var a=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(a):n.setStyles(e.styles,a,t.errors,t.options),t.previousNode=e}},{key:"visitKeyframes",value:function(e,t){var n=t.currentAnimateTimings,r=t.currentTimeline.duration,a=n.duration,i=t.createSubContext().currentTimeline;i.easing=n.easing,e.styles.forEach((function(e){i.forwardTime((e.offset||0)*a),i.setStyles(e.styles,e.easing,t.errors,t.options),i.applyStylesToKeyframe()})),t.currentTimeline.mergeTimelineCollectedStyles(i),t.transformIntoNewTimeline(r+a),t.previousNode=e}},{key:"visitQuery",value:function(e,t){var n=this,r=t.currentTimeline.currentTime,a=e.options||{},i=a.delay?JF(a.delay):0;i&&(6===t.previousNode.type||0==r&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=MM);var o=r,s=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!a.optional,t.errors);t.currentQueryTotal=s.length;var u=null;s.forEach((function(r,a){t.currentQueryIndex=a;var s=t.createSubContext(e.options,r);i&&s.delayNextStep(i),r===t.element&&(u=s.currentTimeline),gM(n,e.animation,s),s.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,s.currentTimeline.currentTime)})),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}},{key:"visitStagger",value:function(e,t){var n=t.parentContext,r=t.currentTimeline,a=e.timings,i=Math.abs(a.duration),o=i*(t.currentQueryTotal-1),s=i*t.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":s=o-s;break;case"full":s=n.currentStaggerTime}var u=t.currentTimeline;s&&u.delayNextStep(s);var c=u.currentTime;gM(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}]),e}(),MM={},LM=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck(this,e),this._driver=t,this.element=n,this.subInstructions=r,this._enterClassName=a,this._leaveClassName=i,this.errors=o,this.timelines=s,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=MM,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new PM(this._driver,n,0),s.push(this.currentTimeline)}return _createClass(e,[{key:"updateOptions",value:function(e,t){var n=this;if(e){var r=e,a=this.options;null!=r.duration&&(a.duration=JF(r.duration)),null!=r.delay&&(a.delay=JF(r.delay));var i=r.params;if(i){var o=a.params;o||(o=this.options.params={}),Object.keys(i).forEach((function(e){t&&o.hasOwnProperty(e)||(o[e]=hM(i[e],o,n.errors))}))}}}},{key:"_copyOptions",value:function(){var e={};if(this.options){var t=this.options.params;if(t){var n=e.params={};Object.keys(t).forEach((function(e){n[e]=t[e]}))}}return e}},{key:"createSubContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=n||this.element,i=new e(this._driver,a,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(a,r||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(t),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}},{key:"transformIntoNewTimeline",value:function(e){return this.previousNode=MM,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}},{key:"appendInstructionToTimeline",value:function(e,t,n){var r={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=n?n:0)+e.delay,easing:""},a=new zM(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(a),r}},{key:"incrementTime",value:function(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}},{key:"delayNextStep",value:function(e){e>0&&this.currentTimeline.delayNextStep(e)}},{key:"invokeQuery",value:function(e,t,n,r,a,i){var o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(NM,"."+this._enterClassName)).replace(OM,"."+this._leaveClassName);var s=this._driver.query(this.element,e,1!=n);0!==n&&(s=n<0?s.slice(s.length+n,s.length):s.slice(0,n)),o.push.apply(o,_toConsumableArray(s))}return a||0!=o.length||i.push('`query("'.concat(t,'")` returned zero elements. (Use `query("').concat(t,'", { optional: true })` if you wish to allow this.)')),o}},{key:"params",get:function(){return this.options.params}}]),e}(),PM=function(){function e(t,n,r,a){_classCallCheck(this,e),this._driver=t,this.element=n,this.startTime=r,this._elementTimelineStylesLookup=a,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}return _createClass(e,[{key:"containsAnimation",value:function(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}},{key:"getCurrentStyleProperties",value:function(){return Object.keys(this._currentKeyframe)}},{key:"delayNextStep",value:function(e){var t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}},{key:"fork",value:function(t,n){return this.applyStylesToKeyframe(),new e(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}},{key:"_loadKeyframe",value:function(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}},{key:"forwardFrame",value:function(){this.duration+=1,this._loadKeyframe()}},{key:"forwardTime",value:function(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}},{key:"_updateStyle",value:function(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}},{key:"allowOnlyTimelineStyles",value:function(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}},{key:"applyEmptyStep",value:function(e){var t=this;e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach((function(e){t._backFill[e]=t._globalTimelineStyles[e]||"*",t._currentKeyframe[e]="*"})),this._currentEmptyStepKeyframe=this._currentKeyframe}},{key:"setStyles",value:function(e,t,n,r){var a=this;t&&(this._previousKeyframe.easing=t);var i=r&&r.params||{},o=function(e,t){var n,r={};return e.forEach((function(e){"*"===e?(n=n||Object.keys(t)).forEach((function(e){r[e]="*"})):rM(e,!1,r)})),r}(e,this._globalTimelineStyles);Object.keys(o).forEach((function(e){var t=hM(o[e],i,n);a._pendingStyles[e]=t,a._localTimelineStyles.hasOwnProperty(e)||(a._backFill[e]=a._globalTimelineStyles.hasOwnProperty(e)?a._globalTimelineStyles[e]:"*"),a._updateStyle(e,t)}))}},{key:"applyStylesToKeyframe",value:function(){var e=this,t=this._pendingStyles,n=Object.keys(t);0!=n.length&&(this._pendingStyles={},n.forEach((function(n){e._currentKeyframe[n]=t[n]})),Object.keys(this._localTimelineStyles).forEach((function(t){e._currentKeyframe.hasOwnProperty(t)||(e._currentKeyframe[t]=e._localTimelineStyles[t])})))}},{key:"snapshotCurrentStyles",value:function(){var e=this;Object.keys(this._localTimelineStyles).forEach((function(t){var n=e._localTimelineStyles[t];e._pendingStyles[t]=n,e._updateStyle(t,n)}))}},{key:"getFinalKeyframe",value:function(){return this._keyframes.get(this.duration)}},{key:"mergeTimelineCollectedStyles",value:function(e){var t=this;Object.keys(e._styleSummary).forEach((function(n){var r=t._styleSummary[n],a=e._styleSummary[n];(!r||a.time>r.time)&&t._updateStyle(n,a.value)}))}},{key:"buildKeyframes",value:function(){var e=this;this.applyStylesToKeyframe();var t=new Set,n=new Set,r=1===this._keyframes.size&&0===this.duration,a=[];this._keyframes.forEach((function(i,o){var s=rM(i,!0);Object.keys(s).forEach((function(e){var r=s[e];"!"==r?t.add(e):"*"==r&&n.add(e)})),r||(s.offset=o/e.duration),a.push(s)}));var i=t.size?fM(t.values()):[],o=n.size?fM(n.values()):[];if(r){var s=a[0],u=nM(s);s.offset=0,u.offset=1,a=[s,u]}return IM(this.element,a,i,o,this.duration,this.startTime,this.easing,!1)}},{key:"currentTime",get:function(){return this.startTime+this.duration}},{key:"properties",get:function(){var e=[];for(var t in this._currentKeyframe)e.push(t);return e}}]),e}(),zM=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return _classCallCheck(this,n),(u=t.call(this,e,r,s.delay)).element=r,u.keyframes=a,u.preStyleProps=i,u.postStyleProps=o,u._stretchStartingKeyframe=c,u.timings={duration:s.duration,delay:s.delay,easing:s.easing},u}return _createClass(n,[{key:"containsAnimation",value:function(){return this.keyframes.length>1}},{key:"buildKeyframes",value:function(){var e=this.keyframes,t=this.timings,n=t.delay,r=t.duration,a=t.easing;if(this._stretchStartingKeyframe&&n){var i=[],o=r+n,s=n/o,u=rM(e[0],!1);u.offset=0,i.push(u);var c=rM(e[0],!1);c.offset=BM(s),i.push(c);for(var l=e.length-1,h=1;h<=l;h++){var f=rM(e[h],!1);f.offset=BM((n+f.offset*r)/o),i.push(f)}r=o,n=0,a="",e=i}return IM(this.element,e,this.preStyleProps,this.postStyleProps,r,n,a,!0)}}]),n}(PM);function BM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t-1);return Math.round(e*n)/n}var UM=function e(){_classCallCheck(this,e)},WM=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"normalizePropertyName",value:function(e,t){return pM(e)}},{key:"normalizeStyleValue",value:function(e,t,n,r){var a="",i=n.toString().trim();if(VM[t]&&0!==n&&"0"!==n)if("number"==typeof n)a="px";else{var o=n.match(/^[+-]?[\d\.]+([a-z]*)$/);o&&0==o[1].length&&r.push("Please provide a CSS unit value for ".concat(e,":").concat(n))}return i+a}}]),n}(UM),VM=function(e){var t={};return e.forEach((function(e){return t[e]=!0})),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(","));function jM(e,t,n,r,a,i,o,s,u,c,l,h,f){return{type:0,element:e,triggerName:t,isRemovalTransition:a,fromState:n,fromStyles:i,toState:r,toStyles:o,timelines:s,queriedElements:u,preStyleProps:c,postStyleProps:l,totalTime:h,errors:f}}var HM={},qM=function(){function e(t,n,r){_classCallCheck(this,e),this._triggerName=t,this.ast=n,this._stateStyles=r}return _createClass(e,[{key:"match",value:function(e,t,n,r){return function(e,t,n,r,a){return e.some((function(e){return e(t,n,r,a)}))}(this.ast.matchers,e,t,n,r)}},{key:"buildStyles",value:function(e,t,n){var r=this._stateStyles["*"],a=this._stateStyles[e],i=r?r.buildStyles(t,n):{};return a?a.buildStyles(t,n):i}},{key:"build",value:function(e,t,n,r,a,i,o,s,u,c){var l=[],h=this.ast.options&&this.ast.options.params||HM,f=this.buildStyles(n,o&&o.params||HM,l),d=s&&s.params||HM,p=this.buildStyles(r,d,l),v=new Set,m=new Map,g=new Map,y="void"===r,b={params:Object.assign(Object.assign({},h),d)},k=c?[]:DM(e,t,this.ast.animation,a,i,f,p,b,u,l),_=0;if(k.forEach((function(e){_=Math.max(e.duration+e.delay,_)})),l.length)return jM(t,this._triggerName,n,r,y,f,p,[],[],m,g,_,l);k.forEach((function(e){var n=e.element,r=PF(m,n,{});e.preStyleProps.forEach((function(e){return r[e]=!0}));var a=PF(g,n,{});e.postStyleProps.forEach((function(e){return a[e]=!0})),n!==t&&v.add(n)}));var w=fM(v.values());return jM(t,this._triggerName,n,r,y,f,p,k,w,m,g,_)}}]),e}(),GM=function(){function e(t,n){_classCallCheck(this,e),this.styles=t,this.defaultParams=n}return _createClass(e,[{key:"buildStyles",value:function(e,t){var n={},r=nM(this.defaultParams);return Object.keys(e).forEach((function(t){var n=e[t];null!=n&&(r[t]=n)})),this.styles.styles.forEach((function(e){if("string"!=typeof e){var a=e;Object.keys(a).forEach((function(e){var i=a[e];i.length>1&&(i=hM(i,r,t)),n[e]=i}))}})),n}}]),e}(),KM=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.name=t,this.ast=n,this.transitionFactories=[],this.states={},n.states.forEach((function(e){r.states[e.name]=new GM(e.style,e.options&&e.options.params||{})})),XM(this.states,"true","1"),XM(this.states,"false","0"),n.transitions.forEach((function(e){r.transitionFactories.push(new qM(t,e,r.states))})),this.fallbackTransition=new qM(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[function(e,t){return!0}],options:null,queryCount:0,depCount:0},this.states)}return _createClass(e,[{key:"matchTransition",value:function(e,t,n,r){return this.transitionFactories.find((function(a){return a.match(e,t,n,r)}))||null}},{key:"matchStyles",value:function(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}},{key:"containsQueries",get:function(){return this.ast.queryCount>0}}]),e}();function XM(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}var YM=new RM,QM=function(){function e(t,n,r){_classCallCheck(this,e),this.bodyNode=t,this._driver=n,this._normalizer=r,this._animations={},this._playersById={},this.players=[]}return _createClass(e,[{key:"register",value:function(e,t){var n=[],r=xM(this._driver,t,n);if(n.length)throw new Error("Unable to build the animation due to the following errors: ".concat(n.join("\n")));this._animations[e]=r}},{key:"_buildPlayer",value:function(e,t,n){var r=e.element,a=DF(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,a,e.duration,e.delay,e.easing,[],!0)}},{key:"create",value:function(e,t){var n,r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[],o=this._animations[e],s=new Map;if(o?(n=DM(this._driver,t,o,"ng-enter","ng-leave",{},{},a,YM,i)).forEach((function(e){var t=PF(s,e.element,{});e.postStyleProps.forEach((function(e){return t[e]=null}))})):(i.push("The requested animation doesn't exist or has already been destroyed"),n=[]),i.length)throw new Error("Unable to create the animation due to the following errors: ".concat(i.join("\n")));s.forEach((function(e,t){Object.keys(e).forEach((function(n){e[n]=r._driver.computeStyle(t,n,"*")}))}));var u=OF(n.map((function(e){var t=s.get(e.element);return r._buildPlayer(e,{},t)})));return this._playersById[e]=u,u.onDestroy((function(){return r.destroy(e)})),this.players.push(u),u}},{key:"destroy",value:function(e){var t=this._getPlayer(e);t.destroy(),delete this._playersById[e];var n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}},{key:"_getPlayer",value:function(e){var t=this._playersById[e];if(!t)throw new Error("Unable to find the timeline player referenced by ".concat(e));return t}},{key:"listen",value:function(e,t,n,r){var a=LF(t,"","","");return FF(this._getPlayer(e),n,a,r),function(){}}},{key:"command",value:function(e,t,n,r){if("register"!=n)if("create"!=n){var a=this._getPlayer(e);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}else this.create(e,t,r[0]||{});else this.register(e,r[0])}}]),e}(),ZM=[],$M={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},JM={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},eL=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,e),this.namespaceId=n;var r,a=t&&t.hasOwnProperty("value");if(this.value=null!=(r=a?t.value:t)?r:null,a){var i=nM(t);delete i.value,this.options=i}else this.options={};this.options.params||(this.options.params={})}return _createClass(e,[{key:"absorbOptions",value:function(e){var t=e.params;if(t){var n=this.options.params;Object.keys(t).forEach((function(e){null==n[e]&&(n[e]=t[e])}))}}},{key:"params",get:function(){return this.options.params}}]),e}(),tL=new eL("void"),nL=function(){function e(t,n,r){_classCallCheck(this,e),this.id=t,this.hostElement=n,this._engine=r,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,cL(n,this._hostClassName)}return _createClass(e,[{key:"listen",value:function(e,t,n,r){var a,i=this;if(!this._triggers.hasOwnProperty(t))throw new Error('Unable to listen on the animation trigger event "'.concat(n,'" because the animation trigger "').concat(t,"\" doesn't exist!"));if(null==n||0==n.length)throw new Error('Unable to listen on the animation trigger "'.concat(t,'" because the provided event is undefined!'));if("start"!=(a=n)&&"done"!=a)throw new Error('The provided animation trigger event "'.concat(n,'" for the animation trigger "').concat(t,'" is not supported!'));var o=PF(this._elementListeners,e,[]),s={name:t,phase:n,callback:r};o.push(s);var u=PF(this._engine.statesByElement,e,{});return u.hasOwnProperty(t)||(cL(e,"ng-trigger"),cL(e,"ng-trigger-"+t),u[t]=tL),function(){i._engine.afterFlush((function(){var e=o.indexOf(s);e>=0&&o.splice(e,1),i._triggers[t]||delete u[t]}))}}},{key:"register",value:function(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}},{key:"_getTrigger",value:function(e){var t=this._triggers[e];if(!t)throw new Error('The provided animation trigger "'.concat(e,'" has not been registered!'));return t}},{key:"trigger",value:function(e,t,n){var r=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this._getTrigger(t),o=new aL(this.id,t,e),s=this._engine.statesByElement.get(e);s||(cL(e,"ng-trigger"),cL(e,"ng-trigger-"+t),this._engine.statesByElement.set(e,s={}));var u=s[t],c=new eL(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),s[t]=c,u||(u=tL),"void"===c.value||u.value!==c.value){var l=PF(this._engine.playersByElement,e,[]);l.forEach((function(e){e.namespaceId==r.id&&e.triggerName==t&&e.queued&&e.destroy()}));var h=i.matchTransition(u.value,c.value,e,c.params),f=!1;if(!h){if(!a)return;h=i.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:h,fromState:u,toState:c,player:o,isFallbackTransition:f}),f||(cL(e,"ng-animate-queued"),o.onStart((function(){lL(e,"ng-animate-queued")}))),o.onDone((function(){var t=r.players.indexOf(o);t>=0&&r.players.splice(t,1);var n=r._engine.playersByElement.get(e);if(n){var a=n.indexOf(o);a>=0&&n.splice(a,1)}})),this.players.push(o),l.push(o),o}if(!function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var a=0;a<n.length;a++){var i=n[a];if(!t.hasOwnProperty(i)||e[i]!==t[i])return!1}return!0}(u.params,c.params)){var d=[],p=i.matchStyles(u.value,u.params,d),v=i.matchStyles(c.value,c.params,d);d.length?this._engine.reportError(d):this._engine.afterFlush((function(){sM(e,p),oM(e,v)}))}}},{key:"deregister",value:function(e){var t=this;delete this._triggers[e],this._engine.statesByElement.forEach((function(t,n){delete t[e]})),this._elementListeners.forEach((function(n,r){t._elementListeners.set(r,n.filter((function(t){return t.name!=e})))}))}},{key:"clearElementCache",value:function(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);var t=this._engine.playersByElement.get(e);t&&(t.forEach((function(e){return e.destroy()})),this._engine.playersByElement.delete(e))}},{key:"_signalRemovalForInnerTriggers",value:function(e,t){var n=this,r=this._engine.driver.query(e,".ng-trigger",!0);r.forEach((function(e){if(!e.__ng_removed){var r=n._engine.fetchNamespacesByElement(e);r.size?r.forEach((function(n){return n.triggerLeaveAnimation(e,t,!1,!0)})):n.clearElementCache(e)}})),this._engine.afterFlushAnimationsDone((function(){return r.forEach((function(e){return n.clearElementCache(e)}))}))}},{key:"triggerLeaveAnimation",value:function(e,t,n,r){var a=this,i=this._engine.statesByElement.get(e);if(i){var o=[];if(Object.keys(i).forEach((function(t){if(a._triggers[t]){var n=a.trigger(e,t,"void",r);n&&o.push(n)}})),o.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&OF(o).onDone((function(){return a._engine.processLeaveNode(e)})),!0}return!1}},{key:"prepareLeaveAnimationListeners",value:function(e){var t=this,n=this._elementListeners.get(e);if(n){var r=new Set;n.forEach((function(n){var a=n.name;if(!r.has(a)){r.add(a);var i=t._triggers[a].fallbackTransition,o=t._engine.statesByElement.get(e)[a]||tL,s=new eL("void"),u=new aL(t.id,a,e);t._engine.totalQueuedPlayers++,t._queue.push({element:e,triggerName:a,transition:i,fromState:o,toState:s,player:u,isFallbackTransition:!0})}}))}}},{key:"removeNode",value:function(e,t){var n=this,r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),!this.triggerLeaveAnimation(e,t,!0)){var a=!1;if(r.totalAnimations){var i=r.players.length?r.playersByQueriedElement.get(e):[];if(i&&i.length)a=!0;else for(var o=e;o=o.parentNode;)if(r.statesByElement.get(o)){a=!0;break}}if(this.prepareLeaveAnimationListeners(e),a)r.markElementAsRemoved(this.id,e,!1,t);else{var s=e.__ng_removed;s&&s!==$M||(r.afterFlush((function(){return n.clearElementCache(e)})),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}}},{key:"insertNode",value:function(e,t){cL(e,this._hostClassName)}},{key:"drainQueuedTransitions",value:function(e){var t=this,n=[];return this._queue.forEach((function(r){var a=r.player;if(!a.destroyed){var i=r.element,o=t._elementListeners.get(i);o&&o.forEach((function(t){if(t.name==r.triggerName){var n=LF(i,r.triggerName,r.fromState.value,r.toState.value);n._data=e,FF(r.player,t.phase,n,t.callback)}})),a.markedForDestroy?t._engine.afterFlush((function(){a.destroy()})):n.push(r)}})),this._queue=[],n.sort((function(e,n){var r=e.transition.ast.depCount,a=n.transition.ast.depCount;return 0==r||0==a?r-a:t._engine.driver.containsElement(e.element,n.element)?1:-1}))}},{key:"destroy",value:function(e){this.players.forEach((function(e){return e.destroy()})),this._signalRemovalForInnerTriggers(this.hostElement,e)}},{key:"elementContainsData",value:function(e){var t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find((function(t){return t.element===e}))||t}}]),e}(),rL=function(){function e(t,n,r){_classCallCheck(this,e),this.bodyNode=t,this.driver=n,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=function(e,t){}}return _createClass(e,[{key:"_onRemovalComplete",value:function(e,t){this.onRemovalComplete(e,t)}},{key:"createNamespace",value:function(e,t){var n=new nL(e,t,this);return t.parentNode?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}},{key:"_balanceNamespaceList",value:function(e,t){var n=this._namespaceList.length-1;if(n>=0){for(var r=!1,a=n;a>=0;a--)if(this.driver.containsElement(this._namespaceList[a].hostElement,t)){this._namespaceList.splice(a+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}},{key:"register",value:function(e,t){var n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}},{key:"registerTrigger",value:function(e,t,n){var r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}},{key:"destroy",value:function(e,t){var n=this;if(e){var r=this._fetchNamespace(e);this.afterFlush((function(){n.namespacesByHostElement.delete(r.hostElement),delete n._namespaceLookup[e];var t=n._namespaceList.indexOf(r);t>=0&&n._namespaceList.splice(t,1)})),this.afterFlushAnimationsDone((function(){return r.destroy(t)}))}}},{key:"_fetchNamespace",value:function(e){return this._namespaceLookup[e]}},{key:"fetchNamespacesByElement",value:function(e){var t=new Set,n=this.statesByElement.get(e);if(n)for(var r=Object.keys(n),a=0;a<r.length;a++){var i=n[r[a]].namespaceId;if(i){var o=this._fetchNamespace(i);o&&t.add(o)}}return t}},{key:"trigger",value:function(e,t,n,r){if(iL(t)){var a=this._fetchNamespace(e);if(a)return a.trigger(t,n,r),!0}return!1}},{key:"insertNode",value:function(e,t,n,r){if(iL(t)){var a=t.__ng_removed;if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;var i=this.collectedLeaveElements.indexOf(t);i>=0&&this.collectedLeaveElements.splice(i,1)}if(e){var o=this._fetchNamespace(e);o&&o.insertNode(t,n)}r&&this.collectEnterElement(t)}}},{key:"collectEnterElement",value:function(e){this.collectedEnterElements.push(e)}},{key:"markElementAsDisabled",value:function(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),cL(e,"ng-animate-disabled")):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),lL(e,"ng-animate-disabled"))}},{key:"removeNode",value:function(e,t,n,r){if(iL(t)){var a=e?this._fetchNamespace(e):null;if(a?a.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){var i=this.namespacesByHostElement.get(t);i&&i.id!==e&&i.removeNode(t,r)}}else this._onRemovalComplete(t,r)}},{key:"markElementAsRemoved",value:function(e,t,n,r){this.collectedLeaveElements.push(t),t.__ng_removed={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}},{key:"listen",value:function(e,t,n,r,a){return iL(t)?this._fetchNamespace(e).listen(t,n,r,a):function(){}}},{key:"_buildInstruction",value:function(e,t,n,r,a){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,a)}},{key:"destroyInnerAnimations",value:function(e){var t=this,n=this.driver.query(e,".ng-trigger",!0);n.forEach((function(e){return t.destroyActiveAnimationsForElement(e)})),0!=this.playersByQueriedElement.size&&(n=this.driver.query(e,".ng-animating",!0)).forEach((function(e){return t.finishActiveQueriedAnimationOnElement(e)}))}},{key:"destroyActiveAnimationsForElement",value:function(e){var t=this.playersByElement.get(e);t&&t.forEach((function(e){e.queued?e.markedForDestroy=!0:e.destroy()}))}},{key:"finishActiveQueriedAnimationOnElement",value:function(e){var t=this.playersByQueriedElement.get(e);t&&t.forEach((function(e){return e.finish()}))}},{key:"whenRenderingDone",value:function(){var e=this;return new Promise((function(t){if(e.players.length)return OF(e.players).onDone((function(){return t()}));t()}))}},{key:"processLeaveNode",value:function(e){var t=this,n=e.__ng_removed;if(n&&n.setForRemoval){if(e.__ng_removed=$M,n.namespaceId){this.destroyInnerAnimations(e);var r=this._fetchNamespace(n.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,n.setForRemoval)}this.driver.matchesElement(e,".ng-animate-disabled")&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach((function(e){t.markElementAsDisabled(e,!1)}))}},{key:"flush",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((function(t,n){return e._balanceNamespaceList(t,n)})),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(var r=0;r<this.collectedEnterElements.length;r++)cL(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){var a=[];try{n=this._flushAnimations(a,t)}finally{for(var i=0;i<a.length;i++)a[i]()}}else for(var o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach((function(e){return e()})),this._flushFns=[],this._whenQuietFns.length){var s=this._whenQuietFns;this._whenQuietFns=[],n.length?OF(n).onDone((function(){s.forEach((function(e){return e()}))})):s.forEach((function(e){return e()}))}}},{key:"reportError",value:function(e){throw new Error("Unable to process animations due to the following failed trigger transitions\n ".concat(e.join("\n")))}},{key:"_flushAnimations",value:function(e,t){var n=this,r=new RM,a=[],i=new Map,o=[],s=new Map,u=new Map,c=new Map,l=new Set;this.disabledNodes.forEach((function(e){l.add(e);for(var t=n.driver.query(e,".ng-animate-queued",!0),r=0;r<t.length;r++)l.add(t[r])}));var h=this.bodyNode,f=Array.from(this.statesByElement.keys()),d=uL(f,this.collectedEnterElements),p=new Map,v=0;d.forEach((function(e,t){var n="ng-enter"+v++;p.set(t,n),e.forEach((function(e){return cL(e,n)}))}));for(var m=[],g=new Set,y=new Set,b=0;b<this.collectedLeaveElements.length;b++){var k=this.collectedLeaveElements[b],_=k.__ng_removed;_&&_.setForRemoval&&(m.push(k),g.add(k),_.hasAnimation?this.driver.query(k,".ng-star-inserted",!0).forEach((function(e){return g.add(e)})):y.add(k))}var w=new Map,x=uL(f,Array.from(g));x.forEach((function(e,t){var n="ng-leave"+v++;w.set(t,n),e.forEach((function(e){return cL(e,n)}))})),e.push((function(){d.forEach((function(e,t){var n=p.get(t);e.forEach((function(e){return lL(e,n)}))})),x.forEach((function(e,t){var n=w.get(t);e.forEach((function(e){return lL(e,n)}))})),m.forEach((function(e){n.processLeaveNode(e)}))}));for(var C=[],S=[],T=this._namespaceList.length-1;T>=0;T--)this._namespaceList[T].drainQueuedTransitions(t).forEach((function(e){var t=e.player,i=e.element;if(C.push(t),n.collectedEnterElements.length){var l=i.__ng_removed;if(l&&l.setForMove)return void t.destroy()}var f=!h||!n.driver.containsElement(h,i),d=w.get(i),v=p.get(i),m=n._buildInstruction(e,r,v,d,f);if(!m.errors||!m.errors.length)return f||e.isFallbackTransition?(t.onStart((function(){return sM(i,m.fromStyles)})),t.onDestroy((function(){return oM(i,m.toStyles)})),void a.push(t)):(m.timelines.forEach((function(e){return e.stretchStartingKeyframe=!0})),r.append(i,m.timelines),o.push({instruction:m,player:t,element:i}),m.queriedElements.forEach((function(e){return PF(s,e,[]).push(t)})),m.preStyleProps.forEach((function(e,t){var n=Object.keys(e);if(n.length){var r=u.get(t);r||u.set(t,r=new Set),n.forEach((function(e){return r.add(e)}))}})),void m.postStyleProps.forEach((function(e,t){var n=Object.keys(e),r=c.get(t);r||c.set(t,r=new Set),n.forEach((function(e){return r.add(e)}))})));S.push(m)}));if(S.length){var E=[];S.forEach((function(e){E.push("@".concat(e.triggerName," has failed due to:\n")),e.errors.forEach((function(e){return E.push("- ".concat(e,"\n"))}))})),C.forEach((function(e){return e.destroy()})),this.reportError(E)}var A=new Map,I=new Map;o.forEach((function(e){var t=e.element;r.has(t)&&(I.set(t,t),n._beforeAnimationBuild(e.player.namespaceId,e.instruction,A))})),a.forEach((function(e){var t=e.element;n._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach((function(e){PF(A,t,[]).push(e),e.destroy()}))}));var R=m.filter((function(e){return fL(e,u,c)})),N=new Map;sL(N,this.driver,y,c,"*").forEach((function(e){fL(e,u,c)&&R.push(e)}));var O=new Map;d.forEach((function(e,t){sL(O,n.driver,new Set(e),u,"!")})),R.forEach((function(e){var t=N.get(e),n=O.get(e);N.set(e,Object.assign(Object.assign({},t),n))}));var D=[],F=[],M={};o.forEach((function(e){var t=e.element,o=e.player,s=e.instruction;if(r.has(t)){if(l.has(t))return o.onDestroy((function(){return oM(t,s.toStyles)})),o.disabled=!0,o.overrideTotalTime(s.totalTime),void a.push(o);var u=M;if(I.size>1){for(var c=t,h=[];c=c.parentNode;){var f=I.get(c);if(f){u=f;break}h.push(c)}h.forEach((function(e){return I.set(e,u)}))}var d=n._buildAnimation(o.namespaceId,s,A,i,O,N);if(o.setRealPlayer(d),u===M)D.push(o);else{var p=n.playersByElement.get(u);p&&p.length&&(o.parentPlayer=OF(p)),a.push(o)}}else sM(t,s.fromStyles),o.onDestroy((function(){return oM(t,s.toStyles)})),F.push(o),l.has(t)&&a.push(o)})),F.forEach((function(e){var t=i.get(e.element);if(t&&t.length){var n=OF(t);e.setRealPlayer(n)}})),a.forEach((function(e){e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()}));for(var L=0;L<m.length;L++){var P=m[L],z=P.__ng_removed;if(lL(P,"ng-leave"),!z||!z.hasAnimation){var B=[];if(s.size){var U=s.get(P);U&&U.length&&B.push.apply(B,_toConsumableArray(U));for(var W=this.driver.query(P,".ng-animating",!0),V=0;V<W.length;V++){var j=s.get(W[V]);j&&j.length&&B.push.apply(B,_toConsumableArray(j))}}var H=B.filter((function(e){return!e.destroyed}));H.length?hL(this,P,H):this.processLeaveNode(P)}}return m.length=0,D.forEach((function(e){n.players.push(e),e.onDone((function(){e.destroy();var t=n.players.indexOf(e);n.players.splice(t,1)})),e.play()})),D}},{key:"elementContainsData",value:function(e,t){var n=!1,r=t.__ng_removed;return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}},{key:"afterFlush",value:function(e){this._flushFns.push(e)}},{key:"afterFlushAnimationsDone",value:function(e){this._whenQuietFns.push(e)}},{key:"_getPreviousPlayers",value:function(e,t,n,r,a){var i=[];if(t){var o=this.playersByQueriedElement.get(e);o&&(i=o)}else{var s=this.playersByElement.get(e);if(s){var u=!a||"void"==a;s.forEach((function(e){e.queued||(u||e.triggerName==r)&&i.push(e)}))}}return(n||r)&&(i=i.filter((function(e){return!(n&&n!=e.namespaceId||r&&r!=e.triggerName)}))),i}},{key:"_beforeAnimationBuild",value:function(e,t,n){var r,a=this,i=t.element,o=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName,u=_createForOfIteratorHelper(t.timelines);try{var c=function(){var e=r.value.element,u=e!==i,c=PF(n,e,[]);a._getPreviousPlayers(e,u,o,s,t.toState).forEach((function(e){var t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)}))};for(u.s();!(r=u.n()).done;)c()}catch(az){u.e(az)}finally{u.f()}sM(i,t.fromStyles)}},{key:"_buildAnimation",value:function(e,t,n,r,a,i){var o=this,s=t.triggerName,u=t.element,c=[],l=new Set,h=new Set,f=t.timelines.map((function(t){var f=t.element;l.add(f);var d=f.__ng_removed;if(d&&d.removedBeforeQueried)return new IF(t.duration,t.delay);var p,v,m=f!==u,g=(p=(n.get(f)||ZM).map((function(e){return e.getRealPlayer()})),v=[],function e(t,n){for(var r=0;r<t.length;r++){var a=t[r];a instanceof RF?e(a.players,n):n.push(a)}}(p,v),v).filter((function(e){return!!e.element&&e.element===f})),y=a.get(f),b=i.get(f),k=DF(0,o._normalizer,0,t.keyframes,y,b),_=o._buildPlayer(t,k,g);if(t.subTimeline&&r&&h.add(f),m){var w=new aL(e,s,f);w.setRealPlayer(_),c.push(w)}return _}));c.forEach((function(e){PF(o.playersByQueriedElement,e.element,[]).push(e),e.onDone((function(){return function(e,t,n){var r;if(e instanceof Map){if(r=e.get(t)){if(r.length){var a=r.indexOf(n);r.splice(a,1)}0==r.length&&e.delete(t)}}else if(r=e[t]){if(r.length){var i=r.indexOf(n);r.splice(i,1)}0==r.length&&delete e[t]}return r}(o.playersByQueriedElement,e.element,e)}))})),l.forEach((function(e){return cL(e,"ng-animating")}));var d=OF(f);return d.onDestroy((function(){l.forEach((function(e){return lL(e,"ng-animating")})),oM(u,t.toStyles)})),h.forEach((function(e){PF(r,e,[]).push(d)})),d}},{key:"_buildPlayer",value:function(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new IF(e.duration,e.delay)}},{key:"queuedPlayers",get:function(){var e=[];return this._namespaceList.forEach((function(t){t.players.forEach((function(t){t.queued&&e.push(t)}))})),e}}]),e}(),aL=function(){function e(t,n,r){_classCallCheck(this,e),this.namespaceId=t,this.triggerName=n,this.element=r,this._player=new IF,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}return _createClass(e,[{key:"setRealPlayer",value:function(e){var t=this;this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach((function(n){t._queuedCallbacks[n].forEach((function(t){return FF(e,n,void 0,t)}))})),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}},{key:"getRealPlayer",value:function(){return this._player}},{key:"overrideTotalTime",value:function(e){this.totalTime=e}},{key:"syncPlayerEvents",value:function(e){var t=this,n=this._player;n.triggerCallback&&e.onStart((function(){return n.triggerCallback("start")})),e.onDone((function(){return t.finish()})),e.onDestroy((function(){return t.destroy()}))}},{key:"_queueEvent",value:function(e,t){PF(this._queuedCallbacks,e,[]).push(t)}},{key:"onDone",value:function(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}},{key:"onStart",value:function(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}},{key:"onDestroy",value:function(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}},{key:"init",value:function(){this._player.init()}},{key:"hasStarted",value:function(){return!this.queued&&this._player.hasStarted()}},{key:"play",value:function(){!this.queued&&this._player.play()}},{key:"pause",value:function(){!this.queued&&this._player.pause()}},{key:"restart",value:function(){!this.queued&&this._player.restart()}},{key:"finish",value:function(){this._player.finish()}},{key:"destroy",value:function(){this.destroyed=!0,this._player.destroy()}},{key:"reset",value:function(){!this.queued&&this._player.reset()}},{key:"setPosition",value:function(e){this.queued||this._player.setPosition(e)}},{key:"getPosition",value:function(){return this.queued?0:this._player.getPosition()}},{key:"triggerCallback",value:function(e){var t=this._player;t.triggerCallback&&t.triggerCallback(e)}}]),e}();function iL(e){return e&&1===e.nodeType}function oL(e,t){var n=e.style.display;return e.style.display=null!=t?t:"none",n}function sL(e,t,n,r,a){var i=[];n.forEach((function(e){return i.push(oL(e))}));var o=[];r.forEach((function(n,r){var i={};n.forEach((function(e){var n=i[e]=t.computeStyle(r,e,a);n&&0!=n.length||(r.__ng_removed=JM,o.push(r))})),e.set(r,i)}));var s=0;return n.forEach((function(e){return oL(e,i[s++])})),o}function uL(e,t){var n=new Map;if(e.forEach((function(e){return n.set(e,[])})),0==t.length)return n;var r=new Set(t),a=new Map;return t.forEach((function(e){var t=function e(t){if(!t)return 1;var i=a.get(t);if(i)return i;var o=t.parentNode;return i=n.has(o)?o:r.has(o)?1:e(o),a.set(t,i),i}(e);1!==t&&n.get(t).push(e)})),n}function cL(e,t){if(e.classList)e.classList.add(t);else{var n=e.$$classes;n||(n=e.$$classes={}),n[t]=!0}}function lL(e,t){if(e.classList)e.classList.remove(t);else{var n=e.$$classes;n&&delete n[t]}}function hL(e,t,n){OF(n).onDone((function(){return e.processLeaveNode(t)}))}function fL(e,t,n){var r=n.get(e);if(!r)return!1;var a=t.get(e);return a?r.forEach((function(e){return a.add(e)})):t.set(e,r),n.delete(e),!0}var dL=function(){function e(t,n,r){var a=this;_classCallCheck(this,e),this.bodyNode=t,this._driver=n,this._triggerCache={},this.onRemovalComplete=function(e,t){},this._transitionEngine=new rL(t,n,r),this._timelineEngine=new QM(t,n,r),this._transitionEngine.onRemovalComplete=function(e,t){return a.onRemovalComplete(e,t)}}return _createClass(e,[{key:"registerTrigger",value:function(e,t,n,r,a){var i=e+"-"+r,o=this._triggerCache[i];if(!o){var s=[],u=xM(this._driver,a,s);if(s.length)throw new Error('The animation trigger "'.concat(r,'" has failed to build due to the following errors:\n - ').concat(s.join("\n - ")));o=function(e,t){return new KM(e,t)}(r,u),this._triggerCache[i]=o}this._transitionEngine.registerTrigger(t,r,o)}},{key:"register",value:function(e,t){this._transitionEngine.register(e,t)}},{key:"destroy",value:function(e,t){this._transitionEngine.destroy(e,t)}},{key:"onInsert",value:function(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}},{key:"onRemove",value:function(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}},{key:"disableAnimations",value:function(e,t){this._transitionEngine.markElementAsDisabled(e,t)}},{key:"process",value:function(e,t,n,r){if("@"==n.charAt(0)){var a=_slicedToArray(zF(n),2),i=a[0],o=a[1];this._timelineEngine.command(i,t,o,r)}else this._transitionEngine.trigger(e,t,n,r)}},{key:"listen",value:function(e,t,n,r,a){if("@"==n.charAt(0)){var i=_slicedToArray(zF(n),2),o=i[0],s=i[1];return this._timelineEngine.listen(o,t,s,a)}return this._transitionEngine.listen(e,t,n,r,a)}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._transitionEngine.flush(e)}},{key:"whenRenderingDone",value:function(){return this._transitionEngine.whenRenderingDone()}},{key:"players",get:function(){return this._transitionEngine.players.concat(this._timelineEngine.players)}}]),e}();function pL(e,t){var n=null,r=null;return Array.isArray(t)&&t.length?(n=mL(t[0]),t.length>1&&(r=mL(t[t.length-1]))):t&&(n=mL(t)),n||r?new vL(e,n,r):null}var vL=function(){var e=function(){function e(t,n,r){_classCallCheck(this,e),this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;var a=e.initialStylesByElement.get(t);a||e.initialStylesByElement.set(t,a={}),this._initialStyles=a}return _createClass(e,[{key:"start",value:function(){this._state<1&&(this._startStyles&&oM(this._element,this._startStyles,this._initialStyles),this._state=1)}},{key:"finish",value:function(){this.start(),this._state<2&&(oM(this._element,this._initialStyles),this._endStyles&&(oM(this._element,this._endStyles),this._endStyles=null),this._state=1)}},{key:"destroy",value:function(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(sM(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(sM(this._element,this._endStyles),this._endStyles=null),oM(this._element,this._initialStyles),this._state=3)}}]),e}();return e.initialStylesByElement=new WeakMap,e}();function mL(e){for(var t=null,n=Object.keys(e),r=0;r<n.length;r++){var a=n[r];gL(a)&&((t=t||{})[a]=e[a])}return t}function gL(e){return"display"===e||"position"===e}var yL=function(){function e(t,n,r,a,i,o,s){var u=this;_classCallCheck(this,e),this._element=t,this._name=n,this._duration=r,this._delay=a,this._easing=i,this._fillMode=o,this._onDoneFn=s,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=function(e){return u._handleCallback(e)}}return _createClass(e,[{key:"apply",value:function(){var e,t,n;e=this._element,t="".concat(this._duration,"ms ").concat(this._easing," ").concat(this._delay,"ms 1 normal ").concat(this._fillMode," ").concat(this._name),(n=CL(e,"").trim()).length&&(function(e,t){for(var n=0;n<e.length;n++)e.charAt(n)}(n),t="".concat(n,", ").concat(t)),xL(e,"",t),wL(this._element,this._eventFn,!1),this._startTime=Date.now()}},{key:"pause",value:function(){bL(this._element,this._name,"paused")}},{key:"resume",value:function(){bL(this._element,this._name,"running")}},{key:"setPosition",value:function(e){var t=kL(this._element,this._name);this._position=e*this._duration,xL(this._element,"Delay","-".concat(this._position,"ms"),t)}},{key:"getPosition",value:function(){return this._position}},{key:"_handleCallback",value:function(e){var t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}},{key:"finish",value:function(){this._finished||(this._finished=!0,this._onDoneFn(),wL(this._element,this._eventFn,!0))}},{key:"destroy",value:function(){var e,t,n,r;this._destroyed||(this._destroyed=!0,this.finish(),e=this._element,t=this._name,n=CL(e,"").split(","),(r=_L(n,t))>=0&&(n.splice(r,1),xL(e,"",n.join(","))))}}]),e}();function bL(e,t,n){xL(e,"PlayState",n,kL(e,t))}function kL(e,t){var n=CL(e,"");return n.indexOf(",")>0?_L(n.split(","),t):_L([n],t)}function _L(e,t){for(var n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function wL(e,t,n){n?e.removeEventListener("animationend",t):e.addEventListener("animationend",t)}function xL(e,t,n,r){var a="animation"+t;if(null!=r){var i=e.style[a];if(i.length){var o=i.split(",");o[r]=n,n=o.join(",")}}e.style[a]=n}function CL(e,t){return e.style["animation"+t]}var SL=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck(this,e),this.element=t,this.keyframes=n,this.animationName=r,this._duration=a,this._delay=i,this._finalStyles=s,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this.currentSnapshot={},this._state=0,this.easing=o||"linear",this.totalTime=a+i,this._buildStyler()}return _createClass(e,[{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"destroy",value:function(){this.init(),this._state>=4||(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"_flushDoneFns",value:function(){this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[]}},{key:"_flushStartFns",value:function(){this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[]}},{key:"finish",value:function(){this.init(),this._state>=3||(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}},{key:"setPosition",value:function(e){this._styler.setPosition(e)}},{key:"getPosition",value:function(){return this._styler.getPosition()}},{key:"hasStarted",value:function(){return this._state>=2}},{key:"init",value:function(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}},{key:"play",value:function(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}},{key:"pause",value:function(){this.init(),this._styler.pause()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"reset",value:function(){this._styler.destroy(),this._buildStyler(),this._styler.apply()}},{key:"_buildStyler",value:function(){var e=this;this._styler=new yL(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",(function(){return e.finish()}))}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}},{key:"beforeDestroy",value:function(){var e=this;this.init();var t={};if(this.hasStarted()){var n=this._state>=3;Object.keys(this._finalStyles).forEach((function(r){"offset"!=r&&(t[r]=n?e._finalStyles[r]:yM(e.element,r))}))}this.currentSnapshot=t}}]),e}(),TL=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this)).element=e,a._startingStyles={},a.__initialized=!1,a._styles=YF(r),a}return _createClass(n,[{key:"init",value:function(){var e=this;!this.__initialized&&this._startingStyles&&(this.__initialized=!0,Object.keys(this._styles).forEach((function(t){e._startingStyles[t]=e.element.style[t]})),_get(_getPrototypeOf(n.prototype),"init",this).call(this))}},{key:"play",value:function(){var e=this;this._startingStyles&&(this.init(),Object.keys(this._styles).forEach((function(t){return e.element.style.setProperty(t,e._styles[t])})),_get(_getPrototypeOf(n.prototype),"play",this).call(this))}},{key:"destroy",value:function(){var e=this;this._startingStyles&&(Object.keys(this._startingStyles).forEach((function(t){var n=e._startingStyles[t];n?e.element.style.setProperty(t,n):e.element.style.removeProperty(t)})),this._startingStyles=null,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this))}}]),n}(IF),EL=function(){function e(){_classCallCheck(this,e),this._count=0,this._head=document.querySelector("head"),this._warningIssued=!1}return _createClass(e,[{key:"validateStyleProperty",value:function(e){return qF(e)}},{key:"matchesElement",value:function(e,t){return GF(e,t)}},{key:"containsElement",value:function(e,t){return KF(e,t)}},{key:"query",value:function(e,t,n){return XF(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"buildKeyframeElement",value:function(e,t,n){n=n.map((function(e){return YF(e)}));var r="@keyframes ".concat(t," {\n"),a="";n.forEach((function(e){a=" ";var t=parseFloat(e.offset);r+="".concat(a).concat(100*t,"% {\n"),a+=" ",Object.keys(e).forEach((function(t){var n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+="".concat(a,"animation-timing-function: ").concat(n,";\n")));default:return void(r+="".concat(a).concat(t,": ").concat(n,";\n"))}})),r+="".concat(a,"}\n")})),r+="}\n";var i=document.createElement("style");return i.innerHTML=r,i}},{key:"animate",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;o&&this._notifyFaultyScrubber();var s=i.filter((function(e){return e instanceof SL})),u={};vM(n,r)&&s.forEach((function(e){var t=e.currentSnapshot;Object.keys(t).forEach((function(e){return u[e]=t[e]}))}));var c=function(e){var t={};return e&&(Array.isArray(e)?e:[e]).forEach((function(e){Object.keys(e).forEach((function(n){"offset"!=n&&"easing"!=n&&(t[n]=e[n])}))})),t}(t=mM(e,t,u));if(0==n)return new TL(e,c);var l="gen_css_kf_".concat(this._count++),h=this.buildKeyframeElement(e,l,t);document.querySelector("head").appendChild(h);var f=pL(e,t),d=new SL(e,t,l,n,r,a,c,f);return d.onDestroy((function(){var e;(e=h).parentNode.removeChild(e)})),d}},{key:"_notifyFaultyScrubber",value:function(){this._warningIssued||(console.warn("@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\n","  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill."),this._warningIssued=!0)}}]),e}(),AL=function(){function e(t,n,r,a){_classCallCheck(this,e),this.element=t,this.keyframes=n,this.options=r,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}return _createClass(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"init",value:function(){this._buildPlayer(),this._preparePlayerBeforeStart()}},{key:"_buildPlayer",value:function(){var e=this;if(!this._initialized){this._initialized=!0;var t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",(function(){return e._onFinish()}))}}},{key:"_preparePlayerBeforeStart",value:function(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}},{key:"_triggerWebAnimation",value:function(e,t,n){return e.animate(t,n)}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"play",value:function(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}},{key:"pause",value:function(){this.init(),this.domPlayer.pause()}},{key:"finish",value:function(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}},{key:"reset",value:function(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"_resetDomPlayerState",value:function(){this.domPlayer&&this.domPlayer.cancel()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"hasStarted",value:function(){return this._started}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"setPosition",value:function(e){this.domPlayer.currentTime=e*this.time}},{key:"getPosition",value:function(){return this.domPlayer.currentTime/this.time}},{key:"beforeDestroy",value:function(){var e=this,t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach((function(n){"offset"!=n&&(t[n]=e._finished?e._finalKeyframe[n]:yM(e.element,n))})),this.currentSnapshot=t}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}},{key:"totalTime",get:function(){return this._delay+this._duration}}]),e}(),IL=function(){function e(){_classCallCheck(this,e),this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(RL().toString()),this._cssKeyframesDriver=new EL}return _createClass(e,[{key:"validateStyleProperty",value:function(e){return qF(e)}},{key:"matchesElement",value:function(e,t){return GF(e,t)}},{key:"containsElement",value:function(e,t){return KF(e,t)}},{key:"query",value:function(e,t,n){return XF(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"overrideWebAnimationsSupport",value:function(e){this._isNativeImpl=e}},{key:"animate",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,a,i);var s={duration:n,delay:r,fill:0==r?"both":"forwards"};a&&(s.easing=a);var u={},c=i.filter((function(e){return e instanceof AL}));vM(n,r)&&c.forEach((function(e){var t=e.currentSnapshot;Object.keys(t).forEach((function(e){return u[e]=t[e]}))}));var l=pL(e,t=mM(e,t=t.map((function(e){return rM(e,!1)})),u));return new AL(e,t,s,l)}}]),e}();function RL(){return"undefined"!=typeof window&&void 0!==window.document&&Element.prototype.animate||{}}var NL,OL=((NL=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this))._nextAnimationId=0,a._renderer=e.createRenderer(r.body,{id:"0",encapsulation:jt.None,styles:[],data:{animation:[]}}),a}return _createClass(n,[{key:"build",value:function(e){var t=this._nextAnimationId.toString();this._nextAnimationId++;var n=Array.isArray(e)?TF(e):e;return ML(this._renderer,null,t,"register",[n]),new DL(t,this._renderer)}}]),n}(SF)).\u0275fac=function(e){return new(e||NL)(It(ks),It(kc))},NL.\u0275prov=Ge({token:NL,factory:NL.\u0275fac}),NL),DL=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck(this,n),(a=t.call(this))._id=e,a._renderer=r,a}return _createClass(n,[{key:"create",value:function(e,t){return new FL(this._id,e,t||{},this._renderer)}}]),n}(function(){return function e(){_classCallCheck(this,e)}}()),FL=function(){function e(t,n,r,a){_classCallCheck(this,e),this.id=t,this.element=n,this._renderer=a,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}return _createClass(e,[{key:"_listen",value:function(e,t){return this._renderer.listen(this.element,"@@".concat(this.id,":").concat(e),t)}},{key:"_command",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return ML(this._renderer,this.element,this.id,e,n)}},{key:"onDone",value:function(e){this._listen("done",e)}},{key:"onStart",value:function(e){this._listen("start",e)}},{key:"onDestroy",value:function(e){this._listen("destroy",e)}},{key:"init",value:function(){this._command("init")}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this._command("play"),this._started=!0}},{key:"pause",value:function(){this._command("pause")}},{key:"restart",value:function(){this._command("restart")}},{key:"finish",value:function(){this._command("finish")}},{key:"destroy",value:function(){this._command("destroy")}},{key:"reset",value:function(){this._command("reset")}},{key:"setPosition",value:function(e){this._command("setPosition",e)}},{key:"getPosition",value:function(){return 0}}]),e}();function ML(e,t,n,r,a){return e.setProperty(t,"@@".concat(n,":").concat(r),a)}var LL,PL,zL,BL,UL=((LL=function(){function e(t,n,r){_classCallCheck(this,e),this.delegate=t,this.engine=n,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),n.onRemovalComplete=function(e,t){t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}return _createClass(e,[{key:"createRenderer",value:function(e,t){var n=this,r=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){var a=this._rendererCache.get(r);return a||(a=new WL("",r,this.engine),this._rendererCache.set(r,a)),a}var i=t.id,o=t.id+"-"+this._currentId;return this._currentId++,this.engine.register(o,e),t.data.animation.forEach((function t(r){Array.isArray(r)?r.forEach(t):n.engine.registerTrigger(i,o,e,r.name,r)})),new VL(this,o,r,this.engine)}},{key:"begin",value:function(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}},{key:"_scheduleCountTask",value:function(){var e=this;this.promise.then((function(){e._microtaskId++}))}},{key:"scheduleListenerCallback",value:function(e,t,n){var r=this;e>=0&&e<this._microtaskId?this._zone.run((function(){return t(n)})):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then((function(){r._zone.run((function(){r._animationCallbacksBuffer.forEach((function(e){var t=_slicedToArray(e,2);(0,t[0])(t[1])})),r._animationCallbacksBuffer=[]}))})),this._animationCallbacksBuffer.push([t,n]))}},{key:"end",value:function(){var e=this;this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular((function(){e._scheduleCountTask(),e.engine.flush(e._microtaskId)})),this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.engine.whenRenderingDone()}}]),e}()).\u0275fac=function(e){return new(e||LL)(It(ks),It(dL),It(Wu))},LL.\u0275prov=Ge({token:LL,factory:LL.\u0275fac}),LL),WL=function(){function e(t,n,r){_classCallCheck(this,e),this.namespaceId=t,this.delegate=n,this.engine=r,this.destroyNode=this.delegate.destroyNode?function(e){return n.destroyNode(e)}:null}return _createClass(e,[{key:"destroy",value:function(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}},{key:"createElement",value:function(e,t){return this.delegate.createElement(e,t)}},{key:"createComment",value:function(e){return this.delegate.createComment(e)}},{key:"createText",value:function(e){return this.delegate.createText(e)}},{key:"appendChild",value:function(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}},{key:"insertBefore",value:function(e,t,n){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,!0)}},{key:"removeChild",value:function(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}},{key:"selectRootElement",value:function(e,t){return this.delegate.selectRootElement(e,t)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setAttribute",value:function(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)&&"@.disabled"==t?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}},{key:"setValue",value:function(e,t){this.delegate.setValue(e,t)}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"disableAnimations",value:function(e,t){this.engine.disableAnimations(e,t)}},{key:"data",get:function(){return this.delegate.data}}]),e}(),VL=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck(this,n),(o=t.call(this,r,a,i)).factory=e,o.namespaceId=r,o}return _createClass(n,[{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&"@.disabled"==t?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){var r,a,i=this;if("@"==t.charAt(0)){var o,s=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e),u=t.substr(1),c="";return"@"!=u.charAt(0)&&(a=(r=u).indexOf("."),u=(o=_slicedToArray([r.substring(0,a),r.substr(a+1)],2))[0],c=o[1]),this.engine.listen(this.namespaceId,s,u,c,(function(e){i.factory.scheduleListenerCallback(e._data||-1,n,e)}))}return this.delegate.listen(e,t,n)}}]),n}(WL),jL=((PL=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){return _classCallCheck(this,n),t.call(this,e.body,r,a)}return n}(dL)).\u0275fac=function(e){return new(e||PL)(It(kc),It($F),It(UM))},PL.\u0275prov=Ge({token:PL,factory:PL.\u0275fac}),PL),HL=new kt("AnimationModuleType"),qL=[{provide:$F,useFactory:function(){return"function"==typeof RL()?new IL:new EL}},{provide:HL,useValue:"BrowserAnimations"},{provide:SF,useClass:OL},{provide:UM,useFactory:function(){return new WM}},{provide:dL,useClass:jL},{provide:ks,useFactory:function(e,t,n){return new UL(e,t,n)},deps:[Al,dL,Wu]}],GL=((zL=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:zL}),zL.\u0275inj=Ke({factory:function(e){return new(e||zL)},providers:qL,imports:[Vl]}),zL),KL=new Ss("9.2.4"),XL=new kt("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}}),YL=((BL=function(){function e(t,n,r){_classCallCheck(this,e),this._hasDoneGlobalChecks=!1,this._document=r,t._applyBodyHighContrastModeCssClasses(),this._sanityChecks=n,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}return _createClass(e,[{key:"_getDocument",value:function(){var e=this._document||document;return"object"==typeof e&&e?e:null}},{key:"_getWindow",value:function(){var e=this._getDocument(),t=(null==e?void 0:e.defaultView)||window;return"object"==typeof t&&t?t:null}},{key:"_checksAreEnabled",value:function(){return Kr()&&!this._isTestEnv()}},{key:"_isTestEnv",value:function(){var e=this._getWindow();return e&&(e.__karma__||e.jasmine)}},{key:"_checkDoctypeIsDefined",value:function(){var e=this._checksAreEnabled()&&(!0===this._sanityChecks||this._sanityChecks.doctype),t=this._getDocument();e&&t&&!t.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}},{key:"_checkThemeIsPresent",value:function(){var e=!this._checksAreEnabled()||!1===this._sanityChecks||!this._sanityChecks.theme,t=this._getDocument();if(!e&&t&&t.body&&"function"==typeof getComputedStyle){var n=t.createElement("div");n.classList.add("mat-theme-loaded-marker"),t.body.appendChild(n);var r=getComputedStyle(n);r&&"none"!==r.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),t.body.removeChild(n)}}},{key:"_checkCdkVersionMatch",value:function(){this._checksAreEnabled()&&(!0===this._sanityChecks||this._sanityChecks.version)&&KL.full!==CF.full&&console.warn("The Angular Material version ("+KL.full+") does not match the Angular CDK version ("+CF.full+").\nPlease ensure the versions of these two packages exactly match.")}}]),e}()).\u0275mod=Zt({type:BL}),BL.\u0275inj=Ke({factory:function(e){return new(e||BL)(It(wF),It(XL,8),It(kc,8))},imports:[[xF],xF]}),BL);function QL(e,t){return function(e){_inherits(r,e);var n=_createSuper(r);function r(){var e;_classCallCheck(this,r);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).color=t,e}return _createClass(r,[{key:"color",get:function(){return this._color},set:function(e){var n=e||t;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove("mat-".concat(this._color)),n&&this._elementRef.nativeElement.classList.add("mat-".concat(n)),this._color=n)}}]),r}(e)}try{"undefined"!=typeof Intl}catch(iz){!1}var ZL,$L,JL,eP,tP=function(){function e(t,n,r){_classCallCheck(this,e),this._renderer=t,this.element=n,this.config=r,this.state=3}return _createClass(e,[{key:"fadeOut",value:function(){this._renderer.fadeOutRipple(this)}}]),e}(),nP={enterDuration:450,exitDuration:400},rP=dF({passive:!0}),aP=["mousedown","touchstart"],iP=["mouseup","mouseleave","touchend","touchcancel"],oP=function(){function e(t,n,r,a){_classCallCheck(this,e),this._target=t,this._ngZone=n,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,a.isBrowser&&(this._containerElement=oF(r))}return _createClass(e,[{key:"fadeInRipple",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=Object.assign(Object.assign({},nP),r.animation);r.centered&&(e=a.left+a.width/2,t=a.top+a.height/2);var o=r.radius||function(e,t,n){var r=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),a=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(r*r+a*a)}(e,t,a),s=e-a.left,u=t-a.top,c=i.enterDuration,l=document.createElement("div");l.classList.add("mat-ripple-element"),l.style.left="".concat(s-o,"px"),l.style.top="".concat(u-o,"px"),l.style.height="".concat(2*o,"px"),l.style.width="".concat(2*o,"px"),null!=r.color&&(l.style.backgroundColor=r.color),l.style.transitionDuration="".concat(c,"ms"),this._containerElement.appendChild(l),window.getComputedStyle(l).getPropertyValue("opacity"),l.style.transform="scale(1)";var h=new tP(this,l,r);return h.state=0,this._activeRipples.add(h),r.persistent||(this._mostRecentTransientRipple=h),this._runTimeoutOutsideZone((function(){var e=h===n._mostRecentTransientRipple;h.state=1,r.persistent||e&&n._isPointerDown||h.fadeOut()}),c),h}},{key:"fadeOutRipple",value:function(e){var t=this._activeRipples.delete(e);if(e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),t){var n=e.element,r=Object.assign(Object.assign({},nP),e.config.animation);n.style.transitionDuration="".concat(r.exitDuration,"ms"),n.style.opacity="0",e.state=2,this._runTimeoutOutsideZone((function(){e.state=3,n.parentNode.removeChild(n)}),r.exitDuration)}}},{key:"fadeOutAll",value:function(){this._activeRipples.forEach((function(e){return e.fadeOut()}))}},{key:"setupTriggerEvents",value:function(e){var t=oF(e);t&&t!==this._triggerElement&&(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(aP))}},{key:"handleEvent",value:function(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(iP),this._pointerUpEventsRegistered=!0)}},{key:"_onMousedown",value:function(e){var t=pF(e),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;this._target.rippleDisabled||t||n||(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}},{key:"_onTouchStart",value:function(e){if(!this._target.rippleDisabled){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;for(var t=e.changedTouches,n=0;n<t.length;n++)this.fadeInRipple(t[n].clientX,t[n].clientY,this._target.rippleConfig)}}},{key:"_onPointerUp",value:function(){this._isPointerDown&&(this._isPointerDown=!1,this._activeRipples.forEach((function(e){!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()})))}},{key:"_runTimeoutOutsideZone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._ngZone.runOutsideAngular((function(){return setTimeout(e,t)}))}},{key:"_registerEvents",value:function(e){var t=this;this._ngZone.runOutsideAngular((function(){e.forEach((function(e){t._triggerElement.addEventListener(e,t,rP)}))}))}},{key:"_removeTriggerEvents",value:function(){var e=this;this._triggerElement&&(aP.forEach((function(t){e._triggerElement.removeEventListener(t,e,rP)})),this._pointerUpEventsRegistered&&iP.forEach((function(t){e._triggerElement.removeEventListener(t,e,rP)})))}}]),e}(),sP=new kt("mat-ripple-global-options"),uP=(($L=function(){function e(t,n,r,a,i){_classCallCheck(this,e),this._elementRef=t,this._animationMode=i,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=a||{},this._rippleRenderer=new oP(this,n,t,r)}return _createClass(e,[{key:"ngOnInit",value:function(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}},{key:"ngOnDestroy",value:function(){this._rippleRenderer._removeTriggerEvents()}},{key:"fadeOutAll",value:function(){this._rippleRenderer.fadeOutAll()}},{key:"_setupTriggerEventsIfEnabled",value:function(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}},{key:"launch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,t,Object.assign(Object.assign({},this.rippleConfig),n)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),e))}},{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=e,this._setupTriggerEventsIfEnabled()}},{key:"trigger",get:function(){return this._trigger||this._elementRef.nativeElement},set:function(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}},{key:"rippleConfig",get:function(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}},{key:"rippleDisabled",get:function(){return this.disabled||!!this._globalOptions.disabled}}]),e}()).\u0275fac=function(e){return new(e||$L)(Fo(ys),Fo(Wu),Fo(hF),Fo(sP,8),Fo(HL,8))},$L.\u0275dir=Jt({type:$L,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,t){2&e&&$o("mat-ripple-unbounded",t.unbounded)},inputs:{radius:["matRippleRadius","radius"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"],color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],animation:["matRippleAnimation","animation"]},exportAs:["matRipple"]}),$L),cP=((ZL=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:ZL}),ZL.\u0275inj=Ke({factory:function(e){return new(e||ZL)},imports:[[YL,fF],YL]}),ZL),lP=["mat-button",""],hP=["*"],fP=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],dP=QL(function(e){return function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._disabled=!1,e}return _createClass(n,[{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=iF(e)}}]),n}(e)}(function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._disableRipple=!1,e}return _createClass(n,[{key:"disableRipple",get:function(){return this._disableRipple},set:function(e){this._disableRipple=iF(e)}}]),n}((function e(t){_classCallCheck(this,e),this._elementRef=t})))),pP=((eP=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;_classCallCheck(this,n),(i=t.call(this,e))._focusMonitor=r,i._animationMode=a,i.isRoundButton=i._hasHostAttributes("mat-fab","mat-mini-fab"),i.isIconButton=i._hasHostAttributes("mat-icon-button");var o,s=_createForOfIteratorHelper(fP);try{for(s.s();!(o=s.n()).done;){var u=o.value;i._hasHostAttributes(u)&&i._getHostElement().classList.add(u)}}catch(az){s.e(az)}finally{s.f()}return e.nativeElement.classList.add("mat-button-base"),i._focusMonitor.monitor(i._elementRef,!0),i.isRoundButton&&(i.color="accent"),i}return _createClass(n,[{key:"ngOnDestroy",value:function(){this._focusMonitor.stopMonitoring(this._elementRef)}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program",t=arguments.length>1?arguments[1]:void 0;this._focusMonitor.focusVia(this._getHostElement(),e,t)}},{key:"_getHostElement",value:function(){return this._elementRef.nativeElement}},{key:"_isRippleDisabled",value:function(){return this.disableRipple||this.disabled}},{key:"_hasHostAttributes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.some((function(t){return e._getHostElement().hasAttribute(t)}))}}]),n}(dP)).\u0275fac=function(e){return new(e||eP)(Fo(ys),Fo(yF),Fo(HL,8))},eP.\u0275cmp=Kt({type:eP,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(e,t){var n,r,a,i;1&e&&(i=uP,function(e,t,n,r,a,i){e.firstCreatePass&&function(e,t,n){null===e.queries&&(e.queries=new du),e.queries.track(new pu(t,-1))}(e,new fu(n,!0,!1,void 0)),function(e,t){var n=new cu;!function(e,t,n,r){var a=Si(t);a.push(n),e.firstCreatePass&&Ti(e).push(r,a.length-1)}(e,t,n,n.destroy),null===t[19]&&(t[19]=new hu),t[19].queries.push(new lu(n))}(e,t)}(An(),En(),i)),2&e&&function(e){var t=En(),n=An(),r=zn();Bn(r+1);var a=yu(n,r);if(e.dirty&&kn(t)===a.metadata.isStatic){if(null===a.matches)e.reset([]);else{var i=a.crossesNgTemplate?function e(t,n,r,a){var i=t.queries.getByIndex(r),o=i.matches;if(null!==o)for(var s=gu(t,n,i,r),u=0;u<o.length;u+=2){var c=o[u];if(c>0)a.push(s[u/2]);else{for(var l=o[u+1],h=n[-c],f=10;f<h.length;f++){var d=h[f];d[17]===d[3]&&e(d[1],d,l,a)}if(null!==h[9])for(var p=h[9],v=0;v<p.length;v++){var m=p[v];e(m[1],m,l,a)}}}return a}(n,t,r,[]):gu(n,t,a,r);e.reset(i),e.notifyOnChanges()}return!0}return!1}((r=En(),a=zn(),n=r[19].queries[a].queryList))&&(t.ripple=n.first)},hostAttrs:[1,"mat-focus-indicator"],hostVars:3,hostBindings:function(e,t){2&e&&(Do("disabled",t.disabled||null),$o("_mat-animation-noopable","NoopAnimations"===t._animationMode))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[os],attrs:lP,ngContentSelectors:hP,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(e,t){1&e&&(Ko(),Bo(0,"span",0),Xo(1),Uo(),Wo(2,"div",1),Wo(3,"div",2)),2&e&&(Pa(2),$o("mat-button-ripple-round",t.isRoundButton||t.isIconButton),Po("matRippleDisabled",t._isRippleDisabled())("matRippleCentered",t.isIconButton)("matRippleTrigger",t._getHostElement()))},directives:[uP],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled],.mat-flat-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.cdk-high-contrast-active .mat-button-focus-overlay{background-color:#fff}.cdk-high-contrast-black-on-white .mat-button-focus-overlay{background-color:#000}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}\n"],encapsulation:2,changeDetection:0}),eP),vP=((JL=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:JL}),JL.\u0275inj=Ke({factory:function(e){return new(e||JL)},imports:[[cP,YL],YL]}),JL);function mP(e,t){return new ne((function(n){var r=e.length;if(0!==r)for(var a=new Array(r),i=0,o=0,s=function(s){var u=xe(e[s]),c=!1;n.add(u.subscribe({next:function(e){c||(c=!0,o++),a[s]=e},error:function(e){return n.error(e)},complete:function(){++i!==r&&c||(o===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=a[n],e}),{}):a),n.complete())}}))},u=0;u<r;u++)s(u);else n.complete()}))}var gP=function e(){_classCallCheck(this,e)},yP=function(){function e(t){var n=this;_classCallCheck(this,e),this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?function(){n.headers=new Map,t.split("\n").forEach((function(e){var t=e.indexOf(":");if(t>0){var r=e.slice(0,t),a=r.toLowerCase(),i=e.slice(t+1).trim();n.maybeSetNormalizedName(r,a),n.headers.has(a)?n.headers.get(a).push(i):n.headers.set(a,[i])}}))}:function(){n.headers=new Map,Object.keys(t).forEach((function(e){var r=t[e],a=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(n.headers.set(a,r),n.maybeSetNormalizedName(e,a))}))}:this.headers=new Map}return _createClass(e,[{key:"has",value:function(e){return this.init(),this.headers.has(e.toLowerCase())}},{key:"get",value:function(e){this.init();var t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}},{key:"keys",value:function(){return this.init(),Array.from(this.normalizedNames.values())}},{key:"getAll",value:function(e){return this.init(),this.headers.get(e.toLowerCase())||null}},{key:"append",value:function(e,t){return this.clone({name:e,value:t,op:"a"})}},{key:"set",value:function(e,t){return this.clone({name:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({name:e,value:t,op:"d"})}},{key:"maybeSetNormalizedName",value:function(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}},{key:"init",value:function(){var t=this;this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach((function(e){return t.applyUpdate(e)})),this.lazyUpdate=null))}},{key:"copyFrom",value:function(e){var t=this;e.init(),Array.from(e.headers.keys()).forEach((function(n){t.headers.set(n,e.headers.get(n)),t.normalizedNames.set(n,e.normalizedNames.get(n))}))}},{key:"clone",value:function(t){var n=new e;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}},{key:"applyUpdate",value:function(e){var t=e.name.toLowerCase();switch(e.op){case"a":case"s":var n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);var r=("a"===e.op?this.headers.get(t):void 0)||[];r.push.apply(r,_toConsumableArray(n)),this.headers.set(t,r);break;case"d":var a=e.value;if(a){var i=this.headers.get(t);if(!i)return;0===(i=i.filter((function(e){return-1===a.indexOf(e)}))).length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,i)}else this.headers.delete(t),this.normalizedNames.delete(t)}}},{key:"forEach",value:function(e){var t=this;this.init(),Array.from(this.normalizedNames.keys()).forEach((function(n){return e(t.normalizedNames.get(n),t.headers.get(n))}))}}]),e}(),bP=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"encodeKey",value:function(e){return kP(e)}},{key:"encodeValue",value:function(e){return kP(e)}},{key:"decodeKey",value:function(e){return decodeURIComponent(e)}},{key:"decodeValue",value:function(e){return decodeURIComponent(e)}}]),e}();function kP(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var _P=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new bP,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){var n=new Map;return e.length>0&&e.split("&").forEach((function(e){var r=e.indexOf("="),a=_slicedToArray(-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],2),i=a[0],o=a[1],s=n.get(i)||[];s.push(o),n.set(i,s)})),n}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach((function(e){var r=n.fromObject[e];t.map.set(e,Array.isArray(r)?r:[r])}))):this.map=null}return _createClass(e,[{key:"has",value:function(e){return this.init(),this.map.has(e)}},{key:"get",value:function(e){this.init();var t=this.map.get(e);return t?t[0]:null}},{key:"getAll",value:function(e){return this.init(),this.map.get(e)||null}},{key:"keys",value:function(){return this.init(),Array.from(this.map.keys())}},{key:"append",value:function(e,t){return this.clone({param:e,value:t,op:"a"})}},{key:"set",value:function(e,t){return this.clone({param:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({param:e,value:t,op:"d"})}},{key:"toString",value:function(){var e=this;return this.init(),this.keys().map((function(t){var n=e.encoder.encodeKey(t);return e.map.get(t).map((function(t){return n+"="+e.encoder.encodeValue(t)})).join("&")})).filter((function(e){return""!==e})).join("&")}},{key:"clone",value:function(t){var n=new e({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat([t]),n}},{key:"init",value:function(){var e=this;null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach((function(t){return e.map.set(t,e.cloneFrom.map.get(t))})),this.updates.forEach((function(t){switch(t.op){case"a":case"s":var n=("a"===t.op?e.map.get(t.param):void 0)||[];n.push(t.value),e.map.set(t.param,n);break;case"d":if(void 0===t.value){e.map.delete(t.param);break}var r=e.map.get(t.param)||[],a=r.indexOf(t.value);-1!==a&&r.splice(a,1),r.length>0?e.map.set(t.param,r):e.map.delete(t.param)}})),this.cloneFrom=this.updates=null)}}]),e}();function wP(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function xP(e){return"undefined"!=typeof Blob&&e instanceof Blob}function CP(e){return"undefined"!=typeof FormData&&e instanceof FormData}var SP=function(){function e(t,n,r,a){var i;if(_classCallCheck(this,e),this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||a?(this.body=void 0!==r?r:null,i=a):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new yP),this.params){var o=this.params.toString();if(0===o.length)this.urlWithParams=n;else{var s=n.indexOf("?");this.urlWithParams=n+(-1===s?"?":s<n.length-1?"&":"")+o}}else this.params=new _P,this.urlWithParams=n}return _createClass(e,[{key:"serializeBody",value:function(){return null===this.body?null:wP(this.body)||xP(this.body)||CP(this.body)||"string"==typeof this.body?this.body:this.body instanceof _P?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}},{key:"detectContentTypeHeader",value:function(){return null===this.body||CP(this.body)?null:xP(this.body)?this.body.type||null:wP(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof _P?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.method||this.method,r=t.url||this.url,a=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,o=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,s=void 0!==t.reportProgress?t.reportProgress:this.reportProgress,u=t.headers||this.headers,c=t.params||this.params;return void 0!==t.setHeaders&&(u=Object.keys(t.setHeaders).reduce((function(e,n){return e.set(n,t.setHeaders[n])}),u)),t.setParams&&(c=Object.keys(t.setParams).reduce((function(e,n){return e.set(n,t.setParams[n])}),c)),new e(n,r,i,{params:c,headers:u,reportProgress:s,responseType:a,withCredentials:o})}}]),e}(),TP=function(){var e={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return e[e.Sent]="Sent",e[e.UploadProgress]="UploadProgress",e[e.ResponseHeader]="ResponseHeader",e[e.DownloadProgress]="DownloadProgress",e[e.Response]="Response",e[e.User]="User",e}(),EP=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,n),(e=t.call(this,r)).type=TP.Response,e.body=void 0!==r.body?r.body:null,e}return _createClass(n,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new n({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}]),n}(function(){return function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";_classCallCheck(this,e),this.headers=t.headers||new yP,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}());function AP(e,t){return{body:t,headers:e.headers,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}var IP,RP=((IP=function(){function e(t){_classCallCheck(this,e),this.handler=t}return _createClass(e,[{key:"request",value:function(e,t){var n,r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e instanceof SP)n=e;else{var i=void 0;i=a.headers instanceof yP?a.headers:new yP(a.headers);var o=void 0;a.params&&(o=a.params instanceof _P?a.params:new _P({fromObject:a.params})),n=new SP(e,t,void 0!==a.body?a.body:null,{headers:i,params:o,reportProgress:a.reportProgress,responseType:a.responseType||"json",withCredentials:a.withCredentials})}var s=jl(n).pipe(Rh((function(e){return r.handler.handle(e)})));if(e instanceof SP||"events"===a.observe)return s;var u=s.pipe(Jl((function(e){return e instanceof EP})));switch(a.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return u.pipe(be((function(e){if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body})));case"blob":return u.pipe(be((function(e){if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body})));case"text":return u.pipe(be((function(e){if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body})));case"json":default:return u.pipe(be((function(e){return e.body})))}case"response":return u;default:throw new Error("Unreachable: unhandled observe type ".concat(a.observe,"}"))}}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,t)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",e,t)}},{key:"head",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("HEAD",e,t)}},{key:"jsonp",value:function(e,t){return this.request("JSONP",e,{params:(new _P).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}},{key:"options",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("OPTIONS",e,t)}},{key:"patch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PATCH",e,AP(n,t))}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,AP(n,t))}},{key:"put",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",e,AP(n,t))}}]),e}()).\u0275fac=function(e){return new(e||IP)(It(gP))},IP.\u0275prov=Ge({token:IP,factory:IP.\u0275fac}),IP),NP=["*"];function OP(e){return Error('Unable to find icon with the name "'.concat(e,'"'))}function DP(e){return Error("The URL provided to MatIconRegistry was not trusted as a resource URL "+"via Angular's DomSanitizer. Attempted URL was \"".concat(e,'".'))}function FP(e){return Error("The literal provided to MatIconRegistry was not trusted as safe HTML by "+"Angular's DomSanitizer. Attempted literal was \"".concat(e,'".'))}var MP,LP=function e(t,n){_classCallCheck(this,e),this.options=n,t.nodeName?this.svgElement=t:this.url=t},PP=((MP=function(){function e(t,n,r,a){_classCallCheck(this,e),this._httpClient=t,this._sanitizer=n,this._errorHandler=a,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._defaultFontSetClass="material-icons",this._document=r}return _createClass(e,[{key:"addSvgIcon",value:function(e,t,n){return this.addSvgIconInNamespace("",e,t,n)}},{key:"addSvgIconLiteral",value:function(e,t,n){return this.addSvgIconLiteralInNamespace("",e,t,n)}},{key:"addSvgIconInNamespace",value:function(e,t,n,r){return this._addSvgIconConfig(e,t,new LP(n,r))}},{key:"addSvgIconLiteralInNamespace",value:function(e,t,n,r){var a=this._sanitizer.sanitize(va.HTML,n);if(!a)throw FP(n);var i=this._createSvgElementForSingleIcon(a,r);return this._addSvgIconConfig(e,t,new LP(i,r))}},{key:"addSvgIconSet",value:function(e,t){return this.addSvgIconSetInNamespace("",e,t)}},{key:"addSvgIconSetLiteral",value:function(e,t){return this.addSvgIconSetLiteralInNamespace("",e,t)}},{key:"addSvgIconSetInNamespace",value:function(e,t,n){return this._addSvgIconSetConfig(e,new LP(t,n))}},{key:"addSvgIconSetLiteralInNamespace",value:function(e,t,n){var r=this._sanitizer.sanitize(va.HTML,t);if(!r)throw FP(t);var a=this._svgElementFromString(r);return this._addSvgIconSetConfig(e,new LP(a,n))}},{key:"registerFontClassAlias",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this._fontCssClassesByAlias.set(e,t),this}},{key:"classNameForFontAlias",value:function(e){return this._fontCssClassesByAlias.get(e)||e}},{key:"setDefaultFontSetClass",value:function(e){return this._defaultFontSetClass=e,this}},{key:"getDefaultFontSetClass",value:function(){return this._defaultFontSetClass}},{key:"getSvgIconFromUrl",value:function(e){var t=this,n=this._sanitizer.sanitize(va.RESOURCE_URL,e);if(!n)throw DP(e);var r=this._cachedIconsByUrl.get(n);return r?jl(zP(r)):this._loadSvgIconFromConfig(new LP(e)).pipe(Oh((function(e){return t._cachedIconsByUrl.set(n,e)})),be((function(e){return zP(e)})))}},{key:"getNamedSvgIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=BP(t,e),r=this._svgIconConfigs.get(n);if(r)return this._getSvgFromConfig(r);var a,i=this._iconSetConfigs.get(t);return i?this._getSvgFromIconSetConfigs(e,i):(a=OP(n),new ne((function(e){return e.error(a)})))}},{key:"ngOnDestroy",value:function(){this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}},{key:"_getSvgFromConfig",value:function(e){return e.svgElement?jl(zP(e.svgElement)):this._loadSvgIconFromConfig(e).pipe(Oh((function(t){return e.svgElement=t})),be((function(e){return zP(e)})))}},{key:"_getSvgFromIconSetConfigs",value:function(e,t){var n=this,r=this._extractIconWithNameFromAnySet(e,t);return r?jl(r):function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(1===t.length){var r=t[0];if(V(r))return mP(r,null);if(j(r)&&Object.getPrototypeOf(r)===Object.prototype){var a=Object.keys(r);return mP(a.map((function(e){return r[e]})),a)}}if("function"==typeof t[t.length-1]){var i=t.pop();return mP(t=1===t.length&&V(t[0])?t[0]:t,null).pipe(be((function(e){return i.apply(void 0,_toConsumableArray(e))})))}return mP(t,null)}(t.filter((function(e){return!e.svgElement})).map((function(e){return n._loadSvgIconSetFromConfig(e).pipe(ph((function(t){var r="Loading icon set URL: ".concat(n._sanitizer.sanitize(va.RESOURCE_URL,e.url)," failed: ").concat(t.message);return n._errorHandler?n._errorHandler.handleError(new Error(r)):console.error(r),jl(null)})))}))).pipe(be((function(){var r=n._extractIconWithNameFromAnySet(e,t);if(!r)throw OP(e);return r})))}},{key:"_extractIconWithNameFromAnySet",value:function(e,t){for(var n=t.length-1;n>=0;n--){var r=t[n];if(r.svgElement){var a=this._extractSvgIconFromSet(r.svgElement,e,r.options);if(a)return a}}return null}},{key:"_loadSvgIconFromConfig",value:function(e){var t=this;return this._fetchUrl(e.url).pipe(be((function(n){return t._createSvgElementForSingleIcon(n,e.options)})))}},{key:"_loadSvgIconSetFromConfig",value:function(e){var t=this;return e.svgElement?jl(e.svgElement):this._fetchUrl(e.url).pipe(be((function(n){return e.svgElement||(e.svgElement=t._svgElementFromString(n)),e.svgElement})))}},{key:"_createSvgElementForSingleIcon",value:function(e,t){var n=this._svgElementFromString(e);return this._setSvgAttributes(n,t),n}},{key:"_extractSvgIconFromSet",value:function(e,t,n){var r=e.querySelector('[id="'.concat(t,'"]'));if(!r)return null;var a=r.cloneNode(!0);if(a.removeAttribute("id"),"svg"===a.nodeName.toLowerCase())return this._setSvgAttributes(a,n);if("symbol"===a.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(a),n);var i=this._svgElementFromString("<svg></svg>");return i.appendChild(a),this._setSvgAttributes(i,n)}},{key:"_svgElementFromString",value:function(e){var t=this._document.createElement("DIV");t.innerHTML=e;var n=t.querySelector("svg");if(!n)throw Error("<svg> tag not found");return n}},{key:"_toSvgElement",value:function(e){for(var t=this._svgElementFromString("<svg></svg>"),n=e.attributes,r=0;r<n.length;r++){var a=n[r],i=a.name,o=a.value;"id"!==i&&t.setAttribute(i,o)}for(var s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&t.appendChild(e.childNodes[s].cloneNode(!0));return t}},{key:"_setSvgAttributes",value:function(e,t){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),t&&t.viewBox&&e.setAttribute("viewBox",t.viewBox),e}},{key:"_fetchUrl",value:function(e){var t=this;if(!this._httpClient)throw Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.");if(null==e)throw Error('Cannot fetch icon from URL "'.concat(e,'".'));var n=this._sanitizer.sanitize(va.RESOURCE_URL,e);if(!n)throw DP(e);var r=this._inProgressUrlFetches.get(n);if(r)return r;var a=this._httpClient.get(n,{responseType:"text"}).pipe(Mh((function(){return t._inProgressUrlFetches.delete(n)})),Le());return this._inProgressUrlFetches.set(n,a),a}},{key:"_addSvgIconConfig",value:function(e,t,n){return this._svgIconConfigs.set(BP(e,t),n),this}},{key:"_addSvgIconSetConfig",value:function(e,t){var n=this._iconSetConfigs.get(e);return n?n.push(t):this._iconSetConfigs.set(e,[t]),this}}]),e}()).\u0275fac=function(e){return new(e||MP)(It(RP,8),It(zl),It(kc,8),It(Mr,8))},MP.\u0275prov=Ge({factory:function(){return new MP(It(RP,8),It(zl),It(kc,8),It(Mr,8))},token:MP,providedIn:"root"}),MP);function zP(e){return e.cloneNode(!0)}function BP(e,t){return e+":"+t}var UP,WP,VP=QL((function e(t){_classCallCheck(this,e),this._elementRef=t})),jP=new kt("mat-icon-location",{providedIn:"root",factory:function(){var e=Rt(kc),t=e?e.location:null;return{getPathname:function(){return t?t.pathname+t.search:""}}}}),HP=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],qP=HP.map((function(e){return"[".concat(e,"]")})).join(", "),GP=/^url\(['"]?#(.*?)['"]?\)$/,KP=((WP=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck(this,n),(s=t.call(this,e))._iconRegistry=r,s._location=i,s._errorHandler=o,s._inline=!1,s._currentIconFetch=G.EMPTY,a||e.nativeElement.setAttribute("aria-hidden","true"),s}return _createClass(n,[{key:"_splitIconName",value:function(e){if(!e)return["",""];var t=e.split(":");switch(t.length){case 1:return["",t[0]];case 2:return t;default:throw Error('Invalid icon name: "'.concat(e,'"'))}}},{key:"ngOnChanges",value:function(e){var t=this,n=e.svgIcon;if(n)if(this._currentIconFetch.unsubscribe(),this.svgIcon){var r=_slicedToArray(this._splitIconName(this.svgIcon),2),a=r[0],i=r[1];this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(i,a).pipe(gh(1)).subscribe((function(e){return t._setSvgElement(e)}),(function(e){var n="Error retrieving icon ".concat(a,":").concat(i,"! ").concat(e.message);t._errorHandler?t._errorHandler.handleError(new Error(n)):console.error(n)}))}else n.previousValue&&this._clearSvgElement();this._usingFontIcon()&&this._updateFontIconClasses()}},{key:"ngOnInit",value:function(){this._usingFontIcon()&&this._updateFontIconClasses()}},{key:"ngAfterViewChecked",value:function(){var e=this._elementsWithExternalReferences;if(e&&this._location&&e.size){var t=this._location.getPathname();t!==this._previousPath&&(this._previousPath=t,this._prependPathToReferences(t))}}},{key:"ngOnDestroy",value:function(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}},{key:"_usingFontIcon",value:function(){return!this.svgIcon}},{key:"_setSvgElement",value:function(e){this._clearSvgElement();for(var t=e.querySelectorAll("style"),n=0;n<t.length;n++)t[n].textContent+=" ";if(this._location){var r=this._location.getPathname();this._previousPath=r,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(r)}this._elementRef.nativeElement.appendChild(e)}},{key:"_clearSvgElement",value:function(){var e=this._elementRef.nativeElement,t=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();t--;){var n=e.childNodes[t];1===n.nodeType&&"svg"!==n.nodeName.toLowerCase()||e.removeChild(n)}}},{key:"_updateFontIconClasses",value:function(){if(this._usingFontIcon()){var e=this._elementRef.nativeElement,t=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();t!=this._previousFontSetClass&&(this._previousFontSetClass&&e.classList.remove(this._previousFontSetClass),t&&e.classList.add(t),this._previousFontSetClass=t),this.fontIcon!=this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}}},{key:"_cleanupFontValue",value:function(e){return"string"==typeof e?e.trim().split(" ")[0]:e}},{key:"_prependPathToReferences",value:function(e){var t=this._elementsWithExternalReferences;t&&t.forEach((function(t,n){t.forEach((function(t){n.setAttribute(t.name,"url('".concat(e,"#").concat(t.value,"')"))}))}))}},{key:"_cacheChildrenWithExternalReferences",value:function(e){for(var t=e.querySelectorAll(qP),n=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map,r=function(e){HP.forEach((function(r){var a=t[e],i=a.getAttribute(r),o=i?i.match(GP):null;if(o){var s=n.get(a);s||(s=[],n.set(a,s)),s.push({name:r,value:o[1]})}}))},a=0;a<t.length;a++)r(a)}},{key:"inline",get:function(){return this._inline},set:function(e){this._inline=iF(e)}},{key:"fontSet",get:function(){return this._fontSet},set:function(e){this._fontSet=this._cleanupFontValue(e)}},{key:"fontIcon",get:function(){return this._fontIcon},set:function(e){this._fontIcon=this._cleanupFontValue(e)}}]),n}(VP)).\u0275fac=function(e){return new(e||WP)(Fo(ys),Fo(PP),Mo("aria-hidden"),Fo(jP,8),Fo(Mr,8))},WP.\u0275cmp=Kt({type:WP,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:4,hostBindings:function(e,t){2&e&&$o("mat-icon-inline",t.inline)("mat-icon-no-color","primary"!==t.color&&"accent"!==t.color&&"warn"!==t.color)},inputs:{color:"color",inline:"inline",fontSet:"fontSet",fontIcon:"fontIcon",svgIcon:"svgIcon"},exportAs:["matIcon"],features:[os,fs],ngContentSelectors:NP,decls:1,vars:0,template:function(e,t){1&e&&(Ko(),Xo(0))},styles:[".mat-icon{background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}\n"],encapsulation:2,changeDetection:0}),WP),XP=((UP=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:UP}),UP.\u0275inj=Ke({factory:function(e){return new(e||UP)},imports:[[YL],YL]}),UP),YP=function(e){return{color:e}};function QP(e,t){if(1&e&&(Bo(0,"p",11),rs(1),Uo()),2&e){var n=t.$implicit;Po("ngStyle",(2,i=YP,o="user"==n[1]?"red":"black",function(e,t,n,r,a,i){var o=t+2;return Oo(e,o,a)?function(e,t,n){return e[t]=n}(e,o+1,r(a)):function(e,t){var n=e[t];return n===Oa?void 0:n}(e,o+1)}(En(),(r=Sn.lFrame,-1===(a=r.bindingRootIndex)&&(a=r.bindingRootIndex=r.tView.bindingStartIndex),a),0,i,o))),Pa(1),as(" ",n[0]," ")}var r,a,i,o}var ZP,$P=((ZP=function(){function e(){_classCallCheck(this,e),this.inputText="Hey Marco "}return _createClass(e,[{key:"ngOnInit",value:function(){return Np(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==t&&(t={}),function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=s.getLoadHandlers(t,n)).length){e.next=6;break}r.push(s.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new PC("Found more than one (".concat(r.length,") load handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new PC("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,u=null!=a.weightData&&null!=a.weightSpecs&&o,c=KT(yE(i),void 0,u),null!=(l=a.trainingConfig)&&c.loadTrainingConfig(l),null!=a.userDefinedMetadata&&c.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new PC("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(h=function(e,t){var n=s.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}(a.weightData,a.weightSpecs),f=h.modelWeights,d=h.optimizerWeights,c.loadWeights(f,o),e.t0=null!=c.optimizer&&d.length>0,!e.t0){e.next=17;break}return e.next=17,c.optimizer.setWeights(d);case 17:ty(f),ty(d.map((function(e){return e.tensor})));case 19:return e.abrupt("return",c);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(t,0,n));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()("model.json",t);case 2:return this.model=e.sent,e.next=5,aF.getJSON("char2idx.json",(function(e){return e.responseJSON}));case 5:return this.char2idx=e.sent,e.next=8,function(e){return Np(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object.keys(e));case 1:case"end":return t.stop()}}),t)})))}(this.char2idx);case 8:this.idx2char=e.sent;case 9:case"end":return e.stop()}}),e,this)})))}},{key:"reset",value:function(){this.genText=void 0,this.model.resetStates(),this.inputText=""}},{key:"generate",value:function(e){var t,n,r;0!=e.length&&(void 0===this.genText?this.genText=[[e,"user"]]:this.genText.push([e,"user"])),this.inputText="",e=e.length>100?e.slice(e.length-100,e.length):e;for(var a="",i="",o=function(e,t){for(var n=[],r=0;r<t.length-1;r++)n.push(e[t.slice(r,r+1)]);return n}(this.char2idx,e),s=0;s<e.length+100||"."!=i;s++)s<e.length&&(this.inputTensor=rg([o[s]],0)),t=this.model.predict(this.inputTensor),n=(t=ig(t,[0])).dataSync(),r=JP(Array.from(n)),this.inputTensor=rg([r],0),s>=e.length-1&&(i=this.idx2char[r],a=a.concat(i));a=(a=a.replace("\n","\n\n")).replace("  "," "),this.genText.push([a,"ai"])}}]),e}()).\u0275fac=function(e){return new(e||ZP)},ZP.\u0275cmp=Kt({type:ZP,selectors:[["app-text-gen"]],decls:19,vars:2,consts:[[1,"container-fluid"],[1,"row"],[1,"col-2"],[1,"form-group"],["for","nlgInputArea"],["id","nlgInputArea","rows","10",1,"form-control",3,"value"],["meditationInput",""],[1,"col-sm"],["mat-flat-button","","type","button","color","primary",3,"click"],[1,"col","overflow-auto"],["class","lead","style","display:inline;white-space:pre-wrap",3,"ngStyle",4,"ngFor","ngForOf"],[1,"lead",2,"display","inline","white-space","pre-wrap",3,"ngStyle"]],template:function(e,t){if(1&e){var n=En();Wo(0,"br"),Bo(1,"div",0),Bo(2,"div",1),Bo(3,"div",2),Bo(4,"div",3),Bo(5,"label",4),rs(6,"Begin with some words"),Uo(),Wo(7,"textarea",5,6),Uo(),Bo(9,"div",1),Bo(10,"div",7),Bo(11,"button",8),jo("click",(function(){Sn.lFrame.contextLView=n;var e=Sn.lFrame.contextLView[28];return t.generate(e.value)})),rs(12,"Meditate"),Uo(),Uo(),Bo(13,"div",7),Bo(14,"button",8),jo("click",(function(){return t.reset()})),Bo(15,"mat-icon"),rs(16,"refresh"),Uo(),Uo(),Uo(),Uo(),Uo(),Bo(17,"div",9),function(e,t,n,r,a,i,o,s){var u=En(),c=An(),l=c.firstCreatePass?function(e,t,n,r,a,i,o,s,u){var c=t.consts,l=Xa(t,n[6],18,0,"p",wn(c,10));ai(t,n,l,wn(c,void 0)),Qn(t,l);var h=l.tViews=ti(2,-1,r,2,4,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c),f=ni(0,null,2,-1,null,null);return f.injectorIndex=l.injectorIndex,h.node=f,null!==t.queries&&(t.queries.template(t,l),h.queries=t.queries.embeddedTView(l)),l}(0,c,u,t):c.data[38];Rn(l,!1);var h=u[11].createComment("");Hi(c,u,h,l),ya(h,u),bi(u,u[38]=mi(h,u,h,l)),un(l)&&Ja(c,u,l)}(0,QP),Uo(),Uo(),Uo()}2&e&&(Pa(7),Po("value",t.inputText),Pa(11),Po("ngForOf",t.genText))},directives:[pP,KP,nl,al],styles:[""]}),ZP);function JP(e){if(0===e.length)return-1;for(var t=e[0],n=0,r=1;r<e.length;r++)e[r]>t&&(n=r,t=e[r]);return n}var ez,tz,nz=((tz=function e(){_classCallCheck(this,e),this.title="nlg-project"}).\u0275fac=function(e){return new(e||tz)},tz.\u0275cmp=Kt({type:tz,selectors:[["app-root"]],decls:7,vars:0,consts:[[1,"jumbotron"],[1,"display-4"],[1,"lead"],[1,"my-4"]],template:function(e,t){1&e&&(Bo(0,"div",0),Bo(1,"h1",1),rs(2,"Meditations NLG"),Uo(),Bo(3,"p",2),rs(4,"An algorithmic Stoic philosopher."),Uo(),Wo(5,"hr",3),Wo(6,"app-text-gen"),Uo())},directives:[$P],styles:[""]}),tz),rz=((ez=function e(){_classCallCheck(this,e)}).\u0275mod=Zt({type:ez,bootstrap:[nz]}),ez.\u0275inj=Ke({factory:function(e){return new(e||ez)},providers:[],imports:[[Vl,Rp,GL,vP,XP]]}),ez);(function(){if(Gr)throw new Error("Cannot enable prod mode after platform setup.");qr=!1})(),Ul().bootstrapModule(rz).catch((function(e){return console.error(e)}))},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);